{"framerate":60,"highQualityPen":true,"maxClones":9999999999,"fencing":false,"miscLimits":false,"stageWidth":640,"autoplay":true,"loadingScreen":{"text":"test build 2","progressBar":true,"imageMode":"normal","image":null},"controls":{"greenFlag":{"enabled":true},"stopAll":{"enabled":true},"fullscreen":{"enabled":true},"pause":{"enabled":true}},"compiler":{"warpTimer":true,"enabled":true},"target":"electron-win32","app":{"version":"0.1.0","icon":{"__isBlob":true,"type":"image/x-icon","name":"icon.ico","data":"AAABAAEAEBAAAAEAIAC0AAAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAQAAAAEAgGAAAAH/P/YQAAAAhhY1RMAAAAAQAAAAC0LemgAAAAGmZjVEwAAAAAAAAAEAAAABAAAAAAAAAAAAABAAEAAG8TIMQAAABBSURBVHicY2CgIvhPidr/uCTwaMaqlhQDUAQowQz/ff6Th/EagCyOTw3tXDAwBhBjGLp6DBcQirZBGgaUpkSKAABYI0q+B+yCRgAAAABJRU5ErkJggg=="},"packageName":"escape-from-morocco","windowTitle":"Escape From Morocco","windowMode":"window","escapeBehavior":"unfullscreen-only","windowControls":"default"},"chunks":{"gamepad":true,"pointerlock":false},"cloudVariables":{"mode":"local","unsafeCloudBehaviors":true,"cloudHost":"wss://clouddata.turbowarp.org","custom":{"☁ unlockedLevels":"ws","☁ tutorialPassed?":"ws","☁ curLevel":"ws","☁ stat_rateOfFire":"ws","☁ stat_dirhams":"ws","☁ stat_damage":"ws","☁ shopStat_rateOfFire_bought":"ws","☁ shopStat_damage_bought":"ws","☁ stat_playerHealth":"ws","☁ shopStat_projSpeed_bought":"ws","☁ stat_projSpeed":"ws","☁ shopStat_piercing_bought":"ws","☁ shopStat_accuracy_bought":"ws","☁ stat_accuracy":"ws","☁ stat_piercing":"ws"},"specialCloudBehaviors":false},"turbo":false,"interpolation":false,"stageHeight":360,"resizeMode":"preserve-ratio","username":"player####","closeWhenStopped":false,"projectId":"p4-@Escape From Morocco.sb3","custom":{"css":"","js":""},"appearance":{"background":"#000000","foreground":"#ffffff","accent":"#ff4c4c"},"monitors":{"editableLists":false,"variableColor":"#ff8c1a","listColor":"#fc662c"},"packagedRuntime":true,"cursor":{"type":"auto","custom":null,"center":{"x":0,"y":0}},"steamworks":{"appId":"480","onError":"warning"},"extensions":["https://extensions.turbowarp.org/TheShovel/CanvasEffects.js","https://extensions.turbowarp.org/JeremyGamer13/tween.js","data:text/javascript;base64,Ly8gTmFtZTogQmV0dGVyIENvbW1lbnRzCi8vIElEOiBTUGNvbW1lbnRzCi8vIERlc2NyaXB0aW9uOiBCZXR0ZXIgQ29tbWVudHMgd2l0aCBNb3JlIEN1c3RvbWl6YXRpb24KLy8gQnk6IFNoYXJrUG9vbAovLyBMaWNlbnNlOiBNSVQKCi8vIFZlcnNpb24gVi4yLjAuMQoKKGZ1bmN0aW9uIChTY3JhdGNoKSB7CiAgInVzZSBzdHJpY3QiOwogIGlmICghU2NyYXRjaC5leHRlbnNpb25zLnVuc2FuZGJveGVkKSB0aHJvdyBuZXcgRXJyb3IoIkJldHRlciBDb21tZW50cyBBZGRvbiBtdXN0IHJ1biB1bnNhbmRib3hlZCEiKTsKCiAgY29uc3QgbWVudUljb25VUkkgPQoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0k1TUM0eU9UVWlJR2hsYVdkb2REMGlPVEF1TWprMUlpQjJhV1YzUW05NFBTSXdJREFnT1RBdU1qazFJRGt3TGpJNU5TSStQSEJoZEdnZ1pEMGlUVElnTkRVdU1UUTRReklnTWpFdU16RTRJREl4TGpNeE9DQXlJRFExTGpFME9DQXljelF6TGpFME9DQXhPUzR6TVRnZ05ETXVNVFE0SURRekxqRTBPQzB4T1M0ek1UZ2dORE11TVRRNExUUXpMakUwT0NBME15NHhORGhUTWlBMk9DNDVOemdnTWlBME5TNHhORGg2SWlCbWFXeHNQU0lqT1dJNU1qVmtJaUJ6ZEhKdmEyVTlJaU0xWkRVNE16Z2lJSE4wY205clpTMTNhV1IwYUQwaU5DSXZQanh3WVhSb0lHUTlJazB4T1M0ek1TQTJOQzQ1T0RWMkxUTTVZekF0TXk0eE5ESWdNeTR4TmpjdE5pNDFJRFl1TVRjMUxUWXVOV2d6T1M0Mk5XTXpMalUyTlNBd0lEVXVPRFV4SURNdU16VTRJRFV1T0RVeElEWXVOWFl6T1dNd0lETXVOelE1TFRJdU9UYzNJRFl1TVRjMUxUVXVPRFVnTmk0eE56VklNalV1TVRaakxUTXVOVFl5SURBdE5TNDROUzB5TGpReU5pMDFMamcxTFRZdU1UYzFlaUlnWm1sc2JEMGlibTl1WlNJZ2MzUnliMnRsTFc5d1lXTnBkSGs5SWk0MUlpQnpkSEp2YTJVOUlpTXdNREFpSUhOMGNtOXJaUzEzYVdSMGFEMGlOQ0l2UGp4d1lYUm9JR1E5SWsweE9TNHpNU0EyTkM0NU9EVjJMVE01WXpBdE15NHhORElnTXk0eE5qY3ROaTQxSURZdU1UYzFMVFl1Tldnek9TNDJOV016TGpVMk5TQXdJRFV1T0RVeElETXVNelU0SURVdU9EVXhJRFl1TlhZek9XTXdJRE11TnpRNUxUSXVPVGMzSURZdU1UYzFMVFV1T0RVZ05pNHhOelZJTWpVdU1UWmpMVE11TlRZeUlEQXROUzQ0TlMweUxqUXlOaTAxTGpnMUxUWXVNVGMxSWlCbWFXeHNQU0lqWm1abU1EazVJaTgrUEhCaGRHZ2daRDBpVFRFNUxqTXhJRE15TGpJeU9IWXROaTR5TkRSak1DMHpMakUwTVNBekxqRTJOeTAyTGpVZ05pNHhOelV0Tmk0MWFETTVMalkxWXpNdU5UWTFJREFnTlM0NE5URWdNeTR6TlRrZ05TNDROVEVnTmk0MWRqWXVNalEwZWlJZ1ptbHNiRDBpSTJOalltWTNZU0l2UGp4d1lYUm9JR1E5SWsweE9TNHlORFFnTXpJdU1UY3hhRFV4TGpnek0zb2lJR1pwYkd3OUltNXZibVVpSUhOMGNtOXJaUzF2Y0dGamFYUjVQU0l1TlNJZ2MzUnliMnRsUFNJak1EQXdJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqSWlMejQ4WnlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaUxqVWlJSE4wY205clpUMGlJekF3TUNJZ2MzUnliMnRsTFhkcFpIUm9QU0l4TUNJZ2MzUnliMnRsTFd4cGJtVmpZWEE5SW5KdmRXNWtJaUIwY21GdWMyWnZjbTA5SW5SeVlXNXpiR0YwWlNndE1UazBMamcxTWlBdE1UTTBMamcxTWlraUx6NDhjR0YwYUNCa1BTSk5OREV1T0RRNElEVTVMalUwT0hZdE5DNDFhQzAwTGpWakxUSXVNakVnTUMwMExURXVORGMzTFRRdE15NHpjekV1TnprdE15NHpJRFF0TXk0emFEUXVOWFl0TkM0MVl6QXRNaTR5TVNBeExqUTNOeTAwSURNdU15MDBjek11TXlBeExqYzVJRE11TXlBMGRqUXVOV2cwTGpWak1pNHlNU0F3SURRZ01TNDBOemNnTkNBekxqTnpMVEV1TnprZ015NHpMVFFnTXk0emFDMDBMalYyTkM0MVl6QWdNaTR5TVMweExqUTNOeUEwTFRNdU15QTBjeTB6TGpNdE1TNDNPUzB6TGpNdE5Ib2lJR1pwYkd3OUltNXZibVVpSUhOMGNtOXJaUzF2Y0dGamFYUjVQU0l1TlRBeUlpQnpkSEp2YTJVOUlpTXdNREFpSUhOMGNtOXJaUzEzYVdSMGFEMGlOU0l2UGp4d1lYUm9JR1E5SWswME1TNDRORGdnTlRrdU5UUTRkaTAwTGpWb0xUUXVOV010TWk0eU1TQXdMVFF0TVM0ME56Y3ROQzB6TGpOek1TNDNPUzB6TGpNZ05DMHpMak5vTkM0MWRpMDBMalZqTUMweUxqSXhJREV1TkRjM0xUUWdNeTR6TFRSek15NHpJREV1TnprZ015NHpJRFIyTkM0MWFEUXVOV015TGpJeElEQWdOQ0F4TGpRM055QTBJRE11TTNNdE1TNDNPU0F6TGpNdE5DQXpMak5vTFRRdU5YWTBMalZqTUNBeUxqSXhMVEV1TkRjM0lEUXRNeTR6SURSekxUTXVNeTB4TGpjNUxUTXVNeTAwSWlCbWFXeHNQU0lqWm1abUlpOCtQQzl6ZG1jKyI7CgogIGNvbnN0IGNvbG9ySWNvbiA9IAoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlNQ0F5TUNJZ2FHVnBaMmgwUFNJeU1DSWdkMmxrZEdnOUlqSXdJajQ4Y0dGMGFDQmtQU0p0TVRRdU1EUTFJRGt1TmprekxTNHdNVFF0TGpBeE5HTXRMalU1TVMwdU16RTFMVEV1TlRFMExTNDVPRGt0TWk0Mk1TMHlMakEzT0dFeE15QXhNeUF3SURBZ01TMHVPRGM1TFM0NU5EWnNMalV5TFM0Mk5EVmpMak14Tmk0eU5UZ3VOall5TGpVM015QXhMakF5TXk0NU16SXVNak11TWpJNUxqUXhPQzQwTXk0Mk1EVXVOak5oTGpZdU5pQXdJREFnTUNBdU1UTXVNVE5qTGpnd055NDVNVGNnTVM0eU9ETWdNUzQyTmpJZ01TNDBPVGtnTWk0d09USWdNQ0F1TURFMExqQXhOQzR3TWpndU1ERTBMakEwTXkwdU1EZzJMUzR3TkRNdExqRTROeTB1TURnMkxTNHlPRGd0TGpFME5HMHRNeTQwTkRVdU16Y3pZeTB1T0RZMUxqUTNNeTB4TGpZNE55NDVNVGN0TWk0NU9EUXVOakUyTFRFdU5EUXlMUzR6TXkweUxqRXpNeTB1T1RFM0xUSXVOREl5TFRFdU1qWnNNeTR4TVRRdE5DNHdNVFJqTGpJeE5pNDBNeTQxTXpNdU9EYzBMamcyTlNBeExqSTVMUzR6TkRZdU5URTJMUzQyTWk0NU5EWXRMamMxSURFdU1UUTNZUzQxTkM0MU5DQXdJREFnTUNBdU1UZzRMamN6TGpVdU5TQXdJREFnTUNBdU1qY3pMakE0TjJNdU1UZzRJREFnTGpNMkxTNHhMalEyTWkwdU1qVTRMakUxT0MwdU1qY3pMak0wTmkwdU5UWXVOVFE0TFM0NE5EWXVNekF5TGpNME5DNDFOell1TmpFMkxqYzJOQzQ0TURNdU5ERTRMalF4TlM0NE16WXVOemc0SURFdU1qUWdNUzR4TVRndExqUTNOaTR4TWpndExqZzVOQzR6TnpJdE1TNHlPVGd1TlRnM2JTMHVNemt0TkM0M00yTXRMakV4TlM0eE5UZ3RMakkwTkM0ek1UWXRMak0yTGpRMU9TMHVNelEyTFM0ME5Ua3RMalUyTWkwdU9ETXhMUzQyTnpjdE1TNHdPUzR5TkRVdU1UQXhMalU1TGpNeE5pQXhMakF6T0M0Mk16RnRNeTR6TFRFdU1qWXhZeTR4TmlBd0lDNHpNekl1TURJNUxqTTJNUzR4TGpFM015NHpNVFl0TGpJME5TQXhMak14T1MwdU9EQTNJREl1TWpJeWJDMHVNakUyTFM0eU1UVmpMUzR5TXpFdExqSXpMUzQyTWkwdU5UZzRMVEV1TURZM0xTNDVOelV1TmpZekxTNDJOek1nTVM0eU5qZ3RNUzR4TXpJZ01TNDNNeTB4TGpFek1tMHpMakEwTVNBNExqQTROR0UwTGpjZ05DNDNJREFnTUNBd0xTNDVOalV0TVM0ME9TNDRMamdnTUNBd0lEQXRMakUyTFM0eE5EUmpMakkwTmkwdU5UTXRMakUxT0MweExqSTVMUzQxTURRdE1TNDRNelZoTVRBdU5pQXhNQzQySURBZ01DQXdMVEV1TURrMUxURXVORFEzWXk0MU5qSXRMamcySURFdU5USTRMVEl1TlRZMklERXVNREE1TFRNdU5UY3RMakUxT1MwdU15MHVOVEU1TFM0Mk56TXRNUzR6TWpZdExqWTNNMmd0TGpBeE5XTXRMamd5TVNBd0xURXVOek11TmpZdE1pNDFOVEVnTVM0MU1pMHVPVEl6TFM0Mk56UXRNUzQ1TXpJdE1TNHlNRFV0TWk0MU16Y3RMamcyTFM0d05UZ3VNREk0TFM0eE15NHdOVGN0TGpFM015NHhNVFF0TGpBeE5TNHdNVFF0TGpBME15NHdNamt0TGpBMU9DNHdOVGRoTGpJdU1pQXdJREFnTUMwdU1EUXpMakExT0d3dExqQXhOUzR3TWpoTU5DNHhNamdnT1M0d05XTXRMakF4TlNBd0xTNHdNVFVnTUMwdU1ETXVNREUwYkMwdU9Ea3pJREV1TVRZdExqQTBNeTR3TkRSaExqUXVOQ0F3SURBZ01DMHVNRGczTGpFME0zWXVNREUwWXkwdU5EUTNMamt4T0NBeExqSXhNU0F5TGpjeElERXVPVGtnTXk0ME9UZ3VOamt4TGpZNE9DQXlMakl5SURJdU1EYzRJRE11TVRjZ01pNHdOemhoTGpjdU55QXdJREFnTUNBdU5UQTFMUzR4T0Rac05TNDFNakV0TkM0eU5UZGpMakF6TFM0d01UVXVNRFEwTFM0d05ETXVNRGN5TFM0d056SXVNRE11TURJNUxqQTBOQzR3TnpJdU1EVTRMakV1TVRjekxqTTBOQzR5T0RndU56QXpMak13TXlBeExqQTVZVFF1TmlBMExqWWdNQ0F3SURFdExqQTBNeUF4TGpFM05YWXVNREUwWVRFdU15QXhMak1nTUNBd0lEQWdNQ0F1TXpNZ01TNHhPREVnTVM0eE9ERWdNQ0F3SURBZ01pNHpNelV0TGpNMU9HTXRMakE0TnkwdU5UWXRMakl3TWkweExqRXpNeTB1TkRNekxURXVOamMzSWlCbWFXeHNQU0lqTlRjMVJUYzFJaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpTHo0OEwzTjJaejQ9IjsKICBjb25zdCBmb250SWNvbiA9CiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXpNaTR4TnpRaUlHaGxhV2RvZEQwaU16SXVOalkySWlCMmFXVjNRbTk0UFNJd0lEQWdNekl1TVRjMElETXlMalkyTmlJK1BIUmxlSFFnZEhKaGJuTm1iM0p0UFNKMGNtRnVjMnhoZEdVb05DNHhNaklnTVRRdU1qSXBjMk5oYkdVb0xqTXlOamM0S1NJZ1ptOXVkQzF6YVhwbFBTSTBNQ0lnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJZ1ptbHNiRDBpSXpVM05XVTNOU0lnYzNSeWIydGxQU0lqTlRjMVpUYzFJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqRXVOU0lnWm05dWRDMW1ZVzFwYkhrOUlsTmhibk1nVTJWeWFXWWlJR1p2Ym5RdGQyVnBaMmgwUFNJME1EQWlQangwYzNCaGJpQjRQU0l3SWlCa2VUMGlNQ0krUVR3dmRITndZVzQrUEM5MFpYaDBQangwWlhoMElIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLREV6TGpFeU1pQXlNQzQzTWlselkyRnNaU2d1TWpnek5EZ3BJaUJtYjI1MExYTnBlbVU5SWpRMUlpQjRiV3c2YzNCaFkyVTlJbkJ5WlhObGNuWmxJaUJtYVd4c1BTSWpOVGMxWlRjMUlpQnpkSEp2YTJVOUlpTTFOelZsTnpVaUlITjBjbTlyWlMxM2FXUjBhRDBpTVM0MElpQm1iMjUwTFdaaGJXbHNlVDBpUTI5dGFXTWdVMkZ1Y3lCTmN5SWdabTl1ZEMxM1pXbG5hSFE5SWpRd01DSStQSFJ6Y0dGdUlIZzlJakFpSUdSNVBTSXdJajVDUEM5MGMzQmhiajQ4TDNSbGVIUStQSFJsZUhRZ2RISmhibk5tYjNKdFBTSjBjbUZ1YzJ4aGRHVW9NVGt1TmpJeUlESTNMamN5S1hOallXeGxLQzR6TWpFNE15a2lJR1p2Ym5RdGMybDZaVDBpTkRBaUlIaHRiRHB6Y0dGalpUMGljSEpsYzJWeWRtVWlJR1pwYkd3OUlpTTFOelZsTnpVaUlITjBjbTlyWlQwaUl6VTNOV1UzTlNJZ2MzUnliMnRsTFhkcFpIUm9QU0l4TGpVaUlHWnZiblF0Wm1GdGFXeDVQU0pCY21saGJDSWdabTl1ZEMxM1pXbG5hSFE5SWpRd01DSStQSFJ6Y0dGdUlIZzlJakFpSUdSNVBTSXdJajVEUEM5MGMzQmhiajQ4TDNSbGVIUStQSEJoZEdnZ1pEMGlUVEFnTXpJdU5qWTJWaTQwT1RKb016SXVNVGMwZGpNeUxqRTNOSG9pSUdacGJHdzlJbTV2Ym1VaUx6NDhMM04yWno0PSI7CgogIGNvbnN0IHZtID0gU2NyYXRjaC52bTsKICBjb25zdCBydW50aW1lID0gdm0ucnVudGltZTsKCiAgY29uc3QgaXNQTSA9IFNjcmF0Y2guZXh0ZW5zaW9ucy5pc1Blbmd1aW5Nb2Q7CiAgY29uc3QgbWFya2Rvd25Db25zdHMgPSB7CiAgICAiKioiOiAiYiIsICIqLyI6ICJpIiwgIn5+IjogInMiLCAiIzEiOiAiaDEiLCAiIzIiOiAiaDIiLAogICAgIkBjIjogYHNwYW4gc3R5bGU9ImNvbG9yOiAtLS0iYCwgIkBoIjogYHNwYW4gc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IC0tLSJgLCAiQGYiOiBgc3BhbiBzdHlsZT0iZm9udC1mYW1pbHk6IC0tLSJgLAogICAgIjxpIjogImltZyIsICI8YSI6ICJhdWRpbyIsICI8diI6ICJ2aWRlbyIsCiAgfTsKICBsZXQgY29tbWVudFN0b3JlID0ge307CgogIC8vIHV0aWxzCiAgY29uc3QgeG1sRXNjYXBlID0gZnVuY3Rpb24gKHVuc2FmZSkgewogICAgcmV0dXJuIFNjcmF0Y2guQ2FzdC50b1N0cmluZyh1bnNhZmUpLnJlcGxhY2UoL1smJyJdL2csIGMgPT4gewogICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICBjYXNlICImIjogcmV0dXJuICImYW1wOyI7CiAgICAgICAgY2FzZSAiJyI6IHJldHVybiAiJmFwb3M7IjsKICAgICAgICBjYXNlICJcIiI6IHJldHVybiAiJnF1b3Q7IjsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgZnVuY3Rpb24gdHh0Mm1kKHR4dCkgewogICAgY29uc3QgbWRDYWNoZSA9IFtdOwogICAgbGV0IG1kID0gIiI7CiAgICB0eHQgPSB4bWxFc2NhcGUoU2NyYXRjaC5DYXN0LnRvU3RyaW5nKHR4dCkpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0eHQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgbGV0dCA9IHR4dFtpXTsKICAgICAgY29uc3QgY29kZSA9IGAke2xldHR9JHt0eHRbaSArIDFdfWA7CiAgICAgIGlmICghbWFya2Rvd25Db25zdHNbY29kZV0pIG1kICs9IGxldHQgPT09ICI8IiA/ICImbHQ7IiA6IGxldHQgPT09ICI+IiA/ICImZ3Q7IiA6IGxldHQ7CiAgICAgIGVsc2UgewogICAgICAgIGNvbnN0IGZvcm0gPSBtYXJrZG93bkNvbnN0c1tjb2RlXTsKICAgICAgICBjb25zdCBjYWNoZUluZCA9IG1kQ2FjaGUuaW5kZXhPZihmb3JtKTsKICAgICAgICBpZiAoY2FjaGVJbmQgPT09IC0xKSB7CiAgICAgICAgICBpZiAoY29kZSA9PT0gIkBjIiB8fCBjb2RlID09PSAiQGgiIHx8IGNvZGUgPT09ICJAZiIpIHsKICAgICAgICAgICAgY29uc3QgdGVzdFN0cmluZyA9IHR4dC5zdWJzdHJpbmcoaSArIDIsIHR4dC5sZW5ndGgpOwogICAgICAgICAgICBjb25zdCBpbmQgPSB0ZXN0U3RyaW5nLmluZGV4T2YoIjoiKTsKICAgICAgICAgICAgaWYgKHRlc3RTdHJpbmcuaW5kZXhPZihjb2RlKSA+IC0xICYmIGluZCkgewogICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gdGVzdFN0cmluZy5zdWJzdHJpbmcoMCwgaW5kKTsKICAgICAgICAgICAgICBtZCArPSBgPCR7Zm9ybS5yZXBsYWNlKCItLS0iLCBjb2xvcil9PmA7CiAgICAgICAgICAgICAgbWRDYWNoZS5wdXNoKGZvcm0pOwogICAgICAgICAgICAgIGkgKz0gaW5kICsgMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZCArPSBjb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGZvcm0gPT09ICJpbWciIHx8IGZvcm0gPT09ICJhdWRpbyIgfHwgZm9ybSA9PT0gInZpZGVvIikgewogICAgICAgICAgICBjb25zdCB0ZXN0U3RyaW5nID0gdHh0LnN1YnN0cmluZyhpICsgMiwgdHh0Lmxlbmd0aCk7CiAgICAgICAgICAgIGNvbnN0IGluZCA9IHRlc3RTdHJpbmcuaW5kZXhPZihgJHtmb3JtWzBdfT5gKTsKICAgICAgICAgICAgaWYgKGluZCA9PT0gLTEpIG1kICs9IGAmbHQ7JHtmb3JtWzBdfWA7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIG1kICs9IGA8JHtmb3JtfSB3aWR0aD0iYXV0byIgaGVpZ2h0PSJhdXRvIiAke2Zvcm0gIT09ICJpbWciID8gImNvbnRyb2xzIiA6ICIifSBjcm9zc29yaWdpbj0iQW5vbnltb3VzIiBzcmM9IiR7dGVzdFN0cmluZy5zdWJzdHJpbmcoMCwgaW5kKX0iPmA7CiAgICAgICAgICAgICAgaWYgKGZvcm0gIT09ICJpbWciKSBtZCArPSBgPC8ke2Zvcm19PmA7CiAgICAgICAgICAgICAgaSArPSBpbmQgKyAyOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZCArPSBgPCR7Zm9ybX0+YDsKICAgICAgICAgICAgbWRDYWNoZS5wdXNoKGZvcm0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZCArPSBgPC8ke2Zvcm19PmA7CiAgICAgICAgICBtZENhY2hlLnNwbGljZShjYWNoZUluZCwgMSk7CiAgICAgICAgfQogICAgICAgIGkrKzsKICAgICAgfQogICAgfQogICAgaWYgKG1kQ2FjaGUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBtZENvbnN0VmFscyA9IE9iamVjdC5lbnRyaWVzKG1hcmtkb3duQ29uc3RzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZENhY2hlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgb2xkRm9ybSA9IG1kQ29uc3RWYWxzLmZpbmQoKFtrLCB2XSkgPT4gdiA9PT0gbWRDYWNoZVtpXSk/LlswXTsKICAgICAgICBjb25zdCBpdGVtID0gYDwke21kQ2FjaGVbaV19PmA7CiAgICAgICAgY29uc3QgbGFzdEluZCA9IG1kLmxhc3RJbmRleE9mKGl0ZW0pOwogICAgICAgIG1kID0gbWQuc3Vic3RyaW5nKDAsIGxhc3RJbmQpICsgb2xkRm9ybSArIG1kLnN1YnN0cmluZyhsYXN0SW5kICsgaXRlbS5sZW5ndGgsIG1kLmxlbmd0aCk7IAogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWQucmVwbGFjZSgvXG4vZywgIjxicj4iKTsKICB9CgogIGZ1bmN0aW9uIGNvbG9yRGFya2VuKGhleCwgYW10KSB7CiAgICBjb25zdCByZ2IySGV4ID0gKFtyLCBnLCBiXSkgPT4gewogICAgICByZXR1cm4gKCIjIiArIFtyLCBnLCBiXS5tYXAoKHBhcnQpID0+IHsKICAgICAgICBjb25zdCBoZXggPSBwYXJ0LnRvU3RyaW5nKDE2KTsKICAgICAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PT0gMSA/ICIwIiArIGhleCA6IGhleDsKICAgICAgfSkuam9pbigiIikpOwogICAgfTsKICAgIGNvbnN0IGhleDJSZ2IgPSAoaCkgPT4gewogICAgICBoID0gaC5yZXBsYWNlKCIjIiwgIiIpOwogICAgICBpZiAoaC5sZW5ndGggPT09IDMpIGggPSBoLnNwbGl0KCIiKS5tYXAoY2hhciA9PiBjaGFyICsgY2hhcikuam9pbigiIik7CiAgICAgIGxldCBiaWdpbnQgPSBwYXJzZUludChoLCAxNik7CiAgICAgIHJldHVybiBbKGJpZ2ludCA+PiAxNikgJiAyNTUsIChiaWdpbnQgPj4gOCkgJiAyNTUsIGJpZ2ludCAmIDI1NV07CiAgICB9OwogICAgcmV0dXJuIHJnYjJIZXgoaGV4MlJnYihoZXgpLm1hcCgocGFydCkgPT4gTWF0aC5yb3VuZChwYXJ0ICogKDEgLSBhbXQpKSkpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlSW5wdXRMYWJlbChpZCwgbGFiZWxUZXh0LCBpbmNsdWRlTWFyZ2lucywgb3B0U3R5bGVzKSB7CiAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CiAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoImZvciIsIGlkKTsKICAgIGxhYmVsLnRleHRDb250ZW50ID0gbGFiZWxUZXh0OwogICAgbGFiZWwuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJkaXNwbGF5OiBibG9jazsgZm9udC13ZWlnaHQ6IDcwMDsiICsgKG9wdFN0eWxlcyA/PyAiIikpOwogICAgaWYgKCFpbmNsdWRlTWFyZ2lucykgewogICAgICBsYWJlbC5zdHlsZS5tYXJnaW5Ub3AgPSAiMTBweCI7CiAgICAgIGxhYmVsLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICItMTVweCI7CiAgICB9CiAgICByZXR1cm4gbGFiZWw7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVJbnB1dChpZCwgdHlwZSwgdmFsdWUsIGluY2x1ZGVQYWQsIG9wdFN0eWxlcykgewogICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgaW5wdXRbdHlwZSA9PT0gImNoZWNrYm94IiA/ICJjaGVja2VkIiA6ICJ2YWx1ZSJdID0gdmFsdWU7CiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCB0eXBlKTsKICAgIGlucHV0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZCk7CiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBpZCk7CiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudCgjZmZmIDUwJSwgI2IzYjNiMyk7IGJvcmRlcjogMnB4IHNvbGlkIHdoaXRlOyB3aWR0aDogMTUwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgYm9yZGVyLXJhZGl1czogOHB4OyBjb2xvcjogIzAwMDsiICsgKG9wdFN0eWxlcyA/PyAiIikpOwogICAgaWYgKCFpbmNsdWRlUGFkKSBpbnB1dC5zdHlsZS5wYWRkaW5nID0gIjJweCI7CiAgICBpbnB1dFt0eXBlID09PSAiY2hlY2tib3giID8gImNoZWNrZWQiIDogInZhbHVlIl0gPSB2YWx1ZTsKICAgIHJldHVybiBpbnB1dDsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVNlbGVjdChpZCwgb3B0aW9ucywgdmFsdWUpIHsKICAgIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwogICAgc2VsZWN0LnNldEF0dHJpYnV0ZSgiaWQiLCBpZCk7CiAgICBzZWxlY3Quc2V0QXR0cmlidXRlKCJuYW1lIiwgaWQpOwogICAgc2VsZWN0LnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KCNmZmYgNTAlLCAjYjNiM2IzKTsgYm9yZGVyOiAycHggc29saWQgd2hpdGU7IHBhZGRpbmc6IDJweDsgd2lkdGg6IDE1MHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGJvcmRlci1yYWRpdXM6IDhweDsgY29sb3I6ICMwMDA7Iik7CiAgICBvcHRpb25zLmZvckVhY2gob3B0aW9uVGV4dCA9PiB7CiAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOwogICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIG9wdGlvblRleHQpOwogICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBvcHRpb25UZXh0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgb3B0aW9uVGV4dC5zbGljZSgxKTsKICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICB9KTsKICAgIHNlbGVjdC52YWx1ZSA9IHZhbHVlOwogICAgcmV0dXJuIHNlbGVjdDsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbihpZCwgYnV0dG9uVGV4dCkgewogICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICBidXR0b24uc2V0QXR0cmlidXRlKCJpZCIsIGlkKTsKICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImZvbnQtc2l6ZTogMThweDsgbWFyZ2luLWJvdHRvbTogMTVweDsgYm9yZGVyOiBub25lOyBwYWRkaW5nOiAxMHB4IDE1cHg7IGJhY2tncm91bmQtY29sb3I6ICM0ZjRmNGY7IHRleHQtYWxpZ246IGNlbnRlcjsgYm9yZGVyLXJhZGl1czogMTBweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICNmZmY7Iik7CiAgICBidXR0b24udGV4dENvbnRlbnQgPSBidXR0b25UZXh0OwogICAgcmV0dXJuIGJ1dHRvbjsKICB9CgogIC8vIE1vZGFscwogIGZ1bmN0aW9uIGNyZWF0ZU1vZGFsKHR5cGUsIGRhdGEpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCJTUGNvbW1lbnRNb2RhbCIpOwogICAgICBtb2RhbC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41KTsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGZvbnQtZmFtaWx5OiBBcmlhbDsgcGFkZGluZzogNTBweDsgY29sb3I6IHdoaXRlOyBwb3NpdGlvbjogZml4ZWQ7IHotaW5kZXg6IDk5OTk7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyIpOwoKICAgICAgY29uc3QgbW9kYWxDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIG1vZGFsQ29udGVudC5jbGFzc0xpc3QuYWRkKCJtb2RhbC1jb250ZW50Iik7CiAgICAgIG1vZGFsQ29udGVudC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIndpZHRoOiAzNTBweDsgaGVpZ2h0OiBhdXRvOyBiYWNrZ3JvdW5kLWNvbG9yOiAjMjYyNjI2OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGJvcmRlci1yYWRpdXM6IDE1cHg7IGJveC1zaGFkb3c6IHJnYmEoMTI1LCAxMjUsIDEyNSwgMC41KSAwcHggMHB4IDBweCA1cHg7Iik7CiAgICAgIG1vZGFsLmFwcGVuZENoaWxkKG1vZGFsQ29udGVudCk7CiAgCiAgICAgIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZCgiaGVhZGVyIik7CiAgICAgIGhlYWRlci5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImJvcmRlci1yYWRpdXM6IDE1cHggMTVweCAwcHggMHB4OyBwYWRkaW5nOiAxNXB4IDVweCIpOwogICAgICBoZWFkZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gaXNQTSA/ICIjMDBjM2ZmIiA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCItLWxvb2tzLXNlY29uZGFyeSIpIHx8ICIjZmY0YzRjIjsKICAgICAgbW9kYWxDb250ZW50LmFwcGVuZENoaWxkKGhlYWRlcik7CiAgICAgIGNvbnN0IGgyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDIiKTsKICAgICAgaDIudGV4dENvbnRlbnQgPSAiQ29tbWVudCBDdXN0b21pemF0aW9uIjsKICAgICAgaDIuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoaDIpOwogIAogICAgICBpZiAodHlwZSA9PT0gInR4dCIpIHsKICAgICAgICBjb25zdCBmb250TGFiZWwgPSBjcmVhdGVJbnB1dExhYmVsKCJmb250IiwgIkZvbnQiKTsKICAgICAgICBtb2RhbENvbnRlbnQuYXBwZW5kKGZvbnRMYWJlbCwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgY29uc3QgZm9udElucHV0ID0gY3JlYXRlSW5wdXQoImZvbnQiLCAidGV4dCIsIGRhdGEuZm9udCk7CiAgICAgICAgZm9udElucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKCkgPT4geyBmb250SW5wdXQuc3R5bGUuZm9udEZhbWlseSA9IGZvbnRJbnB1dC52YWx1ZSB9KTsKICAgICAgICBtb2RhbENvbnRlbnQuYXBwZW5kKGZvbnRJbnB1dCwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgY29uc3QgZm9ybWF0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZm9ybWF0RGl2LnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsKCiAgICAgICAgY29uc3QgYm9sZG5lc3MgPSBjcmVhdGVJbnB1dExhYmVsKCJib2xkIiwgIkJvbGQiLCBmYWxzZSwgInBvc2l0aW9uOiBhYnNvbHV0ZTsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMzUwJSwgMCUpOyIpOwogICAgICAgIGNvbnN0IGJvbGRJbnB1dCA9IGNyZWF0ZUlucHV0KCJib2xkIiwgImNoZWNrYm94IiwgZGF0YS5ib2xkLCBmYWxzZSwgIndpZHRoOiA1MHB4OyBwb3NpdGlvbjogYWJzb2x1dGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC0xNzUlLCA5NSUpIik7CiAgICAgICAgY29uc3QgaXRhbGljID0gY3JlYXRlSW5wdXRMYWJlbCgiaXRhbGljIiwgIkl0YWxpYyIsIGZhbHNlLCAicG9zaXRpb246IGFic29sdXRlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSg4MCUsIDAlKTsgZGlzcGxheTogaW5saW5lOyIpOwogICAgICAgIGNvbnN0IGl0YWxJbnB1dCA9IGNyZWF0ZUlucHV0KCJpdGFsaWMiLCAiY2hlY2tib3giLCBkYXRhLml0YWxpYywgZmFsc2UsICJ3aWR0aDogNTBweDsgcG9zaXRpb246IGFic29sdXRlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtMTUlLCA5NSUpIik7CgogICAgICAgIGZvcm1hdERpdi5hcHBlbmQoYm9sZG5lc3MsIGJvbGRJbnB1dCwgaXRhbGljLCBpdGFsSW5wdXQpOwogICAgICAgIG1vZGFsQ29udGVudC5hcHBlbmQoZm9ybWF0RGl2LCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpLCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKICAKICAgICAgICBjb25zdCBhbGlnbm1lbnRMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoImFsaWdubWVudCIsICJUZXh0IEFsaWdubWVudCIpOwogICAgICAgIG1vZGFsQ29udGVudC5hcHBlbmQoYWxpZ25tZW50TGFiZWwsIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwogICAgICAgIGNvbnN0IGFsaWdubWVudFNlbGVjdCA9IGNyZWF0ZVNlbGVjdCgiYWxpZ25tZW50IiwgWyJsZWZ0IiwgImNlbnRlciIsICJyaWdodCJdLCBkYXRhLnRleHRBbGlnbiB8fCAibGVmdCIpOwogICAgICAgIGFsaWdubWVudFNlbGVjdC5zdHlsZS5tYXJnaW5Cb3R0b20gPSAiOTBweCI7CiAgICAgICAgbW9kYWxDb250ZW50LmFwcGVuZENoaWxkKGFsaWdubWVudFNlbGVjdCk7CgogICAgICAgIGNvbnN0IHRleHREaXYxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgdGV4dERpdjEuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDYwJSwgLTEzMCUpOyIpOwogICAgICAgIGNvbnN0IHRleHREaXYyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgdGV4dERpdjIuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDE5MCUsIC0xMjclKTsiKTsKCiAgICAgICAgY29uc3QgZm9udFNpemVMYWJlbCA9IGNyZWF0ZUlucHV0TGFiZWwoImZvbnRTaXplIiwgIkZvbnQgU2l6ZSIpOwogICAgICAgIHRleHREaXYxLmFwcGVuZChmb250U2l6ZUxhYmVsLCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpKTsKICAgICAgICBjb25zdCBmb250U2l6ZUlucHV0ID0gY3JlYXRlSW5wdXQoImZvbnRTaXplIiwgIm51bWJlciIsIGRhdGEuZm9udFNpemUsIGZhbHNlLCAid2lkdGg6IDEwMHB4OyIpOwogICAgICAgIGZvbnRTaXplSW5wdXQuc2V0QXR0cmlidXRlKCJtaW4iLCAiMSIpOwogICAgICAgIHRleHREaXYxLmFwcGVuZENoaWxkKGZvbnRTaXplSW5wdXQpOwogICAgICAgIGNvbnN0IHR4dENvbG9yTGFiZWwgPSBjcmVhdGVJbnB1dExhYmVsKCJ0eHRDb2xvciIsICJUZXh0IENvbG9yIik7CiAgICAgICAgdGV4dERpdjIuYXBwZW5kKHR4dENvbG9yTGFiZWwsIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwogICAgICAgIGNvbnN0IHR4dENvbG9ySW5wdXQgPSBjcmVhdGVJbnB1dCgidHh0Q29sb3IiLCAiY29sb3IiLCBkYXRhLnR4dENvbG9yLCBmYWxzZSwgIndpZHRoOiAxMDBweDsiKTsKICAgICAgICB0ZXh0RGl2Mi5hcHBlbmRDaGlsZCh0eHRDb2xvcklucHV0KTsKICAgICAgICBtb2RhbENvbnRlbnQuYXBwZW5kKHRleHREaXYxLCB0ZXh0RGl2Mik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgdXBkYXRlRGlzcGxheSA9ICgpID0+IHsKICAgICAgICAgIGNvbG9yRGlzcGxheS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcklucHV0LnZhbHVlOwogICAgICAgICAgY29sb3JEaXNwbGF5LnN0eWxlLm9wYWNpdHkgPSBvcGFjaXR5SW5wdXQudmFsdWUgLyAxMDA7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgY29sb3JEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBjb2xvckRpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTsgZGlzcGxheTogaW5saW5lOyBtYXJnaW4tcmlnaHQ6IDIwcHg7IG1hcmdpbi10b3A6IDE1cHg7Iik7CiAgICAgICAgbW9kYWxDb250ZW50LmFwcGVuZENoaWxkKGNvbG9yRGl2KTsKICAKICAgICAgICBjb25zdCBodWVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBodWVEaXYuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJwb3NpdGlvbjogYWJzb2x1dGU7IG1hcmdpbi10b3A6IDQwcHg7Iik7CgogICAgICAgIGNvbnN0IGNvbG9yTGFiZWwgPSBjcmVhdGVJbnB1dExhYmVsKCJjb2xvciIsICJDb2xvciIsIHRydWUpOwogICAgICAgIGNvbG9yTGFiZWwuc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZSgtNTAlLCAtNTAlKSI7CiAgICAgICAgaHVlRGl2LmFwcGVuZENoaWxkKGNvbG9yTGFiZWwpOwogICAgICAgIGNvbnN0IGNvbG9ySW5wdXQgPSBjcmVhdGVJbnB1dCgiY29sb3IiLCAiY29sb3IiLCBkYXRhLmNvbG9yLCB0cnVlLCAid2lkdGg6IDEwMHB4OyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSg0MCUsIC0xMzAlKTsiKTsKICAgICAgICBjb2xvcklucHV0LnZhbHVlID0gZGF0YS5jb2xvcjsgLy8gaGF2ZSB0byBoYXJkY29kZSBpdCBpbiBmb3Igc29tZSByZWFzb24KICAgICAgICBjb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgdXBkYXRlRGlzcGxheSk7CiAgICAgICAgaHVlRGl2LmFwcGVuZENoaWxkKGNvbG9ySW5wdXQpOwogICAgICAgIGNvbG9yRGl2LmFwcGVuZENoaWxkKGh1ZURpdik7CgogICAgICAgIGNvbnN0IG9wYURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIG9wYURpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgInBvc2l0aW9uOiBhYnNvbHV0ZTsgbWFyZ2luLXRvcDogODBweDsiKTsKCiAgICAgICAgY29uc3Qgb3BhTGFiZWwgPSBjcmVhdGVJbnB1dExhYmVsKCJvcGFjaXR5IiwgIk9wYWNpdHkiLCB0cnVlLCAidHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7Iik7CiAgICAgICAgb3BhRGl2LmFwcGVuZENoaWxkKG9wYUxhYmVsKTsKICAgICAgICBjb25zdCBvcGFjaXR5SW5wdXQgPSBjcmVhdGVJbnB1dCgib3BhY2l0eSIsICJyYW5nZSIsIGRhdGEub3BhY2l0eSwgdHJ1ZSwgIndpZHRoOiAxMDBweDsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoNDAlLCAtMTMwJSk7Iik7CiAgICAgICAgb3BhY2l0eUlucHV0LnNldEF0dHJpYnV0ZSgibWF4IiwgMTAwKTsKICAgICAgICBvcGFjaXR5SW5wdXQuc2V0QXR0cmlidXRlKCJtaW4iLCAxMCk7CiAgICAgICAgb3BhY2l0eUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgdXBkYXRlRGlzcGxheSk7CiAgICAgICAgb3BhRGl2LmFwcGVuZENoaWxkKG9wYWNpdHlJbnB1dCk7CiAgICAgICAgY29sb3JEaXYuYXBwZW5kQ2hpbGQob3BhRGl2KTsKCiAgICAgICAgY29uc3QgY29sb3JEaXNwbGF5RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgY29sb3JEaXNwbGF5RGl2LnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiZGlzcGxheTogYmxvY2s7IGJvcmRlci1yYWRpdXM6IDE1cHg7IGJvcmRlcjogN3B4IHNvbGlkICM0ZjRmNGY7IHdpZHRoOiA4NXB4OyBoZWlnaHQ6IDg1cHg7IG1hcmdpbjogMjVweCAxMHB4IDEwcHggMzBweDsiKTsKICAgICAgICBtb2RhbENvbnRlbnQuYXBwZW5kQ2hpbGQoY29sb3JEaXNwbGF5RGl2KTsKICAKICAgICAgICBjb25zdCBjb2xvckRpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBjb2xvckRpc3BsYXkuY2xhc3NMaXN0LmFkZCgiY29sb3ItZGlzcGxheSIpOwogICAgICAgIGNvbG9yRGlzcGxheS5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6IGJsb2NrOyBib3JkZXItcmFkaXVzOiA5cHg7IHdpZHRoOiA4NXB4OyBoZWlnaHQ6IDg1cHg7Iik7CiAgICAgICAgY29sb3JEaXNwbGF5RGl2LmFwcGVuZENoaWxkKGNvbG9yRGlzcGxheSk7CiAgICAgICAgdXBkYXRlRGlzcGxheSgpOwogICAgICB9CgogICAgICBjb25zdCBjYW5jZWxCdG4gPSBjcmVhdGVCdXR0b24oImNhbmNlbEJ0biIsICJDYW5jZWwiKTsKICAgICAgY2FuY2VsQnRuLnN0eWxlLm1hcmdpblJpZ2h0ID0gIjEwcHgiOwogICAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChtb2RhbCk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgICAgbW9kYWxDb250ZW50LmFwcGVuZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpLCBjYW5jZWxCdG4pOwogIAogICAgICBjb25zdCBva2F5QnRuID0gY3JlYXRlQnV0dG9uKCJva2F5QnRuIiwgIk9rYXkiKTsKICAgICAgb2theUJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICBjb25zdCBpbnB1dHMgPSBtb2RhbENvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgiaW5wdXQsIHNlbGVjdCIpOwogICAgICAgIGNvbnN0IHZhbHVlcyA9IHt9OwogICAgICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHsgdmFsdWVzW2lucHV0LmlkXSA9IGlucHV0W2lucHV0LnR5cGUgPT09ICJjaGVja2JveCIgPyAiY2hlY2tlZCIgOiAidmFsdWUiXSB9KTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG1vZGFsKTsKICAgICAgICByZXNvbHZlKHZhbHVlcyk7CiAgICAgIH0pOwogICAgICBtb2RhbENvbnRlbnQuYXBwZW5kQ2hpbGQob2theUJ0bik7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobW9kYWwpOwogICAgfSk7CiAgfQoKICAvLyBDb21tZW50IEZ1bmNzCiAgYXN5bmMgZnVuY3Rpb24gY29sb3JMaXN0ZW4oc3ZnLCBjb21tZW50KSB7CiAgICBjb25zdCBJRCA9IGNvbW1lbnQuaWQ7CiAgICBjb25zdCB2YWx1ZXMgPSBhd2FpdCBjcmVhdGVNb2RhbCgiY29sb3IiLCBjb21tZW50U3RvcmVbSURdKTsKICAgIGlmICh2YWx1ZXMgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBjb2xvciA9IHZhbHVlcy5jb2xvcjsKICAgICAgY29uc3QgY29sb3IyID0gY29sb3JEYXJrZW4odmFsdWVzLmNvbG9yLCAwLjIpOwogICAgICBzdmcuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7CiAgICAgIGNvbnN0IHN2Z0JhciA9IHN2Zy5xdWVyeVNlbGVjdG9yKCJyZWN0LnNjcmF0Y2hXb3Jrc3BhY2VDb21tZW50Qm9yZGVyIikgPz8gc3ZnLnF1ZXJ5U2VsZWN0b3IoInJlY3Quc2NyYXRjaENvbW1lbnRSZWN0Iik7CiAgICAgIGNvbnN0IHN2Z1RleHQgPSBzdmcucXVlcnlTZWxlY3RvcigiYm9keSIpOwogICAgICBjb25zdCB0ZXh0QXJlYSA9IHN2Zy5xdWVyeVNlbGVjdG9yKCIuc2NyYXRjaENvbW1lbnRUZXh0YXJlYS5zY3JhdGNoQ29tbWVudFRleHQiKTsKICAgICAgaWYgKHN2Z0JhcikgewogICAgICAgIHN2Z0Jhci5zdHlsZS5maWxsID0gY29sb3I7CiAgICAgICAgc3ZnQmFyLnN0eWxlLnN0cm9rZSA9IGNvbG9yMjsKICAgICAgfQogICAgICBpZiAoc3ZnVGV4dCkgc3ZnVGV4dC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjsKICAgICAgaWYgKHRleHRBcmVhKSB0ZXh0QXJlYS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjsKICAgICAgY29tbWVudFN0b3JlW0lEXS5jb2xvciA9IGNvbG9yOwogICAgICBjb21tZW50U3RvcmVbSURdLmNvbG9yMiA9IGNvbG9yMjsKCiAgICAgIGNvbnN0IG9wYWNpdHkgPSBTY3JhdGNoLkNhc3QudG9OdW1iZXIodmFsdWVzLm9wYWNpdHkpOwogICAgICBzdmcuc2V0QXR0cmlidXRlKCJvcGFjaXR5Iiwgb3BhY2l0eSAvIDEwMCk7CiAgICAgIGNvbW1lbnRTdG9yZVtJRF0ub3BhY2l0eSA9IG9wYWNpdHk7CiAgICAgIGlmICghaXNQTSkgcnVudGltZS5leHRlbnNpb25TdG9yYWdlWyJTUGNvbW1lbnRzIl0gPSB7IHN0b3JhZ2U6IGNvbW1lbnRTdG9yZSB9OwogICAgICBjb252ZXJ0Mk1kKGNvbW1lbnQsIGNvbW1lbnQuZ2V0VGV4dCgpKTsKICAgIH0KICB9CgogIGFzeW5jIGZ1bmN0aW9uIHR4dExpc3RlbihzdmcsIGNvbW1lbnQpIHsKICAgIGNvbnN0IElEID0gY29tbWVudC5pZDsKICAgIGNvbnN0IHZhbHVlcyA9IGF3YWl0IGNyZWF0ZU1vZGFsKCJ0eHQiLCBjb21tZW50U3RvcmVbSURdKTsKICAgIGlmICh2YWx1ZXMgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBmb250U2l6ZSA9IE1hdGgubWF4KFNjcmF0Y2guQ2FzdC50b051bWJlcih2YWx1ZXMuZm9udFNpemUpLCAxKTsKICAgICAgc3ZnLnN0eWxlLmZvbnRGYW1pbHkgPSB2YWx1ZXMuZm9udDsKICAgICAgc3ZnLnN0eWxlLmZvbnRXZWlnaHQgPSB2YWx1ZXMuYm9sZCA/ICJib2xkZXIiIDogIm5vcm1hbCI7CiAgICAgIHN2Zy5zdHlsZS5mb250U3R5bGUgPSB2YWx1ZXMuaXRhbGljID8gIml0YWxpYyIgOiAibm9ybWFsIjsKICAgICAgc3ZnLnN0eWxlLnRleHRBbGlnbiA9IHZhbHVlcy5hbGlnbm1lbnQ7CiAgICAgIHN2Zy5zdHlsZS5mb250U2l6ZSA9IGAke2ZvbnRTaXplfXB4YDsKICAgICAgc3ZnLnN0eWxlLmNvbG9yID0gdmFsdWVzLnR4dENvbG9yOwoKICAgICAgY29tbWVudFN0b3JlW0lEXSA9IHsKICAgICAgICAuLi5jb21tZW50U3RvcmVbSURdLAogICAgICAgIGZvbnQ6IHZhbHVlcy5mb250LCBib2xkOiB2YWx1ZXMuYm9sZCwgaXRhbGljOiB2YWx1ZXMuaXRhbGljLAogICAgICAgIHRleHRBbGlnbjogdmFsdWVzLmFsaWdubWVudCwgZm9udFNpemUsIHR4dENvbG9yOiB2YWx1ZXMudHh0Q29sb3IKICAgICAgfTsKICAgICAgaWYgKGlzUE0pIHJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZVsiU1Bjb21tZW50cyJdID0geyBzdG9yYWdlOiBjb21tZW50U3RvcmUgfTsKICAgICAgY29udmVydDJNZChjb21tZW50LCBjb21tZW50LmdldFRleHQoKSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZWRvQ29tbWVudChjb21tZW50KSB7CiAgICBpZiAoY29tbWVudFN0b3JlW2NvbW1lbnQuaWRdKSBjb21tZW50U3RvcmVbY29tbWVudC5pZF0uWFkgPSBjb21tZW50LmdldFhZKCk7CiAgICBpZiAoY29tbWVudC5TUGJ1dHRvbnMpIHJldHVybjsKCiAgICAvLyBhZGQgbmV3IGJ1dHRvbnMKICAgIGNvbnN0IGJ0bjEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgImltYWdlIik7CiAgICBidG4xLnNldEF0dHJpYnV0ZSgiaWQiLCBjb21tZW50LmlkKTsKICAgIGJ0bjEuc2V0QXR0cmlidXRlKCJ4IiwgIjI1Iik7IGJ0bjEuc2V0QXR0cmlidXRlKCJ5IiwgIjEiKTsKICAgIGJ0bjEuc2V0QXR0cmlidXRlKCJ3aWR0aCIsICIzMiIpOyBidG4xLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IiwgIjMyIik7CiAgICBidG4xLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGNvbG9ySWNvbik7CiAgICBidG4xLnN0eWxlLmRpc3BsYXkgPSBjb21tZW50LmlzTWluaW1pemVkXyA/ICJub25lIiA6ICJpbmxpbmUiOwoKICAgIGNvbnN0IGJ0bjIgPSBidG4xLmNsb25lTm9kZSh0cnVlKTsKICAgIGJ0bjIuc2V0QXR0cmlidXRlKCJ4IiwgIjYwIik7CiAgICBidG4yLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGZvbnRJY29uKTsKCiAgICBsZXQgcGF0aCA9IGNvbW1lbnQsIGNvbW1lbnRTVkcgPSAiIjsKICAgIGlmIChjb21tZW50LmJsb2NrSWQpIHsKICAgICAgaWYgKCFjb21tZW50LmJ1YmJsZV8pIHJldHVybjsgLy8gd2VpcmQgYnVnIHRoYXRzIGF2b2lkZWQKICAgICAgcGF0aCA9IGNvbW1lbnQuYnViYmxlXy5taW5pbWl6ZUFycm93XzsKICAgICAgY29tbWVudFNWRyA9IGNvbW1lbnQuYnViYmxlXy5idWJibGVCYWNrXy5wYXJlbnROb2RlOwogICAgfSBlbHNlIHsKICAgICAgcGF0aCA9IGNvbW1lbnQubWluaW1pemVBcnJvd187CiAgICAgIGNvbW1lbnRTVkcgPSBjb21tZW50LnN2Z0dyb3VwXzsKICAgIH0KICAgIHBhdGguaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCJiZWZvcmViZWdpbiIsIGJ0bjEpOwogICAgcGF0aC5pbnNlcnRBZGphY2VudEVsZW1lbnQoImJlZm9yZWJlZ2luIiwgYnRuMik7CiAgICBidG4xLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4geyBjb2xvckxpc3Rlbihjb21tZW50U1ZHLCBjb21tZW50KSB9KTsKICAgIGJ0bjIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7IHR4dExpc3Rlbihjb21tZW50LnRleHRhcmVhXywgY29tbWVudCkgfSk7CiAgICBjb21tZW50LlNQYnV0dG9ucyA9IFtidG4xLCBidG4yXTsKCiAgICBpZiAoY29tbWVudFN0b3JlW2NvbW1lbnQuaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgY29tbWVudFN0b3JlW2NvbW1lbnQuaWRdID0gewogICAgICAgIElEIDogY29tbWVudC5pZCwgWFkgOiBjb21tZW50LmdldFhZKCksCiAgICAgICAgY29sb3JCdG4gOiBidG4xLCB0ZXh0QnRuIDogYnRuMiwgY29tbWVudFNWRyA6IGNvbW1lbnRTVkcsCiAgICAgICAgY29sb3IgOiAiI2ZmZjA5OSIsIGNvbG9yMjogIiNiOGFmMzciLCBvcGFjaXR5IDogMTAwLAogICAgICAgIHR4dENvbG9yOiAiIzAwMDAwMCIsIGZvbnQgOiAiQXJpYWwiLCB0ZXh0QWxpZ24gOiAibGVmdCIsCiAgICAgICAgZm9udFNpemUgOiAxNiwgYm9sZCA6IGZhbHNlLCBpdGFsaWMgOiBmYWxzZQogICAgICB9OwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlQ29tbWVudChjb21tZW50KSB7CiAgICBjb25zdCBkYXRhID0gY29tbWVudFN0b3JlW2NvbW1lbnQuaWRdOwogICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCAoY29tbWVudC5ibG9ja0lkICYmICFjb21tZW50LmJ1YmJsZV8pKSByZXR1cm47CiAgICBjb25zdCBzdmcgPSBjb21tZW50LnN2Z0hhbmRsZVRhcmdldF8gIT09IHVuZGVmaW5lZCA/IGNvbW1lbnQuc3ZnR3JvdXBfIDogY29tbWVudC5idWJibGVfLmJ1YmJsZUJhY2tfLnBhcmVudE5vZGU7CiAgICBjb25zdCB0eHQgPSBjb21tZW50LnRleHRhcmVhXzsKICAgIGNvbnN0IHN2Z0JhciA9IHN2Zy5xdWVyeVNlbGVjdG9yKCJyZWN0LnNjcmF0Y2hXb3Jrc3BhY2VDb21tZW50Qm9yZGVyIikgPz8gc3ZnLnF1ZXJ5U2VsZWN0b3IoInJlY3Quc2NyYXRjaENvbW1lbnRSZWN0Iik7CiAgICBjb25zdCBzdmdUZXh0ID0gc3ZnLnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgIGNvbnN0IHRleHRBcmVhID0gc3ZnLnF1ZXJ5U2VsZWN0b3IoIi5zY3JhdGNoQ29tbWVudFRleHRhcmVhLnNjcmF0Y2hDb21tZW50VGV4dCIpOwogICAgc3ZnLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGRhdGEuY29sb3I7CiAgICBpZiAoc3ZnQmFyKSB7CiAgICAgIHN2Z0Jhci5zdHlsZS5maWxsID0gZGF0YS5jb2xvcjsKICAgICAgc3ZnQmFyLnN0eWxlLnN0cm9rZSA9IGRhdGEuY29sb3IyOwogICAgfQogICAgaWYgKHN2Z1RleHQpIHN2Z1RleHQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZGF0YS5jb2xvcjsKICAgIGlmICh0ZXh0QXJlYSkgdGV4dEFyZWEuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZGF0YS5jb2xvcjsKICAgIHN2Zy5zZXRBdHRyaWJ1dGUoIm9wYWNpdHkiLCBkYXRhLm9wYWNpdHkgLyAxMDApOwoKICAgIHR4dC5zdHlsZS5mb250RmFtaWx5ID0gZGF0YS5mb250IHx8ICJBcmlhbCI7CiAgICB0eHQuc3R5bGUuZm9udFdlaWdodCA9IGRhdGEuYm9sZCA/ICJib2xkZXIiIDogIm5vcm1hbCI7CiAgICB0eHQuc3R5bGUuZm9udFN0eWxlID0gZGF0YS5pdGFsaWMgPyAiaXRhbGljIiA6ICJub3JtYWwiOwogICAgdHh0LnN0eWxlLnRleHRBbGlnbiA9IGRhdGEudGV4dEFsaWduOwogICAgdHh0LnN0eWxlLmZvbnRTaXplID0gYCR7ZGF0YS5mb250U2l6ZSB8fCAxNn1weGA7CiAgICB0eHQuc3R5bGUuY29sb3IgPSBkYXRhLnR4dENvbG9yOwoKICAgIGNvbnZlcnQyTWQoY29tbWVudCwgY29tbWVudC5nZXRUZXh0KCkpOwogIH0KCiAgZnVuY3Rpb24gY29udmVydDJNZChjb21tZW50LCB0eHQpIHsKICAgIGlmICghdHh0KSByZXR1cm47CiAgICBjb25zdCB0eHRBcmVhID0gY29tbWVudC50ZXh0YXJlYV87CiAgICBpZiAodHh0QXJlYS5wcmV2aW91c1NpYmxpbmcpIHR4dEFyZWEucHJldmlvdXNTaWJsaW5nLnJlbW92ZSgpOwoKICAgIGNvbnN0IG1kU3BhY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwcmUiKTsKICAgIGNvbnN0IG1kVHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBtZFNwYWNlLnN0eWxlID0gdHh0QXJlYS5nZXRBdHRyaWJ1dGUoInN0eWxlIikucmVwbGFjZShgZGlzcGxheTogbm9uZWAsICIiKSArICIgdGV4dC13cmFwOiB3cmFwOyI7CiAgICBtZFNwYWNlLmFwcGVuZENoaWxkKG1kVHh0KTsKICAgIG1kVHh0Lm91dGVySFRNTCA9IHR4dDJtZCh0eHQpOwogICAgbWRTcGFjZS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiB7CiAgICAgIHR4dEFyZWEuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICB0eHRBcmVhLmZvY3VzKCk7CiAgICAgIG1kU3BhY2UucmVtb3ZlKCk7CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9KTsKCiAgICB0eHRBcmVhLmluc2VydEFkamFjZW50RWxlbWVudCgiYmVmb3JlYmVnaW4iLCBtZFNwYWNlKTsKICAgIHR4dEFyZWEuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIHR4dEFyZWEuYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIChlKSA9PiB7CiAgICAgIHR4dEFyZWEuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgY29udmVydDJNZChjb21tZW50LCB0eHQpOwogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVBbGxDb21tZW50cygpIHsKICAgIGNvbnN0IGFsbENvbW1lbnRzID0gU2NyYXRjaEJsb2Nrcy5tYWluV29ya3NwYWNlLmNvbW1lbnREQl87CiAgICBPYmplY3QudmFsdWVzKGFsbENvbW1lbnRzKS5mb3JFYWNoKGNvbW1lbnQgPT4gewogICAgICByZWRvQ29tbWVudChjb21tZW50KTsKICAgICAgdXBkYXRlQ29tbWVudChjb21tZW50KTsKICAgIH0pOwogIH0KCiAgLy8gUGF0Y2hlcyBhbmQgU3RvcmFnZQogIGlmICghaXNQTSkgewogICAgY29uc3Qgc3RvcmFnZSA9IHJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZVsiU1Bjb21tZW50cyJdOwogICAgaWYgKHN0b3JhZ2UgIT09IHVuZGVmaW5lZCkgY29tbWVudFN0b3JlID0gc3RvcmFnZS5zdG9yYWdlOwogIH0KCiAgZnVuY3Rpb24gZml4U3RvcmFnZSh3cykgewogICAgY29uc3Qgc3RvcmVQb3MgPSB7fSwgaW50ZXJQb3MgPSB7fTsKICAgIGNvbnN0IHN0b3JlZENvbW1lbnRzID0gT2JqZWN0LnZhbHVlcyhjb21tZW50U3RvcmUpOwogICAgc3RvcmVkQ29tbWVudHMuZm9yRWFjaCgoaSkgPT4gewogICAgICBjb25zdCBrZXkgPSBgeyJ4Ijoke01hdGguZmxvb3IoaS5YWS54KX0sInkiOiR7TWF0aC5mbG9vcihpLlhZLnkpfX1gOwogICAgICBzdG9yZVBvc1trZXldID0gaTsKICAgIH0pOwogICAgY29uc3QgaW50ZXJuYWxDb21tZW50cyA9IE9iamVjdC52YWx1ZXMod3MuY29tbWVudERCXyk7CiAgICBpbnRlcm5hbENvbW1lbnRzLmZvckVhY2goKGkpID0+IHsgaW50ZXJQb3NbSlNPTi5zdHJpbmdpZnkoaS5nZXRYWSgpKV0gPSBpIH0pOwoKICAgIGNvbnN0IGludGVyUG9zS2V5cyA9IE9iamVjdC5rZXlzKGludGVyUG9zKTsKICAgIGNvbnN0IG5ld1N0b3JhZ2UgPSB7fTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW50ZXJQb3NLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGNvbW1lbnQgPSBpbnRlclBvc1tpbnRlclBvc0tleXNbaV1dOwogICAgICBjb25zdCBzdG9yZWQgPSBzdG9yZVBvc1tpbnRlclBvc0tleXNbaV1dOwogICAgICBpZiAoc3RvcmVkKSBuZXdTdG9yYWdlW2NvbW1lbnQuaWRdID0geyAuLi5zdG9yZWQsIElEOiBjb21tZW50LmlkIH07CiAgICB9CiAgICBjb21tZW50U3RvcmUgPSBuZXdTdG9yYWdlOwogIH0KCiAgZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkgewogICAgaWYgKFNjcmF0Y2guZ3VpKSBTY3JhdGNoLmd1aS5nZXRCbG9ja2x5KCkudGhlbihTQiA9PiB7CiAgICAgIGNvbnN0IHsgRXZlbnRzLCBtYWluV29ya3NwYWNlIH0gPSBTQjsKICAgICAgY29uc3QgY29tbWVudHMgPSBtYWluV29ya3NwYWNlLmNvbW1lbnREQl87CiAgICAgIGNvbnN0IHdvcmtzcGFjZUV2ZW50cyA9IChldmVudCkgPT4gewogICAgICAgIGlmIChtYWluV29ya3NwYWNlLmlkID09PSBldmVudC53b3Jrc3BhY2VJZCkgewogICAgICAgICAgY29uc3QgY29tbWVudCA9IGNvbW1lbnRzW2V2ZW50LmNvbW1lbnRJZF07CiAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gRXZlbnRzLkNPTU1FTlRfTU9WRSkgcmVkb0NvbW1lbnQoY29tbWVudCk7CiAgICAgICAgICBlbHNlIGlmIChldmVudC50eXBlID09PSBFdmVudHMuQ09NTUVOVF9DUkVBVEUpIHsKICAgICAgICAgICAgcmVkb0NvbW1lbnQoY29tbWVudCk7CiAgICAgICAgICAgIHVwZGF0ZUNvbW1lbnQoY29tbWVudCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09IEV2ZW50cy5DT01NRU5UX0NIQU5HRSkgewogICAgICAgICAgICBjb25zdCBpc01pbiA9IGV2ZW50Lm5ld0NvbnRlbnRzXy5taW5pbWl6ZWQKICAgICAgICAgICAgaWYgKGlzTWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb21tZW50LlNQYnV0dG9uc1swXS5zdHlsZS5kaXNwbGF5ID0gaXNNaW4gPyAibm9uZSIgOiAiaW5saW5lIjsKICAgICAgICAgICAgICBjb21tZW50LlNQYnV0dG9uc1sxXS5zdHlsZS5kaXNwbGF5ID0gaXNNaW4gPyAibm9uZSIgOiAiaW5saW5lIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzTWluKSBjb252ZXJ0Mk1kKGNvbW1lbnQsIGNvbW1lbnQuZ2V0VGV4dCgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIG1haW5Xb3Jrc3BhY2UuYWRkQ2hhbmdlTGlzdGVuZXIod29ya3NwYWNlRXZlbnRzKTsKICAgICAgdXBkYXRlQWxsQ29tbWVudHMoKTsKICAgICAgcnVudGltZS5vbmNlKCJQUk9KRUNUX0xPQURFRCIsICgpID0+IHsKICAgICAgICBmaXhTdG9yYWdlKG1haW5Xb3Jrc3BhY2UpOyAvLyBDb21tZW50IElEcyBhcmUgZGlmZmVyZW50IHVwb24gcHJvamVjdCBsb2FkCiAgICAgICAgdXBkYXRlQWxsQ29tbWVudHMoKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHN0YXJ0TGlzdGVuZXJXb3JrZXIoKSB7CiAgICBjb25zdCBjaGVja0luRWRpdG9yID0gKCkgPT4gIVJlZHV4U3RvcmUuZ2V0U3RhdGUoKS5zY3JhdGNoR3VpLm1vZGUuaXNQbGF5ZXJPbmx5OwogICAgbGV0IGluRWRpdG9yID0gY2hlY2tJbkVkaXRvcigpOwogICAgaWYgKGluRWRpdG9yKSBhdHRhY2hFdmVudHMoKTsKICAgIFJlZHV4U3RvcmUuc3Vic2NyaWJlKCgpID0+IHsKICAgICAgY29uc3QgY3VycmVudGx5SW5FZGl0b3IgPSBjaGVja0luRWRpdG9yKCk7CiAgICAgIGlmIChpbkVkaXRvciAhPT0gY3VycmVudGx5SW5FZGl0b3IpIHsKICAgICAgICBpbkVkaXRvciA9IGN1cnJlbnRseUluRWRpdG9yOwogICAgICAgIGlmIChpbkVkaXRvcikgYXR0YWNoRXZlbnRzKCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAodHlwZW9mIHNjYWZmb2xkaW5nID09PSAidW5kZWZpbmVkIikgc3RhcnRMaXN0ZW5lcldvcmtlcigpOwoKICBjbGFzcyBTUGNvbW1lbnRzIHsKICAgIGdldEluZm8oKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6ICJTUGNvbW1lbnRzIiwKICAgICAgICBuYW1lOiAiQmV0dGVyIENvbW1lbnRzIiwKICAgICAgICBjb2xvcjE6ICIjYjhhZjM3IiwKICAgICAgICBtZW51SWNvblVSSSwKICAgICAgICBibG9ja3M6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgZnVuYzogInR1dG9yaWFsIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CVVRUT04sCiAgICAgICAgICAgIHRleHQ6ICJDb21tZW50IEZvcm1hdHRpbmciCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJzYXZlIiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IGlzUE0sIHRleHQ6ICJwbGFjZSBtZSBpbiBwcm9qZWN0IHRvIHNhdmUiCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9OwogICAgfQoKICAgIHR1dG9yaWFsKCkgewogICAgICBhbGVydChbCiAgICAgICAgIkNhbiBiZSBJbmxpbmVkOlxuIiwKICAgICAgICAiQm9sZCBUZXh0IOKGkiAqKnRleHQqKlxuIiwiSXRhbGljIFRleHQg4oaSICovdGV4dCovXG4iLCJTdHJpa2UgVGV4dCDihpIgfn50ZXh0fn5cbiIsIkhlYWRlciAxIFRleHQg4oaSICMxdGV4dCMxXG4iLCJIZWFkZXIgMiBUZXh0IOKGkiAjMnRleHQjMlxuIiwKICAgICAgICAiXG5DYW5ub3QgYmUgSW5saW5lZDpcbiIsCiAgICAgICAgIkNvbG9yIOKGkiBAYyAjZmYwMDAwOiB0ZXh0QGNcbiIsIkhpZ2hsaWdodCDihpIgQGggIzAwZmYwMDogdGV4dEBoXG4iLCJGb250IOKGkiBAZiBuYW1lOiB0ZXh0QGZcbiIsCiAgICAgICAgIkltYWdlIOKGkiA8aSB1cmwgaT5cbiIsICJBdWRpbyDihpIgPGEgdXJsIGE+XG4iLCAiVmlkZW8g4oaSIDx2IHVybCB2PiIKICAgICAgXS5qb2luKCIiKSk7CiAgICB9CgogICAgLy8gVFcgU3RvcmFnZQogICAgc2F2ZSgpIHsgcmV0dXJuIH0KCiAgICAvLyBQZW5ndWluTW9kIFN0b3JhZ2UKICAgIHNlcmlhbGl6ZSgpIHsKICAgICAgcmV0dXJuIHsgU1Bjb21tZW50czogeyBzdG9yYWdlOiBjb21tZW50U3RvcmUgfSB9CiAgICB9CiAgICBkZXNlcmlhbGl6ZShkYXRhKSB7CiAgICAgIGlmIChkYXRhLlNQY29tbWVudHMgIT09IHVuZGVmaW5lZCkgY29tbWVudFN0b3JlID0gZGF0YS5TUGNvbW1lbnRzLnN0b3JhZ2U7CiAgICB9CiAgfQoKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IFNQY29tbWVudHMoKSk7Cn0pKFNjcmF0Y2gpOwo=","https://extensions.turbowarp.org/Lily/MoreEvents.js","data:text/javascript;base64,Ly8gTmFtZTogS2V5cysgVjIKLy8gSUQ6IGVuZGVyS2V5c1BsdXNWMgovLyBEZXNjcmlwdGlvbjogRXZlbiBtb3JlIHBvd2VyZnVsIGFuZCBmbGV4aWJsZSBrZXkgcHJlc3MgZGV0ZWN0aW9uIGJsb2NrcyB3aXRoIHNvbWUgYWRkaXRpb25hbCBmZWF0dXJlcy4KLy8gQnk6IFN0YWNrT3ZlcmZsb3cKLy8gT3JpZ2luYWw6IFN0YWNrT3ZlcmZsb3cKLy8gTGljZW5zZTogTUlUICYgTEdQTC0zLjAKCihmdW5jdGlvbihTY3JhdGNoKXsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBpZiAoIVNjcmF0Y2guZXh0ZW5zaW9ucy51bnNhbmRib3hlZCkgdGhyb3cgbmV3IEVycm9yKCJLZXlzKyBWMiBtdXN0IHJ1biB1bnNhbmRib3hlZCEiKTsKCiAgICBjb25zdCBydW50aW1lID0gU2NyYXRjaC52bS5ydW50aW1lOwogICAgY29uc3QgQ2FzdCA9IFNjcmF0Y2guQ2FzdDsKCiAgICBjb25zdCBfZm9ybWF0ID0gewogICAgICAgIHRvVmFsdWU6IFsKICAgICAgICAgICAgIkYxIiwgIkYyIiwgIkYzIiwgIkY0IiwgIkY1IiwgIkY2IiwgIkY3IiwgIkY4IiwgIkY5IiwgIkYxMCIsICJGMTEiLCAiRjEyIiwKICAgICAgICAgICAgIkRpZ2l0MCIsICJEaWdpdDEiLCAiRGlnaXQyIiwgIkRpZ2l0MyIsICJEaWdpdDQiLCAiRGlnaXQ1IiwgIkRpZ2l0NiIsICJEaWdpdDciLCAiRGlnaXQ4IiwgIkRpZ2l0OSIsCiAgICAgICAgICAgICJLZXlBIiwgIktleUIiLCAiS2V5QyIsICJLZXlEIiwgIktleUUiLCAiS2V5RiIsICJLZXlHIiwgIktleUgiLCAiS2V5SSIsICJLZXlKIiwgIktleUsiLCAiS2V5TCIsICJLZXlNIiwgIktleU4iLCAiS2V5TyIsICJLZXlQIiwgIktleVEiLCAiS2V5UiIsICJLZXlTIiwgIktleVQiLCAiS2V5VSIsICJLZXlWIiwgIktleVciLCAiS2V5WCIsICJLZXlZIiwgIktleVoiLAogICAgICAgICAgICAiQmFja3F1b3RlIiwgIk1pbnVzIiwgIkVxdWFsIiwgIkJyYWNrZXRMZWZ0IiwgIkJyYWNrZXRSaWdodCIsICJCYWNrc2xhc2giLCAiU2VtaWNvbG9uIiwgIlF1b3RlIiwgIkNvbW1hIiwgIlBlcmlvZCIsICJTbGFzaCIKICAgICAgICBdLAogICAgICAgIHRvQ3VzdG9tVmFsdWU6IHsKICAgICAgICAgICAgIk1ldGFMZWZ0IjogImxlZnQgd2luZG93cyBrZXkiLAogICAgICAgICAgICAiTWV0YVJpZ2h0IjogInJpZ2h0IHdpbmRvd3Mga2V5IiwKICAgICAgICAgICAgIkNvbnRyb2xMZWZ0IjogImxlZnQgY29udHJvbCIsCiAgICAgICAgICAgICJDb250cm9sUmlnaHQiOiAicmlnaHQgY29udHJvbCIsCiAgICAgICAgICAgICJBbHRMZWZ0IjogImxlZnQgYWx0IiwKICAgICAgICAgICAgIkFsdFJpZ2h0IjogInJpZ2h0IGFsdCIsCiAgICAgICAgICAgICJTaGlmdExlZnQiOiAibGVmdCBzaGlmdCIsCiAgICAgICAgICAgICJTaGlmdFJpZ2h0IjogInJpZ2h0IHNoaWZ0IiwKICAgICAgICAgICAgIkFycm93VXAiOiAidXAgYXJyb3ciLAogICAgICAgICAgICAiQXJyb3dEb3duIjogImRvd24gYXJyb3ciLAogICAgICAgICAgICAiQXJyb3dMZWZ0IjogImxlZnQgYXJyb3ciLAogICAgICAgICAgICAiQXJyb3dSaWdodCI6ICJyaWdodCBhcnJvdyIKICAgICAgICB9CiAgICB9OwogICAgY29uc3QgX2ZpbHRlciA9IHsKICAgICAgICBkZWZhdWx0OiBbCiAgICAgICAgICAgICJfYSIsICJfYiIsICJfYyIsICJfZCIsICJfZSIsICJfZiIsICJfZyIsICJfaCIsICJfaSIsICJfaiIsICJfayIsICJfbCIsICJfbSIsCiAgICAgICAgICAgICJfbiIsICJfbyIsICJfcCIsICJfcSIsICJfciIsICJfcyIsICJfdCIsICJfdSIsICJfdiIsICJfdyIsICJfeCIsICJfeSIsICJfeiIsCiAgICAgICAgICAgICJfQSIsICJfQiIsICJfQyIsICJfRCIsICJfRSIsICJfRiIsICJfRyIsICJfSCIsICJfSSIsICJfSiIsICJfSyIsICJfTCIsICJfTSIsCiAgICAgICAgICAgICJfTiIsICJfTyIsICJfUCIsICJfUSIsICJfUiIsICJfUyIsICJfVCIsICJfVSIsICJfViIsICJfVyIsICJfWCIsICJfWSIsICJfWiIsCiAgICAgICAgICAgICJfMCIsICJfMSIsICJfMiIsICJfMyIsICJfNCIsICJfNSIsICJfNiIsICJfNyIsICJfOCIsICJfOSIsCiAgICAgICAgICAgICJfYCIsICJffiIsICJfISIsICJfQCIsICJfIyIsICJfJCIsICJfJSIsICJfXiIsICJfJiIsICJfKiIsCiAgICAgICAgICAgICJfKCIsICJfKSIsICJfLSIsICJfXyIsICJfPSIsICJfKyIsICJfWyIsICJfeyIsICJfXSIsICJffSIsCiAgICAgICAgICAgICJfXFwiLCAiX3wiLCAiXzsiLCAiXzoiLCAiXyciLCAiXCIiLCAiXywiLCAiXzwiLCAiXy4iLCAiXz4iLAogICAgICAgICAgICAiXy8iLCAiXz8iLCAiXyAiCiAgICAgICAgXSwKICAgICAgICBzaGlmdDogWyAiX2xlZnQgc2hpZnQiLCAiX3JpZ2h0IHNoaWZ0IiBdLAogICAgfTsKICAgIGZ1bmN0aW9uIGZvcm1hdChfa2V5KSB7CiAgICAgICAgY29uc3QgbmFtZSA9IF9rZXkuY29kZSwgdmFsdWUgPSBfa2V5LmtleTsKICAgICAgICBpZiAoX2Zvcm1hdC50b1ZhbHVlLmluY2x1ZGVzKG5hbWUpKSByZXR1cm4gIl8iICsgdmFsdWU7CiAgICAgICAgaWYgKG5hbWUuc3RhcnRzV2l0aCgiTnVtcGFkIikpIHJldHVybiAiX251bXBhZDogIiArIG5hbWUuc2xpY2UoNikudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobmFtZSBpbiBfZm9ybWF0LnRvQ3VzdG9tVmFsdWUpIHJldHVybiAiXyIgKyBfZm9ybWF0LnRvQ3VzdG9tVmFsdWVbbmFtZV07CiAgICAgICAgcmV0dXJuICJfIiArIG5hbWUucmVwbGFjZSgvKFthLXowLTldKShbQS1aXSkvZywgJyQxICQyJykudG9Mb3dlckNhc2UoKTsKICAgIH0KICAgIGNvbnN0IGNyZWF0ZUxhYmVsID0gKHRleHQpID0+ICh7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6IHRleHQgfSk7CgogICAgZnVuY3Rpb24gc3RhcnRLZXlFdmVudHMoX3RyaWdnZXIpIHsKICAgICAgICBydW50aW1lLnN0YXJ0SGF0cygiZW5kZXJLZXlzUGx1c1YyX2V2ZW50S2V5UHJlc3NlZCIsIHsgdHJpZ2dlcjogX3RyaWdnZXIgfSk7CiAgICAgICAgcnVudGltZS5zdGFydEhhdHMoImVuZGVyS2V5c1BsdXNWMl9ldmVudEtleXNQcmVzc2VkIiwgeyB0cmlnZ2VyOiBfdHJpZ2dlciB9KTsKICAgICAgICBydW50aW1lLnN0YXJ0SGF0cygiZW5kZXJLZXlzUGx1c1YyX2V2ZW50S2V5YmluZFRyaWdnZXJlZCIsIHsgdHJpZ2dlcjogX3RyaWdnZXIgfSk7CiAgICB9CgogICAgY2xhc3MgZW5kZXJLZXlzUGx1c1YyIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICAgICAiY2xlYXJPbkJsdXIiOiB0cnVlLAogICAgICAgICAgICAgICAgImluY2x1ZGVUYWdzIjogdHJ1ZQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGhpcy5fdGFncyA9IHsKICAgICAgICAgICAgICAgICIjYSI6IFsiYSIsICJBIl0sICIjYiI6IFsiYiIsICJCIl0sICIjYyI6IFsiYyIsICJDIl0sICIjZCI6IFsiZCIsICJEIl0sICIjZSI6IFsiZSIsICJFIl0sICIjZiI6IFsiZiIsICJGIl0sICIjZyI6IFsiZyIsICJHIl0sICIjaCI6IFsiaCIsICJIIl0sICIjaSI6IFsiaSIsICJJIl0sICIjaiI6IFsiaiIsICJKIl0sICIjayI6IFsiayIsICJLIl0sICIjbCI6IFsibCIsICJMIl0sICIjbSI6IFsibSIsICJNIl0sCiAgICAgICAgICAgICAgICAiI24iOiBbIm4iLCAiTiJdLCAiI28iOiBbIm8iLCAiTyJdLCAiI3AiOiBbInAiLCAiUCJdLCAiI3EiOiBbInEiLCAiUSJdLCAiI3IiOiBbInIiLCAiUiJdLCAiI3MiOiBbInMiLCAiUyJdLCAiI3QiOiBbInQiLCAiVCJdLCAiI3UiOiBbInUiLCAiVSJdLCAiI3YiOiBbInYiLCAiViJdLCAiI3ciOiBbInciLCAiVyJdLCAiI3giOiBbIngiLCAiWCJdLCAiI3kiOiBbInkiLCAiWSJdLCAiI3oiOiBbInoiLCAiWiJdLAogICAgICAgICAgICAgICAgIiNsZXR0ZXJzIjogWyJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIl0sCiAgICAgICAgICAgICAgICAiI3VwcGVyY2FzZUxldHRlcnMiOiBbIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiJdLAogICAgICAgICAgICAgICAgIiNsb3dlcmNhc2VMZXR0ZXJzIjogWyJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiXSwKICAgICAgICAgICAgICAgICIjdm93ZWxzIjogWyJhIiwgImUiLCAiaSIsICJvIiwgInUiXSwKICAgICAgICAgICAgICAgICIjY29uc29uYW50cyI6IFsiYiIsICJjIiwgImQiLCAiZiIsICJnIiwgImgiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiXSwKICAgICAgICAgICAgICAgICIjbnVtYmVycyI6IFsiMCIsICIxIiwgIjIiLCAiMyIsICI0IiwgIjUiLCAiNiIsICI3IiwgIjgiLCAiOSJdLAogICAgICAgICAgICAgICAgIiNzcGVjaWFsQ2hhcmFjdGVycyI6IFsiISIsICJAIiwgIiMiLCAiJCIsICIlIiwgIl4iLCAiJiIsICIqIiwgIigiLCAiKSIsICJfIiwgIisiLCAiPSIsICJ7IiwgIn0iLCAiWyIsICJdIiwgInwiLCAiXFwiLCAiOiIsICI7IiwgIiciLCAiXCIiLCAiPCIsICI+IiwgIiwiLCAiLiIsICI/IiwgIi8iLCAifiIsICJgIl0sCiAgICAgICAgICAgICAgICAiI3NoaWZ0IjogWyJsZWZ0IHNoaWZ0IiwgInJpZ2h0IHNoaWZ0Il0sCiAgICAgICAgICAgICAgICAiI2FsdCI6IFsibGVmdCBhbHQiLCAicmlnaHQgYWx0Il0sCiAgICAgICAgICAgICAgICAiI2NvbnRyb2wiOiBbImxlZnQgY29udHJvbCIsICJyaWdodCBjb250cm9sIl0sCiAgICAgICAgICAgICAgICAiI3dpbmRvd3NLZXkiOiBbImxlZnQgd2luZG93cyBrZXkiLCAicmlnaHQgd2luZG93cyBrZXkiXSwKICAgICAgICAgICAgICAgICIjYXJyb3dLZXlzIjogWyJ1cCBhcnJvdyIsICJkb3duIGFycm93IiwgInJpZ2h0IGFycm93IiwgImxlZnQgYXJyb3ciXSwKICAgICAgICAgICAgICAgICIjZnVuY3Rpb25LZXlzIjogWyJGMSIsICJGMiIsICJGMyIsICJGNCIsICJGNSIsICJGNiIsICJGNyIsICJGOCIsICJGOSIsICJGMTAiLCAiRjExIiwgIkYxMiJdLAogICAgICAgICAgICAgICAgIiNuYXZpZ2F0aW9uS2V5cyI6IFsidXAgYXJyb3ciLCAiZG93biBhcnJvdyIsICJyaWdodCBhcnJvdyIsICJsZWZ0IGFycm93IiwgImhvbWUiLCAiZW5kIiwgInBhZ2UgdXAiLCAicGFnZSBkb3duIiwgImluc2VydCIsICJkZWxldGUiXSwKICAgICAgICAgICAgICAgICIjbnVtcGFkIjogWyJudW1wYWQ6IGRpdmlkZSIsICJudW1wYWQ6IG11bHRpcGx5IiwgIm51bXBhZDogc3VidHJhY3QiLCAibnVtcGFkOiBhZGQiLCAibnVtcGFkOiAwIiwgIm51bXBhZDogMSIsICJudW1wYWQ6IDIiLCAibnVtcGFkOiAzIiwgIm51bXBhZDogNCIsICJudW1wYWQ6IDUiLCAibnVtcGFkOiA2IiwgIm51bXBhZDogNyIsICJudW1wYWQ6IDgiLCAibnVtcGFkOiA5IiwgIm51bXBhZDogZGVjaW1hbCIsICJudW1wYWQ6IGVudGVyIl0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5fa2V5YmluZHMgPSB7fTsKCiAgICAgICAgICAgIHRoaXMuX21vdXNlRG93biA9IHt9OwogICAgICAgICAgICB0aGlzLl9zY3JvbGxEZWx0YVkgPSAwOwogICAgICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsVGltZSA9IERhdGUubm93KCk7CgogICAgICAgICAgICB0aGlzLl9rZXlzUHJlc3NlZCA9IHt9OwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5UHJlc3NlZCA9ICIiOwoKICAgICAgICAgICAgdGhpcy5faW1wb3J0RXJyb3IgPSAiTm9uZSI7CgogICAgICAgICAgICBydW50aW1lLm9uKCJCRUZPUkVfRVhFQ1VURSIsICgpID0+IHsKICAgICAgICAgICAgICAgIHJ1bnRpbWUuc3RhcnRIYXRzKCJlbmRlcktleXNQbHVzVjJfZXZlbnRNb3VzZURvd24iLCB7IHRyaWdnZXI6ICJ3aGlsZSIgfSk7CiAgICAgICAgICAgICAgICBzdGFydEtleUV2ZW50cygid2hpbGUiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIEtleXMKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IGZvcm1hdChldmVudCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S2V5UHJlc3NlZCA9IGtleTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fa2V5c1ByZXNzZWRba2V5XSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleXNQcmVzc2VkW2tleV0gPSB7IHRpbWU6IERhdGUubm93KCksIGNvZGU6IGV2ZW50LmNvZGUsIHZhbHVlOiBldmVudC5rZXkgfTsKICAgICAgICAgICAgICAgICAgICBzdGFydEtleUV2ZW50cygid2hlbiIpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIChldmVudCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gZm9ybWF0KGV2ZW50KTsKICAgICAgICAgICAgICAgIHN0YXJ0S2V5RXZlbnRzKCJhZnRlciIpOwogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2tleXNQcmVzc2VkW2tleV07CiAgICAgICAgICAgICAgICB0aGlzLl9maWx0ZXIoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzWyJjbGVhck9uQmx1ciJdKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5c1ByZXNzZWQgPSB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3VzZURvd24gPSB7fTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBNb3VzZQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX21vdXNlRG93bltldmVudC5idXR0b25dKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW91c2VEb3duW2V2ZW50LmJ1dHRvbl0gPSB7IHRpbWU6IERhdGUubm93KCkgfTsKICAgICAgICAgICAgICAgICAgICBydW50aW1lLnN0YXJ0SGF0cygiZW5kZXJLZXlzUGx1c1YyX2V2ZW50TW91c2VEb3duIiwgeyB0cmlnZ2VyOiAid2hlbiIgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIChldmVudCkgPT4gewogICAgICAgICAgICAgICAgcnVudGltZS5zdGFydEhhdHMoImVuZGVyS2V5c1BsdXNWMl9ldmVudE1vdXNlRG93biIsIHsgdHJpZ2dlcjogImFmdGVyIiB9KTsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9tb3VzZURvd25bZXZlbnQuYnV0dG9uXTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JvbGxEZWx0YVkgPSBldmVudC5kZWx0YVk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsVGltZSA9IERhdGUubm93KCkKICAgICAgICAgICAgICAgIHJ1bnRpbWUuc3RhcnRIYXRzKCJlbmRlcktleXNQbHVzVjJfZXZlbnRTY3JvbGwiKQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZ2V0SW5mbygpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiAiZW5kZXJLZXlzUGx1c1YyIiwKICAgICAgICAgICAgICAgIG5hbWU6ICJLZXlzKyBWMiIsCiAgICAgICAgICAgICAgICBkb2NzVVJJOiAiaHR0cHM6Ly9naXRodWIuY29tL0VuZGVyLVN0dWRpby9FbmRlclN0dWRpby1FeHRlbnNpb25zL3dpa2kvRXh0ZW5zaW9ucyNrZXlzIiwKICAgICAgICAgICAgICAgIGNvbG9yMTogIiM2NDc5NzAiLAogICAgICAgICAgICAgICAgY29sb3IyOiAiIzRENUU1NiIsCiAgICAgICAgICAgICAgICBibG9ja3M6IFsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVMYWJlbCgiTW91c2UiKSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImV2ZW50TW91c2VEb3duIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5IQVQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJbdHJpZ2dlcl0gW2J1dHRvbl0gbW91c2UgYnV0dG9uIGlzIGRvd24iLAogICAgICAgICAgICAgICAgICAgICAgICBpc0VkZ2VBY3RpdmF0ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiZXZlbnRUcmlnZ2VyQ29uZGl0aW9uIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIm1vdXNlQnV0dG9ucyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImlzTW91c2VEb3duIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgW2J1dHRvbl0gbW91c2UgYnV0dG9uIGRvd24/IiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b246IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAibW91c2VCdXR0b25zIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiaXNNb3VzZUhpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImlzIFtidXR0b25dIG1vdXNlIGJ1dHRvbiBjbGlja2VkPyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIm1vdXNlQnV0dG9ucyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInRpbWVNb3VzZURvd24iLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAidGltZSBbYnV0dG9uXSBtb3VzZSBidXR0b24gZG93biIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIm1vdXNlQnV0dG9ucyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVMYWJlbCgiU2Nyb2xsaW5nIiksCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJldmVudFNjcm9sbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuSEFULAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAid2hlbiBzY3JvbGxpbmcgW2Rpcl0iLAogICAgICAgICAgICAgICAgICAgICAgICBpc0VkZ2VBY3RpdmF0ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJ1cERvd24iIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJpc1Njcm9sbGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImlzIHNjcm9sbGluZyBbZGlyXT8iLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTW9uaXRvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAidXBEb3duIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAic2Nyb2xsRGlyZWN0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogInNjcm9sbCBkaXJlY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVMYWJlbCgiS2V5cyIpLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiZXZlbnRLZXlzUHJlc3NlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuSEFULAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiW3RyaWdnZXJdIO+8u1trZXlzXe+8vSBrZXlzIGlzIHByZXNzZWQgW29yZGVyZWRdIiwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFZGdlQWN0aXZhdGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImV2ZW50VHJpZ2dlckNvbmRpdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyZWQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAib3JkZXJNb2RlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5czogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogJyJhIiwgImIiLCAiYyInIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJldmVudEtleVByZXNzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkhBVCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIlt0cmlnZ2VyXSBba2V5XSBrZXkgaXMgcHJlc3NlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRWRnZUFjdGl2YXRlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJldmVudFRyaWdnZXJDb25kaXRpb24iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAia2V5cyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImlzS2V5c1ByZXNzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJhcmUg77y7W2tleXNd77y9IGtleXMgcHJlc3NlZCBbb3JkZXJlZF0/IiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcmVkOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIm9yZGVyTW9kZSIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXM6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICciYSIsICJiIiwgImMiJyB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiaXNLZXlQcmVzc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgW2tleV0ga2V5IHByZXNzZWQ/IiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAia2V5cyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImlzS2V5c0hpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImFyZSDvvLtba2V5c13vvL0ga2V5cyBoaXQgW29yZGVyZWRdPyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXJlZDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJvcmRlck1vZGUiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAnImEiLCAiYiIsICJjIicgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImlzS2V5SGl0IiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgW2tleV0ga2V5IGhpdD8iLAogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJrZXlzIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAibGFzdEtleVByZXNzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAibGFzdCBrZXkgcHJlc3NlZCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiY3VycmVudEtleXNQcmVzc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImN1cnJlbnQga2V5cyBwcmVzc2VkIiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiY3VycmVudEtleVByZXNzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiY3VycmVudCBrZXkgcHJlc3NlZCIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImtleVByZXNzZWRQcm9wZXJ0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJjdXJyZW50IGtleSBwcmVzc2VkIFtwcm9wZXJ0eV0iLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTW9uaXRvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJrZXlQcm9wZXJ0eSIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInRpbWVLZXlzUHJlc3NlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJ0aW1lIO+8u1trZXlzXe+8vSBrZXlzIHByZXNzZWQgW21vZGVdIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1vbml0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJyZXR1cm5Nb2RlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5czogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogJyJhIiwgImIiLCAiYyInIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJ0aW1lS2V5UHJlc3NlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJ0aW1lIFtrZXldIGtleSBwcmVzc2VkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1vbml0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImtleXMiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlTGFiZWwoIktleWJpbmRpbmciKSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImV2ZW50S2V5YmluZFRyaWdnZXJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuSEFULAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiW3RyaWdnZXJdIFtldmVudF0gaXMgdHJpZ2dlcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFZGdlQWN0aXZhdGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImV2ZW50VHJpZ2dlckNvbmRpdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiZXZlbnQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIi0tLSIsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJ3aGlsZUtleWJpbmRUcmlnZ2VyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJ3aGlsZSBbZXZlbnRdIGlzIHRyaWdnZXJlZD8iLAogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiZXZlbnQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJ3aGVuS2V5YmluZFRyaWdnZXJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogIndoZW4gW2V2ZW50XSBpcyB0cmlnZ2VyZWQ/IiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImV2ZW50IiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiY2F1c2VLZXliaW5kVHJpZ2dlcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImNhdXNlIG9mIFtldmVudF0gdHJpZ2dlcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1vbml0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJldmVudCIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInRpbWVLZXliaW5kVHJpZ2dlcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogInRpbWUgW2V2ZW50XSBpcyB0cmlnZ2VyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTW9uaXRvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImV2ZW50IiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAia2V5YmluZEJpbmRNdWx0aXBsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImJpbmQg77y7W2tleXNd77y9IGtleXMgW21vZGVdIGFzIFt0cmlnZ2VyXSB0byBbZXZlbnRdIiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAnImEiLCAiYiIsICJjIicgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAib3JkZXJNb2RlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInRyaWdnZXIiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImV2ZW50IiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAia2V5YmluZEJpbmQiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJiaW5kIGtleSBba2V5XSBhcyBbdHJpZ2dlcl0gdG8gW2V2ZW50XSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImtleXMiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidHJpZ2dlciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiZXZlbnQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJrZXliaW5kVW5iaW5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAidW5iaW5kIHRyaWdnZXIgW3RyaWdnZXJdIGZyb20gW2V2ZW50XSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInRyaWdnZXIiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImV2ZW50IiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAia2V5YmluZFJlc2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAicmVzZXQgYmluZHMgb2YgW2V2ZW50XSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJldmVudCIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInJlc2V0QWxsS2V5YmluZHMiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJyZXNldCBhbGwga2V5YmluZGluZ3MiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImtleWJpbmRMaXN0VHJpZ2dlcnMiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAibGlzdCB0cmlnZ2VycyBvZiBbZXZlbnRdIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1vbml0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJldmVudCIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImtleWJpbmRLZXlzSW5UcmlnZ2VyIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImtleXMgYm91bmQgdG8gW3RyaWdnZXJdIGluIFtldmVudF0iLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTW9uaXRvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidHJpZ2dlciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiZXZlbnQiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgIi0tLSIsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJsaXN0QWxsS2V5YmluZHMiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAibGlzdCBhbGwga2V5YmluZGluZ3MiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImxpc3RBY3RpdmVLZXliaW5kcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJsaXN0IGFjdGl2ZSBrZXliaW5kaW5ncyIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUxhYmVsKCJUYWdzIiksCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJjcmVhdGVUYWciLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJzZXQgdmFsdWUgb2YgdGFnOiAjW3RhZ10gdG8g77y7W2tleXNd77y9IiwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWc6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhYmMiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAnImEiLCAiYiIsICJjIicgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImRlbGV0ZVRhZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImRlbGV0ZSB0YWc6ICNbdGFnXSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYWJjIiB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiZGVsZXRlQWxsVGFncyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImRlbGV0ZSBhbGwgdGFncyIsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInZhbHVlT2ZUYWciLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAidmFsdWUgb2YgdGFnOiAjW3RhZ10iLAogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFiYyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImxpc3RUYWdzIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImxpc3QgYWxsIHRhZ3MiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVMYWJlbCgiU3RvcmFnZSIpLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiaW1wb3J0IiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaW1wb3J0IFt0eXBlXSBmcm9tIFtqc29uXSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJkYXRhIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAganNvbjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogIiIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogImltcG9ydEVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImltcG9ydCBlcnJvciIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICItLS0iLAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAiZXhwb3J0IiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogImV4cG9ydCBbdHlwZV0iLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTW9uaXRvcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImRhdGEiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlTGFiZWwoIlNldHRpbmdzIiksCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJ0b2dnbGVTZXR0aW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAic2V0IFtzZXR0aW5nXSB0byBbdG9nZ2xlXSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJzZXR0aW5ncyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJ0b2dnbGUiIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICJpc1NldHRpbmdFbmFibGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAiaXMgW3NldHRpbmddIGVuYWJsZWQ/IiwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZU1vbml0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJzZXR0aW5ncyIgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiLS0tIiwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogInJlc2V0U2V0dGluZ3MiLAogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICJyZXNldCBhbGwgc2V0dGluZ3MiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIG1lbnVzOiB7CiAgICAgICAgICAgICAgICAgICAgbW91c2VCdXR0b25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRleHQ6ICJsZWZ0IiwgdmFsdWU6ICIwIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiAic2Nyb2xsIHdoZWVsIiwgdmFsdWU6ICIxIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiAicmlnaHQiLCB2YWx1ZTogIjIiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRleHQ6ICJiYWNrIiwgdmFsdWU6ICIzIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiAiZm9yd2FyZCIsIHZhbHVlOiAiNCIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBrZXlzOiB7IGl0ZW1zOiAiX2dldEtleXNNZW51IiwgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGV4dDogImNsZWFyIG9uIGJsdXIiLCB2YWx1ZTogImNsZWFyT25CbHVyIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiAiaW5jbHVkZSB0YWdzIG9uIG1lbnUiLCB2YWx1ZTogImluY2x1ZGVUYWdzIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBldmVudFRyaWdnZXJDb25kaXRpb246IHsgaXRlbXM6IFsid2hlbiIsICJ3aGlsZSIsICJhZnRlciJdIH0sCiAgICAgICAgICAgICAgICAgICAga2V5UHJvcGVydHk6IHsgaXRlbXM6IFsidGltZSIsICJuYW1lIiwgImNvZGUiLCAidmFsdWUiXSB9LAogICAgICAgICAgICAgICAgICAgIHJldHVybk1vZGU6IHsgaXRlbXM6IFsidG9nZXRoZXIgJiBpbiBvcmRlciIsICJ0b2dldGhlciAmIGlnbm9yZSBvcmRlciIsICJpbmRpdmlkdWFsbHkiXSB9LAogICAgICAgICAgICAgICAgICAgIG9yZGVyTW9kZTogeyBpdGVtczogWyJ0b2dldGhlciAmIGluIG9yZGVyIiwgInRvZ2V0aGVyICYgaWdub3JlIG9yZGVyIl0gfSwKICAgICAgICAgICAgICAgICAgICB0b2dnbGU6IHsgaXRlbXM6IFsiZW5hYmxlZCIsICJkaXNhYmxlZCJdIH0sCiAgICAgICAgICAgICAgICAgICAgZGF0YTogeyBpdGVtczogWyJhbGwiLCAidGFncyIsICJrZXliaW5kcyIsICJzZXR0aW5ncyJdIH0sCiAgICAgICAgICAgICAgICAgICAgdXBEb3duOiB7IGl0ZW1zOiBbInVwIiwgImRvd24iXSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICAvLyBGaWx0ZXIKICAgICAgICBfZmlsdGVyKCkgeyAKICAgICAgICAgICAgY29uc3Qga2V5c1ByZXNzZWQgPSBydW50aW1lLmlvRGV2aWNlcy5rZXlib2FyZC5fa2V5c1ByZXNzZWQubWFwKGsgPT4gay50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5fa2V5c1ByZXNzZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleU5hbWUgPSBrZXkuc2xpY2UoMSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGlmIChfZmlsdGVyLnNoaWZ0LmluY2x1ZGVzKGtleSkgJiYgIWtleXNQcmVzc2VkLmluY2x1ZGVzKCJzaGlmdCIpKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2tleXNQcmVzc2VkWyJfbGVmdCBzaGlmdCJdOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9rZXlzUHJlc3NlZFsiX3JpZ2h0IHNoaWZ0Il07CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWtleXNQcmVzc2VkLmluY2x1ZGVzKGtleU5hbWUpICYmICgvXl9bYS16QS1aXSQvLnRlc3Qoa2V5KSB8fCBfZmlsdGVyLmRlZmF1bHQuaW5jbHVkZXMoa2V5KSkpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fa2V5c1ByZXNzZWRba2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBIZWxwZXIgRnVuY3Rpb25zCiAgICAgICAgX2dldEtleXNQcmVzc2VkKCkgewogICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5fa2V5c1ByZXNzZWQpOwogICAgICAgICAgICByZXR1cm4ga2V5cy5tYXAoa2V5ID0+IGtleS5zbGljZSgxKSk7CiAgICAgICAgfQogICAgICAgIF9wYXJzZShrZXlzKSB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGtleXMpKSByZXR1cm4ga2V5cy5tYXAoa2V5ID0+IENhc3QudG9TdHJpbmcoa2V5KSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKC9eXFsuKlxdJC8udGVzdChrZXlzKSA/IGtleXMgOiBgWyR7a2V5c31dYCk7CiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShwYXJzZWQpID8gcGFyc2VkLm1hcChrZXkgPT4gQ2FzdC50b1N0cmluZyhrZXkpKSA6IFtdOwogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgX2lzS2V5UHJlc3NlZChfa2V5LCBfc291cmNlKSB7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IENhc3QudG9TdHJpbmcoX2tleSkKICAgICAgICAgICAgY29uc3Qga2V5c1ByZXNzZWQgPSB0aGlzLl9nZXRLZXlzUHJlc3NlZCgpOwogICAgICAgICAgICBpZiAoa2V5c1ByZXNzZWQubGVuZ3RoKSBrZXlzUHJlc3NlZC51bnNoaWZ0KCJhbnkiKTsKICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9ICh0aGlzLl90YWdzW2tleV0gPz8gW10pLmZpbmQoY3VycmVudEtleSA9PiBrZXlzUHJlc3NlZC5pbmNsdWRlcyhjdXJyZW50S2V5KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3NvdXJjZSAKICAgICAgICAgICAgICAgICAgICA/IHsgc291cmNlLCBpc1ByZXNzZWQ6ICEhc291cmNlIH0gCiAgICAgICAgICAgICAgICAgICAgOiAhIXNvdXJjZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3NvdXJjZSAKICAgICAgICAgICAgICAgID8geyBzb3VyY2U6IGtleSwgaXNQcmVzc2VkOiBrZXlzUHJlc3NlZC5pbmNsdWRlcyhrZXkpIH0gCiAgICAgICAgICAgICAgICA6IGtleXNQcmVzc2VkLmluY2x1ZGVzKGtleSk7CiAgICAgICAgfSAgICAgICAgCiAgICAgICAgX2lzS2V5c1ByZXNzZWQoX2tleXMsIG9yZGVyZWQpIHsKICAgICAgICAgICAgY29uc3Qga2V5cyA9IHRoaXMuX3BhcnNlKF9rZXlzKTsKICAgICAgICAgICAgaWYgKCFrZXlzLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAob3JkZXJlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEtleXNQcmVzc2VkKCkuZmlsdGVyKGtleSA9PiBrZXlzLmluY2x1ZGVzKGtleSkpLmpvaW4oKSA9PT0ga2V5cy5qb2luKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGtleXMuZXZlcnkoa2V5ID0+IHRoaXMuX2lzS2V5UHJlc3NlZChrZXkpKTsKICAgICAgICB9CiAgICAgICAgX2lzS2V5YmluZFRyaWdnZXJlZChfZXZlbnQpIHsgCiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5fa2V5YmluZHNbX2V2ZW50XTsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmlnZ2VyIGluIGV2ZW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCBtb2RlID0gZXZlbnRbdHJpZ2dlcl1bIm1vZGUiXTsKICAgICAgICAgICAgICAgIGNvbnN0IGtleXMgPSBldmVudFt0cmlnZ2VyXVsia2V5cyJdOwogICAgICAgICAgICAgICAgY29uc3QgdHJpZ2dlcmVkID0gdGhpcy5faXNLZXlzUHJlc3NlZChrZXlzLCBtb2RlID09PSAidG9nZXRoZXIgJiBpbiBvcmRlciIpOwogICAgICAgICAgICAgICAgaWYgKHRyaWdnZXJlZCkgcmV0dXJuIHsgaXNUcmlnZ2VyZWQ6IHRydWUsIGNhdXNlOiB0cmlnZ2VyIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsgaXNUcmlnZ2VyZWQ6IGZhbHNlLCBjYXVzZTogdW5kZWZpbmVkIH07CiAgICAgICAgfQogIAogICAgICAgIC8vIE1vdXNlCiAgICAgICAgZXZlbnRNb3VzZURvd24oYXJncykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc01vdXNlRG93bihhcmdzKTsKICAgICAgICB9CgogICAgICAgIGlzTW91c2VEb3duKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIENhc3QudG9OdW1iZXIoYXJncy5idXR0b24pIGluIHRoaXMuX21vdXNlRG93bjsKICAgICAgICB9CiAgICAgICAgaXNNb3VzZUhpdChhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aGlzLnRpbWVNb3VzZURvd24oYXJncyk7CiAgICAgICAgICAgIHJldHVybiB0aW1lICE9PSAwICYmIHRpbWUgPD0gMC4wNzU7CiAgICAgICAgfQoKICAgICAgICB0aW1lTW91c2VEb3duKGFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5fbW91c2VEb3duW0Nhc3QudG9OdW1iZXIoYXJncy5idXR0b24pXTsKICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbiA/IChEYXRlLm5vdygpIC0gYnV0dG9uLnRpbWUpIC8gMTAwMCA6IDA7CiAgICAgICAgfQogICAgICAgIC8vIFNjcm9sbGluZwogICAgICAgIGV2ZW50U2Nyb2xsKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIGFyZ3MuZGlyID09PSAidXAiID8gdGhpcy5fc2Nyb2xsRGVsdGFZIDwgMCA6IHRoaXMuX3Njcm9sbERlbHRhWSA+IDA7CiAgICAgICAgfQogICAgICAgIGlzU2Nyb2xsaW5nKHsgZGlyIH0pIHsKICAgICAgICAgICAgY29uc3Qgd2l0aGluUmFuZ2UgPSBEYXRlLm5vdygpIC0gdGhpcy5fbGFzdFNjcm9sbFRpbWUgPCA1MDsKICAgICAgICAgICAgcmV0dXJuIGRpciA9PT0gInVwIiA/IHRoaXMuX3Njcm9sbERlbHRhWSA8IDAgJiYgd2l0aGluUmFuZ2UgOiB0aGlzLl9zY3JvbGxEZWx0YVkgPiAwICYmIHdpdGhpblJhbmdlOwogICAgICAgIH0gICAKICAgICAgICBzY3JvbGxEaXJlY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zY3JvbGxEZWx0YVkgJiYgRGF0ZS5ub3coKSAtIHRoaXMuX2xhc3RTY3JvbGxUaW1lIDwgNTApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxEZWx0YVkgPCAwID8gInVwIiA6ICJkb3duIjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIm5vbmUiOwogICAgICAgIH0gICAgICAgICAgICAKICAgICAgICAvLyBLZXlzCiAgICAgICAgZXZlbnRLZXlzUHJlc3NlZChhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IG9yZGVyZWQgPSBhcmdzLm9yZGVyZWQgPT09ICJ0b2dldGhlciAmIGluIG9yZGVyIjsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzS2V5c1ByZXNzZWQoYXJncy5rZXlzLCBvcmRlcmVkKTsKICAgICAgICB9CiAgICAgICAgZXZlbnRLZXlQcmVzc2VkKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzS2V5UHJlc3NlZChhcmdzLmtleSk7CiAgICAgICAgfQoKICAgICAgICBpc0tleXNQcmVzc2VkKGFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qgb3JkZXJlZCA9IGFyZ3Mub3JkZXJlZCA9PT0gInRvZ2V0aGVyICYgaW4gb3JkZXIiOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNLZXlzUHJlc3NlZChhcmdzLmtleXMsIG9yZGVyZWQpOwogICAgICAgIH0KICAgICAgICBpc0tleVByZXNzZWQoYXJncykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNLZXlQcmVzc2VkKGFyZ3Mua2V5KTsKICAgICAgICB9CgogICAgICAgIGlzS2V5c0hpdChhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aGlzLnRpbWVLZXlzUHJlc3NlZChhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIHRpbWUgIT09IDAgJiYgdGltZSA8PSAwLjA3NTsKICAgICAgICB9CiAgICAgICAgaXNLZXlIaXQoYXJncykgewogICAgICAgICAgICBjb25zdCB0aW1lID0gdGhpcy50aW1lS2V5UHJlc3NlZChhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIHRpbWUgIT09IDAgJiYgdGltZSA8PSAwLjA3NTsKICAgICAgICB9CgogICAgICAgIGxhc3RLZXlQcmVzc2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdEtleVByZXNzZWQuc2xpY2UoMSk7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRLZXlzUHJlc3NlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuX2dldEtleXNQcmVzc2VkKCkpOwogICAgICAgIH0KICAgICAgICBjdXJyZW50S2V5UHJlc3NlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEtleXNQcmVzc2VkKCkucmV2ZXJzZSgpWzBdIHx8ICJOb25lIjsKICAgICAgICB9CiAgICAgICAga2V5UHJlc3NlZFByb3BlcnR5KGFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5jdXJyZW50S2V5UHJlc3NlZCgpOwogICAgICAgICAgICBpZiAoa2V5ID09PSAiTm9uZSIpIHJldHVybiAwOwogICAgICAgICAgICBzd2l0Y2ggKGFyZ3MucHJvcGVydHkpIHsKICAgICAgICAgICAgICAgIGNhc2UgInRpbWUiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpbWVLZXlQcmVzc2VkKHsga2V5OiBrZXkgfSk7CiAgICAgICAgICAgICAgICBjYXNlICJuYW1lIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgY2FzZSAiY29kZSI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleXNQcmVzc2VkWyJfIiArIGtleV0uY29kZTsKICAgICAgICAgICAgICAgIGNhc2UgInZhbHVlIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fa2V5c1ByZXNzZWRbIl8iICsga2V5XS52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGltZUtleXNQcmVzc2VkKGFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qga2V5cyA9IHRoaXMuX3BhcnNlKGFyZ3Mua2V5cyk7CiAgICAgICAgICAgIGlmICgha2V5cy5sZW5ndGgpIHJldHVybiAwOwogICAgICAgICAgICBpZiAoYXJncy5tb2RlID09PSAiaW5kaXZpZHVhbGx5IikgewogICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGtleXMubWFwKGtleSA9PiB0aGlzLnRpbWVLZXlQcmVzc2VkKHsga2V5IH0pKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgb3JkZXJlZCA9IGFyZ3MubW9kZSA9PT0gInRvZ2V0aGVyICYgaW4gb3JkZXIiOwogICAgICAgICAgICBjb25zdCBpc0tleXNQcmVzc2VkID0gdGhpcy5faXNLZXlzUHJlc3NlZChrZXlzLCBvcmRlcmVkKTsKICAgICAgICAgICAgY29uc29sZS5sb2coaXNLZXlzUHJlc3NlZCkKICAgICAgICAgICAgaWYgKGlzS2V5c1ByZXNzZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IG9yZGVyZWQKICAgICAgICAgICAgICAgICAgICA/IGtleXNba2V5cy5sZW5ndGggLSAxXQogICAgICAgICAgICAgICAgICAgIDogdGhpcy5fZ2V0S2V5c1ByZXNzZWQoKQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGtleSA9PiBrZXlzLmluY2x1ZGVzKGtleSkpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXZlcnNlKClbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aW1lS2V5UHJlc3NlZCh7IGtleToga2V5IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICB0aW1lS2V5UHJlc3NlZChhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9pc0tleVByZXNzZWQoYXJncy5rZXksIHRydWUpOwogICAgICAgICAgICBjb25zdCBrZXkgPSB0aGlzLl9rZXlzUHJlc3NlZFsiXyIgKyBkYXRhLnNvdXJjZV07CiAgICAgICAgICAgIHJldHVybiBrZXkgPyAoRGF0ZS5ub3coKSAtIGtleS50aW1lKSAvIDEwMDAgOiAwOwogICAgICAgIH0KICAgICAgICAvLyBLZXliaW5kaW5nCiAgICAgICAgZXZlbnRLZXliaW5kVHJpZ2dlcmVkKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzS2V5YmluZFRyaWdnZXJlZChDYXN0LnRvU3RyaW5nKGFyZ3MuZXZlbnQpKS5pc1RyaWdnZXJlZDsKICAgICAgICB9CgogICAgICAgIHdoaWxlS2V5YmluZFRyaWdnZXJlZChhcmdzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0tleWJpbmRUcmlnZ2VyZWQoQ2FzdC50b1N0cmluZyhhcmdzLmV2ZW50KSkuaXNUcmlnZ2VyZWQ7CiAgICAgICAgfQogICAgICAgIHdoZW5LZXliaW5kVHJpZ2dlcmVkKGFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHRoaXMudGltZUtleWJpbmRUcmlnZ2VyZWQoYXJncyk7CiAgICAgICAgICAgIHJldHVybiB0aW1lICE9PSAwICYmIHRpbWUgPD0gMC4wNzU7CiAgICAgICAgfQoKICAgICAgICB0aW1lS2V5YmluZFRyaWdnZXJlZChhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gQ2FzdC50b1N0cmluZyhhcmdzLmV2ZW50KTsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2lzS2V5YmluZFRyaWdnZXJlZChldmVudCk7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSB0aGlzLl9rZXliaW5kc1tldmVudF0/LltkYXRhLmNhdXNlXTsKICAgICAgICAgICAgaWYgKCFkYXRhLmlzVHJpZ2dlcmVkKSByZXR1cm4gMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudGltZUtleXNQcmVzc2VkKHsgIm1vZGUiOiB0cmlnZ2VyLm1vZGUsICJrZXlzIjogdHJpZ2dlci5rZXlzIH0pOwogICAgICAgIH0KICAgICAgICBjYXVzZUtleWJpbmRUcmlnZ2VyZWQoYXJncykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNLZXliaW5kVHJpZ2dlcmVkKENhc3QudG9TdHJpbmcoYXJncy5ldmVudCkpLmNhdXNlID8/ICIiOwogICAgICAgIH0KCiAgICAgICAga2V5YmluZEJpbmRNdWx0aXBsZShhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gQ2FzdC50b1N0cmluZyhhcmdzLmV2ZW50KTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlciA9IENhc3QudG9TdHJpbmcoYXJncy50cmlnZ2VyKTsKICAgICAgICAgICAgdGhpcy5fa2V5YmluZHNbZXZlbnRdID8/PSB7fTsKICAgICAgICAgICAgdGhpcy5fa2V5YmluZHNbZXZlbnRdW3RyaWdnZXJdID0geyAibW9kZSI6IGFyZ3MubW9kZSwgImtleXMiOiB0aGlzLl9wYXJzZShhcmdzLmtleXMpIH07CiAgICAgICAgfQogICAgICAgIGtleWJpbmRCaW5kKGFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBDYXN0LnRvU3RyaW5nKGFyZ3MuZXZlbnQpOwogICAgICAgICAgICBjb25zdCB0cmlnZ2VyID0gQ2FzdC50b1N0cmluZyhhcmdzLnRyaWdnZXIpOwogICAgICAgICAgICB0aGlzLl9rZXliaW5kc1tldmVudF0gPz89IHt9OwogICAgICAgICAgICB0aGlzLl9rZXliaW5kc1tldmVudF1bdHJpZ2dlcl0gPSB7ICJtb2RlIjogInRvZ2V0aGVyICYgaW4gb3JkZXIiLCAia2V5cyI6IFtDYXN0LnRvU3RyaW5nKGFyZ3Mua2V5KV0gfTsKICAgICAgICB9OwogICAgICAgIGtleWJpbmRVbmJpbmQoYXJncykgewogICAgICAgICAgICBjb25zdCBldmVudCA9IENhc3QudG9TdHJpbmcoYXJncy5ldmVudCk7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSBDYXN0LnRvU3RyaW5nKGFyZ3MudHJpZ2dlcik7CiAgICAgICAgICAgIGlmICghdGhpcy5fa2V5YmluZHNbZXZlbnRdKSByZXR1cm47CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9rZXliaW5kc1tldmVudF1bdHJpZ2dlcl07CiAgICAgICAgICAgIGlmICghT2JqZWN0LmtleXModGhpcy5fa2V5YmluZHNbZXZlbnRdKS5sZW5ndGgpIGRlbGV0ZSB0aGlzLl9rZXliaW5kc1tldmVudF07CiAgICAgICAgfTsgCgogICAgICAgIGtleWJpbmRSZXNldChhcmdzKSB7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9rZXliaW5kc1tDYXN0LnRvU3RyaW5nKGFyZ3MuZXZlbnQpXTsKICAgICAgICB9CiAgICAgICAgcmVzZXRBbGxLZXliaW5kcygpIHsKICAgICAgICAgICAgdGhpcy5fa2V5YmluZHMgPSB7fQogICAgICAgIH0KCiAgICAgICAga2V5YmluZExpc3RUcmlnZ2VycyhhcmdzKSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShPYmplY3Qua2V5cyh0aGlzLl9rZXliaW5kc1tDYXN0LnRvU3RyaW5nKGFyZ3MuZXZlbnQpXSA/PyB7fSkpOwogICAgICAgIH0KICAgICAgICBrZXliaW5kS2V5c0luVHJpZ2dlcihhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5fa2V5YmluZHNbQ2FzdC50b1N0cmluZyhhcmdzLmV2ZW50KV07CiAgICAgICAgICAgIHJldHVybiBldmVudD8uW0Nhc3QudG9TdHJpbmcoYXJncy50cmlnZ2VyKV0KICAgICAgICAgICAgICAgID8gSlNPTi5zdHJpbmdpZnkoZXZlbnRbYXJncy50cmlnZ2VyXVsia2V5cyJdKQogICAgICAgICAgICAgICAgOiAiW10iOwogICAgICAgIH0KCiAgICAgICAgbGlzdEFsbEtleWJpbmRzKCkgewogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXModGhpcy5fa2V5YmluZHMpKTsKICAgICAgICB9CiAgICAgICAgbGlzdEFjdGl2ZUtleWJpbmRzKCkgewogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXModGhpcy5fa2V5YmluZHMpLmZpbHRlcihldmVudCA9PgogICAgICAgICAgICAgICAgdGhpcy5faXNLZXliaW5kVHJpZ2dlcmVkKGV2ZW50KS5pc1RyaWdnZXJlZAogICAgICAgICAgICApKTsKICAgICAgICB9CiAgICAgICAgLy8gVGFncwogICAgICAgIGNyZWF0ZVRhZyhhcmdzKSB7CiAgICAgICAgICAgIHRoaXMuX3RhZ3NbIiMiICsgYXJncy50YWddID0gdGhpcy5fcGFyc2UoYXJncy5rZXlzKTsKICAgICAgICB9CgogICAgICAgIGRlbGV0ZVRhZyhhcmdzKSB7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl90YWdzWyIjIiArIGFyZ3MudGFnXTsKICAgICAgICB9CiAgICAgICAgZGVsZXRlQWxsVGFncygpIHsKICAgICAgICAgICAgdGhpcy5fdGFncyA9IHt9CiAgICAgICAgfQoKICAgICAgICB2YWx1ZU9mVGFnKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuX3RhZ3NbIiMiICsgYXJncy50YWddID8/IFtdKTsKICAgICAgICB9CiAgICAgICAgbGlzdFRhZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShPYmplY3Qua2V5cyh0aGlzLl90YWdzKSk7CiAgICAgICAgfQogICAgICAgIC8vIFNldHRpbmdzCiAgICAgICAgdG9nZ2xlU2V0dGluZyhhcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IGJvb2xlYW4gPSAoYXJncy50b2dnbGUgPT09ICJlbmFibGVkIikgPyB0cnVlIDogZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3NldHRpbmdzW2FyZ3Muc2V0dGluZ10gPSBib29sZWFuOwogICAgICAgIH0KICAgICAgICBpc1NldHRpbmdFbmFibGVkKGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzW2FyZ3Muc2V0dGluZ107CiAgICAgICAgfQogICAgICAgIHJlc2V0U2V0dGluZ3MoKSB7CiAgICAgICAgICAgIHRoaXMuX3NldHRpbmdzID0gewogICAgICAgICAgICAgICAgImNsZWFyT25CbHVyIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJpbmNsdWRlVGFncyI6IHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBTdG9yYWdlCiAgICAgICAgCiAgICAgICAgaW1wb3J0KGFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy52YWxpZGF0ZShhcmdzLnR5cGUsIGFyZ3MuanNvbik7CiAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHJldHVybiB0aGlzLl9pbXBvcnRFcnJvciA9IHJlc3VsdC5lcnJvcjsKICAgICAgICAgICAgdGhpcy5faW1wb3J0RXJyb3IgPSAiTm9uZSI7CiAgICAgICAgICAgIHN3aXRjaCAoYXJncy50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJ0YWdzIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl90YWdzID0gcmVzdWx0Lm91dHB1dDsKICAgICAgICAgICAgICAgIGNhc2UgImtleWJpbmRzIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9rZXliaW5kcyA9IHJlc3VsdC5vdXRwdXQ7CiAgICAgICAgICAgICAgICBjYXNlICJzZXR0aW5ncyI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSByZXN1bHQub3V0cHV0OwogICAgICAgICAgICAgICAgY2FzZSAiYWxsIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl90YWdzID0gcmVzdWx0Lm91dHB1dFsidGFncyJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleWJpbmRzID0gcmVzdWx0Lm91dHB1dFsia2V5YmluZHMiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IHJlc3VsdC5vdXRwdXRbInNldHRpbmdzIl07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW1wb3J0RXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbXBvcnRFcnJvcjsKICAgICAgICB9CgogICAgICAgIGV4cG9ydChhcmdzKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYXJncy50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJ0YWdzIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5fdGFncyk7CiAgICAgICAgICAgICAgICBjYXNlICJrZXliaW5kcyI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuX2tleWJpbmRzKTsKICAgICAgICAgICAgICAgIGNhc2UgInNldHRpbmdzIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5fc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgY2FzZSAiYWxsIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoeyB0YWdzOiB0aGlzLl90YWdzLCBrZXliaW5kczogdGhpcy5fa2V5YmluZHMsIHNldHRpbmdzOiB0aGlzLl9zZXR0aW5ncyB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFsaWRhdGUoX3R5cGUsIF9kYXRhKSB7CiAgICAgICAgICAgIGxldCBkYXRhID0gdHlwZW9mIF9kYXRhID09PSAic3RyaW5nIiA/IF9kYXRhIDogSlNPTi5zdHJpbmdpZnkoX2RhdGEpOwogICAgICAgICAgICB0cnkgeyBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTsgfQogICAgICAgICAgICBjYXRjaCB7IHJldHVybiB7IGVycm9yOiAiSW52YWxpZCBKU09OIiB9OyB9OwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAib2JqZWN0IiB8fCBkYXRhID09PSBudWxsKSByZXR1cm4geyBlcnJvcjogIkludmFsaWQgSlNPTiIgfTsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHJldHVybiB7IGVycm9yOiAiSW5wdXQgY2FuJ3QgYmUgYW4gQXJyYXkiIH0KCiAgICAgICAgICAgIGlmIChfdHlwZSA9PT0gInRhZ3MiKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRhZyBpbiBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZy5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YVt0YWddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhW3RhZ10uZmluZEluZGV4KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gIT09ICJzdHJpbmciKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHJldHVybiB7IGVycm9yOiBgVGFnczogRXhwZWN0ZWQgc3RyaW5nIGF0IGl0ZW0gIyR7aW5kZXh9IG9mICcke3RhZ30nYCB9OwogICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsgcmV0dXJuIHsgZXJyb3I6IGBUYWdzOiBFeHBlY3RlZCBhcnJheSBhdCAnJHt0YWd9J2AgfTsgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IHJldHVybiB7IGVycm9yOiBgVGFnczogSW52YWxpZCB0YWcgaWQsIHJlYWRpbmcgJyR7dGFnfSdgfSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF90eXBlID09PSAia2V5YmluZHMiKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGV2ZW50IGluIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbZXZlbnRdID09PSAib2JqZWN0IiAmJiBkYXRhW2V2ZW50XSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyaWdnZXIgaW4gZGF0YVtldmVudF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJEYXRhID0gZGF0YVtldmVudF1bdHJpZ2dlcl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdHJpZ2dlckRhdGEgPT09ICJvYmplY3QiICYmIHRyaWdnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJpZ2dlckRhdGFbIm1vZGUiXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJpZ2dlckRhdGFbIm1vZGUiXSA9PT0gInRvZ2V0aGVyICYgaW4gb3JkZXIiIHx8IHRyaWdnZXJEYXRhWyJtb2RlIl0gPT09ICJ0b2dldGhlciAmIGlnbm9yZSBvcmRlciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyRGF0YVsia2V5cyJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodHJpZ2dlckRhdGFbImtleXMiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0cmlnZ2VyRGF0YVsia2V5cyJdLmZpbmRJbmRleChpdGVtID0+IHR5cGVvZiBpdGVtICE9PSAic3RyaW5nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiBgS2V5YmluZHM6IEV4cGVjdGVkIHN0cmluZyBhdCBpdGVtICMke2luZGV4fSBvZiAnJHtldmVudH0vJHt0cmlnZ2VyfSdgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyByZXR1cm4geyBlcnJvcjogYEtleWJpbmRzOiBFeHBlY3RlZCBhcnJheSBhdCAnJHtldmVudH0vJHt0cmlnZ2VyfS9rZXlzJ2AgfSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyByZXR1cm4geyBlcnJvcjogYE1pc3NpbmcgJ2tleXMnIGF0ICcke2V2ZW50fS8ke3RyaWdnZXJ9J2AgfSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IHJldHVybiB7IGVycm9yOiBgS2V5YmluZHM6IEludmFsaWQgaW5wdXQgaW4gJyR7ZXZlbnR9LyR7dHJpZ2dlcn0vbW9kZSdgIH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IHJldHVybiB7IGVycm9yOiBgTWlzc2luZyAnbW9kZScgYXQgJyR7ZXZlbnR9LyR7dHJpZ2dlcn0nYCB9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IHJldHVybiB7IGVycm9yOiBgS2V5YmluZHM6IEV4cGVjdGVkIEpTT04gYXQgJyR7ZXZlbnR9LyR7dHJpZ2dlcn0nYCB9fQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgcmV0dXJuIHsgZXJyb3I6IGBLZXliaW5kczogRXhwZWN0ZWQgSlNPTiBhdCAnJHtldmVudH0nYCB9OyB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF90eXBlID09PSAic2V0dGluZ3MiKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNldHRpbmcgaW4gZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtzZXR0aW5nXSAhPT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGVycm9yOiBgU2V0dGluZ3M6IEV4cGVjdGVkIGJvb2xlYW4gYXQgJyR7c2V0dGluZ30nYCB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3R5cGUgPT09ICJhbGwiKSB7CiAgICAgICAgICAgICAgICBpZiAoISgic2V0dGluZ3MiIGluIGRhdGEpKSByZXR1cm4geyBlcnJvcjogIk1pc3NpbmcgJ3NldHRpbmdzJyIgfTsKICAgICAgICAgICAgICAgIGlmICghKCJ0YWdzIiBpbiBkYXRhKSkgcmV0dXJuIHsgZXJyb3I6ICJNaXNzaW5nICd0YWdzJyIgfTsKICAgICAgICAgICAgICAgIGlmICghKCJrZXliaW5kcyIgaW4gZGF0YSkpIHJldHVybiB7IGVycm9yOiAiTWlzc2luZyAna2V5YmluZHMnIiB9OwogICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgdGFnc1ZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlKCJ0YWdzIiwgZGF0YVsidGFncyJdKTsKICAgICAgICAgICAgICAgIGlmICh0YWdzVmFsaWRhdGlvbi5lcnJvcikgcmV0dXJuIHsgZXJyb3I6IGBUYWdzOiAke3RhZ3NWYWxpZGF0aW9uLmVycm9yfWAgfTsKICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGtleWJpbmRzVmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGUoImtleWJpbmRzIiwgZGF0YVsia2V5YmluZHMiXSk7CiAgICAgICAgICAgICAgICBpZiAoa2V5YmluZHNWYWxpZGF0aW9uLmVycm9yKSByZXR1cm4geyBlcnJvcjogYEtleWJpbmRzOiAke2tleWJpbmRzVmFsaWRhdGlvbi5lcnJvcn1gIH07CiAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBzZXR0aW5nc1ZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlKCJzZXR0aW5ncyIsIGRhdGFbInNldHRpbmdzIl0pOwogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzVmFsaWRhdGlvbi5lcnJvcikgcmV0dXJuIHsgZXJyb3I6IGBTZXR0aW5nczogJHtzZXR0aW5nc1ZhbGlkYXRpb24uZXJyb3J9YCB9OwogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7IG91dHB1dDogZGF0YSB9OwogICAgICAgIH0gICAgICAgIAogICAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gTWVudQogICAgICAgIF9nZXRLZXlzTWVudSgpIHsKICAgICAgICAgICAgY29uc3QgdGFncyA9ICB0aGlzLl9zZXR0aW5nc1siaW5jbHVkZVRhZ3MiXSA/IE9iamVjdC5rZXlzKHRoaXMuX3RhZ3MpIDogW107CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAic3BhY2UiLCAidXAgYXJyb3ciLCAiZG93biBhcnJvdyIsICJyaWdodCBhcnJvdyIsICJsZWZ0IGFycm93IiwKICAgICAgICAgICAgICAgICJiYWNrc3BhY2UiLCAiZW50ZXIiLCAiYW55IiwgInJpZ2h0IHNoaWZ0IiwgImxlZnQgc2hpZnQiLCAicmlnaHQgY29udHJvbCIsICJsZWZ0IGNvbnRyb2wiLCAicmlnaHQgYWx0IiwgImxlZnQgYWx0IiwgInJpZ2h0IHdpbmRvd3Mga2V5IiwgImxlZnQgd2luZG93cyBrZXkiLCAiY29udGV4dCBtZW51IiwgImVzY2FwZSIsICJ0YWIiLAogICAgICAgICAgICAgICAgIjAiLCAiMSIsICIyIiwgIjMiLCAiNCIsICI1IiwgIjYiLCAiNyIsICI4IiwgIjkiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwKICAgICAgICAgICAgICAgICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLAogICAgICAgICAgICAgICAgImAiLCAifiIsICIhIiwgIkAiLCAiIyIsICIkIiwgIiUiLCAiXiIsICImIiwgIioiLCAiKCIsICIpIiwgIi0iLCAiKyIsICI9IiwgIlsiLCAiXSIsICJ7IiwgIn0iLCAiXFwiLCAifCIsICI7IiwgIjoiLCAiJyIsICJcIiIsICIsIiwgIi4iLCAiLyIsICI/IiwgIjwiLCAiPiIsCiAgICAgICAgICAgICAgICAiRjEiLCAiRjIiLCAiRjMiLCAiRjQiLCAiRjUiLCAiRjYiLCAiRjciLCAiRjgiLCAiRjkiLCAiRjEwIiwgIkYxMSIsICJGMTIiLCAiY2FwcyBsb2NrIiwgInNjcm9sbCBsb2NrIiwgIm51bSBsb2NrIiwgImluc2VydCIsICJkZWxldGUiLCAiaG9tZSIsICJlbmQiLCAicGFnZSB1cCIsICJwYWdlIGRvd24iLAogICAgICAgICAgICAgICAgIm51bXBhZDogZGl2aWRlIiwgIm51bXBhZDogbXVsdGlwbHkiLCAibnVtcGFkOiBzdWJ0cmFjdCIsICJudW1wYWQ6IGFkZCIsICJudW1wYWQ6IDAiLCAibnVtcGFkOiAxIiwgIm51bXBhZDogMiIsICJudW1wYWQ6IDMiLCAibnVtcGFkOiA0IiwgIm51bXBhZDogNSIsICJudW1wYWQ6IDYiLCAibnVtcGFkOiA3IiwgIm51bXBhZDogOCIsICJudW1wYWQ6IDkiLCAibnVtcGFkOiBkZWNpbWFsIiwgIm51bXBhZDogZW50ZXIiLAogICAgICAgICAgICAgICAgLi4udGFncwogICAgICAgICAgICBdOwogICAgICAgIH0KICAgIH0KCiAgICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IGVuZGVyS2V5c1BsdXNWMigpKTsKfSkoU2NyYXRjaCk7Cg==","data:text/javascript;base64,Ly8gTmFtZTogVHVuZSBTaGFyayBWMw0KLy8gSUQ6IFNQdHVuZVNoYXJrMw0KLy8gRGVzY3JpcHRpb246IEFuIGFkdmFuY2VkIGF1ZGlvIGVuZ2luZSwgcHJvdmlkaW5nIGNvbXBsZXggc291bmQgY29udHJvbC4NCi8vIEJ5OiBTaGFya1Bvb2wNCi8vIExpY2Vuc2U6IE1JVCBBTkQgTEdQTC0zLjANCg0KLy8gVmVyc2lvbiBWLjMuNC4zDQovLyBUaGFua3MgdG8gSE9NRSBmb3IgdGhlIHNvbmcgIlJlc29uYW5jZSIgYmVpbmcgdXNlZCBhcyB0aGUgZGVmYXVsdCBhdWRpbyBsaW5rDQoNCihmdW5jdGlvbiAoU2NyYXRjaCkgew0KICAidXNlIHN0cmljdCI7DQogIGlmICghU2NyYXRjaC5leHRlbnNpb25zLnVuc2FuZGJveGVkKQ0KICAgIHRocm93IG5ldyBFcnJvcihTY3JhdGNoLnRyYW5zbGF0ZSgiVHVuZSBTaGFyayBWMyBtdXN0IGJlIHJ1biB1bnNhbmRib3hlZCIpKTsNCg0KICBjb25zdCBtZW51SWNvblVSSSA9DQogICAgImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE1ESXVNVGcxSWlCb1pXbG5hSFE5SWpFd01pNHhPRFVpSUhacFpYZENiM2c5SWpBZ01DQXhNREl1TVRnMUlERXdNaTR4T0RVaVBqeG5JSE4wY205clpTMXRhWFJsY214cGJXbDBQU0l4TUNJK1BIQmhkR2dnWkQwaVRUQWdOVEV1TURrelF6QWdNakl1T0RjMUlESXlMamczTlNBd0lEVXhMakE1TXlBd2N6VXhMakE1TXlBeU1pNDROelVnTlRFdU1Ea3pJRFV4TGpBNU15MHlNaTQ0TnpVZ05URXVNRGt6TFRVeExqQTVNeUExTVM0d09UTlRNQ0EzT1M0ek1URWdNQ0ExTVM0d09UTWlJR1pwYkd3OUlpTTBNRFF3TkRBaUx6NDhjR0YwYUNCa1BTSk5OQzQ0TmlBMU1TNHdPVE5qTUMweU5TNDFNelFnTWpBdU55MDBOaTR5TXpNZ05EWXVNak16TFRRMkxqSXpNeUF5TlM0MU16UWdNQ0EwTmk0eU16TWdNakF1TnlBME5pNHlNek1nTkRZdU1qTXpJREFnTWpVdU5UTTBMVEl3TGpjZ05EWXVNak16TFRRMkxqSXpNeUEwTmk0eU16TXRNalV1TlRNMElEQXRORFl1TWpNekxUSXdMamN0TkRZdU1qTXpMVFEyTGpJek15SWdabWxzYkQwaUl6WTJOaUl2UGp4d1lYUm9JR1E5SWswM01pNDRNemNnT0RZdU5qUXpkaTB1TURBell5MHhMakkxTkNBeUxqVXpOaTAwTGpZMk9DQXpMamt6TlMwNExqSTJOQ0F6TGpFNU55MDBMakV4T0MwdU9EUTBMVFl1T1RFMUxUUXVNVGN0Tmk0eU5EWXROeTQwTWpndU5qWTRMVE11TWpZZ05DNDFORGd0TlM0eU1UWWdPQzQyTmpZdE5DNHpOekVnTVM0NE56VXVNemcwSURNdU5EYzBJREV1TWpnMElEUXVOaUF5TGpRMU4ydzJMalk0TXkweE5DNHhOemhqTFRFd0xqVTJOaTAwTGpFek5TMHhPUzQzTmkwMUxqQTVOaTB4T1M0M05pMDFMakE1Tm13dE9DNDVPRGNnTVRrdU1EWXhZeTB1T1RZMklESXVPVEkzTFRRdU5qTTJJRFF1TmpJeUxUZ3VOVElnTXk0NE1qWXROQzR4TVRjdExqZzBOQzAyTGpreE5DMDBMakUzTFRZdU1qUTJMVGN1TkRNdU5qWTVMVE11TWpVNElEUXVOVFE0TFRVdU1qRTBJRGd1TmpZM0xUUXVNemNnTVM0NU1TNHpPVEVnTXk0MU16WWdNUzR6TVRjZ05DNDJOalFnTWk0MU1qSnNNVEl1TURNMUxUSTFMalV3TjNNeE15NDFNekl1TWpNMklESTJMamswTnlBM0xqRXhOSG9pSUdacGJHdzlJaU5tWm1ZaUx6NDhjR0YwYUNCa1BTSnRNamd1TXpBNUlETXdMamd6TVNBMExqQTBNeUF5TXk0Mk9EUWlJR1pwYkd3OUltNXZibVVpSUhOMGNtOXJaVDBpSTJabVppSWdjM1J5YjJ0bExYZHBaSFJvUFNJeklpQnpkSEp2YTJVdGJHbHVaV05oY0QwaWMzRjFZWEpsSWk4K1BIQmhkR2dnWkQwaVRUTTBMakF6TXlBMU5TNHlNVGxqTVM0ek9DQXlMall3TmkwdU56Y3lJRFl1TURRdE5DNDRNRGdnTnk0Mk55MDBMakF6TnlBeExqWXpMVGd1TkRJNUxqZ3pOeTA1TGpneExURXVOemN0TVM0ek9DMHlMall3Tmk0M056SXROaTR3TkNBMExqZ3dPUzAzTGpZM0lEUXVNRE0yTFRFdU5qSTVJRGd1TkRJNExTNDRNemNnT1M0NE1Ea2dNUzQzTjIwdE55NDVOUzB5Tnk0d05qaHpPUzQzTURVdE1TNDNNRFFnTVRJdU16WXpJREl1Tnpkak1pNHpOelVnTkNBdU1EY3hJRGd1TmprMUxqSXhNaUF4TUM0eE1qZ3VNVFFnTVM0ME16TWdNaTR4TnpVZ01TNHhNRGtnTWk0eE56VWdNUzR4TURsc0xTNHdNVFFnTVM0Mk56UnpMVEl1T0RZMExqWTJPUzB6TGpReE1pMHhMak15WXkwdU5UUTNMVEV1T1RnNExTNDFOaTAxTGprM09DMHlMamd5TXkwNExqSXlOeTB5TGpJMk5TMHlMakkxTFRjdU5UTTNMUzQzTlRrdE55NDFNemN0TGpjMU9TSWdabWxzYkQwaUkyWm1aaUl2UGp4d1lYUm9JR1E5SWswMk1DNDBNellnTXpVdU16Y3hZeTB1TXpNeklESXVNVEU0TFRJdU16VXpJRE11TXpBNUxUUXVNVGc1SURRdU1EQXlMVEV1TmpVdU56STJMVE11TlRVZ01TNHdNRGd0TlM0eU56WXVNemN0TVM0Mk16RXRMak00TVMwekxqRTRPQzB4TGpnd055MHlMams1TkMwekxqVTVPQzR4TlRRdE1pNHdPRFVnTVM0NE9UWXRNeTQ0TWpJZ015NDROREl0TkM0ME1EVWdNUzQ1TkMwdU56azVJRFF1TWpVekxTNDNNeUEyTGpFd05TNHlOaTQ1TVRNdU5ESXhJREl1TVRnNUxURTBMakUwTWlBekxqQXpOUzB5TUM0MU9ETXVNUzB1TmpReUlESXVOVGcwTFM0ME55QXlMalV4TXk0eE5URWdNQ0F3TFRFdU9EVTBJREUxTGpVeU1pMHpMakF6TmlBeU15NDRNRE1pSUdacGJHdzlJaU5tWm1ZaUlHWnBiR3d0Y25Wc1pUMGlaWFpsYm05a1pDSXZQand2Wno0OEwzTjJaejQ9IjsNCiAgY29uc3QgYmxvY2tJY29uVVJJID0NCiAgICAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kzT0M0NU56UWlJR2hsYVdkb2REMGlOemd1T1RjMElpQjJhV1YzUW05NFBTSXdJREFnTnpndU9UYzBJRGM0TGprM05DSStQR2NnYzNSeWIydGxMVzFwZEdWeWJHbHRhWFE5SWpFd0lqNDhjR0YwYUNCa1BTSk5NQ0EzT0M0NU56UldNR2czT0M0NU56UjJOemd1T1RjMGVpSWdabWxzYkQwaWJtOXVaU0l2UGp4d1lYUm9JR1E5SW0wMk1TNHlNRElnTlRNdU9ETTJMUzR3TURJdExqQXdNMk10TGpBMk9DQXpMamN4TFRNdU16TTNJRGN1TWpndE9DNHdNVFlnT0M0ME1UWXROUzR6TlRrZ01TNHpNREl0TVRBdU5UTTRMVEV1TURndE1URXVOVFk0TFRVdU16SnpNaTQwT0MwNExqY3pNeUEzTGpnek9TMHhNQzR3TXpWak1pNDBOQzB1TlRreklEUXVPRFF0TGpReUlEWXVPRE14TGpNME1uWXRNakF1TlRaakxURTBMamcxSURFdU1EQXpMVEkyTGpJNU9DQTFMakF3TmkweU5pNHlPVGdnTlM0d01EWjJNamN1TmpRMFl5NDBPU0EwTGpBeE5DMHlMamt4TmlBNExqQTNPQzAzTGprM0lEa3VNekEyTFRVdU16VTRJREV1TXpBeExURXdMalV6TnkweExqQTRNUzB4TVM0MU5qY3ROUzR6TWpGek1pNDBPQzA0TGpjek15QTNMamd6T0MweE1DNHdNelZqTWk0ME9EWXRMall3TkNBMExqa3pNeTB1TkRFMElEWXVPVFEyTGpNNE5Hd3VNREV5TFRNMkxqazVPSE14Tmk0eE9TMDNMakk1SURNMUxqazFOUzAyTGpZek0zb2lJR1pwYkd3OUlpTm1abVlpTHo0OEwyYytQQzl6ZG1jKyI7DQoNCiAgY29uc3QgZXh0cmFJY29ucyA9IHsNCiAgICBzZXQ6ICJkcFpIUm9QU0kzT0M0NU56UWlJR2hsYVdkb2REMGlOemd1T1RjMElpQjJhV1YzUW05NFBTSXdJREFnTnpndU9UYzBJRGM0TGprM05DSStQR2NnYzNSeWIydGxMWGRwWkhSb1BTSXdJaUJ6ZEhKdmEyVXRiV2wwWlhKc2FXMXBkRDBpTVRBaUlENDhjR0YwYUNCa1BTSnROalF1TlRNeklEUXlMall4SURJdU1EUXlMamcxTldFMUxqQXlJRFV1TURJZ01DQXdJREVnTWk0Mk9TQTJMalUzYkMweExqTTNJRE11TWpjMFlUVXVNRElnTlM0d01pQXdJREFnTVMwMkxqVTNJREl1Tmpsc0xUSXVNRFF5TFM0NE5UVmhNalVnTWpVZ01DQXdJREV0TkM0eU9UVWdOQzR5Tm13dU9EUWdNaTR3TldFMUxqQXlJRFV1TURJZ01DQXdJREV0TWk0M05ESWdOaTQxTkRoc0xUTXVNamcxSURFdU16UTFZVFV1TURJZ05TNHdNaUF3SURBZ01TMDJMalUwT0MweUxqYzBNbXd0TGpnMExUSXVNRFZoTWpVZ01qVWdNQ0F3SURFdE5pNHdORGt0TGpBeU1td3RMamcxTlNBeUxqQTBNbUUxTGpBeUlEVXVNRElnTUNBd0lERXROaTQxTnlBeUxqWTViQzB6TGpJM05DMHhMak0zWVRVdU1ESWdOUzR3TWlBd0lEQWdNUzB5TGpZNUxUWXVOVGRzTGpnMU5TMHlMakEwTW1FeU5TQXlOU0F3SURBZ01TMDBMakkyTFRRdU1qazFiQzB5TGpBMUxqZzBZVFV1TURJZ05TNHdNaUF3SURBZ01TMDJMalUwT0MweUxqYzBNbXd0TVM0ek5EVXRNeTR5T0RWaE5TNHdNaUExTGpBeUlEQWdNQ0F4SURJdU56UXlMVFl1TlRRNGJESXVNRFV0TGpnMFlUSTFJREkxSURBZ01DQXhJQzR3TWpJdE5pNHdORGxzTFRJdU1EUXlMUzQ0TlRWaE5TNHdNaUExTGpBeUlEQWdNQ0F4TFRJdU5qa3ROaTQxTjJ3eExqTTNMVE11TWpjMFlUVXVNRElnTlM0d01pQXdJREFnTVNBMkxqVTNMVEl1Tmpsc01pNHdOREl1T0RVMVlUSTFJREkxSURBZ01DQXhJRFF1TWprMUxUUXVNalpzTFM0NE5DMHlMakExWVRVdU1ESWdOUzR3TWlBd0lEQWdNU0F5TGpjME1pMDJMalUwT0d3ekxqSTROUzB4TGpNME5XRTFMakF5SURVdU1ESWdNQ0F3SURFZ05pNDFORGdnTWk0M05ESnNMamcwSURJdU1EVmhNalVnTWpVZ01DQXdJREVnTmk0d05Ea3VNREl5YkM0NE5UVXRNaTR3TkRKaE5TNHdNaUExTGpBeUlEQWdNQ0F4SURZdU5UY3RNaTQyT1d3ekxqSTNOQ0F4TGpNM1lUVXVNRElnTlM0d01pQXdJREFnTVNBeUxqWTVJRFl1TlRkc0xTNDROVFVnTWk0d05ESmhNalVnTWpVZ01DQXdJREVnTkM0eU5pQTBMakk1Tld3eUxqQTFMUzQ0TkdFMUxqQXlJRFV1TURJZ01DQXdJREVnTmk0MU5EZ2dNaTQzTkRKc01TNHpORFVnTXk0eU9EVmhOUzR3TWlBMUxqQXlJREFnTUNBeExUSXVOelF5SURZdU5UUTRiQzB5TGpBMUxqZzBZVEkxSURJMUlEQWdNQ0F4TFM0d01qSWdOaTR3TkRsdExUTTNMalE1T0MwNExqTXpPR010TWk0NE9DQTJMamczTnk0ek5pQXhOQzQzT0RjZ055NHlNemNnTVRjdU5qWTNjekUwTGpjNE55MHVNellnTVRjdU5qWTNMVGN1TWpNM0xTNHpOaTB4TkM0M09EY3ROeTR5TXpjdE1UY3VOalkzTFRFMExqYzROeTR6TmkweE55NDJOamNnTnk0eU16Y2lJR1pwYkd3OUlpTm1abVlpTHo0OGNHRjBhQ0JrUFNKTk1DQTNPQzQ1TnpSV01HZzNPQzQ1TnpSMk56Z3VPVGMwZWlJZ1ptbHNiRDBpYm05dVpTSXZQand2Wno0OEwzTjJaejQ9IiwNCiAgICBub2I6ICJkcFpIUm9QU0kzT0M0NU56UWlJR2hsYVdkb2REMGlOemd1T1RjMElpQjJhV1YzUW05NFBTSXdJREFnTnpndU9UYzBJRGM0TGprM05DSStQR2NnYzNSeWIydGxMWGRwWkhSb1BTSXdJaUJ6ZEhKdmEyVXRiV2wwWlhKc2FXMXBkRDBpTVRBaVBqeHdZWFJvSUdROUlrMHdJRGM0TGprM05GWXdhRGM0TGprM05IWTNPQzQ1TnpSNklpQm1hV3hzUFNKdWIyNWxJaTgrUEhCaGRHZ2daRDBpVFRNM0xqazJNU0F4TUM0NE5EZGhNaTR4TURVZ01pNHhNRFVnTUNBd0lERXRNaTR4TURRdE1pNHhNRFJXTlM0Mk9USmpNQzB4TGpFMk15NDVOREl0TWk0eE1EVWdNaTR4TURRdE1pNHhNRFZvTXk0d05USmpNUzR4TmpJZ01DQXlMakV3TkM0NU5ESWdNaTR4TURRZ01pNHhNRFYyTXk0d05URmhNaTR4TURVZ01pNHhNRFVnTUNBd0lERXRNaTR4TURRZ01pNHhNRFY2YlRBZ05qUXVOVFJoTWk0eE1EVWdNaTR4TURVZ01DQXdJREV0TWk0eE1EUXRNaTR4TURWMkxUTXVNRFV4WXpBdE1TNHhOakl1T1RReUxUSXVNVEExSURJdU1UQTBMVEl1TVRBMWFETXVNRFV5WXpFdU1UWXlJREFnTWk0eE1EUXVPVFF6SURJdU1UQTBJREl1TVRBMWRqTXVNRFV4WVRJdU1UQTFJREl1TVRBMUlEQWdNQ0F4TFRJdU1UQTBJREl1TVRBMWVtMHlNQzQyT1RndE5UY3VNak5oTWk0eE1EVWdNaTR4TURVZ01DQXdJREVnTUMweUxqazNObXd5TGpFMU9DMHlMakUxT0dFeUxqRXdOU0F5TGpFd05TQXdJREFnTVNBeUxqazNOaUF3YkRJdU1UVTRJREl1TVRVNFlUSXVNVEExSURJdU1UQTFJREFnTUNBeElEQWdNaTQ1Tnpac0xUSXVNVFU0SURJdU1UVTRZVEl1TVRBMUlESXVNVEExSURBZ01DQXhMVEl1T1RjMklEQjZUVEV6TGpBeU15QTJNeTQzT1ROaE1pNHhNRFVnTWk0eE1EVWdNQ0F3SURFZ01DMHlMamszTm13eUxqRTFPQzB5TGpFMU9HRXlMakV3TlNBeUxqRXdOU0F3SURBZ01TQXlMamszTmlBd2JESXVNVFU0SURJdU1UVTRZVEl1TVRBMUlESXVNVEExSURBZ01DQXhJREFnTWk0NU56WnNMVEl1TVRVNElESXVNVFU0WVRJdU1UQTFJREl1TVRBMUlEQWdNQ0F4TFRJdU9UYzJJREI2YlRVMUxqRXdOQzB5TlM0NE16SmpNQzB4TGpFMk1pNDVOREl0TWk0eE1EUWdNaTR4TURRdE1pNHhNRFJvTXk0d05URmpNUzR4TmpNZ01DQXlMakV3TlM0NU5ESWdNaTR4TURVZ01pNHhNRFIyTXk0d05USmhNaTR4TURVZ01pNHhNRFVnTUNBd0lERXRNaTR4TURVZ01pNHhNRFJvTFRNdU1EVXhZVEl1TVRBMUlESXVNVEExSURBZ01DQXhMVEl1TVRBMUxUSXVNVEEwZW0wdE5qUXVOVFFnTUdNd0xURXVNVFl5TGprME1pMHlMakV3TkNBeUxqRXdOUzB5TGpFd05HZ3pMakExTVdNeExqRTJNaUF3SURJdU1UQTFMamswTWlBeUxqRXdOU0F5TGpFd05IWXpMakExTW1FeUxqRXdOU0F5TGpFd05TQXdJREFnTVMweUxqRXdOU0F5TGpFd05FZzFMalk1TW1FeUxqRXdOU0F5TGpFd05TQXdJREFnTVMweUxqRXdOUzB5TGpFd05IcHROVGN1TWpNZ01qQXVOams0WVRJdU1UQTFJREl1TVRBMUlEQWdNQ0F4SURJdU9UYzJJREJzTWk0eE5UZ2dNaTR4TlRoaE1pNHhNRFVnTWk0eE1EVWdNQ0F3SURFZ01DQXlMamszTm13dE1pNHhOVGdnTWk0eE5UaGhNaTR4TURVZ01pNHhNRFVnTUNBd0lERXRNaTQ1TnpZZ01Hd3RNaTR4TlRndE1pNHhOVGhoTWk0eE1EVWdNaTR4TURVZ01DQXdJREVnTUMweUxqazNObnBOTVRVdU1UZ3hJREV6TGpBeU0yRXlMakV3TlNBeUxqRXdOU0F3SURBZ01TQXlMamszTmlBd2JESXVNVFU0SURJdU1UVTRZVEl1TVRBMUlESXVNVEExSURBZ01DQXhJREFnTWk0NU56WnNMVEl1TVRVNElESXVNVFU0WVRJdU1UQTFJREl1TVRBMUlEQWdNQ0F4TFRJdU9UYzJJREJzTFRJdU1UVTRMVEl1TVRVNFlUSXVNVEExSURJdU1UQTFJREFnTUNBeElEQXRNaTQ1TnpaNmJUZ3VOREUySURFd0xqUXpZemN1TlRRMkxUY3VOVFEzSURFNUxqQTJOUzA0TGpjd01pQXlOeTQ0TWpjdE15NDBOalV0TGpFeU5TNHdPUzB4TXk0eU5qUWdNVGN1T0RjeUxURXlMakV6TXlBeE9TNHdNRE5zTVM0d016Y2dNUzR3TXpkak1TNHhNeUF4TGpFeklERTRMamt4TXkweE1pNHdNRGdnTVRrdU1EQXpMVEV5TGpFek15QTFMakl6TnlBNExqYzJNaUEwTGpBNE1pQXlNQzR5T0MwekxqUTJOU0F5Tnk0NE1qZ3RPQzQ1TVRFZ09DNDVNUzB5TXk0ek5Ua2dPQzQ1TVMwek1pNHlOeUF3TFRndU9URXRPQzQ1TVRFdE9DNDVNUzB5TXk0ek5Ua2dNQzB6TWk0eU55SWdabWxzYkQwaUkyWm1aaUl2UGp3dlp6NDhMM04yWno0PSIsDQogICAgZmxhZzogIlpwWlhkQ2IzZzlJakFnTUNBeE5pNDJNeUF4Tnk0MUlqNDhjR0YwYUNCa1BTSk5MamMxSURKaE5pNDBOQ0EyTGpRMElEQWdNQ0F4SURjdU5qa2dNR2d3WVRZdU5EUWdOaTQwTkNBd0lEQWdNQ0EzTGpZNUlEQjJNVEF1TkdFMkxqUTBJRFl1TkRRZ01DQXdJREV0Tnk0Mk9TQXdhREJoTmk0ME5DQTJMalEwSURBZ01DQXdMVGN1TmprZ01DSWdjM1I1YkdVOUltWnBiR3c2SXpSalltWTFOanR6ZEhKdmEyVTZJelExT1RrelpEdHpkSEp2YTJVdGJHbHVaV05oY0RweWIzVnVaRHR6ZEhKdmEyVXRiR2x1WldwdmFXNDZjbTkxYm1RaUx6NDhjR0YwYUNCemRIbHNaVDBpWm1sc2JEb2pOR05pWmpVMk8zTjBjbTlyWlRvak5EVTVPVE5rTzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaRHR6ZEhKdmEyVXRkMmxrZEdnNk1TNDFjSGdpSUdROUlrMHVOelVnTVRZdU56VjJMVEUySWk4K1BDOXpkbWMrIiwNCiAgICBzdG9wOiAiWnBaWGRDYjNnOUlqQWdNQ0F4TkNBeE5DSWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2STJWak5UazFPVHR6ZEhKdmEyVTZJMkk0TkRnME9EdHpkSEp2YTJVdGJHbHVaV05oY0RweWIzVnVaRHR6ZEhKdmEyVXRiR2x1WldwdmFXNDZjbTkxYm1RN2MzUnliMnRsTFcxcGRHVnliR2x0YVhRNk1UQWlJR1E5SWswMExqTXVOV2cxTGpSc015NDRJRE11T0hZMUxqUnNMVE11T0NBekxqaElOQzR6VEM0MUlEa3VOMVkwTGpONklpOCtQQzl6ZG1jKyIsDQogIH07DQogIGZvciAoY29uc3Qga2V5IGluIGV4dHJhSWNvbnMpDQogICAgZXh0cmFJY29uc1trZXldID0NCiAgICAgICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSCIgKw0KICAgICAgZXh0cmFJY29uc1trZXldOw0KDQogIC8vIE1vZGlmaWVkIFBpenppY2F0byBMaWJyYXJ5IChXZWIgQXVkaW8gQVBJLCBidXQgd2l0aCBQcmVtYWRlIEVmZmVjdHMgYW5kIFN0dWZmKQ0KICAvLyBNb2RpZmllZCBWZXJzaW9uOiBodHRwczovL2dpdGh1Yi5jb20vU2hhcmtQb29sLVNQL3BpenppY2F0by8NCiAgLy8gT3JpZ2luYWw6IGh0dHBzOi8vZ2l0aHViLmNvbS9hbGVtYW5ndWkvcGl6emljYXRvDQogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hbGVtYW5ndWkvcGl6emljYXRvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UNCg0KICBjb25zdCBzY3JpcHRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7DQogIHNjcmlwdEVsZW1lbnQudGV4dENvbnRlbnQgPSBgIWZ1bmN0aW9uKGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgdD17fSxpPXQsbj0ib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHMsbz0iZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kO24/bW9kdWxlLmV4cG9ydHM9dDpvP2RlZmluZShbXSx0KTplLlBpenppY2F0bz1lLlB6PXQ7dmFyIHM9ZS5BdWRpb0NvbnRleHR8fGUud2Via2l0QXVkaW9Db250ZXh0O2lmKCFzKXtjb25zb2xlLmVycm9yKCJObyBBdWRpb0NvbnRleHQgZm91bmQgaW4gdGhpcyBlbnZpcm9ubWVudC4gUGxlYXNlIGVuc3VyZSB5b3VyIHdpbmRvdyBvciBnbG9iYWwgb2JqZWN0IGNvbnRhaW5zIGEgd29ya2luZyBBdWRpb0NvbnRleHQgY29uc3RydWN0b3IgZnVuY3Rpb24uIik7cmV0dXJufXQuY29udGV4dD1uZXcgczt2YXIgcj10LmNvbnRleHQuY3JlYXRlR2FpbigpO3IuY29ubmVjdCh0LmNvbnRleHQuZGVzdGluYXRpb24pLHQuVXRpbD17aXNTdHJpbmc6ZnVuY3Rpb24oZSl7cmV0dXJuIltvYmplY3QgU3RyaW5nXSI9PT10b1N0cmluZy5jYWxsKGUpfSxpc09iamVjdDpmdW5jdGlvbihlKXtyZXR1cm4iW29iamVjdCBPYmplY3RdIj09PXRvU3RyaW5nLmNhbGwoZSl9LGlzRnVuY3Rpb246ZnVuY3Rpb24oZSl7cmV0dXJuIltvYmplY3QgRnVuY3Rpb25dIj09PXRvU3RyaW5nLmNhbGwoZSl9LGlzTnVtYmVyOmZ1bmN0aW9uKGUpe3JldHVybiJbb2JqZWN0IE51bWJlcl0iPT09dG9TdHJpbmcuY2FsbChlKSYmZT09PStlfSxpc0FycmF5OmZ1bmN0aW9uKGUpe3JldHVybiJbb2JqZWN0IEFycmF5XSI9PT10b1N0cmluZy5jYWxsKGUpfSxpc0luUmFuZ2U6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiEhKGkuVXRpbC5pc051bWJlcihlKSYmaS5VdGlsLmlzTnVtYmVyKHQpJiZpLlV0aWwuaXNOdW1iZXIobikpJiZlPj10JiZlPD1ufSxpc0Jvb2w6ZnVuY3Rpb24oZSl7cmV0dXJuImJvb2xlYW4iPT10eXBlb2YgZX0saXNPc2NpbGxhdG9yOmZ1bmN0aW9uKGUpe3JldHVybiBlJiYiW29iamVjdCBPc2NpbGxhdG9yTm9kZV0iPT09ZS50b1N0cmluZygpfSxpc0F1ZGlvQnVmZmVyU291cmNlTm9kZTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmIltvYmplY3QgQXVkaW9CdWZmZXJTb3VyY2VOb2RlXSI9PT1lLnRvU3RyaW5nKCl9LGlzU291bmQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiBpLlNvdW5kfSxpc0VmZmVjdDpmdW5jdGlvbihlKXtmb3IodmFyIGkgaW4gdC5FZmZlY3RzKWlmKGUgaW5zdGFuY2VvZiB0LkVmZmVjdHNbaV0pcmV0dXJuITA7cmV0dXJuITF9LG5vcm1hbGl6ZTpmdW5jdGlvbihlLHQsbil7aWYoaS5VdGlsLmlzTnVtYmVyKGUpJiZpLlV0aWwuaXNOdW1iZXIodCkmJmkuVXRpbC5pc051bWJlcihuKSlyZXR1cm4obi10KSplLzErdH0sZ2V0RHJ5TGV2ZWw6ZnVuY3Rpb24oZSl7cmV0dXJuIWkuVXRpbC5pc051bWJlcihlKXx8ZT4xfHxlPDA/MDplPD0uNT8xOjEtKGUtLjUpKjJ9LGdldFdldExldmVsOmZ1bmN0aW9uKGUpe3JldHVybiFpLlV0aWwuaXNOdW1iZXIoZSl8fGU+MXx8ZTwwPzA6ZT49LjU/MToxLSguNS1lKSoyfX07dmFyIGE9T2JqZWN0LmdldFByb3RvdHlwZU9mKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LmNvbnRleHQuY3JlYXRlR2FpbigpKSksYz1hLmNvbm5lY3Q7YS5jb25uZWN0PWZ1bmN0aW9uKGUpe3ZhciB0PWkuVXRpbC5pc0VmZmVjdChlKT9lLmlucHV0Tm9kZTplO3JldHVybiBjLmNhbGwodGhpcyx0KSxlfSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCwidm9sdW1lIix7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gci5nYWluLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJnImJihyLmdhaW4udmFsdWU9ZSl9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIm1hc3RlckdhaW5Ob2RlIix7ZW51bWVyYWJsZTohMSxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcn0sc2V0OmZ1bmN0aW9uKGUpe2NvbnNvbGUuZXJyb3IoIkNhbid0IHNldCB0aGUgbWFzdGVyIGdhaW4gbm9kZSIpfX0pLHQuRXZlbnRzPXtvbjpmdW5jdGlvbihlLHQsaSl7ZSYmdCYmKHRoaXMuX2V2ZW50cz10aGlzLl9ldmVudHN8fHt9LCh0aGlzLl9ldmVudHNbZV18fCh0aGlzLl9ldmVudHNbZV09W10pKS5wdXNoKHtjYWxsYmFjazp0LGNvbnRleHQ6aXx8dGhpcyxoYW5kbGVyOnRoaXN9KSl9LHRyaWdnZXI6ZnVuY3Rpb24oZSl7dmFyIHQsaSxuLG87aWYoZSl7Zm9yKHRoaXMuX2V2ZW50cz10aGlzLl9ldmVudHN8fHt9LHQ9dGhpcy5fZXZlbnRzW2VdfHwodGhpcy5fZXZlbnRzW2VdPVtdKSxvPTAsaT1NYXRoLm1heCgwLGFyZ3VtZW50cy5sZW5ndGgtMSksbj1bXTtvPGk7bysrKW5bb109YXJndW1lbnRzW28rMV07Zm9yKG89MDtvPHQubGVuZ3RoO28rKyl0W29dLmNhbGxiYWNrLmFwcGx5KHRbb10uY29udGV4dCxuKX19LG9mZjpmdW5jdGlvbihlKXtlP3RoaXMuX2V2ZW50c1tlXT12b2lkIDA6dGhpcy5fZXZlbnRzPXt9fX0sdC5Tb3VuZD1mdW5jdGlvbihlLG4pe3ZhciBvPXRoaXMscz10LlV0aWwscj1mdW5jdGlvbiBlKHQpe2lmKHQmJiFzLmlzRnVuY3Rpb24odCkmJiFzLmlzU3RyaW5nKHQpJiYhcy5pc09iamVjdCh0KSlyZXR1cm4iRGVzY3JpcHRpb24gdHlwZSBub3Qgc3VwcG9ydGVkLiBJbml0aWFsaXplIGEgc291bmQgdXNpbmcgYW4gb2JqZWN0LCBhIGZ1bmN0aW9uIG9yIGEgc3RyaW5nLiI7aWYocy5pc09iamVjdCh0KSl7aWYoIXMuaXNTdHJpbmcodC5zb3VyY2UpfHwtMT09PVsid2F2ZSIsImZpbGUiLCJpbnB1dCIsInNjcmlwdCIsInNvdW5kIiwiYnVmZmVyIl0uaW5kZXhPZih0LnNvdXJjZSkpcmV0dXJuIlNwZWNpZmllZCBzb3VyY2Ugbm90IHN1cHBvcnRlZC4gU291cmNlcyBjYW4gYmUgd2F2ZSwgZmlsZSwgaW5wdXQgb3Igc2NyaXB0IjtpZigiZmlsZSI9PT10LnNvdXJjZSYmKCF0Lm9wdGlvbnN8fCF0Lm9wdGlvbnMucGF0aCkpcmV0dXJuIkEgcGF0aCBpcyBuZWVkZWQgZm9yIHNvdW5kcyB3aXRoIGEgZmlsZSBzb3VyY2UiO2lmKCJzY3JpcHQiPT09dC5zb3VyY2UmJighdC5vcHRpb25zfHwhdC5vcHRpb25zLmF1ZGlvRnVuY3Rpb24pKXJldHVybiJBbiBhdWRpbyBmdW5jdGlvbiBpcyBuZWVkZWQgZm9yIHNvdW5kcyB3aXRoIGEgc2NyaXB0IHNvdXJjZSJ9fShlKSxhPXMuaXNPYmplY3QoZSkmJnMuaXNPYmplY3QoZS5vcHRpb25zKTtpZihyKXRocm93IGNvbnNvbGUuZXJyb3IociksRXJyb3IoIkVycm9yIGluaXRpYWxpemluZyBQaXp6aWNhdG8gU291bmQ6ICIrcik7ZnVuY3Rpb24gYyhlLG4pe2U9ZXx8e30sdGhpcy5nZXRSYXdTb3VyY2VOb2RlPWZ1bmN0aW9uKCl7dmFyIGk9dGhpcy5zb3VyY2VOb2RlP3RoaXMuc291cmNlTm9kZS5mcmVxdWVuY3kudmFsdWU6ZS5mcmVxdWVuY3ksbj10LmNvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpO3JldHVybiBuLnR5cGU9ZS50eXBlfHwic2luZSIsbi5mcmVxdWVuY3kudmFsdWU9aXx8NDQwLG59LHRoaXMuc291cmNlTm9kZT10aGlzLmdldFJhd1NvdXJjZU5vZGUoKSx0aGlzLnNvdXJjZU5vZGUuZ2FpblN1Y2Nlc3Nvcj1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuc291cmNlTm9kZS5jb25uZWN0KHRoaXMuc291cmNlTm9kZS5nYWluU3VjY2Vzc29yKSxzLmlzRnVuY3Rpb24obikmJm4oKX1mdW5jdGlvbiBoKGUsaSl7ZT1zLmlzQXJyYXkoZSk/ZTpbZV07dmFyIG49bmV3IFhNTEh0dHBSZXF1ZXN0O24ub3BlbigiR0VUIixlWzBdLCEwKSxuLnJlc3BvbnNlVHlwZT0iYXJyYXlidWZmZXIiLG4ub25sb2FkPWZ1bmN0aW9uKG4pe3QuY29udGV4dC5kZWNvZGVBdWRpb0RhdGEobi50YXJnZXQucmVzcG9uc2UsKGZ1bmN0aW9uKGUpe28uZ2V0UmF3U291cmNlTm9kZT1mdW5jdGlvbigpe3ZhciBpPXQuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtyZXR1cm4gaS5sb29wPXRoaXMubG9vcCxpLmJ1ZmZlcj1lLGl9LHMuaXNGdW5jdGlvbihpKSYmaSgpfSkuYmluZChvKSwoZnVuY3Rpb24odCl7aWYoY29uc29sZS5lcnJvcigiRXJyb3IgZGVjb2RpbmcgYXVkaW8gZmlsZSAiK2VbMF0pLGUubGVuZ3RoPjEpe2Uuc2hpZnQoKSxoKGUsaSk7cmV0dXJufXQ9dHx8RXJyb3IoIkVycm9yIGRlY29kaW5nIGF1ZGlvIGZpbGUgIitlWzBdKSxzLmlzRnVuY3Rpb24oaSkmJmkodCl9KS5iaW5kKG8pKX0sbi5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24odCl7ND09PW4ucmVhZHlTdGF0ZSYmMjAwIT09bi5zdGF0dXMmJmNvbnNvbGUuZXJyb3IoIkVycm9yIHdoaWxlIGZldGNoaW5nICIrZVswXSsiLiAiK24uc3RhdHVzVGV4dCl9LG4uc2VuZCgpfWZ1bmN0aW9uIHUoZSxpKXt2YXIgbj1zLmlzRnVuY3Rpb24oZSk/ZTplLmF1ZGlvRnVuY3Rpb24sbz1zLmlzT2JqZWN0KGUpJiZlLmJ1ZmZlclNpemU/ZS5idWZmZXJTaXplOm51bGw7aWYoIW8pdHJ5e3QuY29udGV4dC5jcmVhdGVTY3JpcHRQcm9jZXNzb3IoKX1jYXRjaChyKXtvPTIwNDh9dGhpcy5nZXRSYXdTb3VyY2VOb2RlPWZ1bmN0aW9uKCl7dmFyIGU9dC5jb250ZXh0LmNyZWF0ZVNjcmlwdFByb2Nlc3NvcihvLDEsMSk7cmV0dXJuIGUub25hdWRpb3Byb2Nlc3M9bixlfX10aGlzLmRldGFjaGVkPWEmJmUub3B0aW9ucy5kZXRhY2hlZCx0aGlzLm1hc3RlclZvbHVtZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZmFkZU5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmZhZGVOb2RlLmdhaW4udmFsdWU9MCx0aGlzLmRldGFjaGVkfHx0aGlzLm1hc3RlclZvbHVtZS5jb25uZWN0KHQubWFzdGVyR2Fpbk5vZGUpLHRoaXMubGFzdFRpbWVQbGF5ZWQ9MCx0aGlzLmVmZmVjdHM9W10sdGhpcy5lZmZlY3RDb25uZWN0b3JzPVtdLHRoaXMucGxheWluZz10aGlzLnBhdXNlZD0hMSx0aGlzLmxvb3A9YSYmZS5vcHRpb25zLmxvb3AsdGhpcy5hdHRhY2s9YSYmcy5pc051bWJlcihlLm9wdGlvbnMuYXR0YWNrKT9lLm9wdGlvbnMuYXR0YWNrOi4wNCx0aGlzLnZvbHVtZT1hJiZzLmlzTnVtYmVyKGUub3B0aW9ucy52b2x1bWUpP2Uub3B0aW9ucy52b2x1bWU6MSxhJiZzLmlzTnVtYmVyKGUub3B0aW9ucy5yZWxlYXNlKT90aGlzLnJlbGVhc2U9ZS5vcHRpb25zLnJlbGVhc2U6YSYmcy5pc051bWJlcihlLm9wdGlvbnMuc3VzdGFpbik/KGNvbnNvbGUud2FybigiJ3N1c3RhaW4nIGlzIGRlcHJlY2F0ZWQuIFVzZSAncmVsZWFzZScgaW5zdGVhZC4iKSx0aGlzLnJlbGVhc2U9ZS5vcHRpb25zLnN1c3RhaW4pOnRoaXMucmVsZWFzZT0uMDQsZT9zLmlzU3RyaW5nKGUpP2guYmluZCh0aGlzKShlLG4pOnMuaXNGdW5jdGlvbihlKT91LmJpbmQodGhpcykoZSxuKToiZmlsZSI9PT1lLnNvdXJjZT9oLmJpbmQodGhpcykoZS5vcHRpb25zLnBhdGgsbik6ImJ1ZmZlciI9PT1lLnNvdXJjZT8oZnVuY3Rpb24gZShpLG4pe2lmKChpPUFycmF5LmlzQXJyYXkoaSk/aTpbaV0pWzBdaW5zdGFuY2VvZiBBdWRpb0J1ZmZlcil7bGV0IHM9aVswXTtvLmdldFJhd1NvdXJjZU5vZGU9ZnVuY3Rpb24oKXtsZXQgZT10LmNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7cmV0dXJuIGUubG9vcD10aGlzLmxvb3AsZS5idWZmZXI9cyxlfSwiZnVuY3Rpb24iPT10eXBlb2YgbiYmbigpfX0pLmJpbmQodGhpcykoZS5vcHRpb25zLmJ1ZmZlcixuKToid2F2ZSI9PT1lLnNvdXJjZT9jLmJpbmQodGhpcykoZS5vcHRpb25zLG4pOiJpbnB1dCI9PT1lLnNvdXJjZT8oZnVuY3Rpb24gZShpLG4pe2lmKG5hdmlnYXRvci5nZXRVc2VyTWVkaWE9bmF2aWdhdG9yLmdldFVzZXJNZWRpYXx8bmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYXx8bmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYXx8bmF2aWdhdG9yLm1zR2V0VXNlck1lZGlhLCFuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhJiYoIW5hdmlnYXRvci5tZWRpYURldmljZXN8fG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKSl7Y29uc29sZS5lcnJvcigiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhLiBOb3RlIHRoYXQgdGhlIGN1cnJlbnQgZG9jdW1lbnQgbXVzdCBiZSBsb2FkZWQgc2VjdXJlbHkgZm9yIHRoaXMgdG8gd29yayIpO3JldHVybn12YXIgcj0oZnVuY3Rpb24oZSl7by5nZXRSYXdTb3VyY2VOb2RlPWZ1bmN0aW9uKCl7cmV0dXJuIHQuY29udGV4dC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShlKX0scy5pc0Z1bmN0aW9uKG4pJiZuKCl9KS5iaW5kKG8pLGE9ZnVuY3Rpb24oZSl7cy5pc0Z1bmN0aW9uKG4pJiZuKGUpfTtuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYT9uYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7YXVkaW86ITB9KS50aGVuKHIpLmNhdGNoKGEpOm5hdmlnYXRvci5nZXRVc2VyTWVkaWEoe2F1ZGlvOiEwfSxyLGEpfSkuYmluZCh0aGlzKShlLG4pOiJzY3JpcHQiPT09ZS5zb3VyY2U/dS5iaW5kKHRoaXMpKGUub3B0aW9ucyxuKToic291bmQiPT09ZS5zb3VyY2UmJihmdW5jdGlvbiBlKHQsbil7dGhpcy5nZXRSYXdTb3VyY2VOb2RlPXQuc291bmQuZ2V0UmF3U291cmNlTm9kZSx0LnNvdW5kLnNvdXJjZU5vZGUmJmkuVXRpbC5pc09zY2lsbGF0b3IodC5zb3VuZC5zb3VyY2VOb2RlKSYmKHRoaXMuc291cmNlTm9kZT10aGlzLmdldFJhd1NvdXJjZU5vZGUoKSx0aGlzLmZyZXF1ZW5jeT10LnNvdW5kLmZyZXF1ZW5jeSl9KS5iaW5kKHRoaXMpKGUub3B0aW9ucyxuKTpjLmJpbmQodGhpcykoe30sbil9LHQuU291bmQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodC5FdmVudHMse3BsYXk6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSxuKXt0aGlzLnBsYXlpbmd8fChpLlV0aWwuaXNOdW1iZXIobil8fChuPXRoaXMub2Zmc2V0VGltZXx8MCksaS5VdGlsLmlzTnVtYmVyKGUpfHwoZT0wKSx0aGlzLnBsYXlpbmc9ITAsdGhpcy5wYXVzZWQ9ITEsdGhpcy5zb3VyY2VOb2RlPXRoaXMuZ2V0U291cmNlTm9kZSgpLHRoaXMuYXBwbHlBdHRhY2soKSxpLlV0aWwuaXNGdW5jdGlvbih0aGlzLnNvdXJjZU5vZGUuc3RhcnQpJiYodGhpcy5sYXN0VGltZVBsYXllZD10LmNvbnRleHQuY3VycmVudFRpbWUtbix0aGlzLnNvdXJjZU5vZGUuc3RhcnQoaS5jb250ZXh0LmN1cnJlbnRUaW1lK2UsbikpLHRoaXMudHJpZ2dlcigicGxheSIpKX19LHN0b3A6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oKXsodGhpcy5wYXVzZWR8fHRoaXMucGxheWluZykmJih0aGlzLnBhdXNlZD10aGlzLnBsYXlpbmc9ITEsdGhpcy5zdG9wV2l0aFJlbGVhc2UoKSx0aGlzLm9mZnNldFRpbWU9MCx0aGlzLnRyaWdnZXIoInN0b3AiKSl9fSxwYXVzZTp7ZW51bWVyYWJsZTohMCx2YWx1ZTpmdW5jdGlvbigpe2lmKCF0aGlzLnBhdXNlZCYmdGhpcy5wbGF5aW5nKXt0aGlzLnBhdXNlZD0hMCx0aGlzLnBsYXlpbmc9ITEsdGhpcy5zdG9wV2l0aFJlbGVhc2UoKTt2YXIgZT1pLmNvbnRleHQuY3VycmVudFRpbWUtdGhpcy5sYXN0VGltZVBsYXllZDt0aGlzLnNvdXJjZU5vZGUuYnVmZmVyP3RoaXMub2Zmc2V0VGltZT1lJSh0aGlzLnNvdXJjZU5vZGUuYnVmZmVyLmxlbmd0aC9pLmNvbnRleHQuc2FtcGxlUmF0ZSk6dGhpcy5vZmZzZXRUaW1lPWUsdGhpcy50cmlnZ2VyKCJwYXVzZSIpfX19LGNsb25lOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPW5ldyB0LlNvdW5kKHtzb3VyY2U6InNvdW5kIixvcHRpb25zOntsb29wOnRoaXMubG9vcCxhdHRhY2s6dGhpcy5hdHRhY2sscmVsZWFzZTp0aGlzLnJlbGVhc2Usdm9sdW1lOnRoaXMudm9sdW1lLHNvdW5kOnRoaXN9fSksaT0wO2k8dGhpcy5lZmZlY3RzLmxlbmd0aDtpKyspZS5hZGRFZmZlY3QodGhpcy5lZmZlY3RzW2ldKTtyZXR1cm4gZX19LG9uRW5kZWQ6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKCl7dGhpcy5zb3VyY2VOb2RlJiZ0aGlzLnNvdXJjZU5vZGUhPT1lfHwodGhpcy5wbGF5aW5nJiZ0aGlzLnN0b3AoKSx0aGlzLnBhdXNlZHx8dGhpcy50cmlnZ2VyKCJlbmQiKSl9fX0sYWRkRWZmZWN0OntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFpLlV0aWwuaXNFZmZlY3QoZSkpcmV0dXJuIGNvbnNvbGUuZXJyb3IoIlRoZSBvYmplY3QgcHJvdmlkZWQgaXMgbm90IGEgUGl6emljYXRvIGVmZmVjdC4iKSx0aGlzO3RoaXMuZWZmZWN0cy5wdXNoKGUpO3ZhciB0PXRoaXMuZWZmZWN0Q29ubmVjdG9ycy5sZW5ndGg+MD90aGlzLmVmZmVjdENvbm5lY3RvcnNbdGhpcy5lZmZlY3RDb25uZWN0b3JzLmxlbmd0aC0xXTp0aGlzLmZhZGVOb2RlO3QuZGlzY29ubmVjdCgpLHQuY29ubmVjdChlKTt2YXIgbj1pLmNvbnRleHQuY3JlYXRlR2FpbigpO3JldHVybiB0aGlzLmVmZmVjdENvbm5lY3RvcnMucHVzaChuKSxlLmNvbm5lY3Qobiksbi5jb25uZWN0KHRoaXMubWFzdGVyVm9sdW1lKSx0aGlzfX0scmVtb3ZlRWZmZWN0OntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0LGk9dGhpcy5lZmZlY3RzLmluZGV4T2YoZSk7aWYoLTE9PT1pKXJldHVybiBjb25zb2xlLndhcm4oIkNhbm5vdCByZW1vdmUgZWZmZWN0IHRoYXQgaXMgbm90IGFwcGxpZWQgdG8gdGhpcyBzb3VuZC4iKSx0aGlzO3ZhciBuPXRoaXMucGxheWluZztuJiZ0aGlzLnBhdXNlKCk7dmFyIG89MD09PWk/dGhpcy5mYWRlTm9kZTp0aGlzLmVmZmVjdENvbm5lY3RvcnNbaS0xXTtvLmRpc2Nvbm5lY3QoKTt2YXIgcz10aGlzLmVmZmVjdENvbm5lY3RvcnNbaV07cmV0dXJuIHMuZGlzY29ubmVjdCgpLGUuZGlzY29ubmVjdChzKSx0aGlzLmVmZmVjdENvbm5lY3RvcnMuc3BsaWNlKGksMSksdGhpcy5lZmZlY3RzLnNwbGljZShpLDEpLHQ9aT50aGlzLmVmZmVjdHMubGVuZ3RoLTF8fDA9PT10aGlzLmVmZmVjdHMubGVuZ3RoP3RoaXMubWFzdGVyVm9sdW1lOnRoaXMuZWZmZWN0c1tpXSxvLmNvbm5lY3QodCksbiYmdGhpcy5wbGF5KCksdGhpc319LGNvbm5lY3Q6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubWFzdGVyVm9sdW1lLmNvbm5lY3QoZSksdGhpc319LGRpc2Nvbm5lY3Q6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubWFzdGVyVm9sdW1lLmRpc2Nvbm5lY3QoZSksdGhpc319LGNvbm5lY3RFZmZlY3RzOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPVtdLHQ9MDt0PHRoaXMuZWZmZWN0cy5sZW5ndGg7dCsrKXt2YXIgbj10PT09dGhpcy5lZmZlY3RzLmxlbmd0aC0xP3RoaXMubWFzdGVyVm9sdW1lOnRoaXMuZWZmZWN0c1t0KzFdLmlucHV0Tm9kZTtlW3RdPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5lZmZlY3RzW3RdLm91dHB1dE5vZGUuZGlzY29ubmVjdCh0aGlzLmVmZmVjdENvbm5lY3RvcnNbdF0pLHRoaXMuZWZmZWN0c1t0XS5vdXRwdXROb2RlLmNvbm5lY3Qobil9fX0sdm9sdW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe2lmKHRoaXMubWFzdGVyVm9sdW1lKXJldHVybiB0aGlzLm1hc3RlclZvbHVtZS5nYWluLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJnRoaXMubWFzdGVyVm9sdW1lJiYodGhpcy5tYXN0ZXJWb2x1bWUuZ2Fpbi52YWx1ZT1lKX19LGZyZXF1ZW5jeTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zb3VyY2VOb2RlJiZpLlV0aWwuaXNPc2NpbGxhdG9yKHRoaXMuc291cmNlTm9kZSk/dGhpcy5zb3VyY2VOb2RlLmZyZXF1ZW5jeS52YWx1ZTpudWxsfSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5zb3VyY2VOb2RlJiZpLlV0aWwuaXNPc2NpbGxhdG9yKHRoaXMuc291cmNlTm9kZSkmJih0aGlzLnNvdXJjZU5vZGUuZnJlcXVlbmN5LnZhbHVlPWUpfX0sc3VzdGFpbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gY29uc29sZS53YXJuKCInc3VzdGFpbicgaXMgZGVwcmVjYXRlZC4gVXNlICdyZWxlYXNlJyBpbnN0ZWFkLiIpLHRoaXMucmVsZWFzZX0sc2V0OmZ1bmN0aW9uKGUpe2NvbnNvbGUud2FybigiJ3N1c3RhaW4nIGlzIGRlcHJlY2F0ZWQuIFVzZSAncmVsZWFzZScgaW5zdGVhZC4iKSxpLlV0aWwuaXNJblJhbmdlKGUsMCwxMCkmJih0aGlzLnJlbGVhc2U9ZSl9fSxnZXRTb3VyY2VOb2RlOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKCl7aWYodGhpcy5zb3VyY2VOb2RlKXt2YXIgZT10aGlzLnNvdXJjZU5vZGU7ZS5nYWluU3VjY2Vzc29yLmdhaW4uc2V0VmFsdWVBdFRpbWUoZS5nYWluU3VjY2Vzc29yLmdhaW4udmFsdWUsaS5jb250ZXh0LmN1cnJlbnRUaW1lKSxlLmdhaW5TdWNjZXNzb3IuZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSgxZS00LGkuY29udGV4dC5jdXJyZW50VGltZSsuMiksc2V0VGltZW91dChmdW5jdGlvbigpe2UuZGlzY29ubmVjdCgpLGUuZ2FpblN1Y2Nlc3Nvci5kaXNjb25uZWN0KCl9LDIwMCl9dmFyIHQ9dGhpcy5nZXRSYXdTb3VyY2VOb2RlKCk7cmV0dXJuIHQuZ2FpblN1Y2Nlc3Nvcj1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHQuY29ubmVjdCh0LmdhaW5TdWNjZXNzb3IpLHQuZ2FpblN1Y2Nlc3Nvci5jb25uZWN0KHRoaXMuZmFkZU5vZGUpLHRoaXMuZmFkZU5vZGUuY29ubmVjdCh0aGlzLmdldElucHV0Tm9kZSgpKSxpLlV0aWwuaXNBdWRpb0J1ZmZlclNvdXJjZU5vZGUodCkmJih0Lm9uZW5kZWQ9dGhpcy5vbkVuZGVkKHQpLmJpbmQodGhpcykpLHR9fSxnZXRJbnB1dE5vZGU6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lZmZlY3RzLmxlbmd0aD4wP3RoaXMuZWZmZWN0c1swXS5pbnB1dE5vZGU6dGhpcy5tYXN0ZXJWb2x1bWV9fSxhcHBseUF0dGFjazp7ZW51bWVyYWJsZTohMSx2YWx1ZTpmdW5jdGlvbigpe2lmKHRoaXMuZmFkZU5vZGUuZ2Fpbi52YWx1ZSx0aGlzLmZhZGVOb2RlLmdhaW4uY2FuY2VsU2NoZWR1bGVkVmFsdWVzKGkuY29udGV4dC5jdXJyZW50VGltZSksIXRoaXMuYXR0YWNrKXt0aGlzLmZhZGVOb2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKDEsaS5jb250ZXh0LmN1cnJlbnRUaW1lLC4wMDEpO3JldHVybn12YXIgZT1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiZmlyZWZveCIpPi0xLHQ9dGhpcy5hdHRhY2s7ZXx8KHQ9KDEtdGhpcy5mYWRlTm9kZS5nYWluLnZhbHVlKSp0aGlzLmF0dGFjayksdGhpcy5mYWRlTm9kZS5nYWluLnNldFRhcmdldEF0VGltZSgxLGkuY29udGV4dC5jdXJyZW50VGltZSwyKnQpfX0sc3RvcFdpdGhSZWxlYXNlOntlbnVtZXJhYmxlOiExLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuc291cmNlTm9kZSxuPWZ1bmN0aW9uKCl7cmV0dXJuIGkuVXRpbC5pc0Z1bmN0aW9uKHQuc3RvcCk/dC5zdG9wKDApOnQuZGlzY29ubmVjdCgpfTtpZih0aGlzLmZhZGVOb2RlLmdhaW4udmFsdWUsdGhpcy5mYWRlTm9kZS5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyhpLmNvbnRleHQuY3VycmVudFRpbWUpLCF0aGlzLnJlbGVhc2Upe3RoaXMuZmFkZU5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoMCxpLmNvbnRleHQuY3VycmVudFRpbWUsLjAwMSksbigpO3JldHVybn12YXIgbz1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiZmlyZWZveCIpPi0xLHM9dGhpcy5yZWxlYXNlO298fChzPXRoaXMuZmFkZU5vZGUuZ2Fpbi52YWx1ZSp0aGlzLnJlbGVhc2UpLHRoaXMuZmFkZU5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoMWUtNSxpLmNvbnRleHQuY3VycmVudFRpbWUscy81KSx3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpe24oKX0sMWUzKnMpfX19KSx0Lkdyb3VwPWZ1bmN0aW9uKGUpe2U9ZXx8W10sdGhpcy5tZXJnZUdhaW5Ob2RlPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5tYXN0ZXJWb2x1bWU9aS5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLnNvdW5kcz1bXSx0aGlzLmVmZmVjdHM9W10sdGhpcy5lZmZlY3RDb25uZWN0b3JzPVtdLHRoaXMubWVyZ2VHYWluTm9kZS5jb25uZWN0KHRoaXMubWFzdGVyVm9sdW1lKSx0aGlzLm1hc3RlclZvbHVtZS5jb25uZWN0KGkubWFzdGVyR2Fpbk5vZGUpO2Zvcih2YXIgdD0wO3Q8ZS5sZW5ndGg7dCsrKXRoaXMuYWRkU291bmQoZVt0XSl9LHQuR3JvdXAucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoaS5FdmVudHMse2Nvbm5lY3Q6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubWFzdGVyVm9sdW1lLmNvbm5lY3QoZSksdGhpc319LGRpc2Nvbm5lY3Q6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubWFzdGVyVm9sdW1lLmRpc2Nvbm5lY3QoZSksdGhpc319LGFkZFNvdW5kOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFpLlV0aWwuaXNTb3VuZChlKSl7Y29uc29sZS5lcnJvcigiWW91IGNhbiBvbmx5IGFkZCBQaXp6aWNhdG8uU291bmQgb2JqZWN0cyIpO3JldHVybn1pZih0aGlzLnNvdW5kcy5pbmRleE9mKGUpPi0xKXtjb25zb2xlLndhcm4oIlRoZSBQaXp6aWNhdG8uU291bmQgb2JqZWN0IHdhcyBhbHJlYWR5IGFkZGVkIHRvIHRoaXMgZ3JvdXAiKTtyZXR1cm59aWYoZS5kZXRhY2hlZCl7Y29uc29sZS53YXJuKCJHcm91cHMgZG8gbm90IHN1cHBvcnQgZGV0YWNoZWQgc291bmRzLiBZb3UgY2FuIG1hbnVhbGx5IGNyZWF0ZSBhbiBhdWRpbyBncmFwaCB0byBncm91cCBkZXRhY2hlZCBzb3VuZHMgdG9nZXRoZXIuIik7cmV0dXJufWUuZGlzY29ubmVjdChpLm1hc3RlckdhaW5Ob2RlKSxlLmNvbm5lY3QodGhpcy5tZXJnZUdhaW5Ob2RlKSx0aGlzLnNvdW5kcy5wdXNoKGUpfX0scmVtb3ZlU291bmQ6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zb3VuZHMuaW5kZXhPZihlKTtpZigtMT09PXQpe2NvbnNvbGUud2FybigiQ2Fubm90IHJlbW92ZSBhIHNvdW5kIHRoYXQgaXMgbm90IHBhcnQgb2YgdGhpcyBncm91cC4iKTtyZXR1cm59ZS5kaXNjb25uZWN0KHRoaXMubWVyZ2VHYWluTm9kZSksZS5jb25uZWN0KGkubWFzdGVyR2Fpbk5vZGUpLHRoaXMuc291bmRzLnNwbGljZSh0LDEpfX0sdm9sdW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe2lmKHRoaXMubWFzdGVyVm9sdW1lKXJldHVybiB0aGlzLm1hc3RlclZvbHVtZS5nYWluLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm1hc3RlclZvbHVtZS5nYWluLnZhbHVlPWUpfX0scGxheTp7ZW51bWVyYWJsZTohMCx2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT0wO2U8dGhpcy5zb3VuZHMubGVuZ3RoO2UrKyl0aGlzLnNvdW5kc1tlXS5wbGF5KCk7dGhpcy50cmlnZ2VyKCJwbGF5Iil9fSxzdG9wOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPTA7ZTx0aGlzLnNvdW5kcy5sZW5ndGg7ZSsrKXRoaXMuc291bmRzW2VdLnN0b3AoKTt0aGlzLnRyaWdnZXIoInN0b3AiKX19LHBhdXNlOntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPTA7ZTx0aGlzLnNvdW5kcy5sZW5ndGg7ZSsrKXRoaXMuc291bmRzW2VdLnBhdXNlKCk7dGhpcy50cmlnZ2VyKCJwYXVzZSIpfX0sYWRkRWZmZWN0OntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFpLlV0aWwuaXNFZmZlY3QoZSkpcmV0dXJuIGNvbnNvbGUuZXJyb3IoIlRoZSBvYmplY3QgcHJvdmlkZWQgaXMgbm90IGEgUGl6emljYXRvIGVmZmVjdC4iKSx0aGlzO3RoaXMuZWZmZWN0cy5wdXNoKGUpO3ZhciB0PXRoaXMuZWZmZWN0Q29ubmVjdG9ycy5sZW5ndGg+MD90aGlzLmVmZmVjdENvbm5lY3RvcnNbdGhpcy5lZmZlY3RDb25uZWN0b3JzLmxlbmd0aC0xXTp0aGlzLm1lcmdlR2Fpbk5vZGU7dC5kaXNjb25uZWN0KCksdC5jb25uZWN0KGUpO3ZhciBuPWkuY29udGV4dC5jcmVhdGVHYWluKCk7cmV0dXJuIHRoaXMuZWZmZWN0Q29ubmVjdG9ycy5wdXNoKG4pLGUuY29ubmVjdChuKSxuLmNvbm5lY3QodGhpcy5tYXN0ZXJWb2x1bWUpLHRoaXN9fSxyZW1vdmVFZmZlY3Q6e2VudW1lcmFibGU6ITAsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQsaT10aGlzLmVmZmVjdHMuaW5kZXhPZihlKTtpZigtMT09PWkpcmV0dXJuIGNvbnNvbGUud2FybigiQ2Fubm90IHJlbW92ZSBlZmZlY3QgdGhhdCBpcyBub3QgYXBwbGllZCB0byB0aGlzIGdyb3VwLiIpLHRoaXM7dmFyIG49MD09PWk/dGhpcy5tZXJnZUdhaW5Ob2RlOnRoaXMuZWZmZWN0Q29ubmVjdG9yc1tpLTFdO24uZGlzY29ubmVjdCgpO3ZhciBvPXRoaXMuZWZmZWN0Q29ubmVjdG9yc1tpXTtyZXR1cm4gby5kaXNjb25uZWN0KCksZS5kaXNjb25uZWN0KG8pLHRoaXMuZWZmZWN0Q29ubmVjdG9ycy5zcGxpY2UoaSwxKSx0aGlzLmVmZmVjdHMuc3BsaWNlKGksMSksdD1pPnRoaXMuZWZmZWN0cy5sZW5ndGgtMXx8MD09PXRoaXMuZWZmZWN0cy5sZW5ndGg/dGhpcy5tYXN0ZXJWb2x1bWU6dGhpcy5lZmZlY3RzW2ldLG4uY29ubmVjdCh0KSx0aGlzfX19KSx0LkVmZmVjdHM9e307dmFyIGg9T2JqZWN0LmNyZWF0ZShudWxsLHtjb25uZWN0OntlbnVtZXJhYmxlOiEwLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm91dHB1dE5vZGUuY29ubmVjdChlKSx0aGlzfX0sZGlzY29ubmVjdDp7ZW51bWVyYWJsZTohMCx2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5vdXRwdXROb2RlLmRpc2Nvbm5lY3QoZSksdGhpc319fSk7ZnVuY3Rpb24gdShlLG4pe3RoaXMub3B0aW9ucz17fSxlPWV8fHRoaXMub3B0aW9uczt2YXIgbz17ZnJlcXVlbmN5OjM1MCxwZWFrOjF9O2Zvcih2YXIgcyBpbiB0aGlzLmlucHV0Tm9kZT10aGlzLmZpbHRlck5vZGU9aS5jb250ZXh0LmNyZWF0ZUJpcXVhZEZpbHRlcigpLHRoaXMuZmlsdGVyTm9kZS50eXBlPW4sdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5maWx0ZXJOb2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSxvKXRoaXNbc109ZVtzXSx0aGlzW3NdPXZvaWQgMD09PXRoaXNbc118fG51bGw9PT10aGlzW3NdP29bc106dGhpc1tzXX10LkVmZmVjdHMuRGVsYXk9ZnVuY3Rpb24oZSl7dGhpcy5vcHRpb25zPXt9LGU9ZXx8dGhpcy5vcHRpb25zO3ZhciBpPXtmZWVkYmFjazouNSx0aW1lOi4zLG1peDouNX07Zm9yKHZhciBuIGluIHRoaXMuaW5wdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5kcnlHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMud2V0R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmZlZWRiYWNrR2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmRlbGF5Tm9kZT10LmNvbnRleHQuY3JlYXRlRGVsYXkoKSx0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuZHJ5R2Fpbk5vZGUpLHRoaXMuZHJ5R2Fpbk5vZGUuY29ubmVjdCh0aGlzLm91dHB1dE5vZGUpLHRoaXMuZGVsYXlOb2RlLmNvbm5lY3QodGhpcy5mZWVkYmFja0dhaW5Ob2RlKSx0aGlzLmZlZWRiYWNrR2Fpbk5vZGUuY29ubmVjdCh0aGlzLmRlbGF5Tm9kZSksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmRlbGF5Tm9kZSksdGhpcy5kZWxheU5vZGUuY29ubmVjdCh0aGlzLndldEdhaW5Ob2RlKSx0aGlzLndldEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSxpKXRoaXNbbl09ZVtuXSx0aGlzW25dPXZvaWQgMD09PXRoaXNbbl18fG51bGw9PT10aGlzW25dP2lbbl06dGhpc1tuXX0sdC5FZmZlY3RzLkRlbGF5LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse21peDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1peH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1peD1lLHRoaXMuZHJ5R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0RHJ5TGV2ZWwodGhpcy5taXgpLHRoaXMud2V0R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0V2V0TGV2ZWwodGhpcy5taXgpKX19LHRpbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy50aW1lfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMTgwKSYmKHRoaXMub3B0aW9ucy50aW1lPWUsdGhpcy5kZWxheU5vZGUuZGVsYXlUaW1lLnZhbHVlPWUpfX0sZmVlZGJhY2s6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5mZWVkYmFja30sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmZlZWRiYWNrPXBhcnNlRmxvYXQoZSwxMCksdGhpcy5mZWVkYmFja0dhaW5Ob2RlLmdhaW4udmFsdWU9dGhpcy5mZWVkYmFjayl9fX0pLHQuRWZmZWN0cy5Db21wcmVzc29yPWZ1bmN0aW9uKGUpe3RoaXMub3B0aW9ucz17fSxlPWV8fHRoaXMub3B0aW9uczt2YXIgaT17dGhyZXNob2xkOi0yNCxrbmVlOjMwLGF0dGFjazouMDAzLHJlbGVhc2U6LjI1LHJhdGlvOjEyfTtmb3IodmFyIG4gaW4gdGhpcy5pbnB1dE5vZGU9dGhpcy5jb21wcmVzc29yTm9kZT10LmNvbnRleHQuY3JlYXRlRHluYW1pY3NDb21wcmVzc29yKCksdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5jb21wcmVzc29yTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksaSl0aGlzW25dPWVbbl0sdGhpc1tuXT12b2lkIDA9PT10aGlzW25dfHxudWxsPT09dGhpc1tuXT9pW25dOnRoaXNbbl19LHQuRWZmZWN0cy5Db21wcmVzc29yLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse3RocmVzaG9sZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb21wcmVzc29yTm9kZS50aHJlc2hvbGQudmFsdWV9LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsLTEwMCwwKSYmKHRoaXMuY29tcHJlc3Nvck5vZGUudGhyZXNob2xkLnZhbHVlPWUpfX0sa25lZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb21wcmVzc29yTm9kZS5rbmVlLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7dC5VdGlsLmlzSW5SYW5nZShlLDAsNDApJiYodGhpcy5jb21wcmVzc29yTm9kZS5rbmVlLnZhbHVlPWUpfX0sYXR0YWNrOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbXByZXNzb3JOb2RlLmF0dGFjay52YWx1ZX0sc2V0OmZ1bmN0aW9uKGUpe3QuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5jb21wcmVzc29yTm9kZS5hdHRhY2sudmFsdWU9ZSl9fSxyZWxlYXNlOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbXByZXNzb3JOb2RlLnJlbGVhc2UudmFsdWV9LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsMCwxKSYmKHRoaXMuY29tcHJlc3Nvck5vZGUucmVsZWFzZS52YWx1ZT1lKX19LHJhdGlvOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbXByZXNzb3JOb2RlLnJhdGlvLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7dC5VdGlsLmlzSW5SYW5nZShlLDEsMjApJiYodGhpcy5jb21wcmVzc29yTm9kZS5yYXRpby52YWx1ZT1lKX19LGdldEN1cnJlbnRHYWluUmVkdWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29tcHJlc3Nvck5vZGUucmVkdWN0aW9ufX0pLHQuRWZmZWN0cy5Mb3dQYXNzRmlsdGVyPWZ1bmN0aW9uKGUpe3UuY2FsbCh0aGlzLGUsImxvd3Bhc3MiKX0sdC5FZmZlY3RzLkhpZ2hQYXNzRmlsdGVyPWZ1bmN0aW9uKGUpe3UuY2FsbCh0aGlzLGUsImhpZ2hwYXNzIil9O3ZhciBkPU9iamVjdC5jcmVhdGUoaCx7ZnJlcXVlbmN5OntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZpbHRlck5vZGUuZnJlcXVlbmN5LnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7dC5VdGlsLmlzSW5SYW5nZShlLDEwLDIyMDUwKSYmKHRoaXMuZmlsdGVyTm9kZS5mcmVxdWVuY3kudmFsdWU9ZSl9fSxwZWFrOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZpbHRlck5vZGUuUS52YWx1ZX0sc2V0OmZ1bmN0aW9uKGUpe3QuVXRpbC5pc0luUmFuZ2UoZSwxZS00LDFlMykmJih0aGlzLmZpbHRlck5vZGUuUS52YWx1ZT1lKX19fSk7ZnVuY3Rpb24gbCgpe3ZhciBlLG4sbz1pLmNvbnRleHQuc2FtcGxlUmF0ZSp0aGlzLnRpbWUscz10LmNvbnRleHQuY3JlYXRlQnVmZmVyKDIsbyxpLmNvbnRleHQuc2FtcGxlUmF0ZSkscj1zLmdldENoYW5uZWxEYXRhKDApLGE9cy5nZXRDaGFubmVsRGF0YSgxKTtmb3Iobj0wO248bztuKyspZT10aGlzLnJldmVyc2U/by1uOm4scltuXT0oMipNYXRoLnJhbmRvbSgpLTEpKk1hdGgucG93KDEtZS9vLHRoaXMuZGVjYXkpLGFbbl09KDIqTWF0aC5yYW5kb20oKS0xKSpNYXRoLnBvdygxLWUvbyx0aGlzLmRlY2F5KTt0aGlzLnJldmVyYk5vZGUuYnVmZmVyJiYodGhpcy5pbnB1dE5vZGUuZGlzY29ubmVjdCh0aGlzLnJldmVyYk5vZGUpLHRoaXMucmV2ZXJiTm9kZS5kaXNjb25uZWN0KHRoaXMud2V0R2Fpbk5vZGUpLHRoaXMucmV2ZXJiTm9kZT10LmNvbnRleHQuY3JlYXRlQ29udm9sdmVyKCksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLnJldmVyYk5vZGUpLHRoaXMucmV2ZXJiTm9kZS5jb25uZWN0KHRoaXMud2V0R2Fpbk5vZGUpKSx0aGlzLnJldmVyYk5vZGUuYnVmZmVyPXN9ZnVuY3Rpb24gZihlKXt0aGlzLm9wdGlvbnM9e30sZT1lfHx0aGlzLm9wdGlvbnM7dmFyIHQ9e2N1dG9mZl9mcmVxdWVuY3lfbG93OjEwMCxjdXRvZmZfZnJlcXVlbmN5X2hpZ2g6OGUzLGxvd19iYW5kX2dhaW46MSxtaWRfYmFuZF9nYWluOjEsaGlnaF9iYW5kX2dhaW46MSxsb3dfcGVhazoxLG1pZF9wZWFrOjEsaGlnaF9wZWFrOjF9O2Zvcih2YXIgbiBpbiB0aGlzLmlucHV0Tm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMub3V0cHV0Tm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMubG93RmlsdGVyTm9kZT1pLmNvbnRleHQuY3JlYXRlQmlxdWFkRmlsdGVyKCksdGhpcy5sb3dGaWx0ZXJOb2RlLnR5cGU9Imxvd3Bhc3MiLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5sb3dGaWx0ZXJOb2RlKSx0aGlzLmxvd0dhaW5Ob2RlPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5sb3dGaWx0ZXJOb2RlLmNvbm5lY3QodGhpcy5sb3dHYWluTm9kZSksdGhpcy5taWRGaWx0ZXJOb2RlPWkuY29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKSx0aGlzLm1pZEZpbHRlck5vZGUudHlwZT0iYmFuZHBhc3MiLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5taWRGaWx0ZXJOb2RlKSx0aGlzLm1pZEdhaW5Ob2RlPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5taWRGaWx0ZXJOb2RlLmNvbm5lY3QodGhpcy5taWRHYWluTm9kZSksdGhpcy5oaWdoRmlsdGVyTm9kZT1pLmNvbnRleHQuY3JlYXRlQmlxdWFkRmlsdGVyKCksdGhpcy5oaWdoRmlsdGVyTm9kZS50eXBlPSJoaWdocGFzcyIsdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmhpZ2hGaWx0ZXJOb2RlKSx0aGlzLmhpZ2hHYWluTm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuaGlnaEZpbHRlck5vZGUuY29ubmVjdCh0aGlzLmhpZ2hHYWluTm9kZSksdGhpcy5hbmFseXNlck5vZGU9aS5jb250ZXh0LmNyZWF0ZUFuYWx5c2VyKCksdGhpcy5sb3dHYWluTm9kZS5jb25uZWN0KHRoaXMuYW5hbHlzZXJOb2RlKSx0aGlzLm1pZEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5hbmFseXNlck5vZGUpLHRoaXMuaGlnaEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5hbmFseXNlck5vZGUpLHRoaXMuYW5hbHlzZXJOb2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSx0aGlzLmFuYWx5c2VyTm9kZS5taW5EZWNpYmVscz0tOTAsdGhpcy5hbmFseXNlck5vZGUubWF4RGVjaWJlbHM9MTUsdGhpcy5hbmFseXNlck5vZGUuc21vb3RoaW5nVGltZUNvbnN0YW50PS44NSx0aGlzLmFuYWx5c2VyTm9kZS5mZnRTaXplPTI1Nix0aGlzLm9wdGlvbnMuY3V0b2ZmX2ZyZXF1ZW5jeV9sb3c9dC5jdXRvZmZfZnJlcXVlbmN5X2xvdyx0aGlzLm9wdGlvbnMuY3V0b2ZmX2ZyZXF1ZW5jeV9oaWdoPXQuY3V0b2ZmX2ZyZXF1ZW5jeV9oaWdoLHQpdGhpc1tuXT1lW25dLHRoaXNbbl09dm9pZCAwPT09dGhpc1tuXXx8bnVsbD09PXRoaXNbbl0/dFtuXTp0aGlzW25dfXQuRWZmZWN0cy5Mb3dQYXNzRmlsdGVyLnByb3RvdHlwZT1kLHQuRWZmZWN0cy5IaWdoUGFzc0ZpbHRlci5wcm90b3R5cGU9ZCx0LkVmZmVjdHMuRGlzdG9ydGlvbj1mdW5jdGlvbihlKXt0aGlzLm9wdGlvbnM9e30sZT1lfHx0aGlzLm9wdGlvbnM7dmFyIGk9e2dhaW46LjV9O2Zvcih2YXIgbiBpbiB0aGlzLndhdmVTaGFwZXJOb2RlPXQuY29udGV4dC5jcmVhdGVXYXZlU2hhcGVyKCksdGhpcy5pbnB1dE5vZGU9dGhpcy5vdXRwdXROb2RlPXRoaXMud2F2ZVNoYXBlck5vZGUsaSl0aGlzW25dPWVbbl0sdGhpc1tuXT12b2lkIDA9PT10aGlzW25dfHxudWxsPT09dGhpc1tuXT9pW25dOnRoaXNbbl19LHQuRWZmZWN0cy5EaXN0b3J0aW9uLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse2dhaW46e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5nYWlufSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm9wdGlvbnMuZ2Fpbj1lLHRoaXMuYWRqdXN0R2FpbigpKX19LGFkanVzdEdhaW46e3dyaXRhYmxlOiExLGNvbmZpZ3VyYWJsZTohMSxlbnVtZXJhYmxlOiExLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlLHQ9aS5VdGlsLmlzTnVtYmVyKHRoaXMub3B0aW9ucy5nYWluKT9wYXJzZUludCgxMDAqdGhpcy5vcHRpb25zLmdhaW4sMTApOjUwLG49bmV3IEZsb2F0MzJBcnJheSg0NDEwMCksbz1NYXRoLlBJLzE4MCxzPTA7czw0NDEwMDsrK3MpZT0yKnMvNDQxMDAtMSxuW3NdPSgzK3QpKmUqMjAqby8oTWF0aC5QSSt0Kk1hdGguYWJzKGUpKTt0aGlzLndhdmVTaGFwZXJOb2RlLmN1cnZlPW59fX0pLHQuRWZmZWN0cy5GbGFuZ2VyPWZ1bmN0aW9uKGUpe3RoaXMub3B0aW9ucz17fSxlPWV8fHRoaXMub3B0aW9uczt2YXIgaT17dGltZTouNDUsc3BlZWQ6LjIsZGVwdGg6LjEsZmVlZGJhY2s6LjEsbWl4Oi41fTtmb3IodmFyIG4gaW4gdGhpcy5pbnB1dE5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLm91dHB1dE5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmlucHV0RmVlZGJhY2tOb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy53ZXRHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZHJ5R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmRlbGF5Tm9kZT10LmNvbnRleHQuY3JlYXRlRGVsYXkoKSx0aGlzLm9zY2lsbGF0b3JOb2RlPXQuY29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCksdGhpcy5nYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZmVlZGJhY2tOb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vc2NpbGxhdG9yTm9kZS50eXBlPSJzaW5lIix0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuaW5wdXRGZWVkYmFja05vZGUpLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5kcnlHYWluTm9kZSksdGhpcy5pbnB1dEZlZWRiYWNrTm9kZS5jb25uZWN0KHRoaXMuZGVsYXlOb2RlKSx0aGlzLmlucHV0RmVlZGJhY2tOb2RlLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy5kZWxheU5vZGUuY29ubmVjdCh0aGlzLndldEdhaW5Ob2RlKSx0aGlzLmRlbGF5Tm9kZS5jb25uZWN0KHRoaXMuZmVlZGJhY2tOb2RlKSx0aGlzLmZlZWRiYWNrTm9kZS5jb25uZWN0KHRoaXMuaW5wdXRGZWVkYmFja05vZGUpLHRoaXMub3NjaWxsYXRvck5vZGUuY29ubmVjdCh0aGlzLmdhaW5Ob2RlKSx0aGlzLmdhaW5Ob2RlLmNvbm5lY3QodGhpcy5kZWxheU5vZGUuZGVsYXlUaW1lKSx0aGlzLmRyeUdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSx0aGlzLndldEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSx0aGlzLm9zY2lsbGF0b3JOb2RlLnN0YXJ0KDApLGkpdGhpc1tuXT1lW25dLHRoaXNbbl09dm9pZCAwPT09dGhpc1tuXXx8bnVsbD09PXRoaXNbbl0/aVtuXTp0aGlzW25dfSx0LkVmZmVjdHMuRmxhbmdlci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShoLHt0aW1lOntlbnVtYmVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLnRpbWV9LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsMCwxKSYmKHRoaXMub3B0aW9ucy50aW1lPWUsdGhpcy5kZWxheU5vZGUuZGVsYXlUaW1lLnZhbHVlPWkuVXRpbC5ub3JtYWxpemUoZSwuMDAxLC4wMikpfX0sc3BlZWQ6e2VudW1iZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuc3BlZWR9LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsMCwxKSYmKHRoaXMub3B0aW9ucy5zcGVlZD1lLHRoaXMub3NjaWxsYXRvck5vZGUuZnJlcXVlbmN5LnZhbHVlPWkuVXRpbC5ub3JtYWxpemUoZSwuNSw1KSl9fSxkZXB0aDp7ZW51bWJlcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5kZXB0aH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmRlcHRoPWUsdGhpcy5nYWluTm9kZS5nYWluLnZhbHVlPWkuVXRpbC5ub3JtYWxpemUoZSw1ZS00LC4wMDUpKX19LGZlZWRiYWNrOntlbnVtYmVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmZlZWRiYWNrfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm9wdGlvbnMuZmVlZGJhY2s9ZSx0aGlzLmZlZWRiYWNrTm9kZS5nYWluLnZhbHVlPWkuVXRpbC5ub3JtYWxpemUoZSwwLC44KSl9fSxtaXg6e2VudW1iZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWl4fSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm9wdGlvbnMubWl4PWUsdGhpcy5kcnlHYWluTm9kZS5nYWluLnZhbHVlPXQuVXRpbC5nZXREcnlMZXZlbCh0aGlzLm1peCksdGhpcy53ZXRHYWluTm9kZS5nYWluLnZhbHVlPXQuVXRpbC5nZXRXZXRMZXZlbCh0aGlzLm1peCkpfX19KSx0LkVmZmVjdHMuU3RlcmVvUGFubmVyPWZ1bmN0aW9uKGUpe3RoaXMub3B0aW9ucz17fSxlPWV8fHRoaXMub3B0aW9uczt2YXIgaT17cGFuOjB9O2Zvcih2YXIgbiBpbiB0aGlzLmlucHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMub3V0cHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHQuY29udGV4dC5jcmVhdGVTdGVyZW9QYW5uZXI/KHRoaXMucGFubmVyTm9kZT10LmNvbnRleHQuY3JlYXRlU3RlcmVvUGFubmVyKCksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLnBhbm5lck5vZGUpLHRoaXMucGFubmVyTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSkpOnQuY29udGV4dC5jcmVhdGVQYW5uZXI/KGNvbnNvbGUud2FybigiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgdGhlIFN0ZXJlb1Bhbm5lck5vZGUuIFdpbGwgdXNlIFBhbm5lck5vZGUgaW5zdGVhZC4iKSx0aGlzLnBhbm5lck5vZGU9dC5jb250ZXh0LmNyZWF0ZVBhbm5lcigpLHRoaXMucGFubmVyTm9kZS50eXBlPSJlcXVhbHBvd2VyIix0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMucGFubmVyTm9kZSksdGhpcy5wYW5uZXJOb2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSk6KGNvbnNvbGUud2FybigiWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgdGhlIFBhbm5lciBlZmZlY3QuIiksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLm91dHB1dE5vZGUpKSxpKXRoaXNbbl09ZVtuXSx0aGlzW25dPXZvaWQgMD09PXRoaXNbbl18fG51bGw9PT10aGlzW25dP2lbbl06dGhpc1tuXX0sdC5FZmZlY3RzLlN0ZXJlb1Bhbm5lci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShoLHtwYW46e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5wYW59LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsLTEsMSkmJih0aGlzLm9wdGlvbnMucGFuPWUsdGhpcy5wYW5uZXJOb2RlJiYodGhpcy5wYW5uZXJOb2RlLnRvU3RyaW5nKCkuaW5kZXhPZigiU3RlcmVvUGFubmVyTm9kZSIpPi0xP3RoaXMucGFubmVyTm9kZS5wYW4udmFsdWU9ZTp0aGlzLnBhbm5lck5vZGUuc2V0UG9zaXRpb24oZSwwLDEtTWF0aC5hYnMoZSkpKSl9fX0pLHQuRWZmZWN0cy5Db252b2x2ZXI9ZnVuY3Rpb24oZSxuKXt0aGlzLm9wdGlvbnM9e30sZT1lfHx0aGlzLm9wdGlvbnM7dmFyIG89dGhpcyxzPW5ldyBYTUxIdHRwUmVxdWVzdCxyPXttaXg6LjV9O2Zvcih2YXIgYSBpbiB0aGlzLmNhbGxiYWNrPW4sdGhpcy5pbnB1dE5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmNvbnZvbHZlck5vZGU9dC5jb250ZXh0LmNyZWF0ZUNvbnZvbHZlcigpLHRoaXMub3V0cHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMud2V0R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmRyeUdhaW5Ob2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmNvbnZvbHZlck5vZGUpLHRoaXMuY29udm9sdmVyTm9kZS5jb25uZWN0KHRoaXMud2V0R2Fpbk5vZGUpLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5kcnlHYWluTm9kZSksdGhpcy5kcnlHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksdGhpcy53ZXRHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSkscil0aGlzW2FdPWVbYV0sdGhpc1thXT12b2lkIDA9PT10aGlzW2FdfHxudWxsPT09dGhpc1thXT9yW2FdOnRoaXNbYV07aWYoIWUuaW1wdWxzZSl7Y29uc29sZS5lcnJvcigiTm8gaW1wdWxzZSBmaWxlIHNwZWNpZmllZC4iKTtyZXR1cm59cy5vcGVuKCJHRVQiLGUuaW1wdWxzZSwhMCkscy5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIixzLm9ubG9hZD1mdW5jdGlvbihlKXt2YXIgbj1lLnRhcmdldC5yZXNwb25zZTt0LmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKG4sZnVuY3Rpb24oZSl7by5jb252b2x2ZXJOb2RlLmJ1ZmZlcj1lLG8uY2FsbGJhY2smJmkuVXRpbC5pc0Z1bmN0aW9uKG8uY2FsbGJhY2spJiZvLmNhbGxiYWNrKCl9LGZ1bmN0aW9uKGUpe2U9ZXx8RXJyb3IoIkVycm9yIGRlY29kaW5nIGltcHVsc2UgZmlsZSIpLG8uY2FsbGJhY2smJmkuVXRpbC5pc0Z1bmN0aW9uKG8uY2FsbGJhY2spJiZvLmNhbGxiYWNrKGUpfSl9LHMub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKHQpezQ9PT1zLnJlYWR5U3RhdGUmJjIwMCE9PXMuc3RhdHVzJiZjb25zb2xlLmVycm9yKCJFcnJvciB3aGlsZSBmZXRjaGluZyAiK2UuaW1wdWxzZSsiLiAiK3Muc3RhdHVzVGV4dCl9LHMuc2VuZCgpfSx0LkVmZmVjdHMuQ29udm9sdmVyLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse21peDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1peH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1peD1lLHRoaXMuZHJ5R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0RHJ5TGV2ZWwodGhpcy5taXgpLHRoaXMud2V0R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0V2V0TGV2ZWwodGhpcy5taXgpKX19fSksdC5FZmZlY3RzLlBpbmdQb25nRGVsYXk9ZnVuY3Rpb24oZSl7dGhpcy5vcHRpb25zPXt9LGU9ZXx8dGhpcy5vcHRpb25zO3ZhciBpPXtmZWVkYmFjazouNSx0aW1lOi4zLG1peDouNX07Zm9yKHZhciBuIGluIHRoaXMuaW5wdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5kZWxheU5vZGVMZWZ0PXQuY29udGV4dC5jcmVhdGVEZWxheSgpLHRoaXMuZGVsYXlOb2RlUmlnaHQ9dC5jb250ZXh0LmNyZWF0ZURlbGF5KCksdGhpcy5kcnlHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMud2V0R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmZlZWRiYWNrR2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmNoYW5uZWxNZXJnZXI9dC5jb250ZXh0LmNyZWF0ZUNoYW5uZWxNZXJnZXIoMiksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmRyeUdhaW5Ob2RlKSx0aGlzLmRyeUdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSx0aGlzLmRlbGF5Tm9kZUxlZnQuY29ubmVjdCh0aGlzLmNoYW5uZWxNZXJnZXIsMCwwKSx0aGlzLmRlbGF5Tm9kZVJpZ2h0LmNvbm5lY3QodGhpcy5jaGFubmVsTWVyZ2VyLDAsMSksdGhpcy5kZWxheU5vZGVMZWZ0LmNvbm5lY3QodGhpcy5kZWxheU5vZGVSaWdodCksdGhpcy5mZWVkYmFja0dhaW5Ob2RlLmNvbm5lY3QodGhpcy5kZWxheU5vZGVMZWZ0KSx0aGlzLmRlbGF5Tm9kZVJpZ2h0LmNvbm5lY3QodGhpcy5mZWVkYmFja0dhaW5Ob2RlKSx0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuZmVlZGJhY2tHYWluTm9kZSksdGhpcy5jaGFubmVsTWVyZ2VyLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy53ZXRHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksaSl0aGlzW25dPWVbbl0sdGhpc1tuXT12b2lkIDA9PT10aGlzW25dfHxudWxsPT09dGhpc1tuXT9pW25dOnRoaXNbbl19LHQuRWZmZWN0cy5QaW5nUG9uZ0RlbGF5LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse21peDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1peH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1peD1lLHRoaXMuZHJ5R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0RHJ5TGV2ZWwodGhpcy5taXgpLHRoaXMud2V0R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0V2V0TGV2ZWwodGhpcy5taXgpKX19LHRpbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy50aW1lfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMTgwKSYmKHRoaXMub3B0aW9ucy50aW1lPWUsdGhpcy5kZWxheU5vZGVMZWZ0LmRlbGF5VGltZS52YWx1ZT1lLHRoaXMuZGVsYXlOb2RlUmlnaHQuZGVsYXlUaW1lLnZhbHVlPWUpfX0sZmVlZGJhY2s6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5mZWVkYmFja30sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmZlZWRiYWNrPXBhcnNlRmxvYXQoZSwxMCksdGhpcy5mZWVkYmFja0dhaW5Ob2RlLmdhaW4udmFsdWU9dGhpcy5mZWVkYmFjayl9fX0pLHQuRWZmZWN0cy5SZXZlcmI9ZnVuY3Rpb24oZSl7dGhpcy5vcHRpb25zPXt9LGU9ZXx8dGhpcy5vcHRpb25zO3ZhciBpPXttaXg6LjUsdGltZTouMDEsZGVjYXk6LjAxLHJldmVyc2U6ITF9O2Zvcih2YXIgbiBpbiB0aGlzLmlucHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMucmV2ZXJiTm9kZT10LmNvbnRleHQuY3JlYXRlQ29udm9sdmVyKCksdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy53ZXRHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZHJ5R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMucmV2ZXJiTm9kZSksdGhpcy5yZXZlcmJOb2RlLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmRyeUdhaW5Ob2RlKSx0aGlzLmRyeUdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSx0aGlzLndldEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSxpKXRoaXNbbl09ZVtuXSx0aGlzW25dPXZvaWQgMD09PXRoaXNbbl18fG51bGw9PT10aGlzW25dP2lbbl06dGhpc1tuXTtsLmJpbmQodGhpcykoKX0sdC5FZmZlY3RzLlJldmVyYi5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShoLHttaXg6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5taXh9LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsMCwxKSYmKHRoaXMub3B0aW9ucy5taXg9ZSx0aGlzLmRyeUdhaW5Ob2RlLmdhaW4udmFsdWU9dC5VdGlsLmdldERyeUxldmVsKHRoaXMubWl4KSx0aGlzLndldEdhaW5Ob2RlLmdhaW4udmFsdWU9dC5VdGlsLmdldFdldExldmVsKHRoaXMubWl4KSl9fSx0aW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMudGltZX0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwxZS00LDEwKSYmKHRoaXMub3B0aW9ucy50aW1lPWUsbC5iaW5kKHRoaXMpKCkpfX0sZGVjYXk6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5kZWNheX0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwxZS00LDEwKSYmKHRoaXMub3B0aW9ucy5kZWNheT1lLGwuYmluZCh0aGlzKSgpKX19LHJldmVyc2U6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5yZXZlcnNlfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzQm9vbChlKSYmKHRoaXMub3B0aW9ucy5yZXZlcnNlPWUsbC5iaW5kKHRoaXMpKCkpfX19KSx0LkVmZmVjdHMuQml0Y3J1c2hlcj1mdW5jdGlvbihlKXt0aGlzLmlucHV0Tm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMub3V0cHV0Tm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuYml0cz1lLmJpdHN8fDQsdGhpcy5mcmVxdWVuY3k9ZS5mcmVxdWVuY3l8fDQ0MTAwLHRoaXMuY3J1c2hlck5vZGU9aS5jb250ZXh0LmNyZWF0ZVNjcmlwdFByb2Nlc3Nvcig0MDk2LDEsMSk7dmFyIHQ9dGhpczt0aGlzLmNydXNoZXJOb2RlLm9uYXVkaW9wcm9jZXNzPWZ1bmN0aW9uKGUpe2Zvcih2YXIgbj1lLmlucHV0QnVmZmVyLG89ZS5vdXRwdXRCdWZmZXIscz0wO3M8by5udW1iZXJPZkNoYW5uZWxzO3MrKylmb3IodmFyIHI9bi5nZXRDaGFubmVsRGF0YShzKSxhPW8uZ2V0Q2hhbm5lbERhdGEocyksYz1NYXRoLnBvdyguNSx0LmJpdHMtMSksaD10LmZyZXF1ZW5jeS9pLmNvbnRleHQuc2FtcGxlUmF0ZSx1PTA7dTxuLmxlbmd0aDt1KyspdSVoPT0wP2FbdV09TWF0aC5mbG9vcihyW3VdL2MpKmM6YVt1XT1hW3UtMV19LHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5jcnVzaGVyTm9kZSksdGhpcy5jcnVzaGVyTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksdGhpcy5jb25uZWN0PWZ1bmN0aW9uKGUpe3RoaXMub3V0cHV0Tm9kZS5jb25uZWN0KGUpfSx0aGlzLmRpc2Nvbm5lY3Q9ZnVuY3Rpb24oKXt0aGlzLm91dHB1dE5vZGUuZGlzY29ubmVjdCgpfX0sdC5FZmZlY3RzLkJpdGNydXNoZXIucHJvdG90eXBlPXtjb25zdHJ1Y3Rvcjp0LkVmZmVjdHMuQml0Y3J1c2hlcixzZXRCaXRzOmZ1bmN0aW9uKGUpe2U+PTEmJmU8PTE2JiYodGhpcy5iaXRzPWUpfSxnZXRCaXRzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYml0c30sc2V0RnJlcXVlbmN5OmZ1bmN0aW9uKGUpe2U+MCYmKHRoaXMuZnJlcXVlbmN5PWUpfSxnZXRGcmVxdWVuY3k6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5mcmVxdWVuY3l9fSx0LkVmZmVjdHMuVGhyZWVCYW5kRXF1YWxpemVyPWZ1bmN0aW9uKGUpe2YuY2FsbCh0aGlzLGUpfTt2YXIgcD1PYmplY3QuY3JlYXRlKGgse2N1dG9mZl9mcmVxdWVuY3lfbG93OntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuY3V0b2ZmX2ZyZXF1ZW5jeV9sb3d9LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsMTAsMjIwNTApJiYodGhpcy5vcHRpb25zLmN1dG9mZl9mcmVxdWVuY3lfbG93PWUsdGhpcy5sb3dGaWx0ZXJOb2RlLmZyZXF1ZW5jeS52YWx1ZT1lLHRoaXMubWlkRmlsdGVyTm9kZS5mcmVxdWVuY3kudmFsdWU9LjcwNyoodGhpcy5vcHRpb25zLmN1dG9mZl9mcmVxdWVuY3lfbG93K3RoaXMub3B0aW9ucy5jdXRvZmZfZnJlcXVlbmN5X2hpZ2gpKX19LGN1dG9mZl9mcmVxdWVuY3lfaGlnaDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmN1dG9mZl9mcmVxdWVuY3lfaGlnaH0sc2V0OmZ1bmN0aW9uKGUpe3QuVXRpbC5pc0luUmFuZ2UoZSwxMCwyMjA1MCkmJih0aGlzLm9wdGlvbnMuY3V0b2ZmX2ZyZXF1ZW5jeV9oaWdoPWUsdGhpcy5oaWdoRmlsdGVyTm9kZS5mcmVxdWVuY3kudmFsdWU9ZSx0aGlzLm1pZEZpbHRlck5vZGUuZnJlcXVlbmN5LnZhbHVlPS43MDcqKHRoaXMub3B0aW9ucy5jdXRvZmZfZnJlcXVlbmN5X2xvdyt0aGlzLm9wdGlvbnMuY3V0b2ZmX2ZyZXF1ZW5jeV9oaWdoKSl9fSxsb3dfYmFuZF9nYWluOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubG93X2JhbmRfZ2Fpbn0sc2V0OmZ1bmN0aW9uKGUpe3QuVXRpbC5pc0luUmFuZ2UoZSwtNDAsMTUpJiYodGhpcy5vcHRpb25zLmxvd19iYW5kX2dhaW49ZSx0aGlzLmxvd0dhaW5Ob2RlLmdhaW4udmFsdWU9TWF0aC5wb3coMTAsZS8yMCkpfX0sbWlkX2JhbmRfZ2Fpbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1pZF9iYW5kX2dhaW59LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsLTQwLDE1KSYmKHRoaXMub3B0aW9ucy5taWRfYmFuZF9nYWluPWUsdGhpcy5taWRHYWluTm9kZS5nYWluLnZhbHVlPU1hdGgucG93KDEwLGUvMjApKX19LGhpZ2hfYmFuZF9nYWluOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuaGlnaF9iYW5kX2dhaW59LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsLTQwLDE1KSYmKHRoaXMub3B0aW9ucy5oaWdoX2JhbmRfZ2Fpbj1lLHRoaXMuaGlnaEdhaW5Ob2RlLmdhaW4udmFsdWU9TWF0aC5wb3coMTAsZS8yMCkpfX0sbG93X3BlYWs6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubG93RmlsdGVyTm9kZS5RLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7dC5VdGlsLmlzSW5SYW5nZShlLDFlLTQsMTAwKSYmKHRoaXMubG93RmlsdGVyTm9kZS5RLnZhbHVlPWUpfX0sbWlkX3BlYWs6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWlkRmlsdGVyTm9kZS5RLnZhbHVlfSxzZXQ6ZnVuY3Rpb24oZSl7dC5VdGlsLmlzSW5SYW5nZShlLDFlLTQsMTAwKSYmKHRoaXMubWlkRmlsdGVyTm9kZS5RLnZhbHVlPWUpfX0saGlnaF9wZWFrOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhpZ2hGaWx0ZXJOb2RlLlEudmFsdWV9LHNldDpmdW5jdGlvbihlKXt0LlV0aWwuaXNJblJhbmdlKGUsMWUtNCwxZTMpJiYodGhpcy5oaWdoRmlsdGVyTm9kZS5RLnZhbHVlPWUpfX0sdmlzdWFsaXplckJpbkNvdW50OntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFuYWx5c2VyTm9kZS5mcmVxdWVuY3lCaW5Db3VudH0sc2V0OmZ1bmN0aW9uKGUpe3QuVXRpbC5pc0luUmFuZ2UoZSwxNiwxMDI0KSYmKHRoaXMuYW5hbHl6ZXJOb2RlLmZmdFNpemU9ZSl9fSxhbmFseXNlcjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hbmFseXNlck5vZGV9fSxmcmVxdWVuY3lEYXRhOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzLmJ5dGVGcmVxdWVuY3lEYXRhJiYodGhpcy5ieXRlRnJlcXVlbmN5RGF0YT1uZXcgVWludDhBcnJheSh0aGlzLmFuYWx5c2VyTm9kZS5mcmVxdWVuY3lCaW5Db3VudC52YWx1ZSkpLHRoaXMuYW5hbHlzZXJOb2RlLmdldEJ5dGVGcmVxdWVuY3lEYXRhKHRoaXMuRnJlcXVlbmN5RGF0YSksdGhpcy5ieXRlRnJlcXVlbmN5RGF0YX19fSk7dC5FZmZlY3RzLlRocmVlQmFuZEVxdWFsaXplci5wcm90b3R5cGU9cCx0LkVmZmVjdHMuVHJlbW9sbz1mdW5jdGlvbihlKXt0aGlzLm9wdGlvbnM9e30sZT1lfHx0aGlzLm9wdGlvbnM7dmFyIGk9e3NwZWVkOjQsZGVwdGg6MSxtaXg6Ljh9O2Zvcih2YXIgbiBpbiB0aGlzLmlucHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMub3V0cHV0Tm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZHJ5R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLndldEdhaW5Ob2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy50cmVtb2xvR2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLnRyZW1vbG9HYWluTm9kZS5nYWluLnZhbHVlPTAsdGhpcy5sZm9Ob2RlPXQuY29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCksdGhpcy5zaGFwZXJOb2RlPXQuY29udGV4dC5jcmVhdGVXYXZlU2hhcGVyKCksdGhpcy5zaGFwZXJOb2RlLmN1cnZlPW5ldyBGbG9hdDMyQXJyYXkoWzAsMV0pLHRoaXMuc2hhcGVyTm9kZS5jb25uZWN0KHRoaXMudHJlbW9sb0dhaW5Ob2RlLmdhaW4pLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy5kcnlHYWluTm9kZSksdGhpcy5kcnlHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksdGhpcy5sZm9Ob2RlLmNvbm5lY3QodGhpcy5zaGFwZXJOb2RlKSx0aGlzLmxmb05vZGUudHlwZT0ic2luZSIsdGhpcy5sZm9Ob2RlLnN0YXJ0KDApLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy50cmVtb2xvR2Fpbk5vZGUpLHRoaXMudHJlbW9sb0dhaW5Ob2RlLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy53ZXRHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksaSl0aGlzW25dPWVbbl0sdGhpc1tuXT12b2lkIDA9PT10aGlzW25dfHxudWxsPT09dGhpc1tuXT9pW25dOnRoaXNbbl19LHQuRWZmZWN0cy5UcmVtb2xvLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse21peDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1peH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1peD1lLHRoaXMuZHJ5R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0RHJ5TGV2ZWwodGhpcy5taXgpLHRoaXMud2V0R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0V2V0TGV2ZWwodGhpcy5taXgpKX19LHNwZWVkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuc3BlZWR9LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsMCwyMCkmJih0aGlzLm9wdGlvbnMuc3BlZWQ9ZSx0aGlzLmxmb05vZGUuZnJlcXVlbmN5LnZhbHVlPWUpfX0sZGVwdGg6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5kZXB0aH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmRlcHRoPWUsdGhpcy5zaGFwZXJOb2RlLmN1cnZlPW5ldyBGbG9hdDMyQXJyYXkoWzEtZSwxXSkpfX19KSx0LkVmZmVjdHMuRHViRGVsYXk9ZnVuY3Rpb24oZSl7dGhpcy5vcHRpb25zPXt9LGU9ZXx8dGhpcy5vcHRpb25zO3ZhciBpPXtmZWVkYmFjazouNix0aW1lOi43LG1peDouNSxjdXRvZmY6NzAwfTtmb3IodmFyIG4gaW4gdGhpcy5pbnB1dE5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLm91dHB1dE5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmRyeUdhaW5Ob2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy53ZXRHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZmVlZGJhY2tHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMuZGVsYXlOb2RlPXQuY29udGV4dC5jcmVhdGVEZWxheSgpLHRoaXMuYnFGaWx0ZXJOb2RlPXQuY29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKSx0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuZHJ5R2Fpbk5vZGUpLHRoaXMuZHJ5R2Fpbk5vZGUuY29ubmVjdCh0aGlzLm91dHB1dE5vZGUpLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLmZlZWRiYWNrR2Fpbk5vZGUpLHRoaXMuZmVlZGJhY2tHYWluTm9kZS5jb25uZWN0KHRoaXMuYnFGaWx0ZXJOb2RlKSx0aGlzLmJxRmlsdGVyTm9kZS5jb25uZWN0KHRoaXMuZGVsYXlOb2RlKSx0aGlzLmRlbGF5Tm9kZS5jb25uZWN0KHRoaXMuZmVlZGJhY2tHYWluTm9kZSksdGhpcy5kZWxheU5vZGUuY29ubmVjdCh0aGlzLndldEdhaW5Ob2RlKSx0aGlzLndldEdhaW5Ob2RlLmNvbm5lY3QodGhpcy5vdXRwdXROb2RlKSxpKXRoaXNbbl09ZVtuXSx0aGlzW25dPXZvaWQgMD09PXRoaXNbbl18fG51bGw9PT10aGlzW25dP2lbbl06dGhpc1tuXX0sdC5FZmZlY3RzLkR1YkRlbGF5LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGgse21peDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1peH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1peD1lLHRoaXMuZHJ5R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0RHJ5TGV2ZWwodGhpcy5taXgpLHRoaXMud2V0R2Fpbk5vZGUuZ2Fpbi52YWx1ZT10LlV0aWwuZ2V0V2V0TGV2ZWwodGhpcy5taXgpKX19LHRpbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy50aW1lfSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMTgwKSYmKHRoaXMub3B0aW9ucy50aW1lPWUsdGhpcy5kZWxheU5vZGUuZGVsYXlUaW1lLnZhbHVlPWUpfX0sZmVlZGJhY2s6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5mZWVkYmFja30sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmZlZWRiYWNrPXBhcnNlRmxvYXQoZSwxMCksdGhpcy5mZWVkYmFja0dhaW5Ob2RlLmdhaW4udmFsdWU9dGhpcy5mZWVkYmFjayl9fSxjdXRvZmY6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5jdXRvZmZ9LHNldDpmdW5jdGlvbihlKXtpLlV0aWwuaXNJblJhbmdlKGUsMCw0ZTMpJiYodGhpcy5vcHRpb25zLmN1dG9mZj1lLHRoaXMuYnFGaWx0ZXJOb2RlLmZyZXF1ZW5jeS52YWx1ZT10aGlzLmN1dG9mZil9fX0pLHQuRWZmZWN0cy5SaW5nTW9kdWxhdG9yPWZ1bmN0aW9uKGUpe3RoaXMub3B0aW9ucz17fSxlPWV8fHRoaXMub3B0aW9uczt2YXIgaT17c3BlZWQ6MzAsZGlzdG9ydGlvbjoxLG1peDouNX07Zm9yKHZhciBuIGluIHRoaXMuaW5wdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vdXRwdXROb2RlPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5kcnlHYWluTm9kZT10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMud2V0R2Fpbk5vZGU9dC5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLnZJbj10LmNvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpLHRoaXMudkluLnN0YXJ0KDApLHRoaXMudkluR2Fpbj10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMudkluR2Fpbi5nYWluLnZhbHVlPS41LHRoaXMudkluSW52ZXJ0ZXIxPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy52SW5JbnZlcnRlcjEuZ2Fpbi52YWx1ZT0tMSx0aGlzLnZJbkludmVydGVyMj10LmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMudkluSW52ZXJ0ZXIyLmdhaW4udmFsdWU9LTEsdGhpcy52SW5EaW9kZTE9bmV3IE4odC5jb250ZXh0KSx0aGlzLnZJbkRpb2RlMj1uZXcgTih0LmNvbnRleHQpLHRoaXMudkluSW52ZXJ0ZXIzPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy52SW5JbnZlcnRlcjMuZ2Fpbi52YWx1ZT0tMSx0aGlzLnZjSW52ZXJ0ZXIxPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy52Y0ludmVydGVyMS5nYWluLnZhbHVlPS0xLHRoaXMudmNEaW9kZTM9bmV3IE4odC5jb250ZXh0KSx0aGlzLnZjRGlvZGU0PW5ldyBOKHQuY29udGV4dCksdGhpcy5vdXRHYWluPXQuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vdXRHYWluLmdhaW4udmFsdWU9Myx0aGlzLmNvbXByZXNzb3I9dC5jb250ZXh0LmNyZWF0ZUR5bmFtaWNzQ29tcHJlc3NvcigpLHRoaXMuY29tcHJlc3Nvci50aHJlc2hvbGQudmFsdWU9LTI0LHRoaXMuY29tcHJlc3Nvci5yYXRpby52YWx1ZT0xNix0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuZHJ5R2Fpbk5vZGUpLHRoaXMuZHJ5R2Fpbk5vZGUuY29ubmVjdCh0aGlzLm91dHB1dE5vZGUpLHRoaXMuaW5wdXROb2RlLmNvbm5lY3QodGhpcy52Y0ludmVydGVyMSksdGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLnZjRGlvZGU0Lm5vZGUpLHRoaXMudmNJbnZlcnRlcjEuY29ubmVjdCh0aGlzLnZjRGlvZGUzLm5vZGUpLHRoaXMudkluLmNvbm5lY3QodGhpcy52SW5HYWluKSx0aGlzLnZJbkdhaW4uY29ubmVjdCh0aGlzLnZJbkludmVydGVyMSksdGhpcy52SW5HYWluLmNvbm5lY3QodGhpcy52Y0ludmVydGVyMSksdGhpcy52SW5HYWluLmNvbm5lY3QodGhpcy52Y0Rpb2RlNC5ub2RlKSx0aGlzLnZJbkludmVydGVyMS5jb25uZWN0KHRoaXMudkluSW52ZXJ0ZXIyKSx0aGlzLnZJbkludmVydGVyMS5jb25uZWN0KHRoaXMudkluRGlvZGUyLm5vZGUpLHRoaXMudkluSW52ZXJ0ZXIyLmNvbm5lY3QodGhpcy52SW5EaW9kZTEubm9kZSksdGhpcy52SW5EaW9kZTEuY29ubmVjdCh0aGlzLnZJbkludmVydGVyMyksdGhpcy52SW5EaW9kZTIuY29ubmVjdCh0aGlzLnZJbkludmVydGVyMyksdGhpcy52SW5JbnZlcnRlcjMuY29ubmVjdCh0aGlzLmNvbXByZXNzb3IpLHRoaXMudmNEaW9kZTMuY29ubmVjdCh0aGlzLmNvbXByZXNzb3IpLHRoaXMudmNEaW9kZTQuY29ubmVjdCh0aGlzLmNvbXByZXNzb3IpLHRoaXMuY29tcHJlc3Nvci5jb25uZWN0KHRoaXMub3V0R2FpbiksdGhpcy5vdXRHYWluLmNvbm5lY3QodGhpcy53ZXRHYWluTm9kZSksdGhpcy53ZXRHYWluTm9kZS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSksaSl0aGlzW25dPWVbbl0sdGhpc1tuXT12b2lkIDA9PT10aGlzW25dfHxudWxsPT09dGhpc1tuXT9pW25dOnRoaXNbbl19O3ZhciBOPWZ1bmN0aW9uKGUpe3RoaXMuY29udGV4dD1lLHRoaXMubm9kZT10aGlzLmNvbnRleHQuY3JlYXRlV2F2ZVNoYXBlcigpLHRoaXMudmI9LjIsdGhpcy52bD0uNCx0aGlzLmg9MSx0aGlzLnNldEN1cnZlKCl9O2Z1bmN0aW9uIHYoZSl7Zm9yKHZhciB0PWkuY29udGV4dC5zYW1wbGVSYXRlLG49bmV3IEZsb2F0MzJBcnJheSh0KSxvPU1hdGguUEkvMTgwLHM9MDtzPHQ7cysrKXt2YXIgcj0yKnMvdC0xO25bc109KDMrZSkqcioyMCpvLyhNYXRoLlBJK2UqTWF0aC5hYnMocikpfXJldHVybiBufU4ucHJvdG90eXBlLnNldERpc3RvcnRpb249ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaD1lLHRoaXMuc2V0Q3VydmUoKX0sTi5wcm90b3R5cGUuc2V0Q3VydmU9ZnVuY3Rpb24oKXt2YXIgZSx0LGksbixvLHMscjtmb3IodD0xMDI0LG89bmV3IEZsb2F0MzJBcnJheSh0KSxlPXM9MCxyPW8ubGVuZ3RoOzA8PXI/czxyOnM+cjtlPTA8PXI/KytzOi0tcyluPShpPU1hdGguYWJzKGk9KGUtdC8yKS8odC8yKSkpPD10aGlzLnZiPzA6dGhpcy52YjxpJiZpPD10aGlzLnZsP3RoaXMuaCooTWF0aC5wb3coaS10aGlzLnZiLDIpLygyKnRoaXMudmwtMip0aGlzLnZiKSk6dGhpcy5oKmktdGhpcy5oKnRoaXMudmwrdGhpcy5oKihNYXRoLnBvdyh0aGlzLnZsLXRoaXMudmIsMikvKDIqdGhpcy52bC0yKnRoaXMudmIpKSxvW2VdPW47cmV0dXJuIHRoaXMubm9kZS5jdXJ2ZT1vfSxOLnByb3RvdHlwZS5jb25uZWN0PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm5vZGUuY29ubmVjdChlKX0sdC5FZmZlY3RzLlJpbmdNb2R1bGF0b3IucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoaCx7bWl4OntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWl4fSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm9wdGlvbnMubWl4PWUsdGhpcy5kcnlHYWluTm9kZS5nYWluLnZhbHVlPXQuVXRpbC5nZXREcnlMZXZlbCh0aGlzLm1peCksdGhpcy53ZXRHYWluTm9kZS5nYWluLnZhbHVlPXQuVXRpbC5nZXRXZXRMZXZlbCh0aGlzLm1peCkpfX0sc3BlZWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5zcGVlZH0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDJlMykmJih0aGlzLm9wdGlvbnMuc3BlZWQ9ZSx0aGlzLnZJbi5mcmVxdWVuY3kudmFsdWU9ZSl9fSxkaXN0b3J0aW9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuZGlzdG9ydGlvbn0sc2V0OmZ1bmN0aW9uKGUpe2lmKGkuVXRpbC5pc0luUmFuZ2UoZSwuMiw1MCkpe3RoaXMub3B0aW9ucy5kaXN0b3J0aW9uPXBhcnNlRmxvYXQoZSwxMCk7Zm9yKHZhciB0PVt0aGlzLnZJbkRpb2RlMSx0aGlzLnZJbkRpb2RlMix0aGlzLnZjRGlvZGUzLHRoaXMudmNEaW9kZTRdLG49MCxvPXQubGVuZ3RoO248bztuKyspdFtuXS5zZXREaXN0b3J0aW9uKGUpfX19fSksdC5FZmZlY3RzLlF1YWRyYWZ1eno9ZnVuY3Rpb24oZSl7dGhpcy5vcHRpb25zPXt9LGU9ZXx8dGhpcy5vcHRpb25zO3ZhciB0PXtsb3dHYWluOi42LG1pZExvd0dhaW46LjgsbWlkSGlnaEdhaW46LjUsaGlnaEdhaW46LjZ9O3RoaXMuaW5wdXROb2RlPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5vdXRwdXROb2RlPWkuY29udGV4dC5jcmVhdGVHYWluKCksdGhpcy5kcnlHYWluTm9kZT1pLmNvbnRleHQuY3JlYXRlR2FpbigpLHRoaXMud2V0R2Fpbk5vZGU9aS5jb250ZXh0LmNyZWF0ZUdhaW4oKSx0aGlzLmxvd3Bhc3NMZWZ0PWkuY29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKSx0aGlzLmxvd3Bhc3NMZWZ0LnR5cGU9Imxvd3Bhc3MiLHRoaXMubG93cGFzc0xlZnQuZnJlcXVlbmN5LnZhbHVlPTE0Nyx0aGlzLmxvd3Bhc3NMZWZ0LlEudmFsdWU9LjcwNzEsdGhpcy5iYW5kcGFzczFMZWZ0PWkuY29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKSx0aGlzLmJhbmRwYXNzMUxlZnQudHlwZT0iYmFuZHBhc3MiLHRoaXMuYmFuZHBhc3MxTGVmdC5mcmVxdWVuY3kudmFsdWU9NTg3LHRoaXMuYmFuZHBhc3MxTGVmdC5RLnZhbHVlPS43MDcxLHRoaXMuYmFuZHBhc3MyTGVmdD1pLmNvbnRleHQuY3JlYXRlQmlxdWFkRmlsdGVyKCksdGhpcy5iYW5kcGFzczJMZWZ0LnR5cGU9ImJhbmRwYXNzIix0aGlzLmJhbmRwYXNzMkxlZnQuZnJlcXVlbmN5LnZhbHVlPTI0OTAsdGhpcy5iYW5kcGFzczJMZWZ0LlEudmFsdWU9LjcwNzEsdGhpcy5oaWdocGFzc0xlZnQ9aS5jb250ZXh0LmNyZWF0ZUJpcXVhZEZpbHRlcigpLHRoaXMuaGlnaHBhc3NMZWZ0LnR5cGU9ImhpZ2hwYXNzIix0aGlzLmhpZ2hwYXNzTGVmdC5mcmVxdWVuY3kudmFsdWU9NDk4MCx0aGlzLmhpZ2hwYXNzTGVmdC5RLnZhbHVlPS43MDcxLHRoaXMub3ZlcmRyaXZlcz1bXTtmb3IodmFyIG49MDtuPDQ7bisrKXRoaXMub3ZlcmRyaXZlc1tuXT1pLmNvbnRleHQuY3JlYXRlV2F2ZVNoYXBlcigpLHRoaXMub3ZlcmRyaXZlc1tuXS5jdXJ2ZT12KCk7dGhpcy5pbnB1dE5vZGUuY29ubmVjdCh0aGlzLndldEdhaW5Ob2RlKSx0aGlzLmlucHV0Tm9kZS5jb25uZWN0KHRoaXMuZHJ5R2Fpbk5vZGUpLHRoaXMuZHJ5R2Fpbk5vZGUuY29ubmVjdCh0aGlzLm91dHB1dE5vZGUpO3ZhciBvPVt0aGlzLmxvd3Bhc3NMZWZ0LHRoaXMuYmFuZHBhc3MxTGVmdCx0aGlzLmJhbmRwYXNzMkxlZnQsdGhpcy5oaWdocGFzc0xlZnRdO2ZvcihuPTA7bjxvLmxlbmd0aDtuKyspdGhpcy53ZXRHYWluTm9kZS5jb25uZWN0KG9bbl0pLG9bbl0uY29ubmVjdCh0aGlzLm92ZXJkcml2ZXNbbl0pLHRoaXMub3ZlcmRyaXZlc1tuXS5jb25uZWN0KHRoaXMub3V0cHV0Tm9kZSk7Zm9yKHZhciBzIGluIHQpdGhpc1tzXT1lW3NdLHRoaXNbc109dm9pZCAwPT09dGhpc1tzXXx8bnVsbD09PXRoaXNbc10/dFtzXTp0aGlzW3NdfSx0LkVmZmVjdHMuUXVhZHJhZnV6ei5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShoLHtsb3dHYWluOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubG93R2Fpbn0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmxvd0dhaW49ZSx0aGlzLm92ZXJkcml2ZXNbMF0uY3VydmU9dihpLlV0aWwubm9ybWFsaXplKHRoaXMubG93R2FpbiwwLDE1MCkpKX19LG1pZExvd0dhaW46e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5taWRMb3dHYWlufSxzZXQ6ZnVuY3Rpb24oZSl7aS5VdGlsLmlzSW5SYW5nZShlLDAsMSkmJih0aGlzLm9wdGlvbnMubWlkTG93R2Fpbj1lLHRoaXMub3ZlcmRyaXZlc1sxXS5jdXJ2ZT12KGkuVXRpbC5ub3JtYWxpemUodGhpcy5taWRMb3dHYWluLDAsMTUwKSkpfX0sbWlkSGlnaEdhaW46e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5taWRIaWdoR2Fpbn0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLm1pZEhpZ2hHYWluPWUsdGhpcy5vdmVyZHJpdmVzWzJdLmN1cnZlPXYoaS5VdGlsLm5vcm1hbGl6ZSh0aGlzLm1pZEhpZ2hHYWluLDAsMTUwKSkpfX0saGlnaEdhaW46e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5oaWdoR2Fpbn0sc2V0OmZ1bmN0aW9uKGUpe2kuVXRpbC5pc0luUmFuZ2UoZSwwLDEpJiYodGhpcy5vcHRpb25zLmhpZ2hHYWluPWUsdGhpcy5vdmVyZHJpdmVzWzNdLmN1cnZlPXYoaS5VdGlsLm5vcm1hbGl6ZSh0aGlzLmhpZ2hHYWluLDAsMTUwKSkpfX19KX0oInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93Omdsb2JhbCk7YDsNCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHRFbGVtZW50KTsNCiAgLyogZ2xvYmFsIFBpenppY2F0byAqLw0KDQogIGNvbnN0IHsgdm0sIENhc3QgfSA9IFNjcmF0Y2g7DQogIGNvbnN0IHJ1bnRpbWUgPSB2bS5ydW50aW1lOw0KICBjb25zdCBzY3JhdGNoQXVkaW8gPSBydW50aW1lLmF1ZGlvRW5naW5lOw0KDQogIGNvbnN0IHRzM0RhdGEgPSBTeW1ib2woInRzM0RhdGEiKTsNCiAgY29uc3Qgc2ltcGxlRWZmZWN0cyA9IFsNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJwaXRjaCIpLCB2YWx1ZTogInBpdGNoIiB9LA0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImRldHVuZSIpLCB2YWx1ZTogImRldHVuZSIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzcGVlZCIpLCB2YWx1ZTogInNwZWVkIiB9LA0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInBhbiIpLCB2YWx1ZTogInBhbiIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJnYWluIiksIHZhbHVlOiAiZ2FpbiIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJkaXN0b3J0aW9uIiksIHZhbHVlOiAiZGlzdG9ydGlvbiIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJhdHRhY2siKSwgdmFsdWU6ICJhdHRhY2siIH0sDQogICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgicmVsZWFzZSIpLCB2YWx1ZTogInJlbGVhc2UiIH0sDQogIF07DQogIGNvbnN0IGNvbXBsZXhFZmZlY3RzID0gWw0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInJldmVyYiIpLCB2YWx1ZTogInJldmVyYiIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJkZWxheSIpLCB2YWx1ZTogImRlbGF5IiB9LA0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInRyZW1vbG8iKSwgdmFsdWU6ICJ0cmVtb2xvIiB9LA0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImZ1enoiKSwgdmFsdWU6ICJmdXp6IiB9LA0KICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImJpdGNydXNoIiksIHZhbHVlOiAiYml0Y3J1c2giIH0sDQogICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiaGlnaHBhc3MiKSwgdmFsdWU6ICJoaWdocGFzcyIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJsb3dwYXNzIiksIHZhbHVlOiAibG93cGFzcyIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJmbGFuZ2VyIiksIHZhbHVlOiAiZmxhbmdlciIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJjb21wcmVzc29yIiksIHZhbHVlOiAiY29tcHJlc3NvciIgfSwNCiAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJlcXVhbGl6ZXIiKSwgdmFsdWU6ICJlcXVhbGl6ZXIiIH0sDQogIF07DQoNCiAgbGV0IGRlbHRhVGltZSA9IDAsDQogICAgcHJldkZyYW1lVGltZSA9IDA7DQogIGxldCBzb3VuZEJhbmsgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICBsZXQgc2V0dGluZ3MgPSB7IGZsYWdDdHJsOiBmYWxzZSwgY2FuU2F2ZTogZmFsc2UgfTsNCg0KICBjbGFzcyBTUHR1bmVTaGFyazMgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgLyogRGVwcmVjYXRpb24gTWFya2VyICovDQogICAgICB0aGlzLmxvYWRTdG9yYWdlID0gZnVuY3Rpb24gKHN0b3JhZ2UpIHsNCiAgICAgICAgaWYgKHN0b3JhZ2UgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgICBzZXR0aW5ncyA9IHN0b3JhZ2Uuc2V0dGluZ3M7DQogICAgICAgIGNvbnN0IHRlbXBCYW5rID0gc3RydWN0dXJlZENsb25lKHN0b3JhZ2UuYmFuayk7DQogICAgICAgIGNvbnN0IHNvdW5kcyA9IE9iamVjdC52YWx1ZXModGVtcEJhbmspOw0KDQogICAgICAgIGNvbnN0IGdldFRhcmdldE5hbWUgPSAobmFtZSkgPT4gew0KICAgICAgICAgIHJldHVybiBydW50aW1lLnRhcmdldHMuZmluZCgodCkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIHQuZ2V0TmFtZSgpLnJlcGxhY2VBbGwoIi8iLCAiIikgPT09IG5hbWU7DQogICAgICAgICAgfSk7DQogICAgICAgIH07DQogICAgICAgIGNvbnN0IGxvYWRFbmRIYW5kbGVyID0gKGluZGV4KSA9PiB7DQogICAgICAgICAgaWYgKGluZGV4ID49IHNvdW5kcy5sZW5ndGggLSAxKSBzb3VuZEJhbmsgPSB0ZW1wQmFuazsNCiAgICAgICAgfTsNCg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvdW5kcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGNvbnN0IHNvdW5kID0gc291bmRzW2ldOw0KICAgICAgICAgIHNvdW5kLmxvYWRlZCA9IGZhbHNlOw0KICAgICAgICAgIGlmIChzb3VuZC5pc1ZhbmlsbGEpIHsNCiAgICAgICAgICAgIGNvbnN0IGluZm8gPSBzb3VuZC5zcmMNCiAgICAgICAgICAgICAgLnN1YnN0cmluZygxLCBzb3VuZC5zcmMubGFzdEluZGV4T2YoIi4iKSkNCiAgICAgICAgICAgICAgLnNwbGl0KCIvIik7DQogICAgICAgICAgICBsZXQgdGFyZ2V0ID0NCiAgICAgICAgICAgICAgaW5mb1swXSA9PT0gIlN0YWdlIg0KICAgICAgICAgICAgICAgID8gcnVudGltZS5nZXRUYXJnZXRGb3JTdGFnZSgpDQogICAgICAgICAgICAgICAgOiBnZXRUYXJnZXROYW1lKGluZm9bMF0pOw0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIGFsZXJ0KA0KICAgICAgICAgICAgICAgIFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAgICAgYFR1bmUgU2hhcmsgMyAtLSBGYWlsZWQgdG8gbG9hZCAke2luZm9bMV19IGZyb20gJHtpbmZvWzBdfWANCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCBzY3JhdGNoU291bmQgPSB0YXJnZXQuc3ByaXRlLnNvdW5kcy5maW5kKChpKSA9PiB7DQogICAgICAgICAgICAgIHJldHVybiBpLm5hbWUucmVwbGFjZUFsbCgiLyIsICIiKSA9PT0gaW5mb1sxXTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKHNjcmF0Y2hTb3VuZCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIGFsZXJ0KA0KICAgICAgICAgICAgICAgIFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAgICAgYFR1bmUgU2hhcmsgMyAtLSBGYWlsZWQgdG8gbG9hZCAke2luZm9bMV19IGZyb20gJHtpbmZvWzBdfWANCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgYnVmZmVyID0NCiAgICAgICAgICAgICAgdGFyZ2V0LnNwcml0ZS5zb3VuZEJhbmsuc291bmRQbGF5ZXJzW3NjcmF0Y2hTb3VuZC5zb3VuZElkXS5idWZmZXI7DQogICAgICAgICAgICBjb25zdCBlbmdpbmUgPSBuZXcgUGl6emljYXRvLlNvdW5kKHsNCiAgICAgICAgICAgICAgc291cmNlOiAiYnVmZmVyIiwNCiAgICAgICAgICAgICAgb3B0aW9uczogeyBidWZmZXIsIGF0dGFjazogMCB9LA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGVuZ2luZS5zb3VyY2VOb2RlID0gZW5naW5lLmdldFNvdXJjZU5vZGUoKTsNCiAgICAgICAgICAgIHNvdW5kLmNvbnRleHQgPSBlbmdpbmU7DQogICAgICAgICAgICBzb3VuZC5sb2FkZWQgPSB0cnVlOw0KICAgICAgICAgICAgbG9hZEVuZEhhbmRsZXIoaSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IG5ldyBQaXp6aWNhdG8uU291bmQoDQogICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzb3VyY2U6ICJmaWxlIiwNCiAgICAgICAgICAgICAgICBvcHRpb25zOiB7IHBhdGg6IHNvdW5kLnNyYywgYXR0YWNrOiAwIH0sDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICgpID0+IHsNCiAgICAgICAgICAgICAgICBlbmdpbmUuc291cmNlTm9kZSA9IGVuZ2luZS5nZXRTb3VyY2VOb2RlKCk7DQogICAgICAgICAgICAgICAgc291bmQuY29udGV4dCA9IGVuZ2luZTsNCiAgICAgICAgICAgICAgICBzb3VuZC5sb2FkZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGxvYWRFbmRIYW5kbGVyKGkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICApOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICAgIGlmICghU2NyYXRjaC5leHRlbnNpb25zLmlzUGVuZ3Vpbk1vZCkgew0KICAgICAgICBydW50aW1lLm9uKCJQUk9KRUNUX0xPQURFRCIsICgpID0+DQogICAgICAgICAgdGhpcy5sb2FkU3RvcmFnZShydW50aW1lLmV4dGVuc2lvblN0b3JhZ2VbIlNQdHVuZVNoYXJrMyJdKQ0KICAgICAgICApOw0KICAgICAgfQ0KICAgICAgLyogTWFya2VyIEVuZCAqLw0KDQogICAgICBydW50aW1lLm9uKCJQUk9KRUNUX1NUQVJUIiwgKCkgPT4gew0KICAgICAgICBpZiAoc2V0dGluZ3MuZmxhZ0N0cmwpIHRoaXMuY3RybFNvdW5kcyh7IENPTlRST0w6ICJzdG9wIiB9KTsNCiAgICAgIH0pOw0KICAgICAgcnVudGltZS5vbigiUFJPSkVDVF9TVE9QX0FMTCIsICgpID0+IHsNCiAgICAgICAgaWYgKHNldHRpbmdzLmZsYWdDdHJsKSB0aGlzLmN0cmxTb3VuZHMoeyBDT05UUk9MOiAic3RvcCIgfSk7DQogICAgICB9KTsNCiAgICAgIHJ1bnRpbWUub24oIkJFRk9SRV9FWEVDVVRFIiwgKCkgPT4gew0KICAgICAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTsNCiAgICAgICAgZGVsdGFUaW1lID0gcHJldkZyYW1lVGltZSA9PT0gMCA/IDAgOiAobm93IC0gcHJldkZyYW1lVGltZSkgLyAxMDAwOw0KICAgICAgICBwcmV2RnJhbWVUaW1lID0gbm93Ow0KDQogICAgICAgIGNvbnN0IHByb2plY3RWYWwgPSBzY3JhdGNoQXVkaW8uaW5wdXROb2RlLmdhaW4udmFsdWU7DQogICAgICAgIE9iamVjdC52YWx1ZXMoc291bmRCYW5rKS5mb3JFYWNoKChiYW5rKSA9PiB7DQogICAgICAgICAgaWYgKGJhbmsubG9hZGVkKSB7DQogICAgICAgICAgICBjb25zdCBzb3VuZCA9IGJhbmsuY29udGV4dDsNCiAgICAgICAgICAgIC8vIENsYW1wIFZvbHVtZSB0byBQcm9qZWN0IFZvbHVtZQ0KICAgICAgICAgICAgY29uc3QgY3VyVm9sID0gTWF0aC5taW4oMTAwLCBNYXRoLm1heCgwLCBiYW5rLnZvbCkpIC8gMTAwOw0KICAgICAgICAgICAgc291bmQudm9sdW1lID0gY3VyVm9sICogcHJvamVjdFZhbDsNCg0KICAgICAgICAgICAgaWYgKHNvdW5kLnBsYXlpbmcpIHsNCiAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IEN1cnJlbnQgVGltZQ0KICAgICAgICAgICAgICBjb25zdCBsZW5nID0NCiAgICAgICAgICAgICAgICBzb3VuZC5sb29wICYmIGJhbmsubG9vcFBhcm1bMV0NCiAgICAgICAgICAgICAgICAgID8gYmFuay5sb29wUGFybVsxXQ0KICAgICAgICAgICAgICAgICAgOiBzb3VuZC5zb3VyY2VOb2RlLmJ1ZmZlci5kdXJhdGlvbjsNCiAgICAgICAgICAgICAgbGV0IHRpbWUgPSBiYW5rLmN1cnJlbnRUaW1lOw0KICAgICAgICAgICAgICB0aW1lICs9IGRlbHRhVGltZSAqIGJhbmsucmF0ZTsNCiAgICAgICAgICAgICAgaWYgKHNvdW5kLmxvb3ApDQogICAgICAgICAgICAgICAgdGltZSA9DQogICAgICAgICAgICAgICAgICBNYXRoLm1heCgwLCAodGltZSAlIChsZW5nIC0gYmFuay5sb29wUGFybVswXSkpICsgMC4wMDAwMSkgKw0KICAgICAgICAgICAgICAgICAgYmFuay5sb29wUGFybVswXTsNCiAgICAgICAgICAgICAgZWxzZSB0aW1lID0gTWF0aC5taW4obGVuZywgTWF0aC5tYXgoMCwgdGltZSkpOw0KICAgICAgICAgICAgICBiYW5rLmN1cnJlbnRUaW1lID0gdGltZTsNCg0KICAgICAgICAgICAgICAvLyBBcHBseSBTcGVlZCBDaGFuZ2VzDQogICAgICAgICAgICAgIGlmIChiYW5rLnNwZWVkICE9PSAxKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbGFzdFRpbWUgPSBiYW5rLmN1cnJlbnRUaW1lOw0KICAgICAgICAgICAgICAgIHNvdW5kLnN0b3AoKTsNCiAgICAgICAgICAgICAgICBiYW5rLmN1cnJlbnRUaW1lID0gbGFzdFRpbWU7DQogICAgICAgICAgICAgICAgc291bmQucGxheSgwLCBsYXN0VGltZSk7DQogICAgICAgICAgICAgICAgdGhpcy5maXhBdWRpb05vZGVzKHNvdW5kLnNvdXJjZU5vZGUsIGJhbmspOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgICAgcnVudGltZS5vbigiUlVOVElNRV9QQVVTRUQiLCAoKSA9PiB0aGlzLmN0cmxTb3VuZHMoeyBDT05UUk9MOiAicGF1c2UiIH0pKTsNCiAgICAgIHJ1bnRpbWUub24oIlJVTlRJTUVfVU5QQVVTRUQiLCAoKSA9Pg0KICAgICAgICB0aGlzLmN0cmxTb3VuZHMoeyBDT05UUk9MOiAidW5wYXVzZSIgfSkNCiAgICAgICk7DQogICAgfQ0KICAgIGdldEluZm8oKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBpZDogIlNQdHVuZVNoYXJrMyIsDQogICAgICAgIG5hbWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJUdW5lIFNoYXJrIFYzIiksDQogICAgICAgIGRvY3NVUkk6ICJodHRwczovL2V4dGVuc2lvbnMudHVyYm93YXJwLm9yZy9TaGFya1Bvb2wvVHVuZS1TaGFyay1WMyIsDQogICAgICAgIGNvbG9yMTogIiM2NjY2NjYiLA0KICAgICAgICBtZW51SWNvblVSSSwNCiAgICAgICAgYmxvY2tJY29uVVJJLA0KICAgICAgICBibG9ja3M6IFsNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJpbXBvcnRVUkwiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImltcG9ydCBzb3VuZCBmcm9tIFVSTCBbVVJMXSBuYW1lZCBbTkFNRV0iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgVVJMOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogImh0dHBzOi8vc2hhcmtwb29scy1leHRlbnNpb25zLnZlcmNlbC5hcHAvZXh0ZW5zaW9uLXV0aWxzL1RTL1Jlc29uYW5jZS1Ib21lLm1wMyIsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImltcG9ydE1lbnUiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImltcG9ydCBzb3VuZCBbU09VTkRdIG5hbWVkIFtOQU1FXSIpLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLnNldCwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBTT1VORDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TT1VORCB9LA0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJiaW5kU291bmQiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoIltUWVBFXSBzb3VuZCBbTkFNRTJdIGFuZCBzb3VuZCBbTkFNRV0iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgVFlQRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJiaW5kTWVudSIgfSwNCiAgICAgICAgICAgICAgTkFNRTI6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQyIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5MQUJFTCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJBdWRpbyBQbGF5YmFjayIpLA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAic3RhcnRTb3VuZCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgic3RhcnQgc291bmQgW05BTUVdIiksDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAic3RhcnRTb3VuZEF0IiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzdGFydCBzb3VuZCBbTkFNRV0gYXQgdGltZSBbVElNRV0iKSwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgVElNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNSB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInBsYXlBbmRTdG9wIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAic3RhcnQgc291bmQgW05BTUVdIGF0IHRpbWUgW1RJTUVdIGFuZCBzdG9wIGF0IFtNQVhdIHNlY29uZHMiDQogICAgICAgICAgICApLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBUSU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAwIH0sDQogICAgICAgICAgICAgIE1BWDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMiB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInN0b3BTb3VuZCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgic3RvcCBzb3VuZCBbTkFNRV0iKSwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJwYXVzZVNvdW5kIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJbVU5fUEFVU0VdIHNvdW5kIFtOQU1FXSIpLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBVTl9QQVVTRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBtZW51OiAidW5fcGF1c2VNZW51IiwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICAiLS0tIiwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJjdHJsU291bmRzIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJbQ09OVFJPTF0gYWxsIHNvdW5kcyIpLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIENPTlRST0w6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAicGxheU1lbnUiIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5MQUJFTCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJBdWRpbyBPcGVyYXRpb25zIiksDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJlbmFibGVDb250cm9sIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAidG9nZ2xlIHNvdW5kIGxpbmsgdG8gW0dPXSBbU1RPUF0gW09OX09GRl0iDQogICAgICAgICAgICApLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLnNldCwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBHTzogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLklNQUdFLA0KICAgICAgICAgICAgICAgIGRhdGFVUkk6IGV4dHJhSWNvbnMuZmxhZywNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgU1RPUDogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLklNQUdFLA0KICAgICAgICAgICAgICAgIGRhdGFVUkk6IGV4dHJhSWNvbnMuc3RvcCwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgT05fT0ZGOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInRvZ2dsZU1lbnUiIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAidG9nZ2xlT3ZlcmxhcCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgidG9nZ2xlIHNvdW5kIFtOQU1FXSBvdmVybGFwcGluZyBbVFlQRV0iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAidG9nZ2xlTWVudSIgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJ0b2dnbGVSZXZlcnNlIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ0b2dnbGUgc291bmQgW05BTUVdIHJldmVyc2UgbW9kZSBbVFlQRV0iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAidG9nZ2xlTWVudSIgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJ0b2dnbGVMb29wIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ0b2dnbGUgc291bmQgW05BTUVdIGxvb3BpbmcgW1RZUEVdIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInRvZ2dsZU1lbnUiIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAibG9vcFBhcmFtcyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgNCiAgICAgICAgICAgICAgInNvdW5kIFtOQU1FXSBsb29wIHN0YXJ0IFtTVEFSVF0gZW5kIFtFTkRdIg0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFNUQVJUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAwIH0sDQogICAgICAgICAgICAgIEVORDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMiB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgICItLS0iLA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImRlbGV0ZVNvdW5kIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJkZWxldGUgc291bmQgW05BTUVdIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImRlbGV0ZUFsbFNvdW5kcyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiZGVsZXRlIGFsbCBzb3VuZHMiKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJhbGxTb3VuZHMiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJhbGwgc291bmRzIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYWxsUGxheVNvdW5kcyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImFsbCBwbGF5aW5nIHNvdW5kcyIpLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLnNldCwNCiAgICAgICAgICB9LA0KICAgICAgICAgICItLS0iLA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogIndoZW5Tb3VuZCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkhBVCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ3aGVuIHNvdW5kIFtOQU1FXSBbQ09OVFJPTF0iKSwNCiAgICAgICAgICAgIGlzRWRnZUFjdGl2YXRlZDogZmFsc2UsDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBDT05UUk9MOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImhhdFBsYXllciIgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzb3VuZENoZWNrIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzb3VuZCBbTkFNRV0gW0NPTlRST0xdID8iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5zZXQsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIENPTlRST0w6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgbWVudTogInNvdW5kQm9vbHMiLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNvdW5kUHJvcGVydHkiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJbUFJPUF0gb2Ygc291bmQgW05BTUVdIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBQUk9QOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInNvdW5kUHJvcHMiIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiZ2V0TG91ZFRpbWUiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAiW1RZUEVdIG9mIHNvdW5kIFtOQU1FXSBhdCB0aW1lIFtUSU1FXSBpbiBjaGFubmVsIFtDSEFOTkVMXSINCiAgICAgICAgICAgICksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMuc2V0LA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAibG91ZFByb3BzIiB9LA0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgVElNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMCB9LA0KICAgICAgICAgICAgICBDSEFOTkVMOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5MQUJFTCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJBdWRpbyBFZmZlY3RzIiksDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzZXRWb2wiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInNldCB2b2x1bWUgb2Ygc291bmQgW05BTUVdIHRvIFtOVU1dIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMubm9iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBOVU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEwMCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInJlc2V0RWZmZWN0IiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJyZXNldCBbRUZGRUNUXSBvZiBzb3VuZCBbTkFNRV0iKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5ub2IsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgRUZGRUNUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogImVmZmVjdE1lbnUiIH0sDQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgICItLS0iLA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldFRoaW5nTmV3IiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzZXQgW1RZUEVdIG9mIHNvdW5kIFtOQU1FXSB0byBbVkFMVUVdIiksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMubm9iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBUWVBFOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIG1lbnU6ICJzaW5nbGVFZmZlY3ROZXciLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBWQUxVRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldFJldmVyYiIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgNCiAgICAgICAgICAgICAgInNldCByZXZlcmIgb2Ygc291bmQgW05BTUVdIHRvIHRpbWUgW1RJTUVdIGRlY2F5IFtERUNBWV0gbWl4IFtNSVhdIg0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5ub2IsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFRJTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEwMCB9LA0KICAgICAgICAgICAgICBERUNBWTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMTAwIH0sDQogICAgICAgICAgICAgIE1JWDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNTAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzZXREZWxheSIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgNCiAgICAgICAgICAgICAgInNldCBkZWxheSBvZiBzb3VuZCBbTkFNRV0gdG8gdGltZSBbVElNRV0gZmVlZGJhY2sgW0ZFRURdIG1peCBbTUlYXSINCiAgICAgICAgICAgICksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMubm9iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBGRUVEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA2MCB9LA0KICAgICAgICAgICAgICBUSU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1MCB9LA0KICAgICAgICAgICAgICBNSVg6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDUwIH0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAic2V0VHJlbW9sbyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgNCiAgICAgICAgICAgICAgInNldCB0cmVtb2xvIG9mIHNvdW5kIFtOQU1FXSB0byBzcGVlZCBbU1BFRURdIGRlcHRoIFtERVBUSF0gbWl4IFtNSVhdIg0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5ub2IsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFNQRUVEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAzNSB9LA0KICAgICAgICAgICAgICBERVBUSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogODAgfSwNCiAgICAgICAgICAgICAgTUlYOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICAiLS0tIiwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzZXRGdXp6IiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAic2V0IGZ1enogb2Ygc291bmQgW05BTUVdIHRvIGxvdyBbTE9XXSBtZWQtbG93IFtNRUQxXSBtZWQtaGlnaCBbTUVEMl0gaGlnaCBbSElHSF0gbWl4IFtNSVhdIg0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5ub2IsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIExPVzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNjAgfSwNCiAgICAgICAgICAgICAgTUVEMTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogODAgfSwNCiAgICAgICAgICAgICAgTUVEMjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNTAgfSwNCiAgICAgICAgICAgICAgSElHSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNjAgfSwNCiAgICAgICAgICAgICAgTUlYOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1MCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldEJpdGNydXNoIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAic2V0IGJpdGNydXNoIG9mIHNvdW5kIFtOQU1FXSBiaXRzIFtCSVRTXSBmcmVxIFtGUkVRXSINCiAgICAgICAgICAgICksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMubm9iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBCSVRTOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA2NSB9LA0KICAgICAgICAgICAgICBGUkVROiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA2MDAwMCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldFBhc3MiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoDQogICAgICAgICAgICAgICJzZXQgW1RZUEVdIG9mIHNvdW5kIFtOQU1FXSB0byBmcmVxdWVuY3kgW0ZSRVFdIHBlYWsgW1BFQUtdIg0KICAgICAgICAgICAgKSwNCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogZXh0cmFJY29ucy5ub2IsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTkFNRTogew0KICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJNeVNvdW5kIiksDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAidHlwZVBhc3MiIH0sDQogICAgICAgICAgICAgIEZSRVE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDQwMCB9LA0KICAgICAgICAgICAgICBQRUFLOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldEZsYW5nZXIiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoDQogICAgICAgICAgICAgICJzZXQgZmxhbmdlciBvZiBzb3VuZCBbTkFNRV0gdG8gdGltZSBbVElNRV0gc3BlZWQgW1NQRUVEXSBkZXB0aCBbREVQVEhdIGZlZWQgW0ZFRURdIG1peCBbTUlYXSINCiAgICAgICAgICAgICksDQogICAgICAgICAgICBibG9ja0ljb25VUkk6IGV4dHJhSWNvbnMubm9iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE5BTUU6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBTY3JhdGNoLnRyYW5zbGF0ZSgiTXlTb3VuZCIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBUSU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA0NSB9LA0KICAgICAgICAgICAgICBTUEVFRDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMjAgfSwNCiAgICAgICAgICAgICAgREVQVEg6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEwIH0sDQogICAgICAgICAgICAgIEZFRUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEwIH0sDQogICAgICAgICAgICAgIE1JWDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNTAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzZXRDb21wcmVzcyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgNCiAgICAgICAgICAgICAgInNldCBjb21wcmVzc29yIG9mIHNvdW5kIFtOQU1FXSB0byB0aHJlc2hvbGQgW1RIUkVTSF0ga25lZSBbS05FRV0gYXR0YWNrIFtBVFRBQ0tdIHJlbGVhc2UgW1JFTEVBU0VdIHJhdGlvIFtSQVRJT10iDQogICAgICAgICAgICApLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLm5vYiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgVEhSRVNIOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxNSB9LA0KICAgICAgICAgICAgICBLTkVFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1MCB9LA0KICAgICAgICAgICAgICBBVFRBQ0s6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDUwIH0sDQogICAgICAgICAgICAgIFJFTEVBU0U6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDUwIH0sDQogICAgICAgICAgICAgIFJBVElPOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1MCB9LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldEVxdWFsaXplIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAic2V0IGVxdWFsaXplciBvZiBzb3VuZCBbTkFNRV0gdG8gZ2FpbiBsb3cgW0xPV10gbWlkIFtNSURdIGhpZ2ggW0hJR0hdIGN1dG9mZiBsb3cgW0NVVF9MT1ddIGN1dG9mZiBoaWdoIFtDVVRfSElHSF0iDQogICAgICAgICAgICApLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLm5vYiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBOQU1FOiB7DQogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogU2NyYXRjaC50cmFuc2xhdGUoIk15U291bmQiKSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgTE9XOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwNCiAgICAgICAgICAgICAgTUlEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwNCiAgICAgICAgICAgICAgSElHSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMTAwIH0sDQogICAgICAgICAgICAgIENVVF9MT1c6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IC01MCB9LA0KICAgICAgICAgICAgICBDVVRfSElHSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNTAgfSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwNCiAgICAgICAgICAvKiBEZXByZWNhdGlvbiBNYXJrZXIgKi8NCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzYXZlMlByb2plY3QiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiW1NBVkVdIGFsbCBzb3VuZHMgdG8gcHJvamVjdCIpLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLnNldCwgaGlkZUZyb21QYWxldHRlOiB0cnVlLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7IFNBVkU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAic2F2ZU1lbnUiIH0gfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImNvbnZlcnRTb3VuZCIsIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJjb252ZXJ0IHNvdW5kIFtOQU1FMV0gZnJvbSBVUkwgdG8gVVJJIGFuZCBzYXZlIHRvIFtOQU1FMl0iLA0KICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBleHRyYUljb25zLnNldCwgaGlkZUZyb21QYWxldHRlOiB0cnVlLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7IE5BTUUxOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORyB9LCBOQU1FMjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfSB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAic2V0VGhpbmciLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwNCiAgICAgICAgICAgIHRleHQ6ICJzZXQgW1RZUEVdIG9mIHNvdW5kIFtOQU1FXSB0byBbVkFMVUVdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogeyBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiTXlTb3VuZCIgfSwgVFlQRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJzaW5nbGVFZmZlY3RzIiB9LCBWQUxVRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIgfSB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgLyogTWFya2VyIEVuZCAqLw0KICAgICAgICBdLA0KICAgICAgICBtZW51czogew0KICAgICAgICAgIC8qIERlcHJlY2F0aW9uIE1hcmtlciAqLw0KICAgICAgICAgIHNpbmdsZUVmZmVjdHM6IHNpbXBsZUVmZmVjdHMsDQogICAgICAgICAgLyogTWFya2VyIEVuZCAqLw0KICAgICAgICAgIHNhdmVNZW51OiBbDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzYXZlIiksIHZhbHVlOiAic2F2ZSIgfSwNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImRvbnQgc2F2ZSIpLCB2YWx1ZTogImRvbnQgc2F2ZSIgfSwNCiAgICAgICAgICBdLA0KICAgICAgICAgIHVuX3BhdXNlTWVudTogWw0KICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgicGF1c2UiKSwgdmFsdWU6ICJwYXVzZSIgfSwNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInVucGF1c2UiKSwgdmFsdWU6ICJ1bnBhdXNlIiB9LA0KICAgICAgICAgIF0sDQogICAgICAgICAgcGxheU1lbnU6IFsNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInN0YXJ0IiksIHZhbHVlOiAic3RhcnQiIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzdG9wIiksIHZhbHVlOiAic3RvcCIgfSwNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInBhdXNlIiksIHZhbHVlOiAicGF1c2UiIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ1bnBhdXNlIiksIHZhbHVlOiAidW5wYXVzZSIgfSwNCiAgICAgICAgICBdLA0KICAgICAgICAgIGhhdFBsYXllcjogWw0KICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgic3RhcnRzIiksIHZhbHVlOiAic3RhcnRzIiB9LA0KICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgic3RvcHMiKSwgdmFsdWU6ICJzdG9wcyIgfSwNCiAgICAgICAgICBdLA0KICAgICAgICAgIHRvZ2dsZU1lbnU6IFsNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoIm9uIiksIHZhbHVlOiAib24iIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJvZmYiKSwgdmFsdWU6ICJvZmYiIH0sDQogICAgICAgICAgXSwNCiAgICAgICAgICBiaW5kTWVudTogWw0KICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiYmluZCIpLCB2YWx1ZTogImJpbmQiIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ1bkJpbmQiKSwgdmFsdWU6ICJ1bkJpbmQiIH0sDQogICAgICAgICAgXSwNCiAgICAgICAgICBsb3VkUHJvcHM6IFsNCiAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImxvdWRuZXNzIiksIHZhbHVlOiAibG91ZG5lc3MiIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJyYXcgbm9pc2UiKSwgdmFsdWU6ICJyYXcgbm9pc2UiIH0sDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ0b25lIiksIHZhbHVlOiAidG9uZSIgfSwNCiAgICAgICAgICBdLA0KICAgICAgICAgIHR5cGVQYXNzOiBbDQogICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJoaWdocGFzcyIpLCB2YWx1ZTogImhpZ2hwYXNzIiB9LA0KICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgibG93cGFzcyIpLCB2YWx1ZTogImxvd3Bhc3MiIH0sDQogICAgICAgICAgXSwNCiAgICAgICAgICBzaW5nbGVFZmZlY3ROZXc6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogc2ltcGxlRWZmZWN0cyB9LA0KICAgICAgICAgIHNvdW5kUHJvcHM6IHsNCiAgICAgICAgICAgIGFjY2VwdFJlcG9ydGVyczogdHJ1ZSwNCiAgICAgICAgICAgIGl0ZW1zOiBbDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImxlbmd0aCIpLCB2YWx1ZTogImxlbmd0aCIgfSwNCiAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJjdXJyZW50IHRpbWUiKSwNCiAgICAgICAgICAgICAgICB2YWx1ZTogImN1cnJlbnQgdGltZSIsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInNvdXJjZSIpLCB2YWx1ZTogInNvdXJjZSIgfSwNCiAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJlc3RpbWF0ZWQgYnBtIiksDQogICAgICAgICAgICAgICAgdmFsdWU6ICJlc3RpbWF0ZWQgYnBtIiwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiY2hhbm5lbHMiKSwgdmFsdWU6ICJjaGFubmVscyIgfSwNCiAgICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiZmZ0IGRhdGEiKSwgdmFsdWU6ICJmZnQiIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImJpbmRzIiksIHZhbHVlOiAiYmluZHMiIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInZvbHVtZSIpLCB2YWx1ZTogInZvbHVtZSIgfSwNCiAgICAgICAgICAgIF0uY29uY2F0KHNpbXBsZUVmZmVjdHMsIGNvbXBsZXhFZmZlY3RzKSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNvdW5kQm9vbHM6IHsNCiAgICAgICAgICAgIGFjY2VwdFJlcG9ydGVyczogdHJ1ZSwNCiAgICAgICAgICAgIGl0ZW1zOiBbDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImV4aXN0cyIpLCB2YWx1ZTogImV4aXN0cyIgfSwNCiAgICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgicGxheWluZyIpLCB2YWx1ZTogInBsYXlpbmciIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInBhdXNlZCIpLCB2YWx1ZTogInBhdXNlZCIgfSwNCiAgICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgibG9vcGVkIiksIHZhbHVlOiAibG9vcGVkIiB9LA0KICAgICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJvdmVybGFwZWQiKSwgdmFsdWU6ICJvdmVybGFwZWQiIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInJldmVyc2VkIiksIHZhbHVlOiAicmV2ZXJzZWQiIH0sDQogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImJpbmRlZCIpLCB2YWx1ZTogImJpbmRlZCIgfSwNCiAgICAgICAgICAgIF0sDQogICAgICAgICAgfSwNCiAgICAgICAgICBlZmZlY3RNZW51OiB7DQogICAgICAgICAgICBhY2NlcHRSZXBvcnRlcnM6IHRydWUsDQogICAgICAgICAgICBpdGVtczogWw0KICAgICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJhbGwgZWZmZWN0cyIpLCB2YWx1ZTogImFsbCBlZmZlY3RzIiB9LA0KICAgICAgICAgICAgXS5jb25jYXQoc2ltcGxlRWZmZWN0cywgY29tcGxleEVmZmVjdHMpLA0KICAgICAgICAgIH0sDQogICAgICAgIH0sDQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8vIEhlbHBlciBGdW5jcw0KICAgIHN0YXJ0SGF0cyhkYXRhKSB7DQogICAgICBsZXQgbmV3VGhyZWFkcyA9IFtdOw0KICAgICAgcnVudGltZS5hbGxTY3JpcHRzQnlPcGNvZGVEbygNCiAgICAgICAgIlNQdHVuZVNoYXJrM193aGVuU291bmQiLA0KICAgICAgICAoc2NyaXB0LCB0YXJnZXQpID0+IHsNCiAgICAgICAgICBjb25zdCB0aHJlYWQgPSBydW50aW1lLl9wdXNoVGhyZWFkKHNjcmlwdC5ibG9ja0lkLCB0YXJnZXQpOw0KICAgICAgICAgIHRocmVhZFt0czNEYXRhXSA9IGRhdGE7DQogICAgICAgICAgbmV3VGhyZWFkcy5wdXNoKHRocmVhZCk7DQogICAgICAgIH0NCiAgICAgICk7DQogICAgICByZXR1cm4gbmV3VGhyZWFkczsNCiAgICB9DQoNCiAgICBnZW5lcmF0ZURhdGEobmFtZSwgc3JjLCBjb250ZXh0LCBpc1ZhbmlsbGEpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIG5hbWUsDQogICAgICAgIHNyYywNCiAgICAgICAgY29udGV4dCwNCiAgICAgICAgaXNWYW5pbGxhLA0KICAgICAgICBlZmZlY3RzOiB7fSwNCiAgICAgICAgbG9hZGVkOiB0cnVlLA0KICAgICAgICByZXZlcnNlZDogZmFsc2UsDQogICAgICAgIGN1cnJlbnRUaW1lOiAwLA0KICAgICAgICB2b2w6IDEwMCwNCiAgICAgICAgZ2FpbjogMSwNCiAgICAgICAgcGl0Y2g6IDEsDQogICAgICAgIGRldHVuZTogMCwNCiAgICAgICAgc3BlZWQ6IDEsDQogICAgICAgIHJhdGU6IDEsDQogICAgICAgIGxvb3BQYXJtOiBbMCwgMF0sDQogICAgICAgIG92ZXJsYXA6IGZhbHNlLA0KICAgICAgICBvdmVybGF5czogW10sDQogICAgICAgIGlzQmluZDogZmFsc2UsDQogICAgICAgIGJpbmRzOiB7fSwNCiAgICAgICAgX2NhY2hlOiB7IGxvdWRuZXNzOiB7fSwgdG9uZToge30gfSwNCiAgICAgIH07DQogICAgfQ0KDQogICAgZ2V0QlBNKGRhdGEsIHNhbXBsZVJhdGUpIHsNCiAgICAgIGNvbnN0IHBlYWtzID0gW107DQogICAgICBsZXQgbGFzdFBlYWtJbmRleCA9IDAsDQogICAgICAgIG1heCA9IDAuMTsNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAoZGF0YVtpXSA+IG1heCkgbWF4ID0gZGF0YVtpXTsNCiAgICAgIH0NCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAoZGF0YVtpXSA+IG1heCAtIDAuMSAmJiBpIC0gbGFzdFBlYWtJbmRleCA+IHNhbXBsZVJhdGUgLyA0KSB7DQogICAgICAgICAgcGVha3MucHVzaChpKTsNCiAgICAgICAgICBsYXN0UGVha0luZGV4ID0gaTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgY29uc3QgaW50ZXJ2YWxzID0gW107DQogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBlYWtzLmxlbmd0aDsgaSsrKQ0KICAgICAgICBpbnRlcnZhbHMucHVzaChwZWFrc1tpXSAtIHBlYWtzW2kgLSAxXSk7DQogICAgICBjb25zdCBhdmdJbnRlcnZhbCA9DQogICAgICAgIGludGVydmFscy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIGludGVydmFscy5sZW5ndGg7DQogICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoKHNhbXBsZVJhdGUgLyBhdmdJbnRlcnZhbCkgKiA2MCk7DQogICAgICByZXR1cm4gaXNOYU4odmFsdWUpID8gMCA6IHZhbHVlOw0KICAgIH0NCg0KICAgIGZpeEF1ZGlvTm9kZXMoc3JjLCBzb3VuZCkgew0KICAgICAgc3JjLnBsYXliYWNrUmF0ZS52YWx1ZSA9IHNvdW5kLnBpdGNoOw0KICAgICAgc3JjLmRldHVuZS52YWx1ZSA9IHNvdW5kLmRldHVuZTsNCiAgICAgIHNyYy5nYWluU3VjY2Vzc29yLmdhaW4udmFsdWUgPSBzb3VuZC5nYWluOw0KICAgICAgaWYgKHNyYy5sb29wKQ0KICAgICAgICB0aGlzLmxvb3BQYXJhbXMoew0KICAgICAgICAgIE5BTUU6IHNvdW5kLm5hbWUsDQogICAgICAgICAgU1RBUlQ6IHNvdW5kLmxvb3BQYXJtWzBdLA0KICAgICAgICAgIEVORDogc291bmQubG9vcFBhcm1bMV0sDQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIHVwZGF0ZUVmZmVjdChlZmZlY3QsIHNvdW5kLCBuYW1lLCBhcmdzKSB7DQogICAgICBkZWxldGUgYXJncy5OQU1FOw0KICAgICAgZGVsZXRlIGFyZ3MuVFlQRTsNCiAgICAgIGVmZmVjdC5hcmd1bWVudHMgPSBhcmdzOyAvLyBNYXRjaCBPcmlnaW5hbCBWYWx1ZXMsIG5vdCBDb252ZXJ0ZWQNCiAgICAgIGlmIChzb3VuZC5lZmZlY3RzW25hbWVdID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgZWZmZWN0LmlkID0gbmFtZTsNCiAgICAgICAgc291bmQuY29udGV4dC5hZGRFZmZlY3QoZWZmZWN0KTsNCiAgICAgICAgc291bmQuZWZmZWN0c1tuYW1lXSA9IGVmZmVjdDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIERvbnQgUmVtb3ZlIHRoZSBFZmZlY3QgKENhdXNlcyBHbGl0Y2hlcyBpbiBGb3JldmVyIExvb3BzKSwgc2ltcGx5IGNoYW5nZSBlYWNoIHZhbHVlDQogICAgICAgIC8vIFdlIHVzZSBhcmdzIGp1c3QgaW4gY2FzZSBzb21lIEVmZmVjdHMgZG9udCBzdG9yZSB0aGVtIGluIHRoZSBhdWRpbyBjb250ZXh0DQogICAgICAgIGNvbnN0IG9wdGlvbnMgPSBlZmZlY3Qub3B0aW9uczsNCiAgICAgICAgY29uc3QgdGhpc0VmZmVjdCA9IHNvdW5kLmNvbnRleHQuZWZmZWN0cy5maW5kKA0KICAgICAgICAgIChlZmZlY3QpID0+IGVmZmVjdC5pZCA9PT0gbmFtZQ0KICAgICAgICApOw0KICAgICAgICB0aGlzRWZmZWN0LmFyZ3VtZW50cyA9IGVmZmVjdC5hcmd1bWVudHM7DQogICAgICAgIHRoaXNFZmZlY3Qub3B0aW9ucyA9IG9wdGlvbnM7DQogICAgICAgIHN3aXRjaCAobmFtZSkgew0KICAgICAgICAgIGNhc2UgIlBBTiI6IHsNCiAgICAgICAgICAgIHRoaXNFZmZlY3QucGFubmVyTm9kZS5wYW4udmFsdWUgPSBvcHRpb25zLnBhbjsNCiAgICAgICAgICAgIHRoaXNFZmZlY3QucGFuID0gb3B0aW9ucy5wYW47DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNhc2UgIkRJU1RPUlRJT04iOiB7DQogICAgICAgICAgICB0aGlzRWZmZWN0LmdhaW4gPSBvcHRpb25zLmdhaW47DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNhc2UgIkJJVENSVVNIIjogew0KICAgICAgICAgICAgdGhpc0VmZmVjdC5mcmVxdWVuY3kgPSBNYXRoLm1heCgzMDAwMCwgQ2FzdC50b051bWJlcihhcmdzLkZSRVEpKTsNCiAgICAgICAgICAgIHRoaXNFZmZlY3QuYml0cyA9IE1hdGgubWF4KDEwLCBDYXN0LnRvTnVtYmVyKGFyZ3MuQklUUykpIC8gMTA7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNhc2UgIkxPV1BBU1MiOg0KICAgICAgICAgIGNhc2UgIkhJR0hQQVNTIjogew0KICAgICAgICAgICAgY29uc3QgZnJlcSA9IENhc3QudG9OdW1iZXIoYXJncy5GUkVRKTsNCiAgICAgICAgICAgIGNvbnN0IHBlYWsgPSBDYXN0LnRvTnVtYmVyKGFyZ3MuUEVBSykgLyA1Ow0KICAgICAgICAgICAgdGhpc0VmZmVjdC5maWx0ZXJOb2RlLmZyZXF1ZW5jeS52YWx1ZSA9IGZyZXE7DQogICAgICAgICAgICB0aGlzRWZmZWN0LmlucHV0Tm9kZS5mcmVxdWVuY3kudmFsdWUgPSBmcmVxOw0KICAgICAgICAgICAgdGhpc0VmZmVjdC5mcmVxdWVuY3kgPSBmcmVxOw0KICAgICAgICAgICAgdGhpc0VmZmVjdC5maWx0ZXJOb2RlLlEudmFsdWUgPSBwZWFrOw0KICAgICAgICAgICAgdGhpc0VmZmVjdC5pbnB1dE5vZGUuUS52YWx1ZSA9IHBlYWs7DQogICAgICAgICAgICB0aGlzRWZmZWN0LnBlYWsgPSBwZWFrOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjYXNlICJDT01QUkVTU09SIjogew0KICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXNFZmZlY3QuY29tcHJlc3Nvck5vZGU7DQogICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSB7DQogICAgICAgICAgICAgIHRocmVzaG9sZDogTWF0aC5taW4oDQogICAgICAgICAgICAgICAgMCwNCiAgICAgICAgICAgICAgICBNYXRoLm1heCgtMTAwLCBDYXN0LnRvTnVtYmVyKGFyZ3MuVEhSRVNIKSAqIC0xKQ0KICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICByYXRpbzogQ2FzdC50b051bWJlcihhcmdzLlJBVElPKSAvIDUsDQogICAgICAgICAgICAgIGF0dGFjazogTWF0aC5taW4oDQogICAgICAgICAgICAgICAgMCwNCiAgICAgICAgICAgICAgICBNYXRoLm1heCgxLCBDYXN0LnRvTnVtYmVyKGFyZ3MuQVRUQUNLKSAvIDEwMCkNCiAgICAgICAgICAgICAgKSwNCiAgICAgICAgICAgICAgcmVsZWFzZTogTWF0aC5taW4oDQogICAgICAgICAgICAgICAgMCwNCiAgICAgICAgICAgICAgICBNYXRoLm1heCgxLCBDYXN0LnRvTnVtYmVyKGFyZ3MuUkVMRUFTRSkgLyAxMDApDQogICAgICAgICAgICAgICksDQogICAgICAgICAgICAgIGtuZWU6IENhc3QudG9OdW1iZXIoYXJncy5LTkVFKSAvIDIuNSwNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBPYmplY3Qua2V5cyh2YWx1ZXMpLmZvckVhY2goKGtleSkgPT4gew0KICAgICAgICAgICAgICBub2RlW2tleV0udmFsdWUgPSB2YWx1ZXNba2V5XTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBPYmplY3Qua2V5cyhvcHRpb25zKS5mb3JFYWNoKChrZXkpID0+IHsNCiAgICAgICAgICB0aGlzRWZmZWN0W2tleV0gPSBvcHRpb25zW2tleV07DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHBsYXkoc291bmQsIGF0VGltZSwgY29uKSB7DQogICAgICB0cnkgew0KICAgICAgICBpZiAoc291bmQucGxheWluZyAmJiBjb24ub3ZlcmxhcCkgew0KICAgICAgICAgIGNvbnN0IGNsb25lID0gc291bmQuY2xvbmUoKTsgLy8gQ2xvbmUgY29udGV4dCB0byBNZW51IGZvciBDb250cm9sIFB1cnBvc2VzDQogICAgICAgICAgY29uc3QgbmV3TmFtZSA9IGAke2Nvbi5uYW1lfV9DT1BZXyR7TWF0aC5yYW5kb20oKX1gOw0KICAgICAgICAgIHNvdW5kQmFua1tuZXdOYW1lXSA9IHsNCiAgICAgICAgICAgIC4uLnNvdW5kLA0KICAgICAgICAgICAgY29udGV4dDogY2xvbmUsDQogICAgICAgICAgICBuYW1lOiBuZXdOYW1lLA0KICAgICAgICAgICAgbG9vcFBhcm06IFswLCAwXSwNCiAgICAgICAgICAgIG92ZXJsYXA6IGZhbHNlLA0KICAgICAgICAgICAgb3ZlcmxheXM6IFtdLA0KICAgICAgICAgICAgaXNCaW5kOiBmYWxzZSwNCiAgICAgICAgICAgIGJpbmRzOiB7fSwNCiAgICAgICAgICB9Ow0KICAgICAgICAgIGNsb25lLnBsYXkoMCwgYXRUaW1lKTsNCiAgICAgICAgICBjbG9uZS5zb3VyY2VOb2RlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IGNvbi5waXRjaDsNCiAgICAgICAgICBjbG9uZS5zb3VyY2VOb2RlLmdhaW5TdWNjZXNzb3IuZ2Fpbi52YWx1ZSA9IGNvbi5nYWluOw0KICAgICAgICAgIGNvbi5vdmVybGF5cy5wdXNoKGNsb25lKTsNCiAgICAgICAgICBjbG9uZS5vbigiZW5kIiwgKCkgPT4gew0KICAgICAgICAgICAgZGVsZXRlIHNvdW5kQmFua1tuZXdOYW1lXTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAoIXNvdW5kLnBsYXlpbmcpIGNvbi5jdXJyZW50VGltZSA9IGF0VGltZTsNCiAgICAgICAgICBzb3VuZC5wbGF5KDAsIGF0VGltZSk7DQogICAgICAgICAgY29uc3Qgc3JjTm9kZSA9IHNvdW5kLnNvdXJjZU5vZGU7DQogICAgICAgICAgdGhpcy5maXhBdWRpb05vZGVzKHNyY05vZGUsIGNvbik7DQogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNvbi5iaW5kcykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgT2JqZWN0LmtleXMoY29uLmJpbmRzKS5mb3JFYWNoKChrZXkpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdGhpc1NvdW5kID0gY29uLmJpbmRzW2tleV07DQogICAgICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzU291bmQuY29udGV4dDsNCiAgICAgICAgICAgICAgaWYgKCFjb250ZXh0LnBsYXlpbmcpIHRoaXNTb3VuZC5jdXJyZW50VGltZSA9IGF0VGltZTsNCiAgICAgICAgICAgICAgY29udGV4dC5wbGF5KDAsIGF0VGltZSk7DQogICAgICAgICAgICAgIHRoaXMuZml4QXVkaW9Ob2Rlcyhjb250ZXh0LnNvdXJjZU5vZGUsIHRoaXNTb3VuZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKHNvdW5kLmxvb3ApDQogICAgICAgICAgICB0aGlzLmxvb3BQYXJhbXMoew0KICAgICAgICAgICAgICBOQU1FOiBjb24ubmFtZSwNCiAgICAgICAgICAgICAgU1RBUlQ6IGNvbi5sb29wUGFybVswXSwNCiAgICAgICAgICAgICAgRU5EOiBjb24ubG9vcFBhcm1bMV0sDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnN0YXJ0SGF0cyh7IG5hbWU6IGNvbi5uYW1lLCB0eXBlOiAic3RhcnRzIiB9KTsNCiAgICAgIH0gY2F0Y2ggew0KICAgICAgICBjb25zb2xlLndhcm4oU2NyYXRjaC50cmFuc2xhdGUoIkF1ZGlvIGhhcyBub3QgbG9hZGVkIHlldCEiKSk7DQogICAgICAgIHNvdW5kLnN0b3AoKTsgLy8gUmVzZXQNCiAgICAgIH0NCiAgICB9DQoNCiAgICB0eXBlT3ZlcmxheShzb3VuZCwgdHlwZSkgew0KICAgICAgY29uc3QgY3R4ID0gc291bmQuY29udGV4dDsNCiAgICAgIGlmICh0eXBlID09PSAic3RvcCIpIHsNCiAgICAgICAgY29uc3QgbGFzdFRpbWUgPSBzb3VuZC5jdXJyZW50VGltZTsNCiAgICAgICAgY3R4LnN0b3AoKTsNCiAgICAgICAgc291bmQuY3VycmVudFRpbWUgPSBsYXN0VGltZTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VuZC5vdmVybGF5cy5sZW5ndGg7IGkrKykNCiAgICAgICAgICBzb3VuZC5vdmVybGF5c1tpXS5zdG9wKCk7DQogICAgICAgIHRoaXMuc3RhcnRIYXRzKHsgbmFtZTogc291bmQubmFtZSwgdHlwZTogInN0b3BzIiB9KTsNCiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gInBhdXNlIikgew0KICAgICAgICBjdHgucGF1c2UoKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VuZC5vdmVybGF5cy5sZW5ndGg7IGkrKykNCiAgICAgICAgICBzb3VuZC5vdmVybGF5c1tpXS5wYXVzZSgpOw0KICAgICAgICB0aGlzLnN0YXJ0SGF0cyh7IG5hbWU6IHNvdW5kLm5hbWUsIHR5cGU6ICJzdG9wcyIgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnN0YXJ0SGF0cyh7IG5hbWU6IHNvdW5kLm5hbWUsIHR5cGU6ICJzdGFydHMiIH0pOw0KICAgICAgICBpZiAoIWN0eC5wYXVzZWQpIHJldHVybjsNCiAgICAgICAgY29uc3QgbGFzdFRpbWUgPSBzb3VuZC5jdXJyZW50VGltZTsNCiAgICAgICAgY3R4LnN0b3AoKTsNCiAgICAgICAgc291bmQuY3VycmVudFRpbWUgPSBsYXN0VGltZTsNCiAgICAgICAgY3R4LnBsYXkoMCwgbGFzdFRpbWUpOw0KICAgICAgICB0aGlzLmZpeEF1ZGlvTm9kZXMoY3R4LnNvdXJjZU5vZGUsIHNvdW5kKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBhdHRhY2hBbmFseXNlcihiYW5rLCBlbmdpbmUpIHsNCiAgICAgIGJhbmsuYW5hbHlzZXIgPSBQaXp6aWNhdG8uY29udGV4dC5jcmVhdGVBbmFseXNlcigpOw0KICAgICAgYmFuay5hbmFseXNlci5mZnRTaXplID0gMjA0ODsNCiAgICAgIGJhbmsuYW5hbHlzZXIuc21vb3RoaW5nVGltZUNvbnN0YW50ID0gMC44Ow0KICAgICAgYmFuay53YXZlZm9ybUFuYWx5c2VyID0gUGl6emljYXRvLmNvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTsNCiAgICAgIGJhbmsud2F2ZWZvcm1BbmFseXNlci5mZnRTaXplID0gMjA0ODsNCg0KICAgICAgZW5naW5lLmNvbm5lY3QoYmFuay5hbmFseXNlcik7DQogICAgICBlbmdpbmUuY29ubmVjdChiYW5rLndhdmVmb3JtQW5hbHlzZXIpOw0KICAgIH0NCg0KICAgIHRyYWNrRW5kRm4oYmFuaywgZW5naW5lKSB7DQogICAgICBiYW5rLmN1cnJlbnRUaW1lID0gZW5naW5lLmxvb3AgJiYgYmFuay5sb29wUGFybVsxXQ0KICAgICAgICA/IGJhbmsubG9vcFBhcm1bMV0gOiBlbmdpbmUuc291cmNlTm9kZS5idWZmZXIuZHVyYXRpb247DQogICAgfQ0KDQogICAgaW1wb3J0VVJMKGFyZ3MsIHV0aWwpIHsNCiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgdGhpcy5kZWxldGVTb3VuZChhcmdzKTsNCiAgICBpZiAoIWFyZ3MuVVJMKSByZXR1cm4gcmVzb2x2ZSgpOw0KICAgIA0KICAgIGNvbnN0IGVuZ2luZSA9IG5ldyBQaXp6aWNhdG8uU291bmQoDQogICAgICB7DQogICAgICAgIHNvdXJjZTogImZpbGUiLA0KICAgICAgICBvcHRpb25zOiB7IHBhdGg6IGFyZ3MuVVJMLCBhdHRhY2s6IDAgfSwNCiAgICAgIH0sDQogICAgICAoKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgZW5naW5lLnNvdXJjZU5vZGUgPSBlbmdpbmUuZ2V0U291cmNlTm9kZSgpOw0KICAgICAgICAgIGNvbnN0IGJhbmsgPSAoc291bmRCYW5rW2FyZ3MuTkFNRV0gPSB0aGlzLmdlbmVyYXRlRGF0YSgNCiAgICAgICAgICAgIGFyZ3MuTkFNRSwNCiAgICAgICAgICAgIGFyZ3MuVVJMLA0KICAgICAgICAgICAgZW5naW5lLA0KICAgICAgICAgICAgZmFsc2UNCiAgICAgICAgICApKTsNCg0KICAgICAgICAgIHRoaXMuYXR0YWNoQW5hbHlzZXIoYmFuaywgZW5naW5lKTsNCiAgICAgICAgICBlbmdpbmUub24oInN0b3AiLCAoKSA9PiB0aGlzLnRyYWNrRW5kRm4oYmFuaywgZW5naW5lKSk7DQogICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgY29uc29sZS5lcnJvcigiU291bmQgbG9hZCBlcnJvcjoiLCBlKTsNCiAgICAgICAgICBhbGVydCgNCiAgICAgICAgICAgIFNjcmF0Y2gudHJhbnNsYXRlKA0KICAgICAgICAgICAgICAiVHVuZSBTaGFyayBWMyBjYW4ndCBpbXBvcnQgdGhpcyBzb3VuZCwgZmlsZSBtYXkgYmUgY29ycnVwdGVkIG9yIG5vbi1leGlzdGVudC4iDQogICAgICAgICAgICApDQogICAgICAgICAgKTsNCiAgICAgICAgICByZXNvbHZlKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICApOw0KICB9KTsNCn0NCg0KICAgIGltcG9ydE1lbnUoYXJncywgdXRpbCkgew0KICAgICAgY29uc3QgbmFtZSA9IENhc3QudG9TdHJpbmcoYXJncy5TT1VORCk7DQogICAgICBjb25zdCB0YXJnZXQgPSB1dGlsLnRhcmdldC5zcHJpdGU7DQogICAgICBjb25zdCBzb3VuZCA9IHRhcmdldC5zb3VuZHMuZmluZCgoaSkgPT4gew0KICAgICAgICByZXR1cm4gaS5uYW1lID09PSBuYW1lOw0KICAgICAgfSk7DQogICAgICBpZiAoc291bmQpIHsNCiAgICAgICAgdGhpcy5kZWxldGVTb3VuZChhcmdzKTsNCiAgICAgICAgY29uc3Qgc291cmNlVVJMID0gYC8ke3RhcmdldC5uYW1lLnJlcGxhY2VBbGwoIi8iLCAiIil9LyR7c291bmQubmFtZS5yZXBsYWNlQWxsKCIvIiwgIiIpfS4ke3NvdW5kLmRhdGFGb3JtYXR9YDsNCiAgICAgICAgY29uc3QgYnVmZmVyID0gdGFyZ2V0LnNvdW5kQmFuay5zb3VuZFBsYXllcnNbc291bmQuc291bmRJZF0uYnVmZmVyOw0KICAgICAgICBjb25zdCBlbmdpbmUgPSBuZXcgUGl6emljYXRvLlNvdW5kKHsNCiAgICAgICAgICBzb3VyY2U6ICJidWZmZXIiLA0KICAgICAgICAgIG9wdGlvbnM6IHsgYnVmZmVyLCBhdHRhY2s6IDAgfSwNCiAgICAgICAgfSk7DQogICAgICAgIC8vIHRoaXMgcGFydCBvZiB0aGUgTGlicmFyeSB3YXMgbW9kaWZpZWQgdG8gd29yayBsaWtlIHRoaXMNCiAgICAgICAgZW5naW5lLnNvdXJjZU5vZGUgPSBlbmdpbmUuZ2V0U291cmNlTm9kZSgpOw0KICAgICAgICBjb25zdCBiYW5rID0gdGhpcy5nZW5lcmF0ZURhdGEoYXJncy5OQU1FLCBzb3VyY2VVUkwsIGVuZ2luZSwgdHJ1ZSk7DQogICAgICAgIHNvdW5kQmFua1thcmdzLk5BTUVdID0gYmFuazsNCiAgICAgICAgdGhpcy5hdHRhY2hBbmFseXNlcihiYW5rLCBlbmdpbmUpOw0KICAgICAgICBlbmdpbmUub24oInN0b3AiLCAoKSA9PiB0aGlzLnRyYWNrRW5kRm4oYmFuaywgZW5naW5lKSk7DQogICAgICB9DQogICAgfQ0KDQogICAgYmluZFNvdW5kKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kMSA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgY29uc3Qgc291bmQyID0gc291bmRCYW5rW2FyZ3MuTkFNRTJdOw0KICAgICAgaWYgKHNvdW5kMSA9PT0gdW5kZWZpbmVkIHx8IHNvdW5kMiA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBjb25zdCBzaG91bGRCaW5kID0gYXJncy5UWVBFID09PSAiYmluZCI7DQogICAgICBzb3VuZDEuaXNCaW5kID0gc2hvdWxkQmluZDsNCiAgICAgIHNvdW5kMi5pc0JpbmQgPSBzaG91bGRCaW5kOw0KICAgICAgaWYgKHNob3VsZEJpbmQpIHsNCiAgICAgICAgaWYgKHNvdW5kMS5iaW5kc1tzb3VuZDIubmFtZV0pDQogICAgICAgICAgdGhpcy50eXBlT3ZlcmxheShzb3VuZDEuYmluZHNbc291bmQyLm5hbWVdLCAic3RvcCIpOw0KICAgICAgICBpZiAoc291bmQyLmJpbmRzW3NvdW5kMS5uYW1lXSkNCiAgICAgICAgICB0aGlzLnR5cGVPdmVybGF5KHNvdW5kMi5iaW5kc1tzb3VuZDEubmFtZV0sICJzdG9wIik7DQogICAgICAgIHNvdW5kMS5iaW5kc1tzb3VuZDIubmFtZV0gPSBzb3VuZDI7DQogICAgICAgIHNvdW5kMi5iaW5kc1tzb3VuZDEubmFtZV0gPSBzb3VuZDE7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkZWxldGUgc291bmQxLmJpbmRzW3NvdW5kMi5uYW1lXTsNCiAgICAgICAgZGVsZXRlIHNvdW5kMi5iaW5kc1tzb3VuZDEubmFtZV07DQogICAgICB9DQogICAgfQ0KDQogICAgc3RhcnRTb3VuZChhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kICE9PSB1bmRlZmluZWQpIHRoaXMucGxheShzb3VuZC5jb250ZXh0LCAwLCBzb3VuZCk7DQogICAgfQ0KDQogICAgc3RhcnRTb3VuZEF0KGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBjb25zdCB0aW1lID0gQ2FzdC50b051bWJlcihhcmdzLlRJTUUpOw0KICAgICAgaWYgKHNvdW5kICE9PSB1bmRlZmluZWQpIHRoaXMucGxheShzb3VuZC5jb250ZXh0LCB0aW1lLCBzb3VuZCk7DQogICAgfQ0KDQogICAgcGxheUFuZFN0b3AoYXJncywgdXRpbCkgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmF3YWl0aW5nU291bmQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICB1dGlsLnN0YWNrRnJhbWUuYXdhaXRpbmdTb3VuZCA9IHRydWU7DQogICAgICAgIHRoaXMucGxheShzb3VuZC5jb250ZXh0LCBDYXN0LnRvTnVtYmVyKGFyZ3MuVElNRSksIHNvdW5kKTsNCiAgICAgICAgdXRpbC55aWVsZCgpOw0KICAgICAgfSBlbHNlIGlmICh1dGlsLnN0YWNrRnJhbWUuYXdhaXRpbmdTb3VuZCkgew0KICAgICAgICBpZiAoc291bmQuY3VycmVudFRpbWUgPj0gQ2FzdC50b051bWJlcihhcmdzLk1BWCkpDQogICAgICAgICAgdGhpcy50eXBlT3ZlcmxheShzb3VuZCwgInN0b3AiKTsNCiAgICAgICAgZWxzZSB1dGlsLnlpZWxkKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgc3RvcFNvdW5kKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgIT09IHVuZGVmaW5lZCkgdGhpcy50eXBlT3ZlcmxheShzb3VuZCwgInN0b3AiKTsNCiAgICB9DQoNCiAgICBwYXVzZVNvdW5kKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgaWYgKGFyZ3MuVU5fUEFVU0UgPT09ICJwYXVzZSIpIHRoaXMudHlwZU92ZXJsYXkoc291bmQsICJwYXVzZSIpOw0KICAgICAgZWxzZSB0aGlzLnR5cGVPdmVybGF5KHNvdW5kLCAidW5wYXVzZSIpOw0KICAgIH0NCg0KICAgIGN0cmxTb3VuZHMoYXJncykgew0KICAgICAgY29uc3QgYWxsU291bmRzID0gT2JqZWN0LnZhbHVlcyhzb3VuZEJhbmspOw0KICAgICAgaWYgKGFyZ3MuQ09OVFJPTCA9PT0gInN0YXJ0IikNCiAgICAgICAgYWxsU291bmRzLmZvckVhY2goKHNvdW5kKSA9PiB7DQogICAgICAgICAgdGhpcy5wbGF5KHNvdW5kLmNvbnRleHQsIDAsIHNvdW5kKTsNCiAgICAgICAgfSk7DQogICAgICBlbHNlIGlmIChhcmdzLkNPTlRST0wgPT09ICJzdG9wIikNCiAgICAgICAgYWxsU291bmRzLmZvckVhY2goKHNvdW5kKSA9PiB7DQogICAgICAgICAgc291bmQuY29udGV4dC5zdG9wKCk7DQogICAgICAgIH0pOw0KICAgICAgZWxzZSBpZiAoYXJncy5DT05UUk9MID09PSAicGF1c2UiKQ0KICAgICAgICBhbGxTb3VuZHMuZm9yRWFjaCgoc291bmQpID0+IHsNCiAgICAgICAgICB0aGlzLnR5cGVPdmVybGF5KHNvdW5kLCAicGF1c2UiKTsNCiAgICAgICAgfSk7DQogICAgICBlbHNlDQogICAgICAgIGFsbFNvdW5kcy5mb3JFYWNoKChzb3VuZCkgPT4gew0KICAgICAgICAgIHRoaXMudHlwZU92ZXJsYXkoc291bmQsICJ1bnBhdXNlIik7DQogICAgICAgIH0pOw0KICAgIH0NCg0KICAgIGVuYWJsZUNvbnRyb2woYXJncykgew0KICAgICAgc2V0dGluZ3MuZmxhZ0N0cmwgPSBhcmdzLk9OX09GRiA9PT0gIm9uIjsNCiAgICB9DQoNCiAgICB0b2dnbGVPdmVybGFwKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgc291bmQub3ZlcmxhcCA9IGFyZ3MuVFlQRSA9PT0gIm9uIjsNCiAgICB9DQoNCiAgICB0b2dnbGVMb29wKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzb3VuZC5jb250ZXh0Lmxvb3A7DQogICAgICBzb3VuZC5jb250ZXh0Lmxvb3AgPSBhcmdzLlRZUEUgPT09ICJvbiI7DQogICAgICBpZiAoYXJncy5UWVBFID09PSAib2ZmIikgdGhpcy50eXBlT3ZlcmxheShzb3VuZCwgInN0b3AiKTsNCiAgICAgIGVsc2UgaWYgKCFvbGRWYWx1ZSAmJiBzb3VuZC5jb250ZXh0LnBsYXlpbmcpIHsNCiAgICAgICAgY29uc3QgbGFzdFRpbWUgPSBzb3VuZC5jdXJyZW50VGltZTsNCiAgICAgICAgc291bmQuY29udGV4dC5zdG9wKCk7DQogICAgICAgIHNvdW5kLmN1cnJlbnRUaW1lID0gbGFzdFRpbWU7DQogICAgICAgIHNvdW5kLmNvbnRleHQucGxheSgwLCBsYXN0VGltZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgdG9nZ2xlUmV2ZXJzZShhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIGlmIChzb3VuZC5yZXZlcnNlZCA9PT0gKGFyZ3MuVFlQRSA9PT0gIm9uIikpIHJldHVybjsNCiAgICAgIHNvdW5kLnJldmVyc2VkID0gYXJncy5UWVBFID09PSAib24iOw0KICAgICAgdGhpcy50eXBlT3ZlcmxheShzb3VuZCwgInN0b3AiKTsNCiAgICAgIHNvdW5kLl9jYWNoZSA9IHsgbG91ZG5lc3M6IHt9LCB0b25lOiB7fSB9Ow0KICAgICAgY29uc3Qgbm9kZSA9IHNvdW5kLmNvbnRleHQuc291cmNlTm9kZTsNCiAgICAgIGNvbnN0IHJldmVyc2VCdWZmZXIgPSAoYnVmZmVyKSA9PiB7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLm51bWJlck9mQ2hhbm5lbHM7IGkrKykNCiAgICAgICAgICBidWZmZXIuZ2V0Q2hhbm5lbERhdGEoaSkucmV2ZXJzZSgpOw0KICAgICAgICByZXR1cm4gYnVmZmVyOw0KICAgICAgfTsNCiAgICAgIGNvbnN0IGJ1ZmZlclNvdXJjZSA9IG5vZGUuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsNCiAgICAgIGJ1ZmZlclNvdXJjZS5idWZmZXIgPSByZXZlcnNlQnVmZmVyKG5vZGUuYnVmZmVyKTsNCiAgICAgIGJ1ZmZlclNvdXJjZS5jb25uZWN0KG5vZGUuY29udGV4dC5kZXN0aW5hdGlvbik7DQogICAgfQ0KDQogICAgbG9vcFBhcmFtcyhhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIHNvdW5kLmNvbnRleHQubG9vcCA9IHRydWU7DQogICAgICBjb25zdCBzcmNOb2RlID0gc291bmQuY29udGV4dC5zb3VyY2VOb2RlOw0KICAgICAgc3JjTm9kZS5sb29wU3RhcnQgPSBDYXN0LnRvTnVtYmVyKGFyZ3MuU1RBUlQpOw0KICAgICAgc3JjTm9kZS5sb29wRW5kID0gQ2FzdC50b051bWJlcihhcmdzLkVORCk7DQogICAgICBzb3VuZC5sb29wUGFybSA9IFtzcmNOb2RlLmxvb3BTdGFydCwgc3JjTm9kZS5sb29wRW5kXTsNCiAgICB9DQoNCiAgICBkZWxldGVTb3VuZChhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgdGhpcy5zdG9wU291bmQoYXJncyk7DQogICAgICBpZiAoc291bmQpIHsNCiAgICAgICAgc291bmQudm9sID0gMDsNCiAgICAgICAgc291bmQuY29udGV4dC52b2x1bWUgPSAwOw0KICAgICAgfQ0KICAgICAgZGVsZXRlIHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgIH0NCg0KICAgIGRlbGV0ZUFsbFNvdW5kcygpIHsNCiAgICAgIGZvciAobGV0IG5hbWUgaW4gc291bmRCYW5rKSB0aGlzLmRlbGV0ZVNvdW5kKHsgTkFNRTogbmFtZSB9KTsNCiAgICB9DQoNCiAgICBhbGxTb3VuZHMoKSB7DQogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXMoc291bmRCYW5rKSk7DQogICAgfQ0KDQogICAgYWxsUGxheVNvdW5kcygpIHsNCiAgICAgIGNvbnN0IHBsYXllcnMgPSBbXTsNCiAgICAgIE9iamVjdC5lbnRyaWVzKHNvdW5kQmFuaykuZm9yRWFjaCgoW2tleSwgaW5uZXJTcmNdKSA9PiB7DQogICAgICAgIGlmIChpbm5lclNyYy5jb250ZXh0LnBsYXlpbmcpIHBsYXllcnMucHVzaChrZXkpOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkocGxheWVycyk7DQogICAgfQ0KDQogICAgd2hlblNvdW5kKGFyZ3MsIHV0aWwpIHsNCiAgICAgIGNvbnN0IGRhdGEgPSB1dGlsLnRocmVhZFt0czNEYXRhXSA/PyB7fTsNCiAgICAgIHJldHVybiBhcmdzLkNPTlRST0wgPT09IGRhdGEudHlwZSAmJiBhcmdzLk5BTUUgPT09IGRhdGEubmFtZTsNCiAgICB9DQoNCiAgICBzb3VuZENoZWNrKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlOw0KICAgICAgc3dpdGNoIChhcmdzLkNPTlRST0wpIHsNCiAgICAgICAgY2FzZSAiZXhpc3RzIjoNCiAgICAgICAgICByZXR1cm4gc291bmQubG9hZGVkOw0KICAgICAgICBjYXNlICJwbGF5aW5nIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuY29udGV4dC5wbGF5aW5nOw0KICAgICAgICBjYXNlICJwYXVzZWQiOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5jb250ZXh0LnBhdXNlZDsNCiAgICAgICAgY2FzZSAibG9vcGVkIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuY29udGV4dC5sb29wOw0KICAgICAgICBjYXNlICJvdmVybGFwZWQiOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5vdmVybGFwOw0KICAgICAgICBjYXNlICJyZXZlcnNlZCI6DQogICAgICAgICAgcmV0dXJuIHNvdW5kLnJldmVyc2VkOw0KICAgICAgICBjYXNlICJiaW5kZWQiOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5pc0JpbmQ7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHNvdW5kUHJvcGVydHkoYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gMDsNCiAgICAgIGNvbnN0IHNyYyA9IHNvdW5kLmNvbnRleHQuc291cmNlTm9kZTsNCiAgICAgIGNvbnN0IHByb3AgPSBDYXN0LnRvU3RyaW5nKGFyZ3MuUFJPUCk7DQogICAgICBzd2l0Y2ggKHByb3ApIHsNCiAgICAgICAgY2FzZSAibGVuZ3RoIjoNCiAgICAgICAgICByZXR1cm4gc3JjLmJ1ZmZlci5kdXJhdGlvbjsNCiAgICAgICAgY2FzZSAiY3VycmVudCB0aW1lIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuY3VycmVudFRpbWU7DQogICAgICAgIGNhc2UgImVzdGltYXRlZCBicG0iOg0KICAgICAgICAgIHJldHVybiB0aGlzLmdldEJQTSgNCiAgICAgICAgICAgIHNyYy5idWZmZXIuZ2V0Q2hhbm5lbERhdGEoMCksDQogICAgICAgICAgICBzcmMuYnVmZmVyLnNhbXBsZVJhdGUNCiAgICAgICAgICApOw0KICAgICAgICBjYXNlICJjaGFubmVscyI6DQogICAgICAgICAgcmV0dXJuIHNyYy5idWZmZXIubnVtYmVyT2ZDaGFubmVsczsNCiAgICAgICAgY2FzZSAiZmZ0IjoNCiAgICAgICAgICBjb25zdCBkYXRhQXJyYXkgPSBuZXcgVWludDhBcnJheShzb3VuZC5hbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudCk7DQogICAgICAgICAgc291bmQuYW5hbHlzZXIuZ2V0Qnl0ZUZyZXF1ZW5jeURhdGEoZGF0YUFycmF5KTsNCiAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoQXJyYXkuZnJvbShkYXRhQXJyYXkpKTsNCiAgICAgICAgY2FzZSAic291cmNlIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuc3JjOw0KICAgICAgICBjYXNlICJiaW5kcyI6DQogICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KE9iamVjdC5rZXlzKHNvdW5kLmJpbmRzKSk7DQogICAgICAgIGNhc2UgInZvbHVtZSI6DQogICAgICAgICAgcmV0dXJuIHNvdW5kLnZvbDsNCiAgICAgICAgY2FzZSAicGl0Y2giOg0KICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKChzb3VuZC5waXRjaCAtIDEpICogMTAwKTsNCiAgICAgICAgY2FzZSAiZGV0dW5lIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuZGV0dW5lIC8gMTA7DQogICAgICAgIGNhc2UgInNwZWVkIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuc3BlZWQgKiAxMDA7DQogICAgICAgIGNhc2UgImdhaW4iOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5nYWluICogMTAwOw0KICAgICAgICBjYXNlICJwYW4iOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5lZmZlY3RzW3Byb3AudG9VcHBlckNhc2UoKV0/Lm9wdGlvbnMucGFuICogMTAwIHx8IDA7DQogICAgICAgIGNhc2UgImRpc3RvcnRpb24iOg0KICAgICAgICAgIHJldHVybiAoDQogICAgICAgICAgICBzb3VuZC5lZmZlY3RzW3Byb3AudG9VcHBlckNhc2UoKV0/Lm9wdGlvbnMuZ2FpbiAqIDEwMCB8fCAwDQogICAgICAgICAgKTsNCiAgICAgICAgY2FzZSAiYXR0YWNrIjoNCiAgICAgICAgICByZXR1cm4gc291bmQuY29udGV4dC5hdHRhY2sgKiAxMDA7DQogICAgICAgIGNhc2UgInJlbGVhc2UiOg0KICAgICAgICAgIHJldHVybiBzb3VuZC5jb250ZXh0LnJlbGVhc2UgKiAxMDA7DQogICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICBjb25zdCBlZmZlY3QgPSBzb3VuZC5lZmZlY3RzW3Byb3AudG9VcHBlckNhc2UoKV07DQogICAgICAgICAgaWYgKGVmZmVjdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gIiI7DQogICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGVmZmVjdC5hcmd1bWVudHMpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZ2V0TG91ZFRpbWUoYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gMDsNCiAgICAgIGNvbnN0IHRpbWUgPSBDYXN0LnRvTnVtYmVyKGFyZ3MuVElNRSk7DQogICAgICBjb25zdCBjaGFuID0gQ2FzdC50b051bWJlcihhcmdzLkNIQU5ORUwpIC0gMTsNCiAgICAgIGNvbnN0IGF1ZGlvQ3R4ID0gc291bmQuY29udGV4dC5zb3VyY2VOb2RlOw0KICAgICAgY29uc3QgYnVmZmVyID0gYXVkaW9DdHguYnVmZmVyOw0KICAgICAgY29uc3QgZHVyYXRpb24gPSBidWZmZXIuZHVyYXRpb247DQogICAgICBpZiAoDQogICAgICAgIHRpbWUgPCAwIHx8DQogICAgICAgIHRpbWUgPiBkdXJhdGlvbiB8fA0KICAgICAgICBjaGFuIDwgMCB8fA0KICAgICAgICBjaGFuID4gYnVmZmVyLm51bWJlck9mQ2hhbm5lbHMgLSAxDQogICAgICApDQogICAgICAgIHJldHVybiAwOw0KDQogICAgICBsZXQgdmFsdWUgPSAwOw0KICAgICAgaWYgKA0KICAgICAgICBhcmdzLlRZUEUgIT09ICJyYXcgbm9pc2UiICYmDQogICAgICAgIHNvdW5kLl9jYWNoZVthcmdzLlRZUEVdW2Ake3RpbWV9JHtjaGFufWBdICE9PSB1bmRlZmluZWQNCiAgICAgICkNCiAgICAgICAgdmFsdWUgPSBzb3VuZC5fY2FjaGVbYXJncy5UWVBFXVtgJHt0aW1lfSR7Y2hhbn1gXTsNCiAgICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBzYW1wbGVSYXRlID0gYnVmZmVyLnNhbXBsZVJhdGU7DQogICAgICAgIGNvbnN0IGNoYW5uZWxEYXRhID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKGNoYW4pOw0KICAgICAgICBjb25zdCBzYW1wbGVJbmRleCA9IE1hdGguZmxvb3Ioc2FtcGxlUmF0ZSAqIHRpbWUpOw0KICAgICAgICBjb25zdCB3aW5kb3dTaXplID0gc2FtcGxlUmF0ZSAqIDAuMTsNCiAgICAgICAgY29uc3Qgc3RhcnRTYW1wbGUgPSBNYXRoLm1heCgwLCBzYW1wbGVJbmRleCAtIHdpbmRvd1NpemUgLyAyKTsNCiAgICAgICAgY29uc3QgZW5kU2FtcGxlID0gTWF0aC5taW4oDQogICAgICAgICAgY2hhbm5lbERhdGEubGVuZ3RoLA0KICAgICAgICAgIHNhbXBsZUluZGV4ICsgd2luZG93U2l6ZSAvIDINCiAgICAgICAgKTsNCg0KICAgICAgICAvLyBubyBuZWVkIHRvIGNhY2hlIHJhdyBub2lzZSwgbm8gd29yayBpcyBkb25lDQogICAgICAgIGlmIChhcmdzLlRZUEUgPT09ICJyYXcgbm9pc2UiKSB2YWx1ZSA9IGNoYW5uZWxEYXRhW2VuZFNhbXBsZV07DQogICAgICAgIGVsc2UgaWYgKGFyZ3MuVFlQRSA9PT0gInRvbmUiKSB7DQogICAgICAgICAgY29uc3QgZGF0YSA9IGNoYW5uZWxEYXRhLnNsaWNlKHN0YXJ0U2FtcGxlLCBlbmRTYW1wbGUpOw0KICAgICAgICAgIGNvbnN0IHNpemUgPSBkYXRhLmxlbmd0aDsNCiAgICAgICAgICBjb25zdCB0YXVBcnJheSA9IG5ldyBBcnJheShzaXplKS5maWxsKDApOw0KICAgICAgICAgIGZvciAobGV0IHRhdSA9IDE7IHRhdSA8IHNpemU7IHRhdSsrKSB7DQogICAgICAgICAgICBsZXQgc3VtID0gMDsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZSAtIHRhdTsgaSsrKSB7DQogICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBkYXRhW2ldIC0gZGF0YVtpICsgdGF1XTsNCiAgICAgICAgICAgICAgc3VtICs9IGRpZmYgKiBkaWZmOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGF1QXJyYXlbdGF1XSA9IHN1bTsNCiAgICAgICAgICB9DQogICAgICAgICAgZm9yIChsZXQgdGF1ID0gMTsgdGF1IDwgc2l6ZTsgdGF1KyspIHsNCiAgICAgICAgICAgIHZhbHVlICs9IHRhdUFycmF5W3RhdV07DQogICAgICAgICAgICB0YXVBcnJheVt0YXVdICo9IHRhdSAvIHZhbHVlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBsZXQgYmVzdFRhdSA9IC0xOw0KICAgICAgICAgIGZvciAobGV0IHRhdSA9IDE7IHRhdSA8IHNpemU7IHRhdSsrKSB7DQogICAgICAgICAgICBpZiAodGF1QXJyYXlbdGF1XSA8IDAuMSkgew0KICAgICAgICAgICAgICBiZXN0VGF1ID0gdGF1Ow0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgdmFsdWUgPSBiZXN0VGF1ID4gMCA/IHNhbXBsZVJhdGUgLyBiZXN0VGF1IDogMDsNCiAgICAgICAgICBzb3VuZC5fY2FjaGVbInRvbmUiXVtgJHt0aW1lfSR7Y2hhbn1gXSA9IHZhbHVlOw0KICAgICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgICAgfSBlbHNlIGlmIChhcmdzLlRZUEUgPT09ICJsb3VkbmVzcyIpIHsNCiAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnRTYW1wbGU7IGkgPCBlbmRTYW1wbGU7IGkrKykNCiAgICAgICAgICAgIHZhbHVlICs9IGNoYW5uZWxEYXRhW2ldICogY2hhbm5lbERhdGFbaV07DQogICAgICAgICAgY29uc3Qgcm1zID0gTWF0aC5zcXJ0KHZhbHVlIC8gKGVuZFNhbXBsZSAtIHN0YXJ0U2FtcGxlKSk7DQogICAgICAgICAgY29uc3QgZEIgPSAyMCAqIE1hdGgubG9nMTAocm1zKTsNCiAgICAgICAgICB2YWx1ZSA9IE1hdGgubWluKE1hdGgubWF4KChkQiArIDUwKSAvIDUwLCAwKSwgMSkgKiAxMDA7DQogICAgICAgICAgc291bmQuX2NhY2hlWyJsb3VkbmVzcyJdW2Ake3RpbWV9JHtjaGFufWBdID0gdmFsdWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gaXNOYU4odmFsdWUpID8gMCA6IHZhbHVlICogc291bmQuZ2FpbjsNCiAgICB9DQoNCiAgICBzZXRWb2woYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBzb3VuZC52b2wgPSBNYXRoLm1heCgwLCBDYXN0LnRvTnVtYmVyKGFyZ3MuTlVNKSk7DQogICAgfQ0KDQogICAgcmVzZXRFZmZlY3QoYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBjb25zdCBjdHggPSBzb3VuZC5jb250ZXh0Ow0KICAgICAgY29uc3QgZWZmZWN0ID0gQ2FzdC50b1N0cmluZyhhcmdzLkVGRkVDVCk7DQogICAgICBjb25zdCBuYW1lID0gZWZmZWN0LnRvVXBwZXJDYXNlKCk7DQogICAgICBpZiAoZWZmZWN0ID09PSAicGl0Y2giKSBzb3VuZC5waXRjaCA9IDE7DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJkZXR1bmUiKSBzb3VuZC5kZXR1bmUgPSAwOw0KICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAic3BlZWQiKSBzb3VuZC5zcGVlZCA9IDE7DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJnYWluIikgc291bmQuZ2FpbiA9IDE7DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJhdHRhY2siKSBzb3VuZC5jb250ZXh0LmF0dGFjayA9IDA7DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJyZWxlYXNlIikgc291bmQuY29udGV4dC5yZWxlYXNlID0gMDsNCiAgICAgIGVsc2UgaWYgKGVmZmVjdCA9PT0gImFsbCBlZmZlY3RzIikgew0KICAgICAgICBzb3VuZC5waXRjaCA9IDE7DQogICAgICAgIHNvdW5kLmRldHVuZSA9IDA7DQogICAgICAgIHNvdW5kLnNwZWVkID0gMTsNCiAgICAgICAgc291bmQuZ2FpbiA9IDE7DQogICAgICAgIHNvdW5kLmNvbnRleHQuYXR0YWNrID0gMDsNCiAgICAgICAgc291bmQuY29udGV4dC5yZWxlYXNlID0gMDsNCiAgICAgICAgY29uc3QgZWZmZWN0cyA9IHNvdW5kLmVmZmVjdHM7DQogICAgICAgIE9iamVjdC52YWx1ZXMoZWZmZWN0cykuZm9yRWFjaCgoZSkgPT4gY3R4LnJlbW92ZUVmZmVjdChlKSk7DQogICAgICAgIHNvdW5kLmVmZmVjdHMgPSB7fTsNCiAgICAgIH0NCiAgICAgIGlmIChzb3VuZC5lZmZlY3RzW25hbWVdICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgY3R4LnJlbW92ZUVmZmVjdChzb3VuZC5lZmZlY3RzW25hbWVdKTsNCiAgICAgICAgZGVsZXRlIHNvdW5kLmVmZmVjdHNbbmFtZV07DQogICAgICB9DQogICAgICBzb3VuZC5yYXRlID0gc291bmQucGl0Y2ggKiBzb3VuZC5zcGVlZCAqIE1hdGgucG93KDIsIHNvdW5kLmRldHVuZSAvIDEyMDApOw0KICAgICAgdGhpcy5maXhBdWRpb05vZGVzKGN0eC5zb3VyY2VOb2RlLCBzb3VuZCk7DQogICAgfQ0KDQogICAgc2V0VGhpbmdOZXcoYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBjb25zdCBjdHggPSBzb3VuZC5jb250ZXh0Ow0KICAgICAgY29uc3QgdmFsdWUgPSBDYXN0LnRvTnVtYmVyKGFyZ3MuVkFMVUUpIC8gMTAwOw0KICAgICAgaWYgKGFyZ3MuVFlQRSA9PT0gInBpdGNoIikgc291bmQucGl0Y2ggPSBNYXRoLm1heCgwLCB2YWx1ZSArIDEpOw0KICAgICAgZWxzZSBpZiAoYXJncy5UWVBFID09PSAiZGV0dW5lIikgc291bmQuZGV0dW5lID0gdmFsdWUgKiAxMDAwOw0KICAgICAgZWxzZSBpZiAoYXJncy5UWVBFID09PSAic3BlZWQiKSBzb3VuZC5zcGVlZCA9IE1hdGgubWF4KDAsIHZhbHVlKTsNCiAgICAgIGVsc2UgaWYgKGFyZ3MuVFlQRSA9PT0gImdhaW4iKSBzb3VuZC5nYWluID0gdmFsdWU7DQogICAgICBlbHNlIGlmIChhcmdzLlRZUEUgPT09ICJhdHRhY2siKQ0KICAgICAgICBzb3VuZC5jb250ZXh0LmF0dGFjayA9IE1hdGgubWF4KDAsIHZhbHVlKTsNCiAgICAgIGVsc2UgaWYgKGFyZ3MuVFlQRSA9PT0gInJlbGVhc2UiKQ0KICAgICAgICBzb3VuZC5jb250ZXh0LnJlbGVhc2UgPSBNYXRoLm1heCgwLCB2YWx1ZSk7DQogICAgICBlbHNlIGlmIChhcmdzLlRZUEUgPT09ICJwYW4iKSB7DQogICAgICAgIGNvbnN0IHBhbiA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5TdGVyZW9QYW5uZXIoew0KICAgICAgICAgIHBhbjogTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIHZhbHVlKSksDQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVFZmZlY3QocGFuLCBzb3VuZCwgIlBBTiIsIGFyZ3MpOw0KICAgICAgfSBlbHNlIGlmIChhcmdzLlRZUEUgPT09ICJkaXN0b3J0aW9uIikgew0KICAgICAgICBjb25zdCBkaXN0b3J0ID0gbmV3IFBpenppY2F0by5FZmZlY3RzLkRpc3RvcnRpb24oeyBnYWluOiB2YWx1ZSB9KTsNCiAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlRWZmZWN0KGRpc3RvcnQsIHNvdW5kLCAiRElTVE9SVElPTiIsIGFyZ3MpOw0KICAgICAgfQ0KICAgICAgc291bmQucmF0ZSA9IHNvdW5kLnBpdGNoICogc291bmQuc3BlZWQgKiBNYXRoLnBvdygyLCBzb3VuZC5kZXR1bmUgLyAxMjAwKTsNCiAgICAgIHRoaXMuZml4QXVkaW9Ob2RlcyhjdHguc291cmNlTm9kZSwgc291bmQpOw0KICAgIH0NCg0KICAgIHNldFJldmVyYihhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIGNvbnN0IHJldmVyYiA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5SZXZlcmIoew0KICAgICAgICB0aW1lOiBDYXN0LnRvTnVtYmVyKGFyZ3MuVElNRSkgLyAxMCwNCiAgICAgICAgZGVjYXk6IENhc3QudG9OdW1iZXIoYXJncy5ERUNBWSkgLyAxMCwNCiAgICAgICAgbWl4OiBDYXN0LnRvTnVtYmVyKGFyZ3MuTUlYKSAvIDEwMCwNCiAgICAgIH0pOw0KICAgICAgdGhpcy51cGRhdGVFZmZlY3QocmV2ZXJiLCBzb3VuZCwgIlJFVkVSQiIsIGFyZ3MpOw0KICAgIH0NCg0KICAgIHNldERlbGF5KGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgY29uc3QgZGVsYXkgPSBuZXcgUGl6emljYXRvLkVmZmVjdHMuRGVsYXkoew0KICAgICAgICB0aW1lOiBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBDYXN0LnRvTnVtYmVyKGFyZ3MuVElNRSkgLyAxMDApKSwNCiAgICAgICAgZGVjYXk6IENhc3QudG9OdW1iZXIoYXJncy5GRUVEKSAvIDEwMCwNCiAgICAgICAgbWl4OiBDYXN0LnRvTnVtYmVyKGFyZ3MuTUlYKSAvIDEwMCwNCiAgICAgIH0pOw0KICAgICAgdGhpcy51cGRhdGVFZmZlY3QoZGVsYXksIHNvdW5kLCAiREVMQVkiLCBhcmdzKTsNCiAgICB9DQoNCiAgICBzZXRGdXp6KGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgY29uc3QgZnV6eiA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5RdWFkcmFmdXp6KHsNCiAgICAgICAgbG93R2FpbjogTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgQ2FzdC50b051bWJlcihhcmdzLkxPVykgLyAxMDApKSwNCiAgICAgICAgbWlkTG93R2FpbjogTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgQ2FzdC50b051bWJlcihhcmdzLk1FRDEpIC8gMTAwKSksDQogICAgICAgIG1pZEhpZ2hHYWluOiBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBDYXN0LnRvTnVtYmVyKGFyZ3MuTUVEMikgLyAxMDApKSwNCiAgICAgICAgaGlnaEdhaW46IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIENhc3QudG9OdW1iZXIoYXJncy5ISUdIKSAvIDEwMCkpLA0KICAgICAgICBtaXg6IENhc3QudG9OdW1iZXIoYXJncy5NSVgpIC8gMTAwLA0KICAgICAgfSk7DQogICAgICB0aGlzLnVwZGF0ZUVmZmVjdChmdXp6LCBzb3VuZCwgIkZVWloiLCBhcmdzKTsNCiAgICB9DQoNCiAgICBzZXRCaXRjcnVzaChhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIC8qIE5PVEU6IEJpdGNydXNoZXIgdXNlcyAiU2NyaXB0UHJvY2Vzc29yTm9kZSINCiAgICAgICAgZGVzcGl0ZSBiZWluZyAiZGVwcmVjYXRlZCIgdGhleSBhcmUgc3RpbGwgd2lkZWx5IHVzZWQNCiAgICAgICovDQogICAgICBjb25zdCBiaXRjcnVzaCA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5CaXRjcnVzaGVyKHsNCiAgICAgICAgYml0czogTWF0aC5tYXgoMTAsIENhc3QudG9OdW1iZXIoYXJncy5CSVRTKSkgLyAxMCwNCiAgICAgICAgZnJlcXVlbmN5OiBNYXRoLm1heCgzMDAwMCwgQ2FzdC50b051bWJlcihhcmdzLkZSRVEpKSwNCiAgICAgIH0pOw0KICAgICAgdGhpcy51cGRhdGVFZmZlY3QoYml0Y3J1c2gsIHNvdW5kLCAiQklUQ1JVU0giLCBhcmdzKTsNCiAgICB9DQoNCiAgICBzZXRUcmVtb2xvKGFyZ3MpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRV07DQogICAgICBpZiAoc291bmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgY29uc3QgZGlzdG9ydCA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5UcmVtb2xvKHsNCiAgICAgICAgc3BlZWQ6IENhc3QudG9OdW1iZXIoYXJncy5TUEVFRCkgLyA1LA0KICAgICAgICBkZXB0aDogQ2FzdC50b051bWJlcihhcmdzLkRFUFRIKSAvIDEwMCwNCiAgICAgICAgbWl4OiBDYXN0LnRvTnVtYmVyKGFyZ3MuTUlYKSAvIDEwMCwNCiAgICAgIH0pOw0KICAgICAgdGhpcy51cGRhdGVFZmZlY3QoZGlzdG9ydCwgc291bmQsICJUUkVNT0xPIiwgYXJncyk7DQogICAgfQ0KDQogICAgc2V0UGFzcyhhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIGNvbnN0IGpzb24gPSB7DQogICAgICAgIGZyZXF1ZW5jeTogQ2FzdC50b051bWJlcihhcmdzLkZSRVEpLA0KICAgICAgICBwZWFrOiBDYXN0LnRvTnVtYmVyKGFyZ3MuUEVBSykgLyA1LA0KICAgICAgfTsNCiAgICAgIGlmIChhcmdzLlRZUEUgPT09ICJoaWdocGFzcyIpIHsNCiAgICAgICAgY29uc3QgaGlnaHBhc3MgPSBuZXcgUGl6emljYXRvLkVmZmVjdHMuSGlnaFBhc3NGaWx0ZXIoanNvbik7DQogICAgICAgIHRoaXMudXBkYXRlRWZmZWN0KGhpZ2hwYXNzLCBzb3VuZCwgIkhJR0hQQVNTIiwgYXJncyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCBsb3dwYXNzID0gbmV3IFBpenppY2F0by5FZmZlY3RzLkxvd1Bhc3NGaWx0ZXIoanNvbik7DQogICAgICAgIHRoaXMudXBkYXRlRWZmZWN0KGxvd3Bhc3MsIHNvdW5kLCAiTE9XUEFTUyIsIGFyZ3MpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHNldEZsYW5nZXIoYXJncykgew0KICAgICAgY29uc3Qgc291bmQgPSBzb3VuZEJhbmtbYXJncy5OQU1FXTsNCiAgICAgIGlmIChzb3VuZCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICBjb25zdCBmbGFuZyA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5GbGFuZ2VyKHsNCiAgICAgICAgdGltZTogQ2FzdC50b051bWJlcihhcmdzLlRJTUUpIC8gMTAwLA0KICAgICAgICBzcGVlZDogQ2FzdC50b051bWJlcihhcmdzLlNQRUVEKSAvIDEwMCwNCiAgICAgICAgZGVwdGg6IENhc3QudG9OdW1iZXIoYXJncy5ERVBUSCkgLyAxMDAsDQogICAgICAgIGZlZWRiYWNrOiBDYXN0LnRvTnVtYmVyKGFyZ3MuRkVFRCkgLyAxMDAsDQogICAgICAgIG1peDogQ2FzdC50b051bWJlcihhcmdzLk1JWCkgLyAxMDAsDQogICAgICB9KTsNCiAgICAgIHRoaXMudXBkYXRlRWZmZWN0KGZsYW5nLCBzb3VuZCwgIkZMQU5HRVIiLCBhcmdzKTsNCiAgICB9DQoNCiAgICBzZXRDb21wcmVzcyhhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIGNvbnN0IGNvbXByZXNzID0gbmV3IFBpenppY2F0by5FZmZlY3RzLkNvbXByZXNzb3Ioew0KICAgICAgICB0aHJlc2hvbGQ6IE1hdGgubWluKDAsIE1hdGgubWF4KC0xMDAsIENhc3QudG9OdW1iZXIoYXJncy5USFJFU0gpICogLTEpKSwNCiAgICAgICAgcmF0aW86IENhc3QudG9OdW1iZXIoYXJncy5SQVRJTykgLyA1LA0KICAgICAgICBhdHRhY2s6IE1hdGgubWluKDAsIE1hdGgubWF4KDEsIENhc3QudG9OdW1iZXIoYXJncy5BVFRBQ0spIC8gMTAwKSksDQogICAgICAgIHJlbGVhc2U6IE1hdGgubWluKDAsIE1hdGgubWF4KDEsIENhc3QudG9OdW1iZXIoYXJncy5SRUxFQVNFKSAvIDEwMCkpLA0KICAgICAgICBrbmVlOiBDYXN0LnRvTnVtYmVyKGFyZ3MuS05FRSkgLyAyLjUsDQogICAgICB9KTsNCiAgICAgIHRoaXMudXBkYXRlRWZmZWN0KGNvbXByZXNzLCBzb3VuZCwgIkNPTVBSRVNTT1IiLCBhcmdzKTsNCiAgICB9DQoNCiAgICBzZXRFcXVhbGl6ZShhcmdzKSB7DQogICAgICBjb25zdCBzb3VuZCA9IHNvdW5kQmFua1thcmdzLk5BTUVdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIGNvbnN0IGVxdWFsaXplciA9IG5ldyBQaXp6aWNhdG8uRWZmZWN0cy5UaHJlZUJhbmRFcXVhbGl6ZXIoew0KICAgICAgICBjdXRvZmZfZnJlcXVlbmN5X2hpZ2g6IDEyMDAwICsgQ2FzdC50b051bWJlcihhcmdzLkNVVF9ISUdIKSAqIDEyMCwNCiAgICAgICAgY3V0b2ZmX2ZyZXF1ZW5jeV9sb3c6IDEyMDAwICsgQ2FzdC50b051bWJlcihhcmdzLkNVVF9MT1cpICogMTIwLA0KICAgICAgICBsb3dfYmFuZF9nYWluOiBDYXN0LnRvTnVtYmVyKGFyZ3MuTE9XKSAvIDEwLA0KICAgICAgICBtaWRfYmFuZF9nYWluOiBDYXN0LnRvTnVtYmVyKGFyZ3MuTUlEKSAvIDEwLA0KICAgICAgICBoaWdoX2JhbmRfZ2FpbjogQ2FzdC50b051bWJlcihhcmdzLkhJR0gpIC8gMTAsDQogICAgICB9KTsNCiAgICAgIHRoaXMudXBkYXRlRWZmZWN0KGVxdWFsaXplciwgc291bmQsICJFUVVBTElaRVIiLCBhcmdzKTsNCiAgICB9DQoNCiAgICAvKiBEZXByZWNhdGlvbiBNYXJrZXIgKi8NCiAgICAvLyBQZW5ndWluTW9kIFN0b3JhZ2UNCiAgICBzZXJpYWxpemUoKSB7DQogICAgICBpZiAoc2V0dGluZ3MuY2FuU2F2ZSkgew0KICAgICAgICBjb25zdCBjb252ZXJ0ZWRCYW5rID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzb3VuZEJhbmspKTsNCiAgICAgICAgT2JqZWN0LnZhbHVlcyhjb252ZXJ0ZWRCYW5rKS5mb3JFYWNoKGl0ZW0gPT4gZGVsZXRlIGl0ZW0uY29udGV4dCk7DQogICAgICAgIHJldHVybiB7IFNQdHVuZVNoYXJrMzogeyBiYW5rOiBjb252ZXJ0ZWRCYW5rLCBzZXR0aW5ncyB9IH07DQogICAgICB9DQogICAgICByZXR1cm4ge307DQogICAgfQ0KICAgIGRlc2VyaWFsaXplKGRhdGEpIHsNCiAgICAgIHRoaXMubG9hZFN0b3JhZ2UoZGF0YS5TUHR1bmVTaGFyazMpOw0KICAgIH0NCiAgICBzYXZlMlByb2plY3QoYXJncykgew0KICAgICAgc2V0dGluZ3MuY2FuU2F2ZSA9IGFyZ3MuU0FWRSA9PT0gInNhdmUiOw0KICAgICAgaWYgKCFTY3JhdGNoLmV4dGVuc2lvbnMuaXNQZW5ndWluTW9kKSB7DQogICAgICAgIGlmIChzZXR0aW5ncy5jYW5TYXZlKSB7DQogICAgICAgICAgY29uc3QgY29udmVydGVkQmFuayA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc291bmRCYW5rKSk7DQogICAgICAgICAgT2JqZWN0LnZhbHVlcyhjb252ZXJ0ZWRCYW5rKS5mb3JFYWNoKGl0ZW0gPT4gZGVsZXRlIGl0ZW0uY29udGV4dCk7DQogICAgICAgICAgcnVudGltZS5leHRlbnNpb25TdG9yYWdlWyJTUHR1bmVTaGFyazMiXSA9IHsNCiAgICAgICAgICAgIGJhbms6IGNvbnZlcnRlZEJhbmssDQogICAgICAgICAgICBzZXR0aW5ncywNCiAgICAgICAgICB9Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZVsiU1B0dW5lU2hhcmszIl0gPSB1bmRlZmluZWQ7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgYXN5bmMgY29udmVydFNvdW5kKGFyZ3MsIHV0aWwpIHsNCiAgICAgIGNvbnN0IHNvdW5kID0gc291bmRCYW5rW2FyZ3MuTkFNRTFdOw0KICAgICAgaWYgKHNvdW5kID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgU2NyYXRjaC5mZXRjaChzb3VuZC5zcmMpOw0KICAgICAgICBjb25zdCBhdWRpb0Jsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7DQogICAgICAgIGNvbnN0IGF1ZGlvRGF0YVVSTCA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7DQogICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgICByZWFkZXIub25sb2FkZW5kID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0KTsNCiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChhdWRpb0Jsb2IpOw0KICAgICAgICB9KTsNCiAgICAgICAgYXdhaXQgdGhpcy5pbXBvcnRVUkwoeyBOQU1FOiBhcmdzLk5BTUUyLCBVUkw6IGF1ZGlvRGF0YVVSTCB9LCB1dGlsKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgIH0NCiAgICB9DQogICAgc2V0VGhpbmcoYXJncykgeyB0aGlzLnNldFRoaW5nTmV3KGFyZ3MpIH0NCiAgICAvKiBNYXJrZXIgRW5kICovDQogIH0NCg0KICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IFNQdHVuZVNoYXJrMygpKTsNCn0pKFNjcmF0Y2gpOw0K","https://extensions.turbowarp.org/Lily/TempVariables2.js","https://extensions.turbowarp.org/runtime-options.js","data:text/javascript;base64,Ly8gTmFtZTogRHJvcGRvd24gTWFrZXIKLy8gSUQ6IFNQMHpNZW51TWFrZXIKLy8gRGVzY3JpcHRpb246IENyZWF0ZSBDdXN0b20gRHJvcGRvd25zCi8vIEJ5OiBTaGFya1Bvb2wKLy8gQnk6IDB6bnp3IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy8wem56dy8+Ci8vIEJ5OiBDU1QxMjI5IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy9DU1QxMjI5Lz4KLy8gTGljZW5zZTogTUlUIEFORCBMR1BMdjMKCi8vIFZlcnNpb24gVi4xLjAuMDEKCihmdW5jdGlvbiAoU2NyYXRjaCkgewogICJ1c2Ugc3RyaWN0IjsKICBpZiAoIVNjcmF0Y2guZXh0ZW5zaW9ucy51bnNhbmRib3hlZCkgdGhyb3cgbmV3IEVycm9yKCJNZW51IE1ha2VyIG5lZWRzIHRvIHJ1biB1bnNhbmRib3hlZCEiKTsKCiAgY29uc3QgZGVsZXRlU1ZHID0KICAgICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXpPUzQzTXpZaUlHaGxhV2RvZEQwaU16a3VOek0ySWlCMmFXVjNRbTk0UFNJd0lEQWdNemt1TnpNMklETTVMamN6TmlJK1BIQmhkR2dnWkQwaVRURXlMalUwTVNBek5TNHhPVFZoT0NBNElEQWdNQ0F4TFRndE9GWXhNaTQxTkRGaE9DQTRJREFnTUNBeElEZ3RPR2d4TkM0Mk5UUmhPQ0E0SURBZ01DQXhJRGdnT0hZeE5DNDJOVFJoT0NBNElEQWdNQ0F4TFRnZ09Ib2lJR1pwYkd3OUlpTm1aalJrTkdRaUx6NDhjR0YwYUNCa1BTSk5NQ0F6T1M0M016WldNR2d6T1M0M016WjJNemt1TnpNMmVpSWdabWxzYkQwaWJtOXVaU0l2UGp4d1lYUm9JR1E5SWsweE1pNDFOREVnTXpVdU1UazFZVGdnT0NBd0lEQWdNUzA0TFRoV01USXVOVFF4WVRnZ09DQXdJREFnTVNBNExUaG9NVFF1TmpVMFlUZ2dPQ0F3SURBZ01TQTRJRGgyTVRRdU5qVTBZVGdnT0NBd0lEQWdNUzA0SURoNklpQm1hV3hzUFNKdWIyNWxJaUJ6ZEhKdmEyVXRiM0JoWTJsMGVUMGlMakkxTVNJZ2MzUnliMnRsUFNJak1EQXdJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqVWlMejQ4Y0dGMGFDQmtQU0pOTVRNdU1UQTRJREl5TGpVNU9XRXlMalkzSURJdU5qY2dNQ0F3SURFdE1pNDJOeTB5TGpZM2RpMHVNVEl5WVRJdU5qY2dNaTQyTnlBd0lEQWdNU0F5TGpZM0xUSXVOamRvTVRNdU5USmhNaTQyTnlBeUxqWTNJREFnTUNBeElESXVOamNnTWk0Mk4zWXVNVEl5WVRJdU5qY2dNaTQyTnlBd0lEQWdNUzB5TGpZM0lESXVOamQ2SWlCbWFXeHNQU0lqWm1abUlpOCtQQzl6ZG1jKyI7CiAgY29uc3QgYWRkU1ZHID0KICAgICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXpPUzQzTXpZaUlHaGxhV2RvZEQwaU16a3VOek0ySWlCMmFXVjNRbTk0UFNJd0lEQWdNemt1TnpNMklETTVMamN6TmlJK1BIQmhkR2dnWkQwaVRURXlMalUwTVNBek5TNHhPVFZoT0NBNElEQWdNQ0F4TFRndE9GWXhNaTQxTkRGaE9DQTRJREFnTUNBeElEZ3RPR2d4TkM0Mk5UUmhPQ0E0SURBZ01DQXhJRGdnT0hZeE5DNDJOVFJoT0NBNElEQWdNQ0F4TFRnZ09Ib2lJR1pwYkd3OUlpTTFNbVptTTJVaUx6NDhjR0YwYUNCa1BTSk5NVEl1TlRReElETTFMakU1TldFNElEZ2dNQ0F3SURFdE9DMDRWakV5TGpVME1XRTRJRGdnTUNBd0lERWdPQzA0YURFMExqWTFOR0U0SURnZ01DQXdJREVnT0NBNGRqRTBMalkxTkdFNElEZ2dNQ0F3SURFdE9DQTRlaUlnWm1sc2JEMGlibTl1WlNJZ2MzUnliMnRsTFc5d1lXTnBkSGs5SWk0eU5URWlJSE4wY205clpUMGlJekF3TUNJZ2MzUnliMnRsTFhkcFpIUm9QU0kxSWk4K1BIQmhkR2dnWkQwaVRURXpMakV3T0NBeU1pNDFPVGxoTWk0Mk55QXlMalkzSURBZ01DQXhMVEl1TmpjdE1pNDJOM1l0TGpFeU1tRXlMalkzSURJdU5qY2dNQ0F3SURFZ01pNDJOeTB5TGpZM2FERXpMalV5WVRJdU5qY2dNaTQyTnlBd0lEQWdNU0F5TGpZM0lESXVOamQyTGpFeU1tRXlMalkzSURJdU5qY2dNQ0F3SURFdE1pNDJOeUF5TGpZM2VpSWdabWxzYkQwaUkyWm1aaUl2UGp4d1lYUm9JR1E5SWsweE55NHhNemNnTVRNdU1UQTRZVEl1TmpjZ01pNDJOeUF3SURBZ01TQXlMalkzTFRJdU5qZG9MakV5TW1FeUxqWTNJREl1TmpjZ01DQXdJREVnTWk0Mk55QXlMalkzZGpFekxqVXlZVEl1TmpjZ01pNDJOeUF3SURBZ01TMHlMalkzSURJdU5qZG9MUzR4TWpKaE1pNDJOeUF5TGpZM0lEQWdNQ0F4TFRJdU5qY3RNaTQyTjNvaUlHWnBiR3c5SWlObVptWWlMejQ4Y0dGMGFDQmtQU0pOTUNBek9TNDNNelpXTUdnek9TNDNNeloyTXprdU56TTJlaUlnWm1sc2JEMGlibTl1WlNJdlBqd3ZjM1puUGc9PSI7CiAgY29uc3QgZWRpdFNWRyA9CiAgICAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l6T1M0M016WWlJR2hsYVdkb2REMGlNemt1TnpNMklpQjJhV1YzUW05NFBTSXdJREFnTXprdU56TTJJRE01TGpjek5pSStQSEJoZEdnZ1pEMGlUVEV5TGpVME1TQXpOUzR4T1RWaE9DQTRJREFnTUNBeExUZ3RPRll4TWk0MU5ERmhPQ0E0SURBZ01DQXhJRGd0T0dneE5DNDJOVFJoT0NBNElEQWdNQ0F4SURnZ09IWXhOQzQyTlRSaE9DQTRJREFnTUNBeExUZ2dPSG9pSUdacGJHdzlJaU0wTUdRNFptWWlMejQ4Y0dGMGFDQmtQU0pOTVRJdU5UUXhJRE0xTGpFNU5XRTRJRGdnTUNBd0lERXRPQzA0VmpFeUxqVTBNV0U0SURnZ01DQXdJREVnT0MwNGFERTBMalkxTkdFNElEZ2dNQ0F3SURFZ09DQTRkakUwTGpZMU5HRTRJRGdnTUNBd0lERXRPQ0E0ZWlJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bExXOXdZV05wZEhrOUlpNHlOVEVpSUhOMGNtOXJaVDBpSXpBd01DSWdjM1J5YjJ0bExYZHBaSFJvUFNJMUlpOCtQSEJoZEdnZ1pEMGlUVEV5TGpVNE55QXlNeTR3T1RoakxqRXdNaTB1TkRNdU16YzNMUzQ0Tmk0M016UXRNUzR5TGpNeU1TMHVNekExSURRdU9ETTRJRFF1TVRZNElEUXVOVFE0SURRdU5EZ3pMUzR6TkRRdU16Y3pMUzQzT0RndU5qWXpMVEV1TWpNeExqYzJPR3d0TXk0NE5DNDVNVFpqTFM0NE1UY3VNVGswTFRFdU16SXhMUzR6TVMweExqRXlOeTB4TGpFeU5ucHRNVEV1TVRFNExURXdMakF6Tm1FeExqQTVOU0F4TGpBNU5TQXdJREFnTVNBd0xURXVOVFE0YkM0NU5qWXRMamsyTjJFeExqQTVOU0F4TGpBNU5TQXdJREFnTVNBeExqVTBPU0F3YkRJdU9UWTVJREl1T1RkakxqUXlOeTQwTWpjdU5ESTNJREV1TVRJZ01DQXhMalUwT0d3dExqazJOeTQ1TmpaaE1TNHdPVFVnTVM0d09UVWdNQ0F3SURFdE1TNDFORGdnTUhwdExUZ3VNemt4SURndU16a3hZVEV1TURrMUlERXVNRGsxSURBZ01DQXhJREF0TVM0MU5EaHNOaTR3TVMwMkxqQXhZVEV1TURrMUlERXVNRGsxSURBZ01DQXhJREV1TlRRNElEQnNNaTQ1TmprZ01pNDVOamxqTGpReU9DNDBNamd1TkRJNElERXVNVElnTUNBeExqVTBPR3d0Tmk0d01TQTJMakF4WVRFdU1EazFJREV1TURrMUlEQWdNQ0F4TFRFdU5UUTRJREI2SWlCbWFXeHNQU0lqWm1abUlpOCtQSEJoZEdnZ1pEMGlUVEFnTXprdU56TTJWakJvTXprdU56TTJkak01TGpjek5ub2lJR1pwYkd3OUltNXZibVVpTHo0OEwzTjJaejQ9IjsKICBjb25zdCBtZW51SWNvblVSSSA9CiAgICAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4TURZdU5ERTVJaUJvWldsbmFIUTlJakV3Tmk0ME1Ua2lJSFpwWlhkQ2IzZzlJakFnTUNBeE1EWXVOREU1SURFd05pNDBNVGtpUGp4d1lYUm9JR1E5SWsweUxqVWdOVE11TWpGRE1pNDFJREkxTGpJd05DQXlOUzR5TURRZ01pNDFJRFV6TGpJeElESXVOWE0xTUM0M01TQXlNaTQzTURRZ05UQXVOekVnTlRBdU56RXRNakl1TnpBMElEVXdMamN4TFRVd0xqY3hJRFV3TGpjeFV6SXVOU0E0TVM0eU1UWWdNaTQxSURVekxqSXhlaUlnWm1sc2JEMGlJekJtWW1RNFl5SWdjM1J5YjJ0bFBTSWpNR0U0TURWbElpQnpkSEp2YTJVdGQybGtkR2c5SWpVaUx6NDhjR0YwYUNCa1BTSk5NVGt1T1RJZ05UTXVNakZqTUMweE9DNHpPRFlnTVRRdU9UQTBMVE16TGpJNUlETXpMakk1TFRNekxqSTVVemcyTGpVZ016UXVPREkwSURnMkxqVWdOVE11TWpFZ056RXVOVGsySURnMkxqVWdOVE11TWpFZ09EWXVOU0F4T1M0NU1pQTNNUzQxT1RZZ01Ua3VPVElnTlRNdU1qRjZJaUJtYVd4c1BTSWpNR001T1RjeElpQnpkSEp2YTJVOUlpTXdZVGd3TldVaUlITjBjbTlyWlMxM2FXUjBhRDBpTkM0MUlpOCtQSEJoZEdnZ1pEMGlUVFkzTGpNME9DQTBPUzQ0TURKaE5TNHpOaUExTGpNMklEQWdNQ0F4TFRFdU5UZ2dNeTQ0TWpkc0xUZ3VOeklnT0M0M01tRTFMalExSURVdU5EVWdNQ0F3SURFdE55NDJOellnTUd3dE9DNDJPVGd0T0M0M01tRTFMak00SURVdU16Z2dNQ0F3SURFdE1TNDJNREl0TXk0NE1qY2dOUzQxTWlBMUxqVXlJREFnTUNBeElERXVOVGd0TXk0NE5EbGpMalkwTlMwdU5UTTBJREV1TmpBeExURXVOVGdnTVRJdU5UY3RNUzQxT0NBeE1DNDVOamNnTUNBeE1TNDVPU0F4TGpBeU5DQXhNaTQxTkRZZ01TNDFPR0UxTGpReklEVXVORE1nTUNBd0lERWdNUzQxT0NBekxqZzFlaUlnWm1sc2JEMGlibTl1WlNJZ2MzUnliMnRsUFNJak1HRTRNRFZsSWlCemRISnZhMlV0ZDJsa2RHZzlJamN1TlNJdlBqeHdZWFJvSUdROUlrMDJOeTR6TkRnZ05Ea3VPREF5WVRVdU16WWdOUzR6TmlBd0lEQWdNUzB4TGpVNElETXVPREkzYkMwNExqY3lJRGd1TnpKaE5TNDBOU0ExTGpRMUlEQWdNQ0F4TFRjdU5qYzJJREJzTFRndU5qazRMVGd1TnpKaE5TNHpPQ0ExTGpNNElEQWdNQ0F4TFRFdU5qQXlMVE11T0RJM0lEVXVOVElnTlM0MU1pQXdJREFnTVNBeExqVTRMVE11T0RRNVl5NDJORFV0TGpVek5DQXhMall3TVMweExqVTRJREV5TGpVM0xURXVOVGdnTVRBdU9UWTNJREFnTVRFdU9Ua2dNUzR3TWpRZ01USXVOVFEySURFdU5UaGhOUzQwTXlBMUxqUXpJREFnTUNBeElERXVOVGdnTXk0NE5TSWdabWxzYkQwaUkyWm1aaUl2UGp3dmMzWm5QZz09IjsKCiAgY29uc3Qgdm0gPSBTY3JhdGNoLnZtOwogIGNvbnN0IHJ1bnRpbWUgPSB2bS5ydW50aW1lOwogIGNvbnN0IGlzUE0gPSBTY3JhdGNoLmV4dGVuc2lvbnMuaXNQZW5ndWluTW9kOwogIGNvbnN0IFRFTVBfQkxPQ0tfT1BDT0RFID0gIlNQMHpNZW51TWFrZXJfX19TUDB6TWVudU1ha2VyX1RFTVBfQkxPQ0siOyAvLyBvcGNvZGUgb2YgdGhlIHRlbXBvcmFyeSBibG9jayBhZGRlZCB0byBrZWVwIHRoZSBleHRlbnNpb24gaW4gdGhlIHByb2plY3QKCiAgbGV0IGV4dFJldm1vdmFibGUgPSBmYWxzZSwgZXh0ZW5zaW9uSW5zdGFuY2U7IC8vIGNyZWF0ZWQgd2hlbiB0aGUgZXh0ZW5zaW9uIGlzICJyZWdpc3RlcmVkIgogIGxldCBtZW51c1hNTCA9IGA8bGFiZWwgdGV4dD0iVHJ5IGNyZWF0aW5nIHNvbWUgbWVudXMhIiAvPmA7CiAgbGV0IGN1c3RvbU1lbnVzID0gewogICAgIm5ldy1tZW51LTEiOiB7IGl0ZW1zOiBbeyB0ZXh0OiAiZm9vIiwgdmFsdWU6ICJiYXIiIH1dLCBhY2NlcHRSZXBvcnRlcnM6IGZhbHNlIH0KICB9OwoKICAvLyBIZWxwZXIgRnVuY3MKICBjb25zdCBoYXNPd24gPSAob2JqLCBrZXkpID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CgogIGNvbnN0IHhtbEVzY2FwZSA9IGZ1bmN0aW9uICh1bnNhZmUpIHsKICAgIHJldHVybiBTY3JhdGNoLkNhc3QudG9TdHJpbmcodW5zYWZlKS5yZXBsYWNlKC9bPD4mJyJdL2csIGMgPT4gewogICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICBjYXNlICI8IjogcmV0dXJuICImbHQ7IjsKICAgICAgICBjYXNlICI+IjogcmV0dXJuICImZ3Q7IjsKICAgICAgICBjYXNlICImIjogcmV0dXJuICImYW1wOyI7CiAgICAgICAgY2FzZSAiJyI6IHJldHVybiAiJmFwb3M7IjsKICAgICAgICBjYXNlICJcIiI6IHJldHVybiAiJnF1b3Q7IjsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgZnVuY3Rpb24gcmVmcmVzaE1hZ2ljKCkgewogICAgbWVudXNYTUwgPSBPYmplY3Qua2V5cyhjdXN0b21NZW51cykubWFwKG1lbnVOYW1lID0+IHsKICAgICAgY29uc3QgbWVudUJsb2NrID0gYFNQMHpNZW51TWFrZXJfbWVudV8ke3htbEVzY2FwZShtZW51TmFtZSl9YDsKICAgICAgcmV0dXJuIGA8YmxvY2sgdHlwZT0iJHttZW51QmxvY2t9IiBpZD0iJHttZW51QmxvY2t9Ij48L2Jsb2NrPmA7CiAgICB9KS5qb2luKCIiKSB8fCBgPGxhYmVsIHRleHQ9IlRyeSBjcmVhdGluZyBzb21lIG1lbnVzISIgLz5gOwogICAgdm0uZXh0ZW5zaW9uTWFuYWdlci5yZWZyZXNoQmxvY2tzKCkudGhlbigoKSA9PiB2bS5yZWZyZXNoV29ya3NwYWNlKCkpOwogIH0KCiAgZnVuY3Rpb24gcGF0Y2hEaXZDb2xvcihjb250YWluZXIsIGlzRGFyaykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBjaGlsZCA9IGNvbnRhaW5lci5jaGlsZE5vZGVzW2ldOwogICAgICBjaGlsZC5zdHlsZS5iYWNrZ3JvdW5kID0gaSAlIDIgIT09IDAgPyBgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgJHtpc0RhcmsgPyAiIzM0MzQzNCIgOiAiI0Q5RDlEOSJ9IDgwJSwgcmdiYSgwLDAsMCwwKSlgIDogIiI7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXRjaE5hbWUobmFtZSwgYXJyYXkpIHsKICAgIGlmIChhcnJheS5pbmRleE9mKG5hbWUpID4gLTEpIHsKICAgICAgY29uc3QgYXBwZWFyYW5jZSA9IGFycmF5LmZpbHRlcigodikgPT4gdiA9PT0gbmFtZSkubGVuZ3RoOwogICAgICBjb25zdCBsYXN0RGFzaCA9IG5hbWUubGFzdEluZGV4T2YoIi0iKTsKICAgICAgbGV0IG5ld05hbWUgPSBgJHtuYW1lfS0ke2FwcGVhcmFuY2V9YDsKICAgICAgaWYgKGxhc3REYXNoICE9PSAtMSkgewogICAgICAgIGNvbnN0IGxhc3RQYXJ0ID0gbmFtZS5zbGljZShsYXN0RGFzaCArIDEpOwogICAgICAgIGlmICghaXNOYU4ocGFyc2VJbnQobGFzdFBhcnQpKSkgbmV3TmFtZSA9IG5hbWUuc2xpY2UoMCwgbGFzdERhc2gpICsgYC0ke3BhcnNlSW50KGxhc3RQYXJ0KSArIGFwcGVhcmFuY2V9YDsKICAgICAgfQogICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZihuZXdOYW1lKSA+IC0xID8gcGF0Y2hOYW1lKG5ld05hbWUsIGFycmF5KSA6IG5ld05hbWU7CiAgICB9CiAgICByZXR1cm4gbmFtZTsKICB9CgogIC8vIEdVSQogIGZ1bmN0aW9uIG1ha2VUaXRsZSh0eHQpIHsKICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB0aXRsZS50ZXh0Q29udGVudCA9IHR4dDsKICAgIHRpdGxlLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiZGlzcGxheTogaW5saW5lLWJsb2NrOyB0ZXh0LWFsaWduOiBjZW50ZXI7IHdpZHRoOiA0NyU7IG1hcmdpbi1yaWdodDogOHB4OyBtYXJnaW4tbGVmdDogOHB4OyBwYWRkaW5nOiAwcHggMHB4IDIwcHg7Iik7CiAgICByZXR1cm4gdGl0bGU7CiAgfQoKICBmdW5jdGlvbiBtYWtlTGFiZWwodHh0KSB7CiAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgbGFiZWwudGV4dENvbnRlbnQgPSB0eHQ7CiAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIm1hcmdpbjogNXB4OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDAlLCAtNTUlKTsiKTsKICAgIHJldHVybiBsYWJlbDsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbnRhaW4oY2xhc1MsIGRhcmtHVUkpIHsKICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgYm94LmNsYXNzTGlzdC5hZGQoY2xhc1MpOwogICAgYm94LnNldEF0dHJpYnV0ZSgic3R5bGUiLCAib3ZlcmZsb3c6IGhpZGRlbiBzY3JvbGw7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IDQ3JTsgaGVpZ2h0OiAyMDBweDsgcGFkZGluZzogMnB4OyBtYXJnaW4tcmlnaHQ6IDhweDsgbWFyZ2luLWxlZnQ6IDhweDsgYm9yZGVyLXJhZGl1czogNXB4OyIpOwogICAgYm94LnN0eWxlLmJvcmRlciA9IGBzb2xpZCAke2RhcmtHVUkgPyAiIzM0MzQzNCIgOiAiI0Q5RDlEOSJ9IDJweGA7CiAgICByZXR1cm4gYm94OwogIH0KCiAgZnVuY3Rpb24gbWFrZUJ1dHRvbihpbWcsIGNsYXNTKSB7CiAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNsYXNTKTsKICAgIGJ1dHRvbi5zcmMgPSBpbWc7CiAgICBidXR0b24ud2lkdGggPSAiMzIiOwogICAgYnV0dG9uLnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgIHJldHVybiBidXR0b247CiAgfQoKICBmdW5jdGlvbiBtYWtlSW5wdXQodHlwZSwgZGVmYXVsdFYsIG9wdHMpIHsKICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgIGlucHV0LnR5cGUgPSB0eXBlOwogICAgaW5wdXQudmFsdWUgPSBkZWZhdWx0VjsKICAgIGlucHV0LnN0eWxlLndpZHRoID0gb3B0cz8ud2lkdGggPz8gIjEzMHB4IjsKICAgIGlucHV0LnN0eWxlLnRyYW5zZm9ybSA9ICJ0cmFuc2xhdGUoMCUsIC00NSUpIjsKICAgIGlucHV0LnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgIHJldHVybiBpbnB1dDsKICB9CgogIGZ1bmN0aW9uIGdob3N0SW5wdXRSZW1vdmUoc2VsZWN0b3IpIHsKICAgIC8vIEJsb2NrIFRleHQgaW5wdXQgRG9lc250IHNob3cgaW1tZWRpYXRlbHkgOigKICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbGVtZW50KSBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAwOwogICAgZWxzZSBzZXRUaW1lb3V0KCgpID0+IHsgZ2hvc3RJbnB1dFJlbW92ZShzZWxlY3RvcikgfSwgNSk7CiAgfQoKICBmdW5jdGlvbiBtYWtlTWVudU5hbWVSb3cobmFtZSwgbmFtZXNBcnJheSwgaXNEYXJrLCBjb250YWluKSB7CiAgICBjb25zdCByb3dEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIHJvd0Rpdi5zdHlsZS5oZWlnaHQgPSAiMTclIjsKICAgIGlmIChuYW1lc0FycmF5LmluZGV4T2YobmFtZSkgJSAyICE9PSAwKSByb3dEaXYuc3R5bGUuYmFja2dyb3VuZCA9IGByYWRpYWwtZ3JhZGllbnQoY2lyY2xlLCAke2lzRGFyayA/ICIjMzQzNDM0IiA6ICIjRDlEOUQ5In0gODAlLCByZ2JhKDAsMCwwLDApKWA7CgogICAgLy8gRGVsZXRlIEJ1dHRvbgogICAgY29uc3QgZGVsID0gbWFrZUJ1dHRvbihkZWxldGVTVkcsICJkZWxldGUiKTsKICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChkZWwpOwogICAgZGVsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAvLyBTdXBlciBzZWNyZXQgY29tbWVudCBmcm9tIGFzaGltZSA8MwogICAgICBkZWxldGUgY3VzdG9tTWVudXNbbmFtZV07CiAgICAgIG5hbWVzQXJyYXkuc3BsaWNlKG5hbWVzQXJyYXkuaW5kZXhPZihuYW1lKSwgMSk7CiAgICAgIHJvd0Rpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0Rpdik7CiAgICAgIHBhdGNoRGl2Q29sb3IoY29udGFpbiwgaXNEYXJrKTsKCiAgICAgIC8vIFJlbW92ZSBJdGVtcyBDb250YWluZXIKICAgICAgY29uc3QgaXRlbUNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtjbGFzcz0iaXRlbXMiXWApOwogICAgICBpdGVtQ29uLmlubmVySFRNTCA9ICIiOwogICAgfSk7CgogICAgLy8gRWRpdCBCdXR0b24KICAgIGNvbnN0IGVkaXQgPSBtYWtlQnV0dG9uKGVkaXRTVkcsICJlZGl0Iik7CiAgICByb3dEaXYuYXBwZW5kQ2hpbGQoZWRpdCk7CiAgICBlZGl0LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICBwYXRjaERpdkNvbG9yKGNvbnRhaW4sIGlzRGFyayk7CiAgICAgIHJvd0Rpdi5zdHlsZS5iYWNrZ3JvdW5kID0gYHJhZGlhbC1ncmFkaWVudChjaXJjbGUsICNhM2EzYTMgODAlLCByZ2JhKDAsMCwwLDApKWA7CiAgICAgIHJlbmRlckl0ZW1MaXN0KGN1c3RvbU1lbnVzW25hbWVdLCBpc0RhcmssIG5hbWUpOwogICAgfSk7CgogICAgLy8gVGV4dCAmIElucHV0CiAgICBjb25zdCBsaXN0SXRlbSA9IG1ha2VJbnB1dCgidGV4dCIsIG5hbWUpOwogICAgbGlzdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gewogICAgICBjb25zdCBvbGRWYWx1ZSA9IGN1c3RvbU1lbnVzW25hbWVdOwogICAgICBkZWxldGUgY3VzdG9tTWVudXNbbmFtZV07CiAgICAgIGNvbnN0IG5ld05hbWUgPSBwYXRjaE5hbWUobGlzdEl0ZW0udmFsdWUsIG5hbWVzQXJyYXkpOwogICAgICBjdXN0b21NZW51c1tuZXdOYW1lXSA9IG9sZFZhbHVlOwogICAgICBuYW1lc0FycmF5W25hbWVzQXJyYXkuaW5kZXhPZihuYW1lKV0gPSBuZXdOYW1lOwoKICAgICAgLy8gcmVmcmVzaCBtb2RhbCAod2lsbCBidWcgb3V0IGlmIG5vdCByZWZyZXNoZWQpCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGNvbnN0IHBhcmVudCA9IHJvd0Rpdi5wYXJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgICAgZm9yIChsZXQgaSA9IHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7IGktLTsgKSBwYXJlbnQuY2hpbGROb2Rlc1tpXS5yZW1vdmUoKTsKICAgICAgICBjcmVhdGVNZW51TGlzdChPYmplY3Qua2V5cyhjdXN0b21NZW51cyksIHBhcmVudCwgaXNEYXJrKTsKICAgICAgfSwgNSk7CiAgICB9KTsKICAgIGxpc3RJdGVtLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICBwYXRjaERpdkNvbG9yKGNvbnRhaW4sIGlzRGFyayk7CiAgICAgIHJvd0Rpdi5zdHlsZS5iYWNrZ3JvdW5kID0gYHJhZGlhbC1ncmFkaWVudChjaXJjbGUsICNhM2EzYTMgODAlLCByZ2JhKDAsMCwwLDApKWA7CiAgICAgIHJlbmRlckl0ZW1MaXN0KGN1c3RvbU1lbnVzW25hbWVdLCBpc0RhcmssIG5hbWUpOwogICAgfSk7CiAgICByb3dEaXYuYXBwZW5kKG1ha2VMYWJlbCgiTmFtZToiKSwgbGlzdEl0ZW0pOwogICAgcmV0dXJuIHJvd0RpdjsKICB9CgogIGZ1bmN0aW9uIG1ha2VJdGVtUm93KGl0ZW0sIGluZGV4LCBpc0RhcmssIGNvbnRhaW4sIG5hbWUpIHsKICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgcm93RGl2LnN0eWxlLmhlaWdodCA9ICIxNyUiOwogICAgaWYgKGluZGV4ICUgMiAhPT0gMCkgcm93RGl2LnN0eWxlLmJhY2tncm91bmQgPSBgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSwgJHtpc0RhcmsgPyAiIzM0MzQzNCIgOiAiI0Q5RDlEOSJ9IDgwJSwgcmdiYSgwLDAsMCwwKSlgOwoKICAgIC8vIERlbGV0ZSBCdXR0b24KICAgIGNvbnN0IGRlbCA9IG1ha2VCdXR0b24oZGVsZXRlU1ZHLCAiZGVsZXRlIik7CiAgICByb3dEaXYuYXBwZW5kQ2hpbGQoZGVsKTsKICAgIGRlbC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgY3VzdG9tTWVudXNbbmFtZV0uaXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgcmVuZGVySXRlbUxpc3QoY3VzdG9tTWVudXNbbmFtZV0sIGlzRGFyaywgbmFtZSk7CiAgICB9KTsKCiAgICAvLyBUZXh0ICYgSW5wdXQKICAgIGNvbnN0IHRleHQgPSBtYWtlSW5wdXQoInRleHQiLCBpdGVtLnRleHQsIHsgd2lkdGg6ICI2NXB4IiB9KTsKICAgIHRleHQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4geyBjdXN0b21NZW51c1tuYW1lXS5pdGVtc1tpbmRleF0udGV4dCA9IHRleHQudmFsdWUgfSk7CiAgICBjb25zdCB2YWx1ZSA9IG1ha2VJbnB1dCgidGV4dCIsIGl0ZW0udmFsdWUsIHsgd2lkdGg6ICI2NXB4IiB9KTsKICAgIHZhbHVlLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsgY3VzdG9tTWVudXNbbmFtZV0uaXRlbXNbaW5kZXhdLnZhbHVlID0gdmFsdWUudmFsdWUgfSk7CiAgICByb3dEaXYuYXBwZW5kKG1ha2VMYWJlbCgiVGV4dDoiKSwgdGV4dCwgbWFrZUxhYmVsKCJWYWx1ZToiKSwgdmFsdWUpOwogICAgcmV0dXJuIHJvd0RpdjsKICB9CgogIC8vIEludGVybmFsIEdVSQogIGZ1bmN0aW9uIGNyZWF0ZU1lbnVMaXN0KG5hbWVzQXJyYXksIHBhcmVudCwgaXNEYXJrKSB7CiAgICAvLyBJbm5lciBUaXRsZXMgYW5kIENvbnRhaW5lcnMKICAgIGNvbnN0IHRpdGxlMSA9IG1ha2VUaXRsZSgiQ3JlYXRlZCBEcm9wZG93bnMiKSwgdGl0bGUyID0gbWFrZVRpdGxlKCJJdGVtcyBpbiBEcm9wZG93biIpOwogICAgY29uc3QgbGlzdENvbiA9IGNyZWF0ZUNvbnRhaW4oIm1lbnVzIiwgaXNEYXJrKTsKICAgIG5hbWVzQXJyYXkuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICBsaXN0Q29uLmFwcGVuZENoaWxkKG1ha2VNZW51TmFtZVJvdyhuYW1lLCBuYW1lc0FycmF5LCBpc0RhcmssIGxpc3RDb24pKTsKICAgIH0pOwoKICAgIC8vIEFkZCBCdXR0b24KICAgIGNvbnN0IGFkZCA9IG1ha2VCdXR0b24oYWRkU1ZHLCAiYWRkIik7CiAgICBhZGQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGNvbnN0IG5ld04gPSBwYXRjaE5hbWUoYG5ldy1tZW51LSR7bmFtZXNBcnJheS5sZW5ndGggKyAxfWAsIG5hbWVzQXJyYXkpOwogICAgICBjdXN0b21NZW51c1tuZXdOXSA9IHsgaXRlbXM6IFt7IHRleHQ6ICJmb28iLCB2YWx1ZTogImJhciIgfV0sIGFjY2VwdFJlcG9ydGVyczogZmFsc2UgfTsKICAgICAgbmFtZXNBcnJheS5wdXNoKG5ld04pOwogICAgICBsaXN0Q29uLmluc2VydEJlZm9yZShtYWtlTWVudU5hbWVSb3cobmV3TiwgbmFtZXNBcnJheSwgaXNEYXJrLCBsaXN0Q29uKSwgYWRkKTsKICAgICAgcGF0Y2hEaXZDb2xvcihsaXN0Q29uLCBpc0RhcmspOwogICAgfSk7CiAgICBsaXN0Q29uLmFwcGVuZENoaWxkKGFkZCk7CgogICAgLy8gTWVudSBJdGVtcyBDb250YWluZXIgKEluaXRpYWxseSBCbGFuaykKICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoY3JlYXRlQ29udGFpbigiaXRlbXMiLCBpc0RhcmspLCBwYXJlbnQuY2hpbGRyZW5bMF0pOwogICAgcGFyZW50Lmluc2VydEJlZm9yZShsaXN0Q29uLCBwYXJlbnQuY2hpbGRyZW5bMF0pOwogICAgcGFyZW50Lmluc2VydEJlZm9yZSh0aXRsZTIsIHBhcmVudC5jaGlsZHJlblswXSk7CiAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKHRpdGxlMSwgcGFyZW50LmNoaWxkcmVuWzBdKTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlckl0ZW1MaXN0KGl0ZW1zLCBpc0RhcmssIGtleSkgewogICAgY29uc3QgaXRlbUNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtjbGFzcz0iaXRlbXMiXWApOwogICAgaXRlbUNvbi5pbm5lckhUTUwgPSAiIjsgLy8gY2xlYW5zZSBpdGVtcwogICAgaXRlbXMgPSBpdGVtcy5pdGVtczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIGl0ZW1Db24uYXBwZW5kQ2hpbGQobWFrZUl0ZW1Sb3coaXRlbXNbaV0sIGksIGlzRGFyaywgaXRlbUNvbiwga2V5KSk7CgogICAgLy8gQWRkIEJ1dHRvbgogICAgY29uc3QgYWRkID0gbWFrZUJ1dHRvbihhZGRTVkcsICJhZGRJdGVtIik7CiAgICBhZGQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGN1c3RvbU1lbnVzW2tleV0uaXRlbXMucHVzaCh7IHRleHQ6ICJuZXcgaXRlbSIsIHZhbHVlOiAibmV3IHZhbHVlIiB9KTsKICAgICAgcmVuZGVySXRlbUxpc3QoY3VzdG9tTWVudXNba2V5XSwgaXNEYXJrLCBrZXkpOwogICAgfSk7CiAgICBpdGVtQ29uLmFwcGVuZENoaWxkKGFkZCk7CiAgfQoKICBmdW5jdGlvbiBpbml0TWVudU1ha2VyKCkgewogICAgZXh0UmV2bW92YWJsZSA9IGZhbHNlOwogICAgY29uc3QgYWxsQmxvY2tzID0gU2NyYXRjaEJsb2Nrcy5tYWluV29ya3NwYWNlLmJsb2NrREJfOyAvLyBDdXN0b20gQmxvY2sgTW9kYWwgT3ZlcnJpZGVzIEJsb2NrREIKICAgIFNjcmF0Y2hCbG9ja3MuUHJvY2VkdXJlcy5jcmVhdGVQcm9jZWR1cmVEZWZDYWxsYmFja18oKTsKICAgIGNvbnN0IGlzRGFyayA9IGlzUE0gPyBkb2N1bWVudC5ib2R5LmdldEF0dHJpYnV0ZSgidGhlbWUiKSA9PT0gImRhcmsiIDogUmVkdXhTdG9yZS5nZXRTdGF0ZSgpLnNjcmF0Y2hHdWkudGhlbWUudGhlbWUuZ3VpID09PSAiZGFyayI7CgogICAgLy8gQ2xlYW4gTW9kYWwKICAgIGNvbnN0IGJsb2NrU3BhY2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbY2xhc3NePSJjdXN0b20tcHJvY2VkdXJlc193b3Jrc3BhY2VfIl1gKTsKICAgIGJsb2NrU3BhY2UucmVtb3ZlKCk7CiAgICBjb25zdCBidXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2NsYXNzKj0iY3VzdG9tLXByb2NlZHVyZXNfYm9keV8iXWApOwogICAgZm9yIChsZXQgaSA9IGJ1dHRvbnMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaS0tOykgYnV0dG9ucy5yZW1vdmVDaGlsZChidXR0b25zLmZpcnN0Q2hpbGQpOwoKICAgIC8vIE5ldyBUaXRsZQogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbY2xhc3MqPSJtb2RhbF9oZWFkZXItaXRlbS10aXRsZV8iXWApOwogICAgdGl0bGUudGV4dENvbnRlbnQgPSAiTWFrZSBhIERyb3Bkb3duIjsKCiAgICBjcmVhdGVNZW51TGlzdChPYmplY3Qua2V5cyhjdXN0b21NZW51cyksIGJ1dHRvbnMsIGlzRGFyayk7CiAgICBnaG9zdElucHV0UmVtb3ZlKGBbY2xhc3MqPSJyZW1vdmFibGVUZXh0SW5wdXQiXWApOwoKICAgIC8vIE92ZXJyaWRlICJPSyIgQnV0dG9uCiAgICBjb25zdCBva0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtjbGFzc149ImN1c3RvbS1wcm9jZWR1cmVzX29rLWJ1dHRvbl8iXWApOwogICAgY29uc3QgY2xvbmVkT2tCdG4gPSBva0J0bi5jbG9uZU5vZGUodHJ1ZSk7CiAgICBva0J0bi5yZXBsYWNlV2l0aChjbG9uZWRPa0J0bik7CiAgICBjbG9uZWRPa0J0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgLy8gQWxsIE1lbnVzIHNob3VsZCBIYXZlIEF0IGxlYXN0IDEgaW4gYSBNZW51CiAJCQlmb3IgKGNvbnN0IFtrZXksIG1lbnVdIG9mIE9iamVjdC5lbnRyaWVzKGN1c3RvbU1lbnVzKSkgewogIAkJCWlmIChtZW51Lml0ZW1zLmxlbmd0aCA9PT0gMCkgbWVudS5pdGVtcyA9IFt7IHRleHQ6ICJmb28iLCB2YWx1ZTogImJhciIgfV07CgkJCX0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2NsYXNzXj0iY2xvc2UtYnV0dG9uX2Nsb3NlLWJ1dHRvbl8iXWApLmNsaWNrKCk7CiAgICAgIHJlZnJlc2hNYWdpYygpOwoKICAgICAgLy8gUmVtb3ZlIE1lbnUgQmxvY2tzIHRoYXQgbm8gTG9uZ2VyIEV4aXN0CiAgICAgIGNvbnN0IG1lbnVOYW1lcyA9IE9iamVjdC5rZXlzKGN1c3RvbU1lbnVzKTsKICAgICAgZm9yIChjb25zdCBba2V5LCBibG9ja10gb2YgT2JqZWN0LmVudHJpZXMoYWxsQmxvY2tzKSkgewogICAgICAgIGlmIChibG9jay50eXBlLnN0YXJ0c1dpdGgoIlNQMHpNZW51TWFrZXJfbWVudV8iKSkgewogICAgICAgICAgaWYgKG1lbnVOYW1lcy5pbmRleE9mKGJsb2NrLnR5cGUucmVwbGFjZSgiU1Awek1lbnVNYWtlcl9tZW51XyIsICIiKSkgPT09IC0xKSBibG9jay5kaXNwb3NlKCk7CiAgICAgICAgfQoJCSAgfQogICAgfSk7CiAgfQoKICAvLyBNZW51IEJsb2NrIENvbG9yIFNldHRlcnMKICBmdW5jdGlvbiB1cGRhdGVNZW51Q29sb3IoaWQsIG1haW5Xb3Jrc3BhY2UsIHRyZWUpIHsKICAgIGNvbnN0IGJsb2NrID0gbWFpbldvcmtzcGFjZS5nZXRCbG9ja0J5SWQoaWQpOwogICAgaWYgKCFibG9jayB8fCAhYmxvY2sudHlwZS5zdGFydHNXaXRoKCJTUDB6TWVudU1ha2VyX21lbnUiKSkgewogICAgICBpZiAoYmxvY2sgJiYgdHJlZSAmJiBibG9jay5jaGlsZEJsb2Nrc18pIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrLmNoaWxkQmxvY2tzXy5sZW5ndGg7IGkrKykgewogICAgICAgICAgY29uc3QgY2hpbGQgPSBibG9jay5jaGlsZEJsb2Nrc19baV07CiAgICAgICAgICBpZiAoY2hpbGQudHlwZS5zdGFydHNXaXRoKCJTUDB6TWVudU1ha2VyX21lbnUiKSkgdXBkYXRlTWVudUNvbG9yKGNoaWxkLmlkLCBtYWluV29ya3NwYWNlLCBmYWxzZSk7CiAgICAgICAgICBlbHNlIGlmIChjaGlsZC5jaGlsZEJsb2Nrc18pIHVwZGF0ZU1lbnVDb2xvcihjaGlsZC5pZCwgbWFpbldvcmtzcGFjZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhcmVudCA9IGJsb2NrLnBhcmVudEJsb2NrXzsKICAgIGNvbnN0IGJveCA9IGJsb2NrLmlucHV0TGlzdFswXT8uZmllbGRSb3dbMF0/LmJveF87CiAgICBpZiAoIWJveCkgcmV0dXJuOwogICAgaWYgKHBhcmVudCkgewogICAgICBibG9jay5zZXRDb2xvdXIocGFyZW50LmNvbG91cl8sIHBhcmVudC5jb2xvdXJTZWNvbmRhcnlfLCBwYXJlbnQuY29sb3VyVGVydGlhcnlfKTsKICAgICAgYm94LnNldEF0dHJpYnV0ZSgiZmlsbCIsIHBhcmVudC5jb2xvdXJfKTsKICAgICAgYm94LnNldEF0dHJpYnV0ZSgic3Ryb2tlIiwgcGFyZW50LmNvbG91clRlcnRpYXJ5Xyk7CiAgICB9IGVsc2UgewogICAgICBibG9jay5zZXRDb2xvdXIoIiMwRkJEOEMiLCAiIzBlYWE3ZSIsICIjMGM5NzcwIik7CiAgICAgIGJveC5zZXRBdHRyaWJ1dGUoImZpbGwiLCAiIzBGQkQ4QyIpOwogICAgICBib3guc2V0QXR0cmlidXRlKCJzdHJva2UiLCAiIzBjOTc3MCIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkgewogICAgaWYgKFNjcmF0Y2guZ3VpKSBTY3JhdGNoLmd1aS5nZXRCbG9ja2x5KCkudGhlbihTQiA9PiB7CiAgICAgIGNvbnN0IG1haW5Xb3Jrc3BhY2UgPSBTQi5tYWluV29ya3NwYWNlOwogICAgICBjb25zdCB3b3Jrc3BhY2VFdmVudHMgPSAoZSkgPT4gewogICAgICAgIGlmIChlLnR5cGUgPT0gU0IuRXZlbnRzLkVORF9EUkFHICYmIE9iamVjdC5oYXNPd24oZSwgImJsb2NrSWQiKSkgewogICAgICAgICAgaWYgKG1haW5Xb3Jrc3BhY2UuaWQgPT09IGUud29ya3NwYWNlSWQpIHVwZGF0ZU1lbnVDb2xvcihlLmJsb2NrSWQsIG1haW5Xb3Jrc3BhY2UsIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBtYWluV29ya3NwYWNlLmFkZENoYW5nZUxpc3RlbmVyKHdvcmtzcGFjZUV2ZW50cyk7CiAgICAgIGNvbnN0IHVwZGF0ZUFsbEJsb2NrcyA9ICgpID0+IHsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGJsb2NrXSBvZiBPYmplY3QuZW50cmllcyhtYWluV29ya3NwYWNlLmJsb2NrREJfKSkgdXBkYXRlTWVudUNvbG9yKGJsb2NrLmlkLCBtYWluV29ya3NwYWNlLCBmYWxzZSk7CiAgICAgIH07CiAgICAgIHZtLm9uKCJ3b3Jrc3BhY2VVcGRhdGUiLCB1cGRhdGVBbGxCbG9ja3MpOwogICAgICB1cGRhdGVBbGxCbG9ja3MoKTsKCSAgfSk7CiAgfQogIGZ1bmN0aW9uIHN0YXJ0TGlzdGVuZXJXb3JrZXIoKSB7CiAgICBpZiAodHlwZW9mIFJlZHV4U3RvcmUgPT09ICJ1bmRlZmluZWQiKSByZXR1cm47CiAgICBjb25zdCBjaGVja0luRWRpdG9yID0gKCkgPT4gIVJlZHV4U3RvcmUuZ2V0U3RhdGUoKS5zY3JhdGNoR3VpLm1vZGUuaXNQbGF5ZXJPbmx5OwogICAgbGV0IGluRWRpdG9yID0gY2hlY2tJbkVkaXRvcigpOwogICAgaWYgKGluRWRpdG9yKSBhdHRhY2hFdmVudHMoKTsKICAgIFJlZHV4U3RvcmUuc3Vic2NyaWJlKCgpID0+IHsKICAgICAgY29uc3QgY3VycmVudGx5SW5FZGl0b3IgPSBjaGVja0luRWRpdG9yKCk7CiAgICAgIGlmIChpbkVkaXRvciAhPT0gY3VycmVudGx5SW5FZGl0b3IpIHsKICAgICAgICBpbkVkaXRvciA9IGN1cnJlbnRseUluRWRpdG9yOwogICAgICAgIGlmIChpbkVkaXRvcikgYXR0YWNoRXZlbnRzKCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAodHlwZW9mIHNjYWZmb2xkaW5nID09PSAidW5kZWZpbmVkIikgc3RhcnRMaXN0ZW5lcldvcmtlcigpOwoKICBjbGFzcyBTUDB6TWVudU1ha2VyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBjb25zdCBzZWxmID0gdGhpczsgLy8gVG8gYXZvaWQgc2xvdyB3cml0ZXMgZXZlcnkgdGltZSBhIG1lbnUgaXMgY2hhbmdlZAogICAgICBjb25zdCBvbGRUb0pTT04gPSB2bS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9KU09OOwogICAgICB2bS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHsKICAgICAgICBpZiAoZXh0UmV2bW92YWJsZSkgcmV0dXJuIG9sZFRvSlNPTi5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICBpZiAoIWlzUE0pIHZtLnJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZS5TUDB6TWVudU1ha2VyID0gc2VsZi5zZXJpYWxpemUoKS5TUDB6TWVudU1ha2VyOwoKICAgICAgICAvLyBNYWtlIHRoZSBleHRlbnNpb24gc3RheSBieSBhZGRpbmcgYSBkdW1teSBibG9jawogICAgICAgIGNvbnN0IGJsb2NrcyA9IHJ1bnRpbWUudGFyZ2V0c1swXS5ibG9ja3M7CiAgICAgICAgYmxvY2tzLl9ibG9ja3NbVEVNUF9CTE9DS19PUENPREVdID0gewogICAgICAgICAgb3Bjb2RlOiBURU1QX0JMT0NLX09QQ09ERSwgaWQ6IFRFTVBfQkxPQ0tfT1BDT0RFLCBmaWVsZHM6IHt9LAogICAgICAgICAgbmV4dDogbnVsbCwgcGFyZW50OiBudWxsLCBzaGFkb3c6IGZhbHNlLCB0b0xldmVsOiB0cnVlLAogICAgICAgICAgeDogdW5kZWZpbmVkLCB5OiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgY29uc3QganNvblN0ciA9IG9sZFRvSlNPTi5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICAvLyBCbG9jayBJRHMgbWF5IGhhdmUgYmVlbiBjb21wcmVzc2VkIGF0IHRoaXMgcG9pbnQKICAgICAgICBjb25zdCB0ZW1wQmxvY2tJZCA9IE9iamVjdC52YWx1ZXMoYmxvY2tzLl9ibG9ja3MpLmZpbmQobyA9PiBvLm9wY29kZSA9PT0gVEVNUF9CTE9DS19PUENPREUpPy5pZDsKICAgICAgICBpZiAodGVtcEJsb2NrSWQpIGRlbGV0ZSBibG9ja3MuX2Jsb2Nrc1t0ZW1wQmxvY2tJZF07CiAgICAgICAgcmV0dXJuIGpzb25TdHI7CiAgICAgIH07CgogICAgICBjb25zdCBvbGRpbnN0YWxsVGFyZ2V0cyA9IHZtLmluc3RhbGxUYXJnZXRzOwogICAgICB2bS5pbnN0YWxsVGFyZ2V0cyA9IGZ1bmN0aW9uICguLi5hcmdzKSB7CiAgICAgICAgLy8gUmVtb3ZlIHRoZSBkdW1teSBibG9jawogICAgICAgIGlmIChhcmdzWzBdICYmIGFyZ3NbMF1bMF0pIHsKICAgICAgICAgIGNvbnN0IHRlbXBCbG9ja0lkID0gT2JqZWN0LnZhbHVlcyhhcmdzWzBdWzBdLmJsb2Nrcy5fYmxvY2tzKS5maW5kKG8gPT4gby5vcGNvZGUgPT09IFRFTVBfQkxPQ0tfT1BDT0RFKT8uaWQ7CiAgICAgICAgICBpZiAodGVtcEJsb2NrSWQpIGRlbGV0ZSBhcmdzWzBdWzBdLmJsb2Nrcy5fYmxvY2tzW3RlbXBCbG9ja0lkXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9sZGluc3RhbGxUYXJnZXRzLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICB9OwoKICAgICAgLy8gTG9hZCB0aGUgbWVudXMKICAgICAgdGhpcy5yZWZyZXNoU3RvcmFnZSgpOwogICAgICB2bS5ydW50aW1lLm9uKCJQUk9KRUNUX0xPQURFRCIsICgpID0+IHsKICAgICAgICBjb25zdCByZWZyZXNoV29ya3NwYWNlID0gdm0ucmVmcmVzaFdvcmtzcGFjZTsKICAgICAgICB2bS5yZWZyZXNoV29ya3NwYWNlID0gKCkgPT4ge307CiAgICAgICAgdGhpcy5yZWZyZXNoU3RvcmFnZSgpOwogICAgICAgIHZtLmV4dGVuc2lvbk1hbmFnZXIucmVmcmVzaEJsb2NrcygpOwogICAgICAgIHZtLnJlZnJlc2hXb3Jrc3BhY2UgPSByZWZyZXNoV29ya3NwYWNlOwogICAgICAgIHZtLm9uY2UoIkJFRk9SRV9FWEVDVVRFIiwgKCkgPT4gdm0ucmVmcmVzaFdvcmtzcGFjZSgpKTsKICAgIAl9KTsKICAgIH0KCiAgICByZWZyZXNoU3RvcmFnZSgpIHsgLy8gVHVyYm9XYXJwIHN1cHBvcnQKICAgICAgaWYgKCFpc1BNKSB0aGlzLmRlc2VyaWFsaXplKHZtLnJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZSk7CiAgICB9CiAgICBnZXRJbmZvKCkgewogICAgICAvLyBVc2VkIHRvIExvYWQgdGhlIE1lbnVzCiAgICAgIGlmICh0aGlzLm5lZWRzUmVmcmVzaCkgewogICAgICAgIHRoaXMubmVlZHNSZWZyZXNoID0gZmFsc2U7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZWZyZXNoTWFnaWMoKSwgMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogIlNQMHpNZW51TWFrZXIiLAogICAgICAgIG5hbWU6ICJEcm9wZG93biBNYWtlciIsCiAgICAgICAgbWVudUljb25VUkksCiAgICAgICAgYmxvY2tzOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIGZ1bmM6ICJtYWtlTWVudSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQlVUVE9OLAogICAgICAgICAgICB0ZXh0OiAiT3BlbiBNZW51IEVkaXRvciIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGZ1bmM6ICJyZW1vdmVFeHQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJVVFRPTiwKICAgICAgICAgICAgdGV4dDogIlJlbW92ZSB0aGlzIEV4dGVuc2lvbiIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImltcG9ydE1lbnVzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAiaW1wb3J0IGN1c3RvbSBkcm9wZG93biBKU09OIFtNRU5VU10iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBNRU5VUzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsgIm15TWVudS0xIjogeyAiaXRlbXMiOiBbeyAidGV4dCI6ICJvbmUiLCAidmFsdWUiOiAiMSIgfV0gfSB9YCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImV4cG9ydE1lbnVzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImN1c3RvbSBkcm9wZG93bnMgSlNPTiIKICAgICAgICAgIH0sCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6ICJNeSBNZW51cyIgfSwKICAgICAgICAgIHsgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5YTUwsIHhtbDogbWVudXNYTUwgfQogICAgICAgIF0sCiAgICAgICAgbWVudXM6IGN1c3RvbU1lbnVzLAogICAgICB9OwogICAgfQoKICAgIG1ha2VNZW51KCkgeyBpbml0TWVudU1ha2VyKCkgfQoKICAgIHJlbW92ZUV4dCgpIHsKICAgICAgZXh0UmV2bW92YWJsZSA9IHRydWU7CiAgICAgIGNvbnN0IGRlbGV0ZUJsb2NrID0gKHRhcmdldCwgYmxvY2tJZCkgPT4gewogICAgICAgIGlmICh0YXJnZXQgPT09IHZtLmVkaXRpbmdUYXJnZXQgJiYgU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IFNCLmdldE1haW5Xb3Jrc3BhY2UoKS5nZXRCbG9ja0J5SWQoYmxvY2tJZCk/LmRpc3Bvc2UodHJ1ZSwgZmFsc2UpKTsKICAgICAgICBlbHNlIHRhcmdldC5ibG9ja3MuZGVsZXRlQmxvY2soYmxvY2tJZCk7CiAgICAgIH07CiAgICAgIGN1c3RvbU1lbnVzID0ge307CiAgICAgIG1lbnVzWE1MID0gYDxsYWJlbCB0ZXh0PSJUcnkgY3JlYXRpbmcgc29tZSBtZW51cyEiIC8+YDsKICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgcnVudGltZS50YXJnZXRzKSB7CiAgICAgICAgZm9yIChjb25zdCBibG9jayBvZiBPYmplY3QudmFsdWVzKHRhcmdldC5ibG9ja3MuX2Jsb2NrcykpIHsKICAgICAgICAgIGlmIChibG9jay5vcGNvZGUuc3RhcnRzV2l0aCgiU1Awek1lbnVNYWtlcl8iKSkgZGVsZXRlQmxvY2sodGFyZ2V0LCBibG9jay5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZtLmV4dGVuc2lvbk1hbmFnZXIucmVmcmVzaEJsb2NrcygpOwogICAgICBhbGVydCgiU2F2ZSBhbmQgcmVsb2FkIHRoZSBwcm9qZWN0IGZvciB0aGUgZXh0ZW5zaW9uIHRvIGZ1bGx5IGJlIHJlbW92ZWQuIik7CiAgICB9CgogICAgaW1wb3J0TWVudXMoYXJncykgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IG1lbnVzID0gSlNPTi5wYXJzZShhcmdzLk1FTlVTKTsKICAgICAgICBpZiAodHlwZW9mIG1lbnVzICE9PSAib2JqZWN0IiB8fCBtZW51cyA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KG1lbnVzKSkgcmV0dXJuIGFsZXJ0KCJJbXBvcnRlZCBKU09OIE11c3QgYmUgYW4gT2JqZWN0Iik7CiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbWVudXMpIHsKICAgICAgICAgIGlmIChoYXNPd24obWVudXMsIGtleSkpIHsKICAgICAgICAgICAgY29uc3QgaW5uZXJPYmplY3QgPSBtZW51c1trZXldOwogICAgICAgICAgICBpZiAoIWhhc093bihpbm5lck9iamVjdCwgIml0ZW1zIikpIHJldHVybiBhbGVydChgJHtrZXl9IE1lbnUgTmVlZHMgYW4gIml0ZW1zIiBLZXlgKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpbm5lcktleSBpbiBpbm5lck9iamVjdCkgewogICAgICAgICAgICAgIGlmIChoYXNPd24oaW5uZXJPYmplY3QsIGlubmVyS2V5KSAmJiBpbm5lcktleSAhPT0gIml0ZW1zIikgZGVsZXRlIGlubmVyT2JqZWN0W2lubmVyS2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtZW51c1trZXldLmFjY2VwdFJlcG9ydGVycyA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBpdGVtcyA9IGlubmVyT2JqZWN0Lml0ZW1zOwogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaXRlbXMpKSByZXR1cm4gYWxlcnQoYCJpdGVtcyIga2V5IGluICR7a2V5fSBNZW51IE11c3QgYmUgYW4gQXJyYXlgKTsKICAgICAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGFsZXJ0KGAiaXRlbXMiIGtleSBpbiAke2tleX0gTWVudSBNdXN0IGhhdmUgYXQgTGVhc3QgMSBJdGVtYCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gIm9iamVjdCIgfHwgaXRlbSA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KGl0ZW0pKSByZXR1cm4gYWxlcnQoYGl0ZW1zIGluICJpdGVtcyIga2V5IGluICR7a2V5fSBNZW51IE11c3QgYmUgT2JqZWN0c2ApOwogICAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhpdGVtKTsKICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggIT09IDIgfHwgIWtleXMuaW5jbHVkZXMoInRleHQiKSB8fCAha2V5cy5pbmNsdWRlcygidmFsdWUiKSkgcmV0dXJuIGFsZXJ0KGBpdGVtcyBpbiAiaXRlbXMiIGtleSBpbiAke2tleX0gTWVudSBNdXN0IGhhdmUgMiBrZXlzLCAidGV4dCIgYW5kICJ2YWx1ZSJgKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0udGV4dCAhPT0gInN0cmluZyIgfHwgdHlwZW9mIGl0ZW0udmFsdWUgIT09ICJzdHJpbmciKSByZXR1cm4gYWxlcnQoYCJpdGVtIiB2YWx1ZXMgaW4gJHtrZXl9IE1lbnUgTXVzdCBiZSBTdHJpbmdzYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3VzdG9tTWVudXMgPSBtZW51czsKICAgICAgICByZWZyZXNoTWFnaWMoKTsKICAgICAgICAvLyBSZW1vdmUgTWVudSBCbG9ja3MgdGhhdCBubyBMb25nZXIgRXhpc3QKICAgICAgICBjb25zdCBhbGxCbG9ja3MgPSBTY3JhdGNoQmxvY2tzLm1haW5Xb3Jrc3BhY2UuYmxvY2tEQl87CiAgICAgICAgY29uc3QgbWVudU5hbWVzID0gT2JqZWN0LmtleXMoY3VzdG9tTWVudXMpOwogICAgICAgIGZvciAoY29uc3QgW2tleSwgYmxvY2tdIG9mIE9iamVjdC5lbnRyaWVzKGFsbEJsb2NrcykpIHsKICAJICAgICAgaWYgKGJsb2NrLnR5cGUuc3RhcnRzV2l0aCgiU1Awek1lbnVNYWtlcl9tZW51XyIpKSB7CiAgCSAgICAgCSAgaWYgKG1lbnVOYW1lcy5pbmRleE9mKGJsb2NrLnR5cGUucmVwbGFjZSgiU1Awek1lbnVNYWtlcl9tZW51XyIsICIiKSkgPT09IC0xKSBibG9jay5kaXNwb3NlKCk7CiAgCSAgICAgIH0KCQkgICAgfQogICAgICB9IGNhdGNoIHsgYWxlcnQoIkNvdWxkbnQgUGFyc2UgSW1wb3J0ZWQgQ3VzdG9tIE1lbnUgSlNPTiIpIH0KICAgIH0KCiAgICBleHBvcnRNZW51cygpIHsgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGN1c3RvbU1lbnVzKSB9CgogICAgLy8gUGVuZ3Vpbk1vZCArIEludGVybWVkaWFyeVRXIFN0b3JhZ2UKICAgIHNlcmlhbGl6ZSgpIHsgcmV0dXJuIHsgU1Awek1lbnVNYWtlciA6IHsgbWVudXMgOiBjdXN0b21NZW51cyB9IH0gfQogICAgZGVzZXJpYWxpemUoZGF0YSkgewogICAgICBpZiAoZGF0YS5TUDB6TWVudU1ha2VyICE9PSB1bmRlZmluZWQpIGN1c3RvbU1lbnVzID0gZGF0YS5TUDB6TWVudU1ha2VyLm1lbnVzOwogICAgICBlbHNlIHN0YXJ0TGlzdGVuZXJXb3JrZXIoKTsKICAgICAgdGhpcy5uZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgfQogIH0KICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIoKGV4dGVuc2lvbkluc3RhbmNlID0gbmV3IFNQMHpNZW51TWFrZXIoKSkpOwogIGlmIChpc1BNICYmIHR5cGVvZiBzY2FmZm9sZGluZyA9PT0gInVuZGVmaW5lZCIpIHsKICAgIHJlZnJlc2hNYWdpYygpOwogICAgc3RhcnRMaXN0ZW5lcldvcmtlcigpOwogIH0KfSkoU2NyYXRjaCk7Cg==","data:text/javascript;base64,Ly8gTmFtZTogTXkgQmxvY2tzKwovLyBJRDogU1BtYnBDU1QKLy8gRGVzY3JpcHRpb246IENyZWF0ZSBCZXR0ZXIgQ3VzdG9tIEJsb2NrcwovLyBCeTogU2hhcmtQb29sCi8vIEJ5OiBDU1QxMjI5IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy9DU1QxMjI5Lz4KLy8gQnk6IDB6bnp3IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy8wem56dy8+Ci8vIExpY2Vuc2U6IE1JVAoKLy8gVmVyc2lvbiBWLjEuMi4zMQoKKGZ1bmN0aW9uKFNjcmF0Y2gpIHsKICAidXNlIHN0cmljdCI7CiAgaWYgKCFTY3JhdGNoLmV4dGVuc2lvbnMudW5zYW5kYm94ZWQpIHRocm93IG5ldyBFcnJvcigiTXkgQmxvY2tzKyBtdXN0IHJ1biB1bnNhbmRib3hlZCEiKTsKCiAgY29uc3QgbWVudUljb25VUkkgPQogICAgImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJME55NDVORGdpSUdobGFXZG9kRDBpTkRjdU9UUTRJaUIyYVdWM1FtOTRQU0l3SURBZ05EY3VPVFE0SURRM0xqazBPQ0krUEhCaGRHZ2daRDBpVFRBZ01qTXVPVGMwUXpBZ01UQXVOek0wSURFd0xqY3pNeUF3SURJekxqazNOQ0F3Y3pJekxqazNOQ0F4TUM0M016TWdNak11T1RjMElESXpMamszTkMweE1DNDNNek1nTWpNdU9UYzBMVEl6TGprM05DQXlNeTQ1TnpSVE1DQXpOeTR5TVRVZ01DQXlNeTQ1TnpRaUlHWnBiR3c5SWlOall6VXlOallpTHo0OGNHRjBhQ0JrUFNKTk1pNHlNVEVnTWpNdU9UYzBZekF0TVRJdU1ESWdPUzQzTkRRdE1qRXVOell6SURJeExqYzJNeTB5TVM0M05qTnpNakV1TnpZeklEa3VOelEwSURJeExqYzJNeUF5TVM0M05qTXRPUzQzTkRRZ01qRXVOell6TFRJeExqYzJNeUF5TVM0M05qTlRNaTR5TVRFZ016VXVPVGt6SURJdU1qRXhJREl6TGprM05DSWdabWxzYkQwaUkyWm1Oalk0TUNJdlBqeHdZWFJvSUdROUlrMHpPUzR4TlRJZ01UUXVORFUxZGpFNUxqQXpPR0V4TGpFeUlERXVNVElnTUNBd0lERXRMalkxSURFdU1ERTViQzB4TkM0MU5UZ2dOaTQzTVRsaE1TNHhNaUF4TGpFeUlEQWdNQ0F4TFM0NU5DQXdiQzB4TkM0MU5UZ3ROaTQzTW1FeExqRXlJREV1TVRJZ01DQXdJREV0TGpZMUxURXVNREU0VmpFMExqUTFOR0V4TGpFeUlERXVNVElnTUNBd0lERWdMalkxTFRFdU1ERTViREUwTGpVMU9DMDJMamN4T1dFeExqRXlJREV1TVRJZ01DQXdJREVnTGprMElEQnNNVFF1TlRVNElEWXVOekpqTGpNNU55NHhPRE11TmpVeExqVTRMalkxSURFdU1ERTRiUzB5Tnk0MU5pQXdJREV4TGpnNE1pQTFMalE0T0NBeE1TNDRPREl0TlM0ME9EZ3RNVEV1T0RneUxUVXVORGczZW0wdE1TNDFOVFlnTVRndU16SXhJREV5TGpNeE9DQTFMalk0T1ZZeU1TNDRPV3d0TVRJdU16RTRMVFV1TmpnNWVtMHlOaTQ0TnpZZ01GWXhOaTR5TURGc0xURXlMak14T0NBMUxqWTVkakUyTGpVM00zb2lJR1pwYkd3OUlpTm1abVlpTHo0OGNHRjBhQ0JrUFNKTk16SXVNelEySURNMkxqRTJPWFl0TWk0Mk56aG9MVEl1TmpjNFl5MHhMak0yTlNBd0xUSXVORGN5TFM0NU5UTXRNaTQwTnpJdE1pNHhNamh6TVM0eE1EY3RNaTR4TWpnZ01pNDBOekl0TWk0eE1qaG9NaTQyTnpoMkxUSXVOamM0WXpBdE1TNHpOalV1T1RVekxUSXVORGN5SURJdU1USTRMVEl1TkRjeWN6SXVNVEk0SURFdU1UQTNJREl1TVRJNElESXVORGN5ZGpJdU5qYzRhREl1TmpjNFl6RXVNelkxSURBZ01pNDBOekl1T1RVeUlESXVORGN5SURJdU1USTRJREFnTVM0eE56VXRNUzR4TURjZ01pNHhNamd0TWk0ME56SWdNaTR4TWpob0xUSXVOamM0ZGpJdU5qYzRZekFnTVM0ek5qVXRMamsxTXlBeUxqUTNNaTB5TGpFeU9DQXlMalEzTW5NdE1pNHhNamd0TVM0eE1EY3RNaTR4TWpndE1pNDBOeko2SWlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVOUlpTm1aalkyT0RBaUlITjBjbTlyWlMxM2FXUjBhRDBpTkNJdlBqeHdZWFJvSUdROUlrMHpNaTR6TkRZZ016WXVNVFk1ZGkweUxqWTNPR2d0TWk0Mk56aGpMVEV1TXpZMUlEQXRNaTQwTnpJdExqazFNeTB5TGpRM01pMHlMakV5T0hNeExqRXdOeTB5TGpFeU9TQXlMalEzTWkweUxqRXlPV2d5TGpZM09IWXRNaTQyTnpkak1DMHhMak0yTlM0NU5UTXRNaTQwTnpJZ01pNHhNamd0TWk0ME56SnpNaTR4TWpnZ01TNHhNRGNnTWk0eE1qZ2dNaTQwTnpKMk1pNDJOemRvTWk0Mk56aGpNUzR6TmpVZ01DQXlMalEzTWk0NU5UTWdNaTQwTnpJZ01pNHhNamtnTUNBeExqRTNOUzB4TGpFd055QXlMakV5T0MweUxqUTNNaUF5TGpFeU9HZ3RNaTQyTnpoMk1pNDJOemhqTUNBeExqTTJOUzB1T1RVeUlESXVORGN5TFRJdU1USTRJREl1TkRjeUxURXVNVGMxSURBdE1pNHhNamd0TVM0eE1EY3RNaTR4TWpndE1pNDBOeklpSUdacGJHdzlJaU5tWm1ZaUx6NDhMM04yWno0PSI7CgogIGNvbnN0IGd1aVVSSXMgPSAobmFtZSkgPT4gewogICAgY29uc3Qgc3RhcnQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kiOwogICAgcmV0dXJuIHN0YXJ0ICsgewogICAgICAiZHJvcGR3biI6ICIxTnlJZ2FHVnBaMmgwUFNJME9TSWdkbWxsZDBKdmVEMGlNQ0F3SURVM0lEUTVJajQ4WnlCemRISnZhMlV0YldsMFpYSnNhVzFwZEQwaU1UQWlQanh3WVhSb0lHUTlJazAwTGpVZ05EZ3VOV0UwSURRZ01DQXdJREV0TkMwMGRpMDBNR0UwSURRZ01DQXdJREVnTkMwMGFEUTRZVFFnTkNBd0lEQWdNU0EwSURSMk5EQmhOQ0EwSURBZ01DQXhMVFFnTkhvaUlHWnBiR3c5SWlObVpqWTJPREFpSUhOMGNtOXJaVDBpSTJZek5TSXZQanh3WVhSb0lHUTlJazB4TWk0eE1qTWdNemt1T0ROakxURXVOVEEzSURBdE1pNDNNeTB4TGpFME5DMHlMamN6TFRJdU5UVTFkaTB5TlM0MU5XTXdMVEV1TkRFeElERXVNakl6TFRJdU5UVTFJREl1TnpNdE1pNDFOVFZvTXpJdU56VTBZekV1TlRBM0lEQWdNaTQzTXlBeExqRTBOQ0F5TGpjeklESXVOVFUxZGpJMUxqVTFZekFnTVM0ME1URXRNUzR5TWpNZ01pNDFOVFV0TWk0M015QXlMalUxTlhvaUlHWnBiR3c5SWlObVpqUmtObUVpSUhOMGNtOXJaVDBpSTJZek5TSXZQanh3WVhSb0lHUTlJazB6Tmk0d09EUWdNakl1TVRZM1lUSXVPRGdnTWk0NE9DQXdJREFnTVMwdU9EUTRJREl1TURVemJDMDBMalkzTnlBMExqWTNOMkV5TGpreU5DQXlMamt5TkNBd0lEQWdNUzAwTGpFeE9DQXdiQzAwTGpZMk5TMDBMalkzTjJFeUxqa2dNaTQ1SURBZ01DQXhMUzQ0TmkweUxqQTFNeUF5TGprMklESXVPVFlnTUNBd0lERWdMamcwT0MweUxqQTJOR011TXpRMkxTNHlPRGN1T0RVNUxTNDRORGdnTmk0M05ESXRMamcwT0hNMkxqUXpNaTQxTlNBMkxqY3pMamcwT0dNdU5UUTJMalUwT0M0NE5TQXhMakk1TGpnME9DQXlMakEyTkNJZ1ptbHNiRDBpSTJZek5TSXZQanh3WVhSb0lHUTlJazB5T0M0MU1EWWdNamd1TlRVeFlURXVOeUF4TGpjZ01DQXdJREV0TVM0eE9UTXRMalZzTFRRdU56QXlMVFF1TmpjNVlURXVOeklnTVM0M01pQXdJREFnTVNBd0xUSXVNemcyWXk0Mk5qZ3RMalkyT1NBeE1TNHhNUzB1TmpZNUlERXhMamMzT0NBd0lDNDJORE11TmpZMUxqWTBNeUF4TGpjeUlEQWdNaTR6T0Rac0xUUXVOamM0SURRdU5qYzRZeTB1TXpJdU16SXRMamMxTXk0MUxURXVNakExTGpVd01TSWdabWxzYkQwaUkyWm1aaUl2UGp3dlp6NDhMM04yWno0PSIsCiAgICAgICJjb2xvclBrciI6ICJ5TUNJZ2FHVnBaMmgwUFNJeU1DSWdkbWxsZDBKdmVEMGlMVElnTFRNZ01qQWdNakFpUGp4d1lYUm9JR1E5SWsweE1TNHdOalFnTlM0MU5qSWdPUzQwTURrZ015NDVNRGhzTFRNdU9UUWdNeTQ1TW1NdExqRXlMakV6TnkwdU1qQTFMakkzTkMwdU1qUXVOREV0TGpFNE55NDROVEl0TGpneE9DQXhMalV0TVM0MU1UY2dNUzQzTWpKaE1TQXhJREFnTUNBd0xTNDFPQzQxTVRGc0xTNDRNellnTVM0M09XTXRMakExTVM0eE1pMHVNRFV4TGpFNE9DMHVNRFV4TGpJd05Xd3VNamN6TGpJMU5XRXVOaTQySURBZ01DQXdJQzR4T0RjdExqQTFiREV1TnpjMExTNDRNelpqTGpJMExTNHhNaTQwTmkwdU16VTRMalV6TFM0MU9DNHlNRFF0TGpZNU9TNDROeTB4TGpNeklERXVOVFk0TFRFdU5EZ3pMakkzTXkwdU1EWTRMalF5TnkwdU1UVXpMalUwTmkwdU1qbDZiVEl1TURNdE1TNDNPUzR4TXpZdU1UTTJMalU0TGpVNFlTNDRPRFF1T0RnMElEQWdNQ0F4SURBZ01TNHlORFJzTFM0Mk5qVXVOalE0WVM0NE5EY3VPRFEzSURBZ01DQXhMVEV1TVRZdU1EWTRiQzB6TGprMU9DQXpMamt6T0dFeUxqQTNJREl1TURjZ01DQXdJREV0TVM0d01EWXVOVGszWXkwdU5ERXVNRGcxTFM0M01UWXVNemMxTFM0M09EVXVOalEzTFM0eE55NDFOak10TGpZME9DQXhMakE1TVMweExqSXhJREV1TXpZMGJDMHhMamM1TWk0NE16WmpMUzR5TXprdU1UQXlMUzQwT1RVdU1UY3RMamN4Tmk0eE4yRXhMaklnTVM0eUlEQWdNQ0F4TFM0NE55MHVNelJzTFM0ek5ERXRMak0wTW1NdExqTTNOaTB1TXpreUxTNDBORFF0TVM0d01EWXRMakUzTVMweExqWXdNbXd1T0RNMkxURXVOemN6WXk0eU5UWXRMalUyTXk0NE1ESXRNUzR3TkNBeExqTTJOQzB4TGpJeExqSTNNeTB1TURnMkxqVTJNeTB1TXpjMkxqWXhOUzB1TmpNeExqRXhPUzB1TlRFeUxqTXlOQzB1T0RjdU5qRTBMVEV1TVRjM2JETXVPVFUzTFRNdU9UTTNZeTB1TWprdExqTTBNUzB1TWpjekxTNDRNell1TURVeExURXVNVGMzYkM0Mk5qVXRMalkwT0dFdU9EZzJMamc0TmlBd0lEQWdNU0F4TGpJME5pQXdiQzQxTkRZdU5UUTJMakUzTGpFM1RERXlMalk0TkM0ek9UWmhNUzR6TXlBeExqTXpJREFnTUNBeElERXVPRGswSURCakxqSTFOaTR5TlRZdU16a3lMalU1Tnk0ek9USXVPVE00Y3kwdU1UTTJMalk1T1MwdU16a3lMamsxTlhvaUlHWnBiR3c5SW01dmJtVWlJSE4wY205clpTMXZjR0ZqYVhSNVBTSXVNalVpSUhOMGNtOXJaVDBpSXpBd01DSWdjM1J5YjJ0bExYZHBaSFJvUFNJeklpOCtQSEJoZEdnZ1pEMGlUVEV4TGpBMk5DQTFMalUyTWlBNUxqUXdPU0F6TGprd09Hd3RNeTQ1TkNBekxqa3lZeTB1TVRJdU1UTTNMUzR5TURVdU1qYzBMUzR5TkM0ME1TMHVNVGczTGpnMU1pMHVPREU0SURFdU5TMHhMalV4TnlBeExqY3lNbUV4SURFZ01DQXdJREF0TGpVNExqVXhNV3d0TGpnek5pQXhMamM1WXkwdU1EVXhMakV5TFM0d05URXVNVGc0TFM0d05URXVNakExYkM0eU56TXVNalUxWVM0MkxqWWdNQ0F3SURBZ0xqRTROeTB1TURWc01TNDNOelF0TGpnek5tTXVNalF0TGpFeUxqUTJMUzR6TlRndU5UTXRMalU0TGpJd05DMHVOams1TGpnM0xURXVNek1nTVM0MU5qa3RNUzQwT0RNdU1qY3lMUzR3TmpndU5ESTJMUzR4TlRNdU5UUTFMUzR5T1hwdE1pNHdNeTB4TGpjNUxqRXpOaTR4TXpZdU5UZ3VOVGhoTGpnNE5DNDRPRFFnTUNBd0lERWdNQ0F4TGpJME5Hd3RMalkyTlM0Mk5EaGhMamcwTnk0NE5EY2dNQ0F3SURFdE1TNHhOaTR3Tmpoc0xUTXVPVFU0SURNdU9UTTRZVEl1TURjZ01pNHdOeUF3SURBZ01TMHhMakF3Tmk0MU9UZGpMUzQwTVM0d09EVXRMamN4Tmk0ek56VXRMamM0TlM0Mk5EY3RMakUzTGpVMk15MHVOalE0SURFdU1Ea3hMVEV1TWpFZ01TNHpOalJzTFRFdU56a3lMamd6Tm1NdExqSXpPUzR4TURJdExqUTVOUzR4TnkwdU56RTJMakUzWVRFdU1pQXhMaklnTUNBd0lERXRMamczTFM0ek5ERnNMUzR6TkRFdExqTTBZeTB1TXpjMkxTNHpPVE10TGpRME5DMHhMakF3TnkwdU1UY3hMVEV1TmpBemJDNDRNell0TVM0M056TmpMakkxTmkwdU5UWXpMamd3TWkweExqQTBJREV1TXpZMExURXVNakV1TWpjekxTNHdPRFl1TlRZekxTNHpOell1TmpFMUxTNDJNekV1TVRFNUxTNDFNVEl1TXpJMExTNDROeTQyTVRRdE1TNHhOemRzTXk0NU5UY3RNeTQ1TXpoakxTNHlPUzB1TXpRdExqSTNNeTB1T0RNMUxqQTFNUzB4TGpFM05td3VOalkyTFM0Mk5EaGhMamc0Tmk0NE9EWWdNQ0F3SURFZ01TNHlORFVnTUd3dU5UUTJMalUwTmk0eE55NHhOMHd4TWk0Mk9EUXVNemsyWVRFdU16TWdNUzR6TXlBd0lEQWdNU0F4TGpnNU5DQXdZeTR5TlRZdU1qVTJMak01TWk0MU9UY3VNemt5TGprek9ITXRMakV6Tmk0Mk9Ua3RMak01TWk0NU5UVjZJaUJtYVd4c1BTSWpabVptSWk4K1BDOXpkbWMrIiwKICAgICAgImJyYW5jaFN0YXJ0IjogInlNQzR6T1RraUlHaGxhV2RvZEQwaU1qRXVOREl5SWlCMmFXVjNRbTk0UFNJd0lEQWdNakF1TXprNUlESXhMalF5TWlJK1BIQmhkR2dnWkQwaVRURXpMalkxSURFMkxqYzBObU10TGpZMU5TMHVNamd0TVMwdU9TMHhMVEV1TlhZdE1TNDJZeTB4TGpNdExqRXRNaTQxTFM0MUxUTXVOaTB4TGpGc0xTNHhORFl0TGpBM09HTXVNRFUwTGpZME5pNHdPRGNnTVM0d09DNHdPVFlnTVM0eU1EUm9NUzQyWXk0MklEQWdNUzR5TVRndU16UWdNUzQxSURGekxqQTVOaUF4TGpFNE5pMHVNeUF4TGpoakxTNHdOak11TURrNExUUXVOU0EwTGpVdE5DNDFJRFF1TlMwdU55NDJMVEV1Tnk0MkxUSXVOQ0F3YkMwMExqUXROQzQwWXkwdU15MHVNeTB1TlMwdU9DMHVOUzB4TGpJZ01DMHhJQzQ0TFRFdU55QXhMamN0TVM0M2FERXVOV013TFM0eE9ETXVNalU0TFRNdU9UZ3pMalE0TFRjdU5ERTJMakV5TXkweExqa3dPQzR5TXpVdE15NDNOekl1TWpnMUxUUXVOelk1TGpBeE15MHVNRFkyTGpBekxTNHlNREV1TURVeUxTNHlOalF1TVRZMExTNDNNRFl1T0RJeUxURXVNakVnTVM0Mk55MHhMakl4TGpnNExTNHhNaklnTVM0NE9ERXVOakUwSURFdU9TQXhMalkwY1M0d01qSXVNRFF5TGpBeU9DNHdOalZqTGpFMk5TNDROVFl1TXpJZ01TNDROVE11TkRZeUlESXVPUzR5Tnk0MU1EY3VOalE0TGprNE15NDVPREVnTVM0ME1qZ3VPQ0F4TGpFZ01pNHhPVEVnTVM0NElETXVOVGt4SURFdU9IWXRNUzQxWXpBdExqa3VOeTB4TGpjZ01TNDNMVEV1Tnk0MElEQWdMamt1TWlBeExqSXVOV3cwTGpRZ05DNDBZeTQyTGpjdU5pQXhMamNnTUNBeUxqUnNMVFF1TlNBMExqVnpMVEV1TVRRMUxqVTRMVEV1T0M0eklpQm1hV3hzTFc5d1lXTnBkSGs5SWk0eUlpOCtQSEJoZEdnZ1pEMGlUVFF1TmpZNUlESXVNRGM1UXpRdU5UZzFJREV1TkRneUlEVXVNRGszTGprd05TQTFMamd3Tnk0NU1EWmpMalU1TmkwdU1EZzBJREV1TWpjMkxqUXlPQ0F4TGpJM05TQXhMakV6T0NBd0lDNHdNVE11TVRFMElERXVNRFkzTGpJMklESXVOVGd6WVRjZ055QXdJREFnTUNBdU9USTFJREV1TnpjeFl5NDJMamtnTVM0MU9USWdNUzQySURJdU5qa3lJRElnTGprdU15QXhMamd1TkNBeUxqZ3VNbll0TWk0MFl6QXRMalF1TXkwdU55NDNMUzQzTGpJZ01DQXVNeTR4TGpRdU1tdzBMalFnTkM0MFl5NHpMak11TXk0M0lEQWdMamxzTFRRdU5DQTBMalJqTFM0ekxqTXRMalExT0M0ME16RXRMamd6TWk0ek5qbHpMUzR6TmpndExqVTJPUzB1TXpZNExTNDFOamwyTFRJdU5tTXRNUzQxSURBdE1pNDVMUzR6TFRRdU1pMHhZVGd1TXlBNExqTWdNQ0F3SURFdE1TNDFOeTB4TGpBeU5HTXVNVFV4SURJdU1UZzRMakkxTkNBekxqZzRNaTR5TlRRZ05DNHhORGhvTWk0MmN5NDBOakl1TURjMkxqVXVNeUF3SUM0MkxTNHpMamxzTFRRdU5DQTBMalJqTFM0eUxqTXRMall1TXkwdU9TQXdiQzAwTGpRdE5DNDBZeTB1TVMwdU1TMHVNaTB1TWkwdU1pMHVOQ0F3TFM0MExqTXRMamN1TnkwdU4yZ3lMak01T0dNdU1EVTBMVEV1TlRrM0xqRTBOUzAwTGpJeUxqSXpPUzAyTGpZMk5DNHdNaTB1TlRrdU1EUXhMVEV1TVRnMkxqQTJNeTB4TGpjM05uRXVNREF6TFM0d09Ua3VNREUxTFM0eE9USmpMakExTFRFdU1UZ3pMakl4TFRRdU1URXhMakl4TFRRdU1URXhJaUJtYVd4c1BTSWpabVptSWk4K1BDOXpkbWMrIiwKICAgICAgImFkZEltZyI6ICJ5TUNJZ2FHVnBaMmgwUFNJeU1DSWdkbWxsZDBKdmVEMGlNQ0F3SURJd0lESXdJajQ4WnlCbWFXeHNQU0p1YjI1bElpQm1hV3hzTFhKMWJHVTlJbVYyWlc1dlpHUWlQanhuSUhOMGNtOXJaVDBpSTBaR1JpSWdjM1J5YjJ0bExXeHBibVZqWVhBOUluSnZkVzVrSWlCemRISnZhMlV0ZDJsa2RHZzlJakV1TlNJK1BIQmhkR2dnWkQwaWJURTJMakUwTkNBeE1pNDNPQzB5TGpRMU9DMHlMalV6TVdFdU9UY3VPVGNnTUNBd0lEQXRNUzR6TkRjdExqQTJURGt1TWprMUlERXlMalkyWXkwdU5EWTVMak0yTWkweExqRXhNeTR6TURJdE1TNDBOalF0TGpFNGJDMHVNamt6TFM0ek5qTmpMUzR6TlMwdU5EZ3lMVEV1TURVekxTNDFORE10TVM0ME5qTXRMakU0VERNdU9EVWdNVE11T0RBMWFEQmpNQ0F1T0RVeUxqWTVJREV1TlRReklERXVOVFF6SURFdU5UUXphRGd1T0RGaE1pQXlJREFnTUNBd0lESXRNbll0TGpVMk9Ib2lJR1pwYkd3OUlpTkdSa1lpSUhOMGNtOXJaUzFzYVc1bGFtOXBiajBpY205MWJtUWlMejQ4Y0dGMGFDQmtQU0pOTVRZdU1qQXpJRGd1TVRoMk5TNHlPVFJqTUNBdU9UYzBMUzQzT1NBeExqYzJOQzB4TGpjMk5TQXhMamMyTkVnMUxqWXhOV010TGprM05TQXdMVEV1TnpZMUxTNDNPUzB4TGpjMk5TMHhMamMyTkhZdE55NHdObU13TFM0NU56UXVOemt0TVM0M05qUWdNUzQzTmpVdE1TNDNOalJvTnk0d05Ua2lMejQ4TDJjK1BIQmhkR2dnWkQwaVRURTJMamc1TnlBekxqazROV2d1TmpZeVlTNDJOakl1TmpZeUlEQWdNU0F4SURBZ01TNHpNalJvTFM0Mk5qSjJMalkyTW1FdU5qWXlMalkyTWlBd0lERWdNUzB4TGpNeU15QXdkaTB1TmpZeWFDMHVOall5WVM0Mk5qSXVOall5SURBZ01DQXhJREF0TVM0ek1qUm9MalkyTW5ZdExqWTJNV0V1TmpZeUxqWTJNaUF3SURBZ01TQXhMak15TXlBd2VpSWdabWxzYkQwaUkwWkdSaUl2UGp4d1lYUm9JSE4wY205clpUMGlJMFpHUmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l1TWlJZ1pEMGlUVEUyTGprME55QXpMamt6TldndU5qRXlZUzQzTVRJdU56RXlJREFnTVNBeElEQWdNUzQwTWpSc0xTNDJNVEl0TGpBMWRpNDJOakpoTGpjeE1pNDNNVElnTUNBeElERXRNUzQwTWpNZ01Hd3VNRFV0TGpZeE1tZ3RMalkyTW1FdU56RXlMamN4TWlBd0lERWdNU0F3TFRFdU5ESTBiQzQyTVRJdU1EVjJMUzQyTmpGaExqY3hNaTQzTVRJZ01DQXhJREVnTVM0ME1qTWdNSG9pTHo0OEwyYytQQzl6ZG1jKyIKICAgIH1bbmFtZV07CiAgfTsKICBjb25zdCBpbnB1dFVSSXMgPSAobmFtZSkgPT4gewogICAgbGV0IHN0YXJ0ID0gImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqIjsKICAgIGlmIChuYW1lID09PSAiYnJjIikgcmV0dXJuIHN0YXJ0ICsgIkl4TVM0MUlERTFOUzQxSURVM0lEUTVJajQ4Y0dGMGFDQmtQU0pOTWpFMklESXdOR0UwSURRZ01DQXdJREV0TkMwMGRpMDBNR0UwSURRZ01DQXdJREVnTkMwMGJEUTRMalkxTVM0d05UTkJOQ0EwSURBZ01DQXhJREkyT0NBeE5qQjJPQzR4TWpoak1DQXhMak10TWk0eE9EUWdNeTR6T0RNdE15NDROemNnTXk0ek9ETm9MVEV6TGprNE1tTXRNUzR4TURVZ01DMHhMalkxTnk0MU5USXRNaTR5TVNBeExqRXdOV3d0TWk0eU1Ea2dNaTR5TURsakxTNDFOVEl1TlRVeUxURXVNVEExSURFdU1UQTFMVEl1TWpFZ01TNHhNRFZvTFRZdU5qSTNZeTB4TGpFd05TQXdMVEV1TmpVM0xTNDFOVE10TWk0eU1TMHhMakV3Tld3dE1pNHlNRGt0TWk0eU1XTXRMalUxTWkwdU5UVXlMVEV1TVRBMUxURXVNVEEwTFRJdU1qRXRNUzR4TURSb0xUUXVOREU0WXkweExqSXlJREF0TWk0eU1TNDVPUzB5TGpJeElESXVNakYyTVRJdU5UVTBZekFnTVM0eU1pNDVPU0F5TGpJd09DQXlMakl4SURJdU1qQTRhRFF1TkRFNVl6RXVNVEEwSURBZ01TNDJOVGN1TlRVeklESXVNakVnTVM0eE1EVnNNaTR5TURnZ01pNHlNV011TlRVekxqVTFNaUF4TGpFd05TQXhMakV3TkNBeUxqSXhJREV1TVRBMGFEWXVOakk0WXpFdU1UQTBJREFnTVM0Mk5UY3RMalUxTWlBeUxqSXdPUzB4TGpFd05Xd3lMakl4TFRJdU1qQTVZeTQxTlRJdExqVTFNaUF4TGpFd05DMHhMakV3TlNBeUxqSXdPUzB4TGpFd05XZ3hNeTQ1T0RKak1TNDJPVE1nTUNBekxqZzNOeUF5TGpFd05DQXpMamczTnlBekxqVXdNbFl5TURCaE5DQTBJREFnTUNBeExUUWdOSG9pSUhOMGVXeGxQU0ptYVd4c09pTm1aalkyT0RBN2MzUnliMnRsT2lObU16VWlMejQ4TDNOMlp6ND0iOwogICAgZWxzZSBpZiAobmFtZSA9PT0gImltZyIpIHJldHVybiBzdGFydCArICJBZ01DQTFOeUEwT1NJK1BIQmhkR2dnWkQwaVRUUXVOU0EwT0M0MVlUUWdOQ0F3SURBZ01TMDBMVFIyTFRRd1lUUWdOQ0F3SURBZ01TQTBMVFJvTkRoaE5DQTBJREFnTUNBeElEUWdOSFkwTUdFMElEUWdNQ0F3SURFdE5DQTBlaUlnWm1sc2JEMGlJMlptTmpZNE1DSWdjM1J5YjJ0bFBTSWpaak0xSWk4K1BIQmhkR2dnWkQwaVRUTTVMak15SURFMkxqTTBNbll4TUM0ME1qUmpNQ0F1TkRVekxTNHhNVE11TnprekxTNDBOVE1nTVM0d01pMHpMakUzTWlBeUxqWXdOaTAzTGpneE9DQXlMall3TmkweE1TNHhNRE1nTUdFMkxqRTFJRFl1TVRVZ01DQXdJREF0TXk0NE5UTXRNUzR6Tm1NdE1TNDBOek11TVRFekxUSXVOekU1TGpZNExUTXVPRFV5SURFdU5EY3pkamN1TWpVeFl6QWdMalUyTnkwdU5UWTNJREV1TVRNekxURXVNVE16SURFdU1UTXphQzB1TVRFell5MHVOVFkzSURBdE1TNHhNek10TGpVMk5pMHhMakV6TXkweExqRXpNM1l0TWpFdU0yTXdMUzQyT0M0MU5qWXRNUzR4TXpRZ01TNHhNek10TVM0eE16UXVOVFkySURBZ01TNHhNek11TkRVMElERXVNVE16SURFdU1UTTBkaTQwTlROak15NHdOVGt0TVM0ME56TWdOaTQzT1RndE1TNHdNaUE1TGpRd05DQXhMakV6TTJFMkxqRTBJRFl1TVRRZ01DQXdJREFnTnk0M01EUWdNR011TXpRdExqTTBMamt3TnkwdU5EVXpJREV1TXpZdExqSXlOeTQxTmpZdU1URXpMamt3Tmk0MU5qY3VPVEEySURFdU1UTXpiUzB4TGpFek15QXdMUzR4TVRNdExqRXhNMmd0TGpJeU4yTXRNaTQzTVRrZ01pNHhOVE10Tmk0ME5UZ2dNaTR4TlRNdE9TNHhOemNnTUMweUxqUTVNeTB4TGpreU5pMDFMamc1TWkweUxqSTJOaTA0TGpjeU5DMHVOamgyTVRBdU9UbGpNUzR5TkRZdExqWTRJREl1TkRreUxURXVNVE16SURNdU9EVXlMVEV1TWpRMklERXVOeUF3SURNdU1qZzJMalUyTnlBMExqVXpNaUF4TGpVNE5tRTNMalk0TlNBM0xqWTROU0F3SURBZ01DQTVMamMwTkMwdU1URXplaUlnWm1sc2JEMGlJelExT1RrelpDSXZQanh3WVhSb0lHUTlJbTB6T0M0eE9EY2dNVFl1TkRVMUxTNHhNVE1nTVRBdU16RXhkaTR4TVROakxUSXVPRE15SURJdU1qWTJMVFl1T1RFeElESXVNalkyTFRrdU56UTBJREF0TVM0eU5EWXRNUzR3TWkweUxqZ3pNeTB4TGpVNE5pMDBMalV6TWkweExqVTROaTB4TGpNMkxqRXhNeTB5TGpZd05pNDFOamN0TXk0NE5USWdNUzR5TkRaMkxURXdMams1WXpJdU9ETXlMVEV1TlRnMklEWXVNak14TFRFdU1qUTJJRGd1TnpJMExqWTRJREl1TnpJZ01pNHhOVE1nTmk0ME5UZ2dNaTR4TlRNZ09TNHhOemNnTUdndU1qSTNZekFnTGpFeE15NHhNVE11TVRFekxqRXhNeTR5TWpZaUlHWnBiR3c5SWlNMFkySm1OVFlpTHo0OEwzTjJaejQ9IjsKCiAgICBzdGFydCArPSAiQWdNQ0ExTnlBME9TSStQSEpsWTNRZ2VEMGlMalVpSUhrOUlpNDFJaUIzYVdSMGFEMGlOVFlpSUdobGFXZG9kRDBpTkRnaUlISjRQU0kwSWlCeWVUMGlOQ0lnYzNSNWJHVTlJbVpwYkd3NkkyWm1Oalk0TUR0emRISnZhMlV0YldsMFpYSnNhVzFwZERveE1EdHpkSEp2YTJVNkkyWXpOU0l2UGp4eVpXTjBJSGc5SWpndU5TSWdlVDBpT0M0MUlpQjNhV1IwYUQwaU5EQWlJR2hsYVdkb2REMGlNeklpSUhKNFBTSXhOaUlnY25rOUlqRTJJaUJ6ZEhsc1pUMGljM1J5YjJ0bE9pTm0iOwogICAgcmV0dXJuIHN0YXJ0ICsgewogICAgICAibm9ybSI6ICJNelU3Wm1sc2JEb2pabVptTzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaQ0l2UGp4MFpYaDBJSE4wZVd4bFBTSm1iMjUwTFhOcGVtVTZNVEp3ZUR0bWFXeHNPaU0yWlRjME9EZzdabTl1ZEMxbVlXMXBiSGs2U0dWc2RtVjBhV05oVG1WMVpTMUNiMnhrTENCSVpXeDJaWFJwWTJFZ1RtVjFaU3dnYzJGdWN5MXpaWEpwWmp0bWIyNTBMWGRsYVdkb2REbzNNREE3YkdWMGRHVnlMWE53WVdOcGJtYzZNR1Z0T3lJZ2RISmhibk5tYjNKdFBTSjBjbUZ1YzJ4aGRHVW9NVGN1TlNBeU9Ta2lQblJsZUhROEwzUmxlSFErUEM5emRtYysiLAogICAgICAibnVtIjogIk16VTdabWxzYkRvalptWm1PM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpDSXZQangwWlhoMElITjBlV3hsUFNKbWIyNTBMWE5wZW1VNk1USndlRHRtYVd4c09pTTJaVGMwT0RnN1ptOXVkQzFtWVcxcGJIazZTR1ZzZG1WMGFXTmhUbVYxWlMxQ2IyeGtMRWhsYkhabGRHbGpZU0JPWlhWbExITmhibk10YzJWeWFXWTdabTl1ZEMxM1pXbG5hSFE2TnpBd08yeGxkSFJsY2kxemNHRmphVzVuT2pBaUlIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLREkxSURJNUtTSStNRHd2ZEdWNGRENDhMM04yWno0PSIsCiAgICAgICJjb2wiOiAiWm1ZN1ptbHNiRG9qTUdZd08zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkNJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJhbmciOiAiWm1ZN1ptbHNiRG9qTkRRNE9HVTJPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpDSXZQanh3WVhSb0lHUTlJazB4Tmk0eE5UUWdNalF1TldNd0xUWXVOemdnTlM0ME9UWXRNVEl1TWpjMklERXlMakkzTmkweE1pNHlOelpUTkRBdU56QTFJREUzTGpjeUlEUXdMamN3TlNBeU5DNDFJRE0xTGpJeElETTJMamMzTmlBeU9DNDBNeUF6Tmk0M056WWdNVFl1TVRVMElETXhMakk0SURFMkxqRTFOQ0F5TkM0MWVpSWdabWxzYkQwaUl6UXlPREJrTnlJZ2MzUnliMnRsUFNJak16TTNNMk5qSWlCemRISnZhMlV0ZDJsa2RHZzlJaTQxSWk4K1BIQmhkR2dnWkQwaVRUSTRMalF6SURJMExqVldNVEl1TlRBMFl6WXVOakkxSURBZ01URXVPVGsySURVdU16Y2dNVEV1T1RrMklERXhMams1Tm5vaUlHWnBiR3d0YjNCaFkybDBlVDBpTGpJaUlHWnBiR3c5SWlObVptWWlMejQ4Y0dGMGFDQmtQU0pOTWpndU5ETWdNalF1TldneE1pNHlOelVpSUhOMGNtOXJaVDBpSTJabVppSWdjM1J5YjJ0bExYZHBaSFJvUFNJdU5TSWdjM1J5YjJ0bExXeHBibVZqWVhBOUluSnZkVzVrSWk4K1BIQmhkR2dnWkQwaVRUSTRMalF6SURJMExqVldNVEl1TkRRNElpQnpkSEp2YTJVOUlpTm1abVlpSUhOMGNtOXJaUzEzYVdSMGFEMGlMalVpTHo0OGNHRjBhQ0JrUFNKTk16Y3VNekVnTWpRdU5XZ3hMalUyTjIwdExqTTFOaUF5TGpjd05DMHhMalV4TXkwdU5EQTJiUzB1T0RnNElESXVNVFF5SURFdU16VTRMamM0TkUwek5DNDNNU0F6TUM0M09Hd3hMakV3TnlBeExqRXdOMjB0TWk0NU5EY3VNekF6TGpjNE5DQXhMak0xT0cwdE1pNDVNall0TGpRM0xqUXdOaUF4TGpVeE0yMHRNaTQzTURRdU16VTJWak16TGpNNGJTMHlMakk1T0MwdU16QXlMUzQwTURZZ01TNDFNVE50TFRJdU5USXRNUzR3TkRNdU56ZzBMVEV1TXpVNGJTMHhMamcwTFRFdU5ERXRNUzR4TURjZ01TNHhNRGR0TFM0ek1ETXRNaTQ1TkRjdE1TNHpOVGd1TnpnMGJTNDBOeTB5TGpreU5pMHhMalV4TXk0ME1EWk5NVGt1TlRVZ01qUXVOV2d0TVM0MU5qZHRNUzQ0TmprdE1pNHlPVGd0TVM0MU1UTXRMalF3Tm0weExqQTBNeTB5TGpVeUlERXVNelUzTGpjNE5HMHhMalF4TVMweExqZzBMVEV1TVRBM0xURXVNVEEzYlRJdU9UUTNMUzR6TURNdExqYzROQzB4TGpNMU9HMHlMamt5Tmk0ME55MHVOREEyTFRFdU5URXpiVEl1TnpBMElERXVNakV4ZGkweExqVTJOMjB5TGpjd05DNHpOVFl0TGpRd05pQXhMalV4TTIweUxqa3lOaTB1TkRjdExqYzROQ0F4TGpNMU9HMHhMamcwSURFdU5ERWdNUzR4TURjdE1TNHhNRGR0TVM0Mk5qRWdNaTR4TmpNdE1TNHpOVGd1TnpnMGJTNDRPRGdnTWk0eE5ESWdNUzQxTVRNdExqUXdOaUlnYzNSeWIydGxMVzl3WVdOcGRIazlJaTQxSWlCemRISnZhMlU5SWlObVptWWlJSE4wY205clpTMTNhV1IwYUQwaUxqSTFJaTgrUEhCaGRHZ2daRDBpVFRJM0xqa3dPQ0F5TkM0MVlTNDFNakl1TlRJeUlEQWdNU0F4SURFdU1EUTBJREFnTGpVeU1pNDFNaklnTUNBd0lERXRNUzR3TkRRZ01Ib2lJR1pwYkd3OUlpTm1abVlpSUhOMGNtOXJaVDBpSTJabVppSWdjM1J5YjJ0bExYZHBaSFJvUFNJdU5TSXZQanh3WVhSb0lHUTlJazB6T0M0MU5UVWdNalF1TldFeUxqWXhNaUF5TGpZeE1pQXdJREVnTVNBMUxqSXlNeUF3SURJdU5qRXlJREl1TmpFeUlEQWdNQ0F4TFRVdU1qSXpJREI2SWlCbWFXeHNQU0lqWm1abUlpQnpkSEp2YTJVdGIzQmhZMmwwZVQwaUxqSTFJaUJ6ZEhKdmEyVTlJaU5tWm1ZaUlITjBjbTlyWlMxM2FXUjBhRDBpTWlJdlBqeG5JSFJ5WVc1elptOXliVDBpZEhKaGJuTnNZWFJsS0MweU1URXVOU0F0TVRVMUxqVXBJaUJtYVd4c1BTSWpOR001TjJabUlpQm1hV3hzTFhKMWJHVTlJbVYyWlc1dlpHUWlMejQ4Y0dGMGFDQmtQU0pOTkRFdU1UY3hJREl6TGpjeE5XTXdMUzR4TkRRdU1Ea3pMUzR4T1M0eU1TMHVNVEF6YkRFZ0xqYzBPV011TVRFMkxqQTROaTR4TVRjdU1qSTBMUzR3TURNdU16RnNMUzQ1T1RRdU56SmpMUzR4TVRndU1EZzBMUzR5TVRNdU1ETTFMUzR5TVRNdExqRXdOM1l0TGpRek5td3RNUzR4TnpndExqRTVObUV1TVRZdU1UWWdNQ0F3SURFdExqRXlPQzB1TVRVeVl6QXRMakEzTXk0d05pMHVNVFF1TVRJNExTNHhOVEpzTVM0eE56Z3RMakU1TjNvaUlHWnBiR3c5SWlNMFl6azNabVlpSUdacGJHd3RjblZzWlQwaVpYWmxibTlrWkNJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJub3RlIjogIk16VTdabWxzYkRvalptWm1JaTgrUEhCaGRHZ2daRDBpVFRNMUxqYzBJREk0TGpNd05HTXVNamsySURFdU5EYzVMVEV1TURnZ01pNDJOek10TXk0d056TWdNaTQyTnpNdE1TNDVPRGtnTUMwekxqZ3pOaTB4TGpFNU5DMDBMakV5TnkweUxqWTNNeTB1TWprM0xURXVORGdnTVM0d056Z3RNaTQyTnpnZ015NHdOekl0TWk0Mk56Z3VOREU1SURBZ0xqZ3pMakExTkNBeExqSXlOQzR4TlRFdU1qRTVMakExTmk0ME1USXVNVEUzTGpZd055NHhPVFl1TlRZMExTNHdNVE10TGpBMk55MHhMalE0TmkweExqRTRPQzAzTGpreUxURXVNemd5TFRjdU9UWTRJREV1T1RneExURXVNakV5SURVdU5qYzRMVEV1TnpneklETXVOamszTFM0MU56TXVNRFVnTXk0eE1qRXRNaTR6TmpRZ01pNDBPUzB5TGpReE1pMHVOalF0TXk0d01URXROQzQyTXpNdU1UY2dPUzQxTkRSNmJTMHhNUzR3TURnZ015NDRPR011TWprZ01TNDBPQzB4TGpBNE5TQXlMalkzT1MwekxqQTNNU0F5TGpZM09TMHhMams0T0NBd0xUTXVPRE0xTFRFdU1pMDBMakV6TWkweUxqWTRMUzR5T1MweExqUTNPQ0F4TGpBNE5DMHlMalkzTnlBekxqQTNOaTB5TGpZM055NDJOU0F3SURFdU1qZ3VNVEkzSURFdU9EVXVNelV5TGpVek1pMHVNRE0yTFM0d09UZ3RNUzQxTkMweExqSXdOeTAzTGpreUxURXVNemd0Tnk0NU5qZ2dNUzQ1T0RJdE1TNHlNVEVnTlM0Mk56WXRNUzQzT0RNZ015NDJPVFl0TGpVM09TNHdOU0F6TGpFeU1pMHlMak0yTWlBeUxqUTRNeTB5TGpReE1pMHVOalF0TXk0d01USXROQzQyTXpJdU1UY2dPUzQxTkRWNklpQm1hV3hzUFNJak5tVTNORGc0SWk4K1BDOXpkbWMrIiwKICAgICAgIm1hdCI6ICJNelU3Wm1sc2JEb2pNR1JoTlRkaElpOCtQSEJoZEdnZ1pEMGlUVEUzTGpVZ01UWXVOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWHB0TlNBd1lURWdNU0F3SURBZ01TMHhMVEYyTFRKaE1TQXhJREFnTUNBeElERXRNV2d5WVRFZ01TQXdJREFnTVNBeElERjJNbUV4SURFZ01DQXdJREV0TVNBeGVpSWdabWxzYkQwaUkyWm1aaUl2UGp4d1lYUm9JR1E5SWsweU55NDFJREUyTGpWaE1TQXhJREFnTUNBeExURXRNWFl0TW1FeElERWdNQ0F3SURFZ01TMHhhREpoTVNBeElEQWdNQ0F4SURFZ01YWXlZVEVnTVNBd0lEQWdNUzB4SURGNklpQm1hV3hzUFNJak1HWmlaRGhqSWk4K1BIQmhkR2dnWkQwaVRUTXlMalVnTVRZdU5XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZW0wdE1qQWdOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWHB0TlNBd1lURWdNU0F3SURBZ01TMHhMVEYyTFRKaE1TQXhJREFnTUNBeElERXRNV2d5WVRFZ01TQXdJREFnTVNBeElERjJNbUV4SURFZ01DQXdJREV0TVNBeGVtMDFJREJoTVNBeElEQWdNQ0F4TFRFdE1YWXRNbUV4SURFZ01DQXdJREVnTVMweGFESmhNU0F4SURBZ01DQXhJREVnTVhZeVlURWdNU0F3SURBZ01TMHhJREY2YlRVZ01HRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZW0wdE1qQWdOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWG9pSUdacGJHdzlJaU5tWm1ZaUx6NDhjR0YwYUNCa1BTSk5Nakl1TlNBeU5pNDFZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlaUlnWm1sc2JEMGlJekJtWW1RNFl5SXZQanh3WVhSb0lHUTlJazB5Tnk0MUlESTJMalZoTVNBeElEQWdNQ0F4TFRFdE1YWXRNbUV4SURFZ01DQXdJREVnTVMweGFESmhNU0F4SURBZ01DQXhJREVnTVhZeVlURWdNU0F3SURBZ01TMHhJREY2SWlCbWFXeHNQU0lqWm1abUlpOCtQSEJoZEdnZ1pEMGlUVE15TGpVZ01qWXVOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWG9pSUdacGJHdzlJaU13Wm1Ka09HTWlMejQ4Y0dGMGFDQmtQU0pOTXpjdU5TQXlOaTQxWVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZW0wdE1qQWdOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWG9pSUdacGJHdzlJaU5tWm1ZaUx6NDhjR0YwYUNCa1BTSk5Nakl1TlNBek1TNDFZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlbTAxSURCaE1TQXhJREFnTUNBeExURXRNWFl0TW1FeElERWdNQ0F3SURFZ01TMHhhREpoTVNBeElEQWdNQ0F4SURFZ01YWXlZVEVnTVNBd0lEQWdNUzB4SURGNmJUVWdNR0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWG9pSUdacGJHdzlJaU13Wm1Ka09HTWlMejQ4Y0dGMGFDQmtQU0pOTXpjdU5TQXpNUzQxWVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZW0wdE1qQWdOV0V4SURFZ01DQXdJREV0TVMweGRpMHlZVEVnTVNBd0lEQWdNU0F4TFRGb01tRXhJREVnTUNBd0lERWdNU0F4ZGpKaE1TQXhJREFnTUNBeExURWdNWHB0TlNBd1lURWdNU0F3SURBZ01TMHhMVEYyTFRKaE1TQXhJREFnTUNBeElERXRNV2d5WVRFZ01TQXdJREFnTVNBeElERjJNbUV4SURFZ01DQXdJREV0TVNBeGVpSWdabWxzYkQwaUkyWm1aaUl2UGp4d1lYUm9JR1E5SWsweU55NDFJRE0yTGpWaE1TQXhJREFnTUNBeExURXRNWFl0TW1FeElERWdNQ0F3SURFZ01TMHhhREpoTVNBeElEQWdNQ0F4SURFZ01YWXlZVEVnTVNBd0lEQWdNUzB4SURGNklpQm1hV3hzUFNJak1HWmlaRGhqSWk4K1BIQmhkR2dnWkQwaVRUTXlMalVnTXpZdU5XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZWlJZ1ptbHNiRDBpSTJabVppSXZQand2YzNablBnPT0iLAogICAgICAiZW1wIjogIk16VTdabWxzYkRvalptWTBaRFpoTzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaQ0l2UGp3dmMzWm5QZz09IgogICAgfVtuYW1lXTsKICB9OwoKICBjb25zdCB2bSA9IFNjcmF0Y2gudm07CiAgY29uc3QgcnVudGltZSA9IHZtLnJ1bnRpbWU7CiAgY29uc3QgaXNQTSA9IFNjcmF0Y2guZXh0ZW5zaW9ucy5pc1Blbmd1aW5Nb2Q7CgogIGNvbnN0IFRFTVBfQkxPQ0tfT1BDT0RFID0gIlNQbWJwQ1NUXyQtLC5fX19TUG1icENTVF9URU1QX0JMT0NLIjsgLy8gb3Bjb2RlIG9mIHRoZSB0ZW1wb3JhcnkgYmxvY2sgYWRkZWQgdG8ga2VlcCB0aGUgZXh0ZW5zaW9uIGluIHRoZSBwcm9qZWN0CiAgY29uc3QgQ1VTVE9NX01FTlVfSUQgPSAiU1Awek1lbnVNYWtlcl9tZW51XyI7CiAgY29uc3QgdGFyZ2V0UHJvY0RhdGEgPSBTeW1ib2woIk1CUHByb2NlZHVyZURhdGEiKTsgLy8gcGxhY2UgdG8gc3RvcmUgaW1wb3J0YW50IGdsb2JhbCBwcm9jZWR1cmUgZGF0YQoKICBsZXQgcHJvY2VkdXJlc1hNTCA9ICIiLCB0ZW1wU3RvcmUgPSB7fSwgc3RvcmFnZSA9IHt9OwogIGxldCBnbG9iYWxCbG9ja3NDYWNoZSA9IHt9OwogIAogIGxldCBpbWdTdG9yYWdlID0ge30sIGltZ1N0b3JlU2l6ZSA9IDA7CgogIGxldCBleHRlbnNpb25SZW1vdmFibGUgPSBmYWxzZTsKICBsZXQgZXh0OyAvLyBleHRlbnNpb24gb2JqZWN0CiAgbGV0IGV4ZWN1dGUsIFRocmVhZDsgLy8gc2V0IGJ5IGV4cG9ydHMKCiAgLy8gVE9ETyByZW1vdmUgdGhlc2Ugd2hlbiAnZ29vZycgaXMgZXhwb3NlZCBvbiBUdXJib1dhcnAgRGVza3RvcAogIGZ1bmN0aW9uIGNvbG9yRGFya2VuKGhleCwgYW10KSB7CiAgICBjb25zdCBoZXgyUmdiID0gKGgpID0+IHsKICAgICAgaCA9IGgucmVwbGFjZSgiIyIsICIiKTsKICAgICAgaWYgKGgubGVuZ3RoID09PSAzKSBoID0gaC5zcGxpdCgiIikubWFwKGNoYXIgPT4gY2hhciArIGNoYXIpLmpvaW4oIiIpOwogICAgICBsZXQgYmlnaW50ID0gcGFyc2VJbnQoaCwgMTYpOwogICAgICByZXR1cm4gWyhiaWdpbnQgPj4gMTYpICYgMjU1LCAoYmlnaW50ID4+IDgpICYgMjU1LCBiaWdpbnQgJiAyNTVdOwogICAgfQogICAgcmV0dXJuIHJnYjJIZXgoaGV4MlJnYihoZXgpLm1hcCgocGFydCkgPT4gTWF0aC5yb3VuZChwYXJ0ICogKDEgLSBhbXQpKSkpOwogIH0KICBmdW5jdGlvbiByZ2IySGV4KFtyLCBnLCBiXSkgewogICAgcmV0dXJuICgiIyIgKyBbciwgZywgYl0ubWFwKChwYXJ0KSA9PiB7CiAgICAgIGNvbnN0IGhleCA9IHBhcnQudG9TdHJpbmcoMTYpOwogICAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PT0gMSA/ICIwIiArIGhleCA6IGhleDsKICAgIH0pLmpvaW4oIiIpKTsKICB9CgogIGZ1bmN0aW9uIHRoZW1laWZ5Q29sb3IoaGV4KSB7CiAgICBpZiAoaXNQTSkgcmV0dXJuIFtoZXhdOwogICAgY29uc3QgdGhlbWVPYmogPSBSZWR1eFN0b3JlLmdldFN0YXRlKCkuc2NyYXRjaEd1aS50aGVtZS50aGVtZS5nZXRDdXN0b21FeHRlbnNpb25Db2xvcnMoKTsKICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGVtZU9iaikubGVuZ3RoID09PSAwID8gW2hleF0gOiBbCiAgICAgIHRoZW1lT2JqLnByaW1hcnkoaGV4KSwgdGhlbWVPYmouc2Vjb25kYXJ5KGhleCksIHRoZW1lT2JqLnRlcnRpYXJ5KGhleCkKICAgIF07CiAgfQoKICBjb25zdCBpbnB1dFR5cGVzID0gewogICAgY29sOiB7IG9wY29kZTogImNvbG91cl9waWNrZXIiLCBmaWVsZE5hbWU6ICJDT0xPVVIiLCBkZWZhdWx0VmFsdWU6ICgoKSA9PiBgIyR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogTWF0aC5wb3coMiwgMjQpKS50b1N0cmluZygxNikucGFkU3RhcnQoNiwgIjAiKX1gKSB9LAogICAgbm90ZTogeyBvcGNvZGU6ICJub3RlIiwgZmllbGROYW1lOiAiTk9URSIsIGRlZmF1bHRWYWx1ZTogIjYwIiB9LAogICAgbWF0OiB7IG9wY29kZTogIm1hdHJpeCIsIGZpZWxkTmFtZTogIk1BVFJJWCIsIGRlZmF1bHRWYWx1ZTogaXNQTSA/ICIxMTExMDAxMDEwMDExMTAwMTAwMDExMDAwIiA6ICIxMTExMTEwMTAxMDAxMDAwMDEwMDAxMTEwIiB9LAogICAgYW5nOiB7IG9wY29kZTogIm1hdGhfYW5nbGUiLCBmaWVsZE5hbWU6ICJOVU0iLCBkZWZhdWx0VmFsdWU6ICI5MCIgfSwKICAgIC8vICVuIHRlY2huaWNhbGx5IGFscmVhZHkgZXhpc3RzIGJ1dCBzb21lIHBhcnRzIG9mIHNjcmF0Y2gtYmxvY2tzIHJlcGxhY2UgaXQgd2l0aCAlcyBzbyB3ZSBjYW4ndCB1c2UgaXQKICAgIG51bTogeyBvcGNvZGU6ICJtYXRoX251bWJlciIsIGZpZWxkTmFtZTogIk5VTSIsIGRlZmF1bHRWYWx1ZTogIjAiIH0sCiAgICBlbXA6IHsgb3Bjb2RlOiAiZW1wIiwgZmllbGROYW1lOiAiRU1QVFkifSwKICAgIGJyYzogeyBvcGNvZGU6ICJicmMiLCBmaWVsZE5hbWU6ICJTVUJTVEFDSyIgfSwKICAgIGltZzogeyBvcGNvZGU6ICJpbWciLCBmaWVsZE5hbWU6ICJJTUFHRSIgfQogIH07CiAgZnVuY3Rpb24gZ2V0SW5wdXREYXRhKGlucHV0KSB7CiAgICBpZiAoaW5wdXQuaXNEcm9wKSByZXR1cm4geyBvcGNvZGU6IGlucHV0LnR5cGUsIGZpZWxkTmFtZTogbnVsbCwgZGVmYXVsdFZhbHVlOiBudWxsIH07CiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChpbnB1dFR5cGVzLCBpbnB1dC50eXBlKSkgcmV0dXJuIHt9OwogICAgcmV0dXJuIGlucHV0VHlwZXNbaW5wdXQudHlwZV07CiAgfQogIC8vIFVzZWQgZm9yIHNldHRpbmcgaW5wdXRzIHRvIHRoZSBjb3JyZWN0IGJsb2NrIGNvbG9yCiAgZnVuY3Rpb24gaXNOb3JtYWxJbnB1dChvcGNvZGUpIHsKICAgIHJldHVybiBvcGNvZGUgPT09ICJub3RlIiB8fCBvcGNvZGUgPT09ICJtYXRyaXgiIHx8IG9wY29kZSA9PT0gImNvbG91cl9waWNrZXIiCiAgICAgIHx8IG9wY29kZSA9PT0gIm1hdGhfYW5nbGUiIHx8IG9wY29kZSA9PT0gIm1hdGhfbnVtYmVyIiB8fCBvcGNvZGUgPT09ICJ0ZXh0IjsKICB9CgogIC8vIGlmIHRydWUsIHNjcm9sbGluZyB0byBNeSBCbG9ja3Mgd2lsbCBzY3JvbGwgdG8gTXkgQmxvY2tzKyBpbnN0ZWFkCiAgLy8gdXNlZCB0byBtYWtlIHRoZSBNYWtlIGEgQmxvY2sgZGlhbG9nIHNjcm9sbCB0byB0aGUgTUIrIGNhdGVnb3J5CiAgbGV0IHNob3VsZFNjcm9sbFRvTUJQID0gZmFsc2U7CgogIC8vIHJlZnJlc2ggdGhlIGJsb2NrIGxpc3QgaWYgdHJ1ZSB3aGVuIGNhbGxlZCwgb3RoZXJ3aXNlIGRvZXMgbm90aGluZwogIGxldCBsaXN0TmVlZHNSZWZyZXNoID0gZmFsc2UsIHN1c3BlbmRSZW1vdmFsID0gZmFsc2UsIG9sZExpc3RMZW5ndGggPSAwOwoKICAvLyBDdXN0b20gQmxvY2sgTW9kYWwKICBjb25zdCByZXR1cm5UeXBlRXJyb3IgPSAoZSkgPT4gewogICAgLy8gdXNlZCBmb3IgUGVuZ3Vpbk1vZAogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBkaXZbY2xhc3M9IlJlYWN0TW9kYWxQb3J0YWwiXWApOwogICAgaWYgKG1vZGFsPy5wYXJlbnROb2RlKSB7CiAgICAgIGNvbnNvbGUud2FybigiSWdub3JlIHRoZSBmb2xsb3dpbmcgRXJyb3IgYWJvdXQgJ2Nvbm5lY3Rpb25EQkxpc3QnLCBpdCBmaXhlcyBpdHNlbGYiKTsKICAgICAgbW9kYWwucXVlcnlTZWxlY3RvcihgW2NsYXNzXj0iY2xvc2UtYnV0dG9uX2Nsb3NlLWJ1dHRvbl8iXWApLmNsaWNrKCk7CiAgICB9CiAgfTsKCiAgLy8gQ2xlYW4gbm9uZXhpc3RlbnQgaW5wdXRzIGZyb20gdGhlIGlucHV0cyBvYmplY3QKICBmdW5jdGlvbiBjbGVhbnVwQmxvY2tJbnB1dHMoaW5wdXRzLCBhcmdzKSB7CiAgICBmb3IgKGNvbnN0IGlucHV0SWQgaW4gaW5wdXRzKSB7CiAgICAgIGlmICghYXJncy5pbmNsdWRlcyhpbnB1dElkKSkgZGVsZXRlIGlucHV0c1tpbnB1dElkXTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG9wZW5CbG9ja01ha2VyKHdvcmtzcGFjZSwgaXNFZGl0aW5nKSB7CiAgICBpZiAoZXh0ZW5zaW9uUmVtb3ZhYmxlKSByZXR1cm47CiAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgIHNob3VsZFNjcm9sbFRvTUJQID0gdHJ1ZTsKICAgIGNvbnN0IGlzRGFyayA9IGlzUE0gPyBkb2N1bWVudC5ib2R5LmdldEF0dHJpYnV0ZSgidGhlbWUiKSA9PT0gImRhcmsiIDogUmVkdXhTdG9yZS5nZXRTdGF0ZSgpLnNjcmF0Y2hHdWkudGhlbWUudGhlbWUuZ3VpID09PSAiZGFyayI7CiAgICAvLyBTY3JhdGNoIGNyZWF0ZXMgYSBuZXcgd29ya3NwYWNlIGZvciBDdXN0b20gQmxvY2tzLCB3ZSBuZWVkIHRvIGNhcHR1cmUgaXQKICAgIGNvbnN0IG5ld1dvcmtzcGFjZSA9IFNjcmF0Y2hCbG9ja3MubWFpbldvcmtzcGFjZTsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2NsYXNzPSJSZWFjdE1vZGFsUG9ydGFsIl1gKTsKICAgIG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYGRpdltjbGFzcyo9Im1vZGFsX2hlYWRlci1pdGVtLXRpdGxlIl1gKS50ZXh0Q29udGVudCA9ICJNYWtlIGEgQmxvY2srIjsKICAgIGlmICghaXNQTSkgbW9kYWwucXVlcnlTZWxlY3RvcihgZGl2W2NsYXNzKj0ibW9kYWxfbW9kYWwtb3ZlcmxheV8iXWApLnN0eWxlLnRvcCA9ICItMjVweCI7CiAgICBlbHNlIHsKICAgICAgY29uc3Qgb3B0aW9uUm93ID0gbW9kYWwucXVlcnlTZWxlY3RvckFsbChgW2NsYXNzXj0iY3VzdG9tLXByb2NlZHVyZXNfb3B0aW9ucy1yb3dfIl1gKTsKICAgICAgY29uc3QgcmV0dXJuQ2hlY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yQWxsKGBpbnB1dFt0eXBlPSJjaGVja2JveCJdYCk7CgogICAgICBjb25zdCBpbm5lck1vZGFsID0gbW9kYWwuZmlyc3RDaGlsZDsKICAgICAgaW5uZXJNb2RhbC5zdHlsZS5vdmVyZmxvdyA9ICJhdXRvIjsKICAgICAgbGV0IG9nVG9wOwogICAgICBpbm5lck1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsICgpID0+IHsKICAgICAgICBjb25zdCBhY3RpdmVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltjbGFzc149ImJsb2NrbHlXaWRnZXREaXYiXVtjbGFzcyo9ImZpZWxkVGV4dElucHV0Il1gKTsKICAgICAgICBpZiAoYWN0aXZlSW5wdXQpIHsKICAgICAgICAgIGlmICghb2dUb3ApIHsKICAgICAgICAgICAgY29uc3QgbW9kYWxSZWN0ID0gaW5uZXJNb2RhbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgY29uc3QgaW5wdXRSZWN0ID0gYWN0aXZlSW5wdXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIG9nVG9wID0gaW5wdXRSZWN0LnRvcCAtIG1vZGFsUmVjdC50b3AgKyBpbm5lck1vZGFsLnNjcm9sbFRvcDsKICAgICAgICAgIH0KICAgICAgICAgIGFjdGl2ZUlucHV0LnN0eWxlLnRvcCA9IGAke29nVG9wIC0gaW5uZXJNb2RhbC5zY3JvbGxUb3B9cHhgOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbC5xdWVyeVNlbGVjdG9yKGBbY2xhc3NePSJjdXN0b20tcHJvY2VkdXJlc19jb2xvci1waWNrZXItYXJlYV8iXWApLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIGlmIChvcHRpb25Sb3dbMV0pIG9wdGlvblJvd1sxXS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBpZiAocmV0dXJuQ2hlY2tbMV0pIHJldHVybkNoZWNrWzFdLnBhcmVudE5vZGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gewogICAgICAgIG9wdGlvblJvd1sxXS5zdHlsZS5kaXNwbGF5ID0gZS50YXJnZXQuY2hlY2tlZCA/ICIiIDogIm5vbmUiOwogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHJvdyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYFtjbGFzc149ImN1c3RvbS1wcm9jZWR1cmVzX29wdGlvbnMtcm93XyJdYCk7CiAgICBjb25zdCBibG9ja0VkaXRvciA9IG5ld1dvcmtzcGFjZS5nZXRCbG9ja0J5SWQobW9kYWwucXVlcnlTZWxlY3RvcigiZ1tkYXRhLWlkXSIpLmdldEF0dHJpYnV0ZSgiZGF0YS1pZCIpKTsKICAgIGNvbnN0IGN1clByb2MgPSBibG9ja0VkaXRvci5wcm9jQ29kZV87CiAgICB0ZW1wU3RvcmUgPSBzdHJ1Y3R1cmVkQ2xvbmUoc3RvcmVHZXQoY3VyUHJvYykpIHx8IHt9OyAvLyBSZXNldAogICAgYmxvY2tFZGl0b3IuU1BtYnBDU1Rfc3RvcmUgPSB0ZW1wU3RvcmU7CgogICAgYXR0YWNoSW5wdXRCdG5zKHJvdywgYmxvY2tFZGl0b3IsIGlzRGFyaywgd29ya3NwYWNlKTsKICAgIGF0dGFjaENvbG9ycyhyb3csIGlzRGFyaywgYmxvY2tFZGl0b3IpOwogICAgYXR0YWNoQ2hlY2tib3hlcyhtb2RhbCwgYmxvY2tFZGl0b3IsIGlzRWRpdGluZywgY3VyUHJvYyk7CgogICAgLy8gQXR0YWNoIE9rYXkgQnV0dG9uIExpc3RlbmVyCiAgICBjb25zdCBva0J0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYGJ1dHRvbltjbGFzc149ImN1c3RvbS1wcm9jZWR1cmVzX29rLWJ1dHRvbl8iXWApOwogICAgb2tCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gewogICAgICAvLyBwcmV2ZW50IHByb2Njb2RlIGNvbmZsaWN0cwogICAgICBjb25zdCBwcm9jID0gYmxvY2tFZGl0b3IucHJvY0NvZGVfOwogICAgICBsZXQgcHJvdG9FeGlzdHMgPSBTY3JhdGNoQmxvY2tzLlByb2NlZHVyZXMuZ2V0UHJvdG90eXBlQmxvY2socHJvYywgd29ya3NwYWNlKTsKICAgICAgaWYgKCFwcm90b0V4aXN0cykgewogICAgICAgIHJlZnJlc2hHbG9iYWxCbG9ja3NDYWNoZSgpOwogICAgICAgIGNvbnN0IHRoaXNJRCA9IHZtLmVkaXRpbmdUYXJnZXQuaWQ7CiAgICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgcnVudGltZS50YXJnZXRzKSB7CiAgICAgICAgICBwcm90b0V4aXN0cyA9IHRhcmdldC5ibG9ja3MuZ2V0UHJvY2VkdXJlRGVmaW5pdGlvbihwcm9jKTsKICAgICAgICAgIGlmIChwcm90b0V4aXN0cykgewogICAgICAgICAgICBpZiAodGhpc0lEID09PSBnbG9iYWxCbG9ja3NDYWNoZVtwcm9jXT8uaWQpIHsKICAgICAgICAgICAgICBwcm90b0V4aXN0cyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAodGhpc0lEID09PSB0YXJnZXQuaWQgJiYgaXNFZGl0aW5nKSBwcm90b0V4aXN0cyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoKHByb3RvRXhpc3RzICYmICghaXNFZGl0aW5nIHx8IGN1clByb2MgIT09IHByb2MpKSkgewogICAgICAgIGFsZXJ0KCJBIGN1c3RvbSBibG9jayB3aXRoIHRoaXMgdGV4dCBhbHJlYWR5IGV4aXN0cyEiKTsKICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2xlYW51cEJsb2NrSW5wdXRzKHRlbXBTdG9yZS5pbnB1dHMsIGJsb2NrRWRpdG9yLmFyZ3VtZW50SWRzXyk7CiAgICAgIHN0b3JlU2V0KGJsb2NrRWRpdG9yLnByb2NDb2RlXywgdGVtcFN0b3JlKTsKICAgICAgaWYgKGlzRWRpdGluZyAmJiBjdXJQcm9jICE9PSBibG9ja0VkaXRvci5wcm9jQ29kZV8pIHN0b3JlRGVsKGN1clByb2MpOwogICAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKCiAgICAgIGlmIChpc1BNKSB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImVycm9yIiwgcmV0dXJuVHlwZUVycm9yLCB7IG9uY2U6IHRydWUgfSk7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgcmV0dXJuVHlwZUVycm9yLCB7IG9uY2U6IHRydWUgfSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZ2VuRHJwQnV0dG9uKGNvbnRhaW5lciwgb3B0cywgZGVmYXVsdFZhbHVlLCBpc0RhcmssIGlzTGFiZWwsIGNoYW5nZUZ1bmMsIHNldEZ1bmMpIHsKICAgIGNvbnN0IGltZyA9IGNvbnRhaW5lci5jaGlsZE5vZGVzWzBdLCBidG4gPSBjb250YWluZXIuY2hpbGROb2Rlc1syXTsKICAgIGltZy5zcmMgPSBkZWZhdWx0VmFsdWU7CiAgICBpZiAoaXNMYWJlbCkgY29udGFpbmVyLmNoaWxkTm9kZXNbMV0uZmlyc3RDaGlsZC50ZXh0Q29udGVudCA9ICJBZGQgYSBsYWJlbCI7CgogICAgLy8gcmVwbGFjZSB0ZXh0IHdpdGggZHJvcGRvd24gaW5wdXQKICAgIGxldCBkcnBkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2VsZWN0Iik7CiAgICBkcnBkb3duLnNldEF0dHJpYnV0ZSgic3R5bGUiLCBgJHtpc0xhYmVsID8gIndpZHRoOiAxMDAlOyAiIDogIiJ9IGJvcmRlci1yYWRpdXM6IDVweDsgdGV4dC1hbGlnbjogY2VudGVyOyBiYWNrZ3JvdW5kOiAke2lzRGFyayA/ICIjMWUxZTFlIiA6ICIjZmZmIn07IGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLXVpLWJsYWNrLXRyYW5zcGFyZW50LCByZ2JhKDAsIDAsIDAsIDAuMTUpKTtgKTsKICAgIGZvciAoY29uc3QgW3R4dCwgdmFsXSBvZiBvcHRzKSB7CiAgICAgIGxldCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgb3B0LnRleHQgPSB0eHQ7IG9wdC52YWx1ZSA9IHZhbDsKICAgICAgZHJwZG93bi5hcHBlbmRDaGlsZChvcHQpOwogICAgfTsKICAgIGJ0bi5yZXBsYWNlQ2hpbGQoZHJwZG93biwgYnRuLnF1ZXJ5U2VsZWN0b3IoInNwYW4iKSk7CgogICAgLy8gb24gRmlyZWZveCwgdGhlICJjbGljayIgZXZlbnQgd2lsbCBwcm9wYWdhdGUgdG8gdGhlIGJ1dHRvbiwgd2hpY2ggd2lsbCBhZGQgYW5vdGhlciBpbnB1dC4gZG9uJ3QgZG8gdGhhdAogICAgZHJwZG93bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTsKICAgIGRycGRvd24uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKGUpID0+IHsKICAgICAgY2hhbmdlRnVuYyhlLnRhcmdldC52YWx1ZSwgaW1nKTsKICAgICAgY29udGFpbmVyLmNsaWNrKCk7CiAgICB9KTsKICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiBzZXRGdW5jKGUsIGRycGRvd24pKTsKICAgIHJldHVybiBjb250YWluZXI7CiAgfQoKICBmdW5jdGlvbiBhdHRhY2hJbnB1dEJ0bnMocm93LCBlZGl0b3IsIGlzRGFyaywgd29ya3NwYWNlKSB7CiAgICBjb25zdCBvbGRCb29sVVJMID0gcm93LmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5zcmM7CiAgICBjb25zdCBvbGRMYWJlbFVSTCA9IHJvdy5jaGlsZE5vZGVzW2lzUE0gPyAzIDogMl0uY2hpbGROb2Rlc1swXS5zcmM7CgogICAgLy8gZHJvcGRvd24gYnRuCiAgICBjb25zdCBkcm9wQnRuID0gcm93LmNoaWxkTm9kZXNbMV0uY2xvbmVOb2RlKHRydWUpOwogICAgZHJvcEJ0bi5jaGlsZE5vZGVzWzBdLnNyYyA9IGd1aVVSSXMoImRyb3Bkd24iKTsKICAgIGRyb3BCdG4uY2hpbGROb2Rlc1syXS50ZXh0Q29udGVudCA9ICJkcm9wZG93biI7CiAgICByb3cuaW5zZXJ0QmVmb3JlKGRyb3BCdG4sIHJvdy5jaGlsZE5vZGVzWzJdKTsKICAgIGRyb3BCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBvcGVuTWVudVNlbGVjdG9yKGVkaXRvciwgaXNEYXJrLCB3b3Jrc3BhY2UpKTsKCiAgICAvLyBicmFuY2ggYnRuCiAgICBjb25zdCBicmFuY2hCdG4gPSByb3cuY2hpbGROb2Rlc1sxXS5jbG9uZU5vZGUodHJ1ZSk7CiAgICBicmFuY2hCdG4uY2hpbGROb2Rlc1swXS5zcmMgPSBpbnB1dFVSSXMoImJyYyIpOwogICAgYnJhbmNoQnRuLmNoaWxkTm9kZXNbMl0udGV4dENvbnRlbnQgPSAiYnJhbmNoIjsKICAgIHJvdy5pbnNlcnRCZWZvcmUoYnJhbmNoQnRuLCByb3cuY2hpbGROb2Rlc1szXSk7CiAgICBicmFuY2hCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gewogICAgICBlZGl0b3IuYWRkU3RyaW5nTnVtYmVyRXh0ZXJuYWwoKTsKICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCiAgICAgIGNvbnN0IGFyZ3MgPSBlZGl0b3IuYXJndW1lbnRJZHNfOwogICAgICBjb25zdCBpZCA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgaW5wdXRzID0gdGVtcFN0b3JlLmlucHV0cyB8fCB7fTsKICAgICAgaW5wdXRzW2lkXSA9IHsgdHlwZTogImJyYyIsIGlzRHJvcDogZmFsc2UgfTsKICAgICAgdGVtcFN0b3JlLmlucHV0cyA9IGlucHV0czsKICAgICAgY2xlYW51cEJsb2NrSW5wdXRzKGlucHV0cywgYXJncyk7CgogICAgICBlZGl0b3IuZGlzcGxheU5hbWVzX1thcmdzLmxlbmd0aCAtIDFdID0gImJyYW5jaCI7CiAgICAgIGVkaXRvci51cGRhdGVEaXNwbGF5XygpOwogICAgICBlZGl0b3IuZm9jdXNMYXN0RWRpdG9yXygpOwogICAgfSk7CgogICAgLy8gZHluYW1pYyBidG5zCiAgICBjb25zdCBsYWJQYXRocyA9IFtbInRleHQiLCAidGV4dCJdLCBbImltYWdlIiwgImltZyJdXTsKICAgIGNvbnN0IGlucFBhdGhzID0gWwogICAgICBbIm51bWJlciBvciB0ZXh0IiwgIm5vcm0iXSwgWyJudW1iZXIiLCAibnVtIl0sIFsiYm9vbGVhbiIsICJib29sIl0sIFsiYW5nbGUiLCAiYW5nIl0sCiAgICAgIFsiY29sb3IiLCAiY29sIl0sIFsicGlhbm8iLCAibm90ZSJdLCBbIm1hdHJpeCIsICJtYXQiXSwgWyJlbXB0eSIsICJlbXAiXQogICAgXTsKCiAgICBjb25zdCB0ZW1wQnRuID0gcm93LmNoaWxkTm9kZXNbMV07CiAgICByb3cucmVwbGFjZUNoaWxkKGdlbkRycEJ1dHRvbigKICAgICAgdGVtcEJ0bi5jbG9uZU5vZGUodHJ1ZSksIGlucFBhdGhzLCBpbnB1dFVSSXMoIm5vcm0iKSwgaXNEYXJrLCBmYWxzZSwKICAgICAgKHZhbHVlLCBpbWcpID0+IHsKICAgICAgICBpbWcuc3JjID0gdmFsdWUgPT09ICJib29sIiA/IG9sZEJvb2xVUkwgOiBpbnB1dFVSSXModmFsdWUpOwogICAgICB9LAogICAgICAoZSwgZHJwZG93bikgPT4gewogICAgICAgIGlmIChlLnRhcmdldCA9PT0gZHJwZG93bikgcmV0dXJuOwogICAgICAgIGlmIChkcnBkb3duLnZhbHVlID09PSAiYm9vbCIpIHsKICAgICAgICAgIGVkaXRvci5hZGRCb29sZWFuRXh0ZXJuYWwoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsgLy8gZG9uJ3QgcnVuIHRoZSBvbGQgYWRkIGV2ZW50CiAgICAgICAgaWYgKGRycGRvd24udmFsdWUgPT09ICJub3JtIikgcmV0dXJuOwoKICAgICAgICBjb25zdCBhcmdzID0gZWRpdG9yLmFyZ3VtZW50SWRzXzsKICAgICAgICBjb25zdCBpZCA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTsKICAgICAgICBjb25zdCBpbnB1dHMgPSB0ZW1wU3RvcmUuaW5wdXRzIHx8IHt9OwogICAgICAgIGlucHV0c1tpZF0gPSB7IHR5cGU6IGRycGRvd24udmFsdWUsIGlzRHJvcDogZmFsc2UgfTsKICAgICAgICB0ZW1wU3RvcmUuaW5wdXRzID0gaW5wdXRzOwogICAgICAgIGNsZWFudXBCbG9ja0lucHV0cyhpbnB1dHMsIGFyZ3MpOwoKICAgICAgICBlZGl0b3IuZGlzcGxheU5hbWVzX1thcmdzLmxlbmd0aCAtIDFdID0gZHJwZG93bi5zZWxlY3RlZE9wdGlvbnNbMF0udGV4dENvbnRlbnQ7CiAgICAgICAgZWRpdG9yLnVwZGF0ZURpc3BsYXlfKCk7CiAgICAgICAgZWRpdG9yLmZvY3VzTGFzdEVkaXRvcl8oKTsKICAgICAgfQogICAgKSwgcm93LmNoaWxkTm9kZXNbMF0pOwogICAgcm93LnJlcGxhY2VDaGlsZChnZW5EcnBCdXR0b24oCiAgICAgIHRlbXBCdG4uY2xvbmVOb2RlKHRydWUpLCBsYWJQYXRocywgb2xkTGFiZWxVUkwsIGlzRGFyaywgdHJ1ZSwKICAgICAgKHZhbHVlLCBpbWcpID0+IHsKICAgICAgICBpbWcuc3JjID0gdmFsdWUgPT09ICJ0ZXh0IiA/IG9sZExhYmVsVVJMIDogaW5wdXRVUklzKHZhbHVlKTsKICAgICAgfSwKICAgICAgKGUsIGRycGRvd24pID0+IHsKICAgICAgICBpZiAoZS50YXJnZXQgPT09IGRycGRvd24pIHJldHVybjsKICAgICAgICBpZiAoZHJwZG93bi52YWx1ZSA9PT0gInRleHQiKSBlZGl0b3IuYWRkTGFiZWxFeHRlcm5hbCgpOwogICAgICAgIGVsc2Ugb3BlbkltZ1NlbGVjdG9yKGVkaXRvciwgaXNEYXJrLCB3b3Jrc3BhY2UpOwogICAgICB9CiAgICApLCByb3cuY2hpbGROb2Rlc1tpc1BNID8gNSA6IDRdKTsKICAgIHJvdy5jaGlsZE5vZGVzWzFdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgfQoKICBmdW5jdGlvbiBhdHRhY2hDaGVja2JveGVzKG1vZGFsLCBlZGl0b3IsIGlzRWRpdGluZywgb2dQcm9jb2RlKSB7CiAgICBjb25zdCBjaGVja1JvdyA9IGlzUE0gPyBtb2RhbC5xdWVyeVNlbGVjdG9yKGBkaXZbY2xhc3NePSJjdXN0b20tcHJvY2VkdXJlc19idXR0b24tcm93XyJdYCkucHJldmlvdXNTaWJsaW5nCiAgICAgIDogbW9kYWwucXVlcnlTZWxlY3RvcihgW2NsYXNzXj0iY3VzdG9tLXByb2NlZHVyZXNfY2hlY2tib3gtcm93Il1gKTsKICAgIGNvbnN0IG1ha2VCb3ggPSAodHh0LCB2YWwsIGZ1bmMpID0+IHsKICAgICAgY29uc3QgYm94ID0gY2hlY2tSb3cuZmlyc3RDaGlsZC5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgIGJveC5jaGlsZE5vZGVzWzFdLnRleHRDb250ZW50ID0gdHh0OwogICAgICBib3guY2hpbGROb2Rlc1swXS5jaGVja2VkID0gdmFsOwogICAgICBib3guYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBmdW5jKGJveC5jaGlsZE5vZGVzWzBdLmNoZWNrZWQpKTsKICAgICAgcmV0dXJuIGJveDsKICAgIH07CiAgICBpZiAoaXNFZGl0aW5nICYmIGlzUE0pIHsKICAgICAgY29uc3QgaXNSZXR1cm5lciA9IGVkaXRvci5nZXRSZXR1cm5zKCk7CiAgICAgIGNvbnN0IHJldHVyblR5cGUgPSBtYWtlQm94KAogICAgICAgICJCb29sZWFuIiwgZWRpdG9yLm91dHB1dFR5cGUgPT09ICJib29sZWFuIiwKICAgICAgICAodmFsKSA9PiB7IGVkaXRvci5zZXRUeXBlKHZhbCA/ICJib29sZWFuIiA6ICJzdHJpbmciKSB9CiAgICAgICk7CiAgICAgIHJldHVyblR5cGUuc3R5bGUuZGlzcGxheSA9IGlzUmV0dXJuZXIgPyAiIiA6ICJub25lIjsKICAgICAgcmV0dXJuVHlwZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjVweCI7CiAgICAgIGNvbnN0IHJldHVybkNoZWNrID0gbWFrZUJveCgKICAgICAgICAiUmV0dXJucyBhIHZhbHVlIiwgaXNSZXR1cm5lciwKICAgICAgICAodmFsKSA9PiB7CiAgICAgICAgICBlZGl0b3Iuc2V0UmV0dXJucyh2YWwpOwogICAgICAgICAgaWYgKHZhbCkgewogICAgICAgICAgICBlZGl0b3Iuc2V0VHlwZSgic3RyaW5nIik7CiAgICAgICAgICAgIHJldHVyblR5cGUuY2hpbGROb2Rlc1swXS5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVyblR5cGUuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWRpdG9yLnNldFR5cGUoInN0YXRlbWVudCIpOwogICAgICAgICAgICByZXR1cm5UeXBlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICApOwogICAgICBjaGVja1Jvdy5hcHBlbmQocmV0dXJuQ2hlY2ssIHJldHVyblR5cGUpOwogICAgfQogICAgY2hlY2tSb3cuYXBwZW5kKGlzUE0gJiYgIWlzRWRpdGluZyA/ICIiIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSwgbWFrZUJveCgKICAgICAgIkNhcCBibG9jayIsIHRlbXBTdG9yZS5pc1Rlcm1pbmFsICE9PSB1bmRlZmluZWQgPyB0ZW1wU3RvcmUuaXNUZXJtaW5hbCA6IGZhbHNlLAogICAgICAodmFsKSA9PiB7CiAgICAgICAgZWRpdG9yLnNldE5leHRTdGF0ZW1lbnQoIXZhbCk7CiAgICAgICAgdGVtcFN0b3JlLmlzVGVybWluYWwgPSB2YWw7CiAgICAgIH0KICAgICkpOwogICAgY2hlY2tSb3cuYXBwZW5kKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIiksIG1ha2VCb3goCiAgICAgICJBdmFpbGFibGUgZm9yIGFsbCBzcHJpdGVzIiwgdGVtcFN0b3JlLmdsb2JhbCAhPT0gdW5kZWZpbmVkID8gdGVtcFN0b3JlLmdsb2JhbCA6IGZhbHNlLAogICAgICAodmFsKSA9PiB7IHRlbXBTdG9yZS5nbG9iYWwgPSB2YWwgfQogICAgKSk7CiAgfQoKICBmdW5jdGlvbiBhdHRhY2hDb2xvcnMocm93LCBpc0RhcmssIGVkaXRvcikgewogICAgY29uc3QgYm91bmNlQW5pbSA9IChjaXJjKSA9PiB7CiAgICAgIGNpcmMuYW5pbWF0ZSgKICAgICAgICBbeyB0cmFuc2Zvcm06ICJzY2FsZSgwLjc1KSIgfSwgeyB0cmFuc2Zvcm06ICJzY2FsZSgxKSIgfV0sIHsgZHVyYXRpb246IDIwMCwgZWFzaW5nOiAiZWFzZS1pbi1vdXQiIH0KICAgICAgKTsKICAgIH07CiAgICBjb25zdCBzZXRDb2wgPSAoY29sKSA9PiB7CiAgICAgIHRlbXBTdG9yZS5jb2xvciA9IGNvbDsKICAgICAgaWYgKGlzUE0pIGVkaXRvci5zZXRDb2xvcihjb2wsIGNvbG9yRGFya2VuKGNvbCwgMC4xKSwgY29sb3JEYXJrZW4oY29sLCAwLjIpKTsKICAgICAgZWxzZSB7CiAgICAgICAgZWRpdG9yLnNldENvbG91ciguLi50aGVtZWlmeUNvbG9yKGNvbCkpOwogICAgICAgIGVkaXRvci51cGRhdGVEaXNwbGF5XygpOwogICAgICB9CiAgICB9OwoKICAgIGNvbnN0IGNvbG9yRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBjb2xvckRpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBtYXJnaW4tdG9wOiAxNXB4OyBib3JkZXItcmFkaXVzOiAxMHB4OyIpOwogICAgaWYgKGlzUE0pIGNvbG9yRGl2LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICIxNXB4IjsKICAgIGNvbG9yRGl2LnN0eWxlLmJvcmRlciA9IGBzb2xpZCAke2lzRGFyayA/ICIjMzQzNDM0IiA6ICIjRDlEOUQ5In0gMi41cHhgOwoKICAgIGNvbnN0IGNvbG9yTGlzdCA9IGlzUE0gPyBTY3JhdGNoQmxvY2tzLkNvbG91cnMgOiBSZWR1eFN0b3JlLmdldFN0YXRlKCkuc2NyYXRjaEd1aS50aGVtZS50aGVtZS5nZXRTdGFnZUJsb2NrQ29sb3JzKCk7CiAgICBjb25zdCBjb2xvcnMgPSBbCiAgICAgIGNvbG9yTGlzdC5tb3Rpb24ucHJpbWFyeSwgY29sb3JMaXN0Lmxvb2tzLnByaW1hcnksIGNvbG9yTGlzdC5zb3VuZHMucHJpbWFyeSwKICAgICAgY29sb3JMaXN0LmV2ZW50LnByaW1hcnksIGNvbG9yTGlzdC5jb250cm9sLnByaW1hcnksIGNvbG9yTGlzdC5zZW5zaW5nLnByaW1hcnksCiAgICAgIGNvbG9yTGlzdC5vcGVyYXRvcnMucHJpbWFyeSwgY29sb3JMaXN0LmRhdGEucHJpbWFyeSwgY29sb3JMaXN0LmRhdGFfbGlzdHMucHJpbWFyeSwKICAgICAgY29sb3JMaXN0Lm1vcmUucHJpbWFyeSwgY29sb3JMaXN0LnBlbi5wcmltYXJ5LCAicmVkIiwKICAgIF07CiAgICBjb2xvcnMuZm9yRWFjaChjb2xvciA9PiB7CiAgICAgIGNvbnN0IGNpcmNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMzVweDsgaGVpZ2h0OiAzNXB4OyBib3JkZXItcmFkaXVzOiA1MCU7IGJvcmRlcjogMi41cHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjEzKTsgbWFyZ2luOiA3cHg7IGN1cnNvcjogcG9pbnRlcjsiKTsKICAgICAgY2lyY2xlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yOwogICAgICBjaXJjbGUuc3R5bGUuYm94U2hhZG93ID0gYDBweCAwcHggMHB4IDIuNXB4ICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifWA7CiAgICAgIGNvbG9yRGl2LmFwcGVuZENoaWxkKGNpcmNsZSk7CiAgICAgIGlmIChjb2xvciA9PT0gInJlZCIpIHsKICAgICAgICBjb25zdCBpbm5lckltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGlubmVySW1nLnNyYyA9IGd1aVVSSXMoImNvbG9yUGtyIik7CiAgICAgICAgaW5uZXJJbWcuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMjVweDsgaGVpZ2h0OiAyNXB4OyBwb3NpdGlvbjogcmVsYXRpdmU7IHBhZGRpbmc6IDJweDsgbGVmdDogNTAlOyB0b3A6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7Iik7CiAgICAgICAgY2lyY2xlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgYm91bmNlQW5pbShjaXJjbGUpOwogICAgICAgICAgY29sSW5wLmNsaWNrKCk7CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGNvbElucCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgY29sSW5wLnR5cGUgPSAiY29sb3IiOwogICAgICAgIGNvbElucC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIm9wYWNpdHk6IDA7IGN1cnNvcjogcG9pbnRlcjsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDE1cHgsIC0yNXB4KTsiKTsKICAgICAgICBjaXJjbGUuYXBwZW5kKGlubmVySW1nLCBjb2xJbnApOwogICAgICAgIGNvbElucC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgICAgIGNpcmNsZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xJbnAudmFsdWU7CiAgICAgICAgICBzZXRDb2woY29sSW5wLnZhbHVlKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjaXJjbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICBib3VuY2VBbmltKGNpcmNsZSk7CiAgICAgICAgICBzZXRDb2woY29sb3IpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGlmICghdGVtcFN0b3JlLmNvbG9yKSBzZXRDb2woY29sb3JzWzldKTsKICAgIHJvdy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjb2xvckRpdiwgcm93LnBhcmVudE5vZGUubGFzdENoaWxkLnByZXZpb3VzU2libGluZyk7CiAgfQoKICAvLyBDdXN0b20gTWluaSBNb2RhbHMKICBmdW5jdGlvbiBvcGVuTW9kYWwodGl0bGVOYW1lLCB3b3JrZXJGbiwgY2FsbGJhY2tGbikgewogICAgY29uc3QgbW9kYWxTdG9yYWdlID0ge307CiAgICBTY3JhdGNoQmxvY2tzLnByb21wdCgKICAgICAgIiIsICIiLCAoKSA9PiBjYWxsYmFja0ZuKG1vZGFsU3RvcmFnZS52YWx1ZSksCiAgICAgIHRpdGxlTmFtZSwgImJyb2FkY2FzdF9tc2ciCiAgICApOwoKICAgIGxldCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGRpdltjbGFzcz0iUmVhY3RNb2RhbFBvcnRhbCJdYCk7CiAgICBtb2RhbCA9IG1vZGFsW21vZGFsLmxlbmd0aCAtIDFdOwogICAgbW9kYWwuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOyBtb2RhbC5zdHlsZS56SW5kZXggPSAiOTk5OTkiOwogICAgY29uc3QgYm94TW9kYWwgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCJpbnB1dCIpLnBhcmVudE5vZGU7CiAgICBib3hNb2RhbC5wcmV2aW91c1NpYmxpbmcucmVtb3ZlKCk7IGJveE1vZGFsLmZpcnN0Q2hpbGQucmVtb3ZlKCk7CiAgICB3b3JrZXJGbihib3hNb2RhbCwgbW9kYWxTdG9yYWdlKTsKICB9CgogIGZ1bmN0aW9uIG9wZW5NZW51U2VsZWN0b3IoZWRpdG9yLCBpc0RhcmssIG9nV29ya3NwYWNlKSB7CiAgICBjb25zdCBhcnJvd0ljb24gPSBpc1BNID8gInN0YXRpYy9ibG9ja3MtbWVkaWEvZHJvcGRvd24tYXJyb3ciIDogIi9zdGF0aWMvYmxvY2tzLW1lZGlhL2RlZmF1bHQvZHJvcGRvd24tYXJyb3ciOwoKICAgIC8vIEdldCBBbGwgRHJvcGRvd25zCiAgICBjb25zdCBhdm9pZCA9IFsibG9va3NfY29zdHVtZW51bWJlcm5hbWUiLCAiZXh0ZW5zaW9uX3dlZG9fdGlsdF9tZW51IiwgImxtc01vcmVFdmVudHNfbWVudV9zdGF0ZSJdOwogICAgbGV0IGFsbEJsb2NrcyA9IE9iamVjdC5rZXlzKFNjcmF0Y2hCbG9ja3MuQmxvY2tzKTsKICAgIGFsbEJsb2NrcyA9IGFsbEJsb2Nrcy5maWx0ZXIoKGkpID0+IGkuaW5jbHVkZXMoIm1lbnUiKSAmJiAhYXZvaWQuaW5jbHVkZXMoaSkpOwogICAgYWxsQmxvY2tzLnVuc2hpZnQoImxvb2tzX2Nvc3R1bWUiLCAibG9va3NfYmFja2Ryb3BzIiwgInNlbnNpbmdfa2V5b3B0aW9ucyIpOwogICAgYWxsQmxvY2tzLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgaWYgKGUuc3RhcnRzV2l0aChDVVNUT01fTUVOVV9JRCkpIHsKICAgICAgICBhbGxCbG9ja3MudW5zaGlmdChlKTsKICAgICAgICBhbGxCbG9ja3Muc3BsaWNlKGkgKyAxLCAxKTsKICAgICAgfQogICAgfSk7CgogICAgb3Blbk1vZGFsKAogICAgICAiU2VsZWN0IGEgRHJvcGRvd24iLAogICAgICAobW9kYWwsIG1vZGFsU3RvcmFnZSkgPT4gewogICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IGFsbEJsb2Nrc1swXTsKICAgICAgICBjb25zdCBkcm9wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZHJvcERpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgYHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDIwMHB4OyBtYXJnaW4tYm90dG9tOiAxNXB4OyBvdmVyZmxvdzogc2Nyb2xsOyBib3JkZXI6IHNvbGlkICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifSAycHg7IGJvcmRlci1yYWRpdXM6IDEwcHg7YCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxCbG9ja3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGRyb3BJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgcHJldiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGBjdXJzb3I6IHBvaW50ZXI7IHBhZGRpbmc6IDhweDsgd2lkdGg6IDEwMCU7IGhlaWdodDogbWF4LWNvbnRlbnQ7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyO2ApOwogICAgICAgICAgZHJvcEl0ZW0uYXBwZW5kKHByZXYsIHRleHQpOwogICAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IGFsbEJsb2Nrc1tpXS5yZXBsYWNlKENVU1RPTV9NRU5VX0lELCAiIik7CgogICAgICAgICAgY29uc3QgaXNDdXN0b20gPSBhbGxCbG9ja3NbaV0uaW5jbHVkZXMoQ1VTVE9NX01FTlVfSUQpOwogICAgICAgICAgY29uc3QgYmxvY2sgPSBvZ1dvcmtzcGFjZS5nZXRCbG9ja0J5SWQoYWxsQmxvY2tzW2ldKTsKICAgICAgICAgIGxldCBwcmV2VHh0ID0gYmxvY2sgPyBibG9jay5pbnB1dExpc3RbMF0uZmllbGRSb3dbMF0udGV4dF8uc3Vic3RyaW5nKDAsIDE3KSA6ICIiOwogICAgICAgICAgaWYgKHByZXZUeHQubGVuZ3RoID09PSAxNykgcHJldlR4dCArPSAiLi4uIjsKICAgICAgICAgIHByZXYub3V0ZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjogI2ZmZjsgYmFja2dyb3VuZDogJHtpc0N1c3RvbSA/ICIjRkY2NjgwIiA6IGJsb2NrID8gYmxvY2suY29sb3VyXyA6ICIjNTA1MDUwIn07IGJvcmRlci1yYWRpdXM6ICR7YmxvY2sgPyA1MCA6IDV9cHg7IHdpZHRoOiBtYXgtY29udGVudDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiA1cHg7IHBhZGRpbmc6IDVweCAxMHB4IDVweCAxMHB4OyBmb250LXdlaWdodDogNTAwOyBib3JkZXI6IHNvbGlkIDFweCByZ2JhKDAsMCwwLDAuMykiPgogICAgICAgICAgICAgIDxzcGFuPiR7YmxvY2sgPyBwcmV2VHh0IDogIj8/PyJ9PC9zcGFuPjxpbWcgc3R5bGU9Im1hcmdpbi1sZWZ0OiA1cHg7IiBzcmM9IiR7YXJyb3dJY29ufS5zdmciPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIGA7CgogICAgICAgICAgY29uc3QgYmdDb2xvciA9IGkgJSAyID09PSAwID8gaXNDdXN0b20gPyAiI2NjNTI2NjQwIiA6ICIjYWFhMyIgOiBpc0N1c3RvbSA/ICIjY2M1MjY2ODAiIDogInRyYW5zcGFyZW50IjsKICAgICAgICAgIGRyb3BJdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGB2YXIoLS1zZWxlY3RlZC1jb2xvciwgJHtiZ0NvbG9yfSlgOwogICAgICAgICAgaWYgKGkgPT09IDApIGRyb3BJdGVtLnN0eWxlLnNldFByb3BlcnR5KCItLXNlbGVjdGVkLWNvbG9yIiwgaXNDdXN0b20gPyAiI2Y3ODg5YTk5IiA6ICIjYWFhYSIpOwogICAgICAgICAgZHJvcERpdi5hcHBlbmRDaGlsZChkcm9wSXRlbSk7CiAgICAgICAgICBkcm9wSXRlbS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICAgICAgQXJyYXkuZnJvbShkcm9wRGl2LmNoaWxkcmVuKS5mb3JFYWNoKGMgPT4gYy5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiLS1zZWxlY3RlZC1jb2xvciIpKTsKICAgICAgICAgICAgZHJvcEl0ZW0uc3R5bGUuc2V0UHJvcGVydHkoIi0tc2VsZWN0ZWQtY29sb3IiLCBpc0N1c3RvbSA/ICIjZjc4ODlhOTkiIDogIiNhYWFhIik7CiAgICAgICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IGFsbEJsb2Nrc1tpXTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBtb2RhbC5pbnNlcnRCZWZvcmUoZHJvcERpdiwgbW9kYWwubGFzdENoaWxkKTsKICAgICAgfSwKICAgICAgKHZhbHVlKSA9PiB7CiAgICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgICAgY29uc3QgYXJncyA9IGVkaXRvci5hcmd1bWVudElkc187CiAgICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9IHZhbHVlLnJlcGxhY2UoQ1VTVE9NX01FTlVfSUQsICIiKTsKICAgICAgICBlZGl0b3IudXBkYXRlRGlzcGxheV8oKTsKICAgICAgICBlZGl0b3IuZm9jdXNMYXN0RWRpdG9yXygpOwoKICAgICAgICBjb25zdCBpbnB1dHMgPSB0ZW1wU3RvcmUuaW5wdXRzIHx8IHt9OwogICAgICAgIGlucHV0c1tpZF0gPSB7IHR5cGU6IHZhbHVlLCBpc0Ryb3A6IHRydWUgfTsKICAgICAgICB0ZW1wU3RvcmUuaW5wdXRzID0gaW5wdXRzOwogICAgICAgIGNsZWFudXBCbG9ja0lucHV0cyhpbnB1dHMsIGFyZ3MpOwogICAgICB9CiAgICApOwogIH0KCiAgLy8gSW1hZ2UgTW9kYWwKICBmdW5jdGlvbiBvcGVuSW1nU2VsZWN0b3IoZWRpdG9yLCBpc0RhcmssIG9nV29ya3NwYWNlKSB7CiAgICAvLyBHZXQgQWxsIEltYWdlcwogICAgY29uc3QgaW1hZ2VzID0gbmV3IFNldCgpOwogICAgY29uc3QgZXh0cmFjdEltYWdlID0gKGJsb2NrKSA9PiB7CiAgICAgIGlmICghYmxvY2suaW5pdCkgcmV0dXJuOwogICAgICBsZXQganNvbiA9IHt9OwogICAgICBjb25zdCBqc29uSW5pdCA9IChqc29uMCkgPT4geyBqc29uID0ganNvbjA7IH07CiAgICAgIHRyeSB7CiAgICAgICAgYmxvY2suaW5pdC5jYWxsKHsganNvbkluaXQgfSk7CiAgICAgIH0gY2F0Y2ggeyByZXR1cm4gfQoKICAgICAgZm9yIChjb25zdCBrZXkgaW4ganNvbikgewogICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgiYXJncyIpKSBmb3IgKGNvbnN0IGFyZyBvZiBqc29uW2tleV0pIHsKICAgICAgICAgIGlmIChhcmcudHlwZSA9PT0gImZpZWxkX2ltYWdlIiAmJiBhcmcuc3JjKSBpbWFnZXMuYWRkKGFyZy5zcmMpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIE9iamVjdC52YWx1ZXMoU2NyYXRjaEJsb2Nrcy5CbG9ja3MpLmZvckVhY2goZXh0cmFjdEltYWdlKTsKCiAgICBjb25zdCBzZWxlY3RCdG4gPSAoZHJvcERpdiwgYnRuKSA9PiB7CiAgICAgIEFycmF5LmZyb20oZHJvcERpdi5jaGlsZHJlbikuZm9yRWFjaChjID0+IHsKICAgICAgICBjLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJ2YXIoLS1kZWZhdWx0LWJnKSI7CiAgICAgICAgYy5zdHlsZS5ib3JkZXIgPSAic29saWQgdmFyKC0tZGVmYXVsdC1ib3JkZXIpIDJweCI7CiAgICAgIH0pOwogICAgICBidG4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInZhcigtLWxvb2tzLXRyYW5zcGFyZW50LCBoc2xhKDE5NCwgMTAwJSwgNTAlLCAwLjM1KSkiOwogICAgICBidG4uc3R5bGUuYm9yZGVyID0gInNvbGlkIHZhcigtLWxvb2tzLXNlY29uZGFyeSwgaHNsKDE5NCwgMTAwJSwgNTAlKSkgMnB4IjsKICAgIH07CgogICAgb3Blbk1vZGFsKAogICAgICAiU2VsZWN0IGFuIEltYWdlIiwKICAgICAgKG1vZGFsLCBtb2RhbFN0b3JhZ2UpID0+IHsKICAgICAgICBjb25zdCBmbGV4Q29uc3QgPSAiZGlzcGxheTogZmxleDsgZmxleC13cmFwOiB3cmFwOyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsiOwogICAgICAgIGNvbnN0IGJvcmRlckNvbnN0ID0gYGJvcmRlcjogc29saWQgdmFyKC0tZGVmYXVsdC1ib3JkZXIpIDJweDsgYm9yZGVyLXJhZGl1czogMTBweDtgOwogICAgICAgIGNvbnN0IGl0ZW1DU1MgPSBgY3Vyc29yOiBwb2ludGVyOyB3aWR0aDogNzVweDsgaGVpZ2h0OiA3NXB4OyAke2ZsZXhDb25zdH0gcGFkZGluZzogNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1kZWZhdWx0LWJnKTsgbWFyZ2luOiA3cHg7ICR7Ym9yZGVyQ29uc3R9IC0tZGVmYXVsdC1ib3JkZXI6ICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifTsgLS1kZWZhdWx0LWJnOiAke2lzRGFyayA/ICIjMWYxZjFmIiA6ICIjZjVmNWY1In07YDsKCiAgICAgICAgY29uc3QgZHJvcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGRyb3BEaXYuc2V0QXR0cmlidXRlKCJzdHlsZSIsIGB3aWR0aDogMTAwJTsgaGVpZ2h0OiAyMDBweDsgJHtmbGV4Q29uc3R9IG92ZXJmbG93OiBoaWRkZW4gc2Nyb2xsOyBtYXJnaW4tYm90dG9tOiAxNXB4OyAke2JvcmRlckNvbnN0fSAtLWRlZmF1bHQtYm9yZGVyOiAke2lzRGFyayA/ICIjMzQzNDM0IiA6ICIjRDlEOUQ5In07YCk7CgogICAgICAgIGNvbnN0IGRyb3BJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGl0ZW1DU1MpOwogICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIndpZHRoOiA3NSU7IGhlaWdodDogNzUlOyIpOwogICAgICAgIGltZy5zcmMgPSBndWlVUklzKCJhZGRJbWciKTsKICAgICAgICAKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgInRleHQtd3JhcDogbm93cmFwOyBmb250LXNpemU6IDYwJTsiKTsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gIkN1c3RvbSBJbWFnZSI7CiAgICAgICAgZHJvcEl0ZW0uYXBwZW5kKGltZywgdGV4dCk7CgogICAgICAgIGRyb3BEaXYuYXBwZW5kQ2hpbGQoZHJvcEl0ZW0pOwogICAgICAgIGRyb3BJdGVtLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgY29uc3Qgc3JjID0gcHJvbXB0KCJFbnRlciB0aGUgVVJMIG9yIERhdGEuVVJJIG9mIHlvdXIgaW1hZ2U6Iik7CiAgICAgICAgICBpZiAoc3JjKSB7CiAgICAgICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IHNyYzsKICAgICAgICAgICAgc2VsZWN0QnRuKGRyb3BEaXYsIGRyb3BJdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaW1hZ2VzLmZvckVhY2goKGltYWdlLCBpLCBkKSA9PiB7CiAgICAgICAgICBjb25zdCBkcm9wSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGl0ZW1DU1MpOwogICAgICAgICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CiAgICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyIpOwogICAgICAgICAgaW1nLnNyYyA9IGltYWdlOwogICAgICAgICAgZHJvcEl0ZW0uYXBwZW5kQ2hpbGQoaW1nKTsKCiAgICAgICAgICBkcm9wRGl2LmFwcGVuZENoaWxkKGRyb3BJdGVtKTsKICAgICAgICAgIGRyb3BJdGVtLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgICBzZWxlY3RCdG4oZHJvcERpdiwgZHJvcEl0ZW0pOwogICAgICAgICAgICBtb2RhbFN0b3JhZ2UudmFsdWUgPSBpbWFnZTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIG1vZGFsLmluc2VydEJlZm9yZShkcm9wRGl2LCBtb2RhbC5sYXN0Q2hpbGQpOwogICAgICB9LAogICAgICAodmFsdWUpID0+IHsKICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47CiAgICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgICAgY29uc3QgYXJncyA9IGVkaXRvci5hcmd1bWVudElkc187CiAgICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9ICJpbWFnZSI7CiAgICAgICAgZWRpdG9yLnVwZGF0ZURpc3BsYXlfKCk7CiAgICAgICAgZWRpdG9yLmZvY3VzTGFzdEVkaXRvcl8oKTsKCiAgICAgICAgY29uc3QgaW5wdXRzID0gdGVtcFN0b3JlLmlucHV0cyB8fCB7fTsKICAgICAgICBpbnB1dHNbaWRdID0geyB0eXBlOiAiaW1nIiwgaXNEcm9wOiBmYWxzZSwgc3JjOiBzdG9yZUltYWdlKHZhbHVlKSB9OwogICAgICAgIHRlbXBTdG9yZS5pbnB1dHMgPSBpbnB1dHM7CiAgICAgICAgY2xlYW51cEJsb2NrSW5wdXRzKGlucHV0cywgYXJncyk7CiAgICAgIH0KICAgICk7CiAgfQoKICAvLyBDb21waWxlciBQYXRjaGVzCiAgZnVuY3Rpb24gZ2V0RXhwb3J0cygpIHsKICAgIGlmICh2bS5leHBvcnRzLmlfd2lsbF9ub3RfYXNrX2Zvcl9oZWxwX3doZW5fdGhlc2VfYnJlYWspIHJldHVybiB2bS5leHBvcnRzLmlfd2lsbF9ub3RfYXNrX2Zvcl9oZWxwX3doZW5fdGhlc2VfYnJlYWsoKTsKICAgIGVsc2UgaWYgKHZtLmV4cG9ydHMuSlNHZW5lcmF0b3IgJiYgdm0uZXhwb3J0cy5JUkdlbmVyYXRvcj8uZXhwb3J0cykgcmV0dXJuIHsKICAgICAgLi4udm0uZXhwb3J0cywgU2NyaXB0VHJlZUdlbmVyYXRvcjogdm0uZXhwb3J0cy5JUkdlbmVyYXRvci5leHBvcnRzLlNjcmlwdFRyZWVHZW5lcmF0b3IKICAgIH07CiAgfQogIGNvbnN0IGV4cG9ydHMgPSBnZXRFeHBvcnRzKCk7CiAgaWYgKGV4cG9ydHMpIHsKICAgIGNvbnN0IHNhbml0aXplID0gc3RyaW5nID0+IHsKICAgICAgaWYgKHR5cGVvZiBzdHJpbmcgIT09ICJzdHJpbmciKSB7CiAgICAgICAgY29uc29sZS53YXJuKGBzYW5pdGl6ZSBnb3QgdW5leHBlY3RlZCB0eXBlOiAke3R5cGVvZiBzdHJpbmd9YCk7CiAgICAgICAgc3RyaW5nID0gIiIgKyBzdHJpbmc7CiAgICAgIH0KICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHN0cmluZykuc2xpY2UoMSwgLTEpOwogICAgfTsKCiAgICBUaHJlYWQgPSBleHBvcnRzLlRocmVhZDsgZXhlY3V0ZSA9IGV4cG9ydHMuZXhlY3V0ZTsKICAgIGNvbnN0IHsgSlNHZW5lcmF0b3IsIFNjcmlwdFRyZWVHZW5lcmF0b3IgfSA9IGV4cG9ydHM7CiAgICBjb25zdCBleHAgPSBKU0dlbmVyYXRvci5leHBvcnRzID09PSB1bmRlZmluZWQgPyBKU0dlbmVyYXRvci51bnN0YWJsZV9leHBvcnRzIDogSlNHZW5lcmF0b3IuZXhwb3J0czsKICAgIGNvbnN0IF9vZ0lSZGVzY2VuZFN0YWNrID0gU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jazsKICAgIFNjcmlwdFRyZWVHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2sgPSBmdW5jdGlvbihibG9jaykgewogICAgICBzd2l0Y2ggKGJsb2NrLm9wY29kZSkgewogICAgICAgIGNhc2UgInByb2NlZHVyZXNfY2FsbCI6IHsKICAgICAgICAgIGNvbnN0IHByb2MgPSBibG9jay5tdXRhdGlvbi5wcm9jY29kZTsKICAgICAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQocHJvYywgdGhpcy50YXJnZXQpOwogICAgICAgICAgaWYgKCF0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0pIHRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXSA9IHt9OwogICAgICAgICAgdGhpcy50aHJlYWRbdGFyZ2V0UHJvY0RhdGFdW3Byb2NdID0geyBibG9jaywgc3RvcmUgfTsgLy8gYXR0YWNoIHNvbWUgZGF0YSB3ZSBuZWVkCiAgICAgICAgICBpZiAoIXN0b3JlIHx8ICFzdG9yZS5pbnB1dHMpIHJldHVybiBfb2dJUmRlc2NlbmRTdGFjay5jYWxsKHRoaXMsIGJsb2NrKTsKCiAgICAgICAgICAvLyBpZ25vcmUgYnJhbmNoZXMgdGVtcG9yYXJpbHkKICAgICAgICAgIGNvbnN0IGFyZ0lkcyA9IEpTT04ucGFyc2UoYmxvY2subXV0YXRpb24uYXJndW1lbnRpZHMpOwogICAgICAgICAgY29uc3QgYXBwZW5kZXJzID0gW107CiAgICAgICAgICBjb25zdCB0ZW1wQmxvY2sgPSBzdHJ1Y3R1cmVkQ2xvbmUoYmxvY2spOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBibG9jay5pbnB1dHNbYXJnSWRzW2ldXTsKICAgICAgICAgICAgaWYgKHN0b3JlLmlucHV0c1tpbnB1dD8ubmFtZV0/LnR5cGUgPT09ICJicmMiKSB7CiAgICAgICAgICAgICAgYXBwZW5kZXJzLnB1c2goW2ksIGlucHV0LmJsb2NrXSk7CiAgICAgICAgICAgICAgZGVsZXRlIHRlbXBCbG9jay5pbnB1dHNbaW5wdXQubmFtZV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV1bcHJvY10uYXBwZW5kZXJzID0gYXBwZW5kZXJzOwogICAgICAgICAgY29uc3Qgbm9kZSA9IF9vZ0lSZGVzY2VuZFN0YWNrLmNhbGwodGhpcywgdGVtcEJsb2NrKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXBwZW5kZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5vZGUuYXJndW1lbnRzW2FwcGVuZGVyc1tpXVswXV0gPSB7IGtpbmQ6ICJjb25zdGFudCIsIG1icEtleTogdHJ1ZSwgdmFsdWU6IHRoaXMud2Fsa1N0YWNrKGFwcGVuZGVyc1tpXVsxXSkgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVF9zZXRQYXJhbSI6IHsKICAgICAgICAgIGxldCBwYXJhbUluZGV4ID0gdGhpcy5zY3JpcHQuYXJndW1lbnRzLmxhc3RJbmRleE9mKGJsb2NrLmZpZWxkcy5QQVJBTS52YWx1ZSk7CiAgICAgICAgICBpZiAocGFyYW1JbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgcGFyYW1JbmRleCA9IHRoaXMuc2NyaXB0LmFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMuc2NyaXB0LmFyZ3VtZW50cy5wdXNoKGJsb2NrLmZpZWxkcy5QQVJBTS52YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBraW5kOiAiU1BtYnBDU1Quc2V0UGFyYW0iLCBwYXJhbUluZGV4LCB2YWw6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlZBTFVFIikKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNhc2UgIlNQbWJwQ1NUX2V2YWxQYXJhbSI6IHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSB7IGtpbmQ6ICJTUG1icENTVC5ldmFsUGFyYW0iIH07CiAgICAgICAgICBpZiAoIXRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXSkgcmV0dXJuIG5vZGU7CiAgICAgICAgICBjb25zdCBwcm9jRGF0YSA9IHRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXVt0aGlzLnNjcmlwdC5wcm9jZWR1cmVDb2RlXTsKICAgICAgICAgIGNvbnN0IHByb2NlZHVyZUJsb2NrID0gcHJvY0RhdGE/LmJsb2NrOwogICAgICAgICAgaWYgKHByb2NlZHVyZUJsb2NrKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtSW5kZXggPSB0aGlzLnNjcmlwdC5hcmd1bWVudHMubGFzdEluZGV4T2YoYmxvY2suZmllbGRzLlBBUkFNLnZhbHVlKTsKICAgICAgICAgICAgY29uc3QgYXJnSWRzID0gSlNPTi5wYXJzZShwcm9jZWR1cmVCbG9jay5tdXRhdGlvbi5hcmd1bWVudGlkcyk7CiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICBjb25zdCBhcmcgPSBwcm9jZWR1cmVCbG9jay5pbnB1dHNbYXJnSWRzW3BhcmFtSW5kZXhdXTsKICAgICAgICAgICAgICBpZiAoYXJnPy5ibG9jayAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IHRoaXMudGFyZ2V0LmJsb2Nrcy5nZXRCbG9jayhhcmcuYmxvY2spOwogICAgICAgICAgICAgICAgbm9kZVsiaW5wdXQiXSA9IHRoaXMuZGVzY2VuZElucHV0KGlucHV0KTsKICAgICAgICAgICAgICAgIG5vZGVbImluZGV4Il0gPSBwYXJhbUluZGV4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgICAgfQogICAgICAgIGNhc2UgIlNQbWJwQ1NUX3J1bkJyYW5jaCI6IHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSB7IGtpbmQ6ICJTUG1icENTVC5ydW5CcmFuY2giLCBpbmRleDogdGhpcy5kZXNjZW5kSW5wdXRPZkJsb2NrKGJsb2NrLCAiSU5ERVgiKSB9OwogICAgICAgICAgaWYgKCF0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0pIHJldHVybiBub2RlOwogICAgICAgICAgY29uc3QgcHJvY0RhdGEgPSB0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV1bdGhpcy5zY3JpcHQucHJvY2VkdXJlQ29kZV07CiAgICAgICAgICBjb25zdCBwcm9jZWR1cmVCbG9jayA9IHByb2NEYXRhPy5ibG9jazsKICAgICAgICAgIGlmIChwcm9jZWR1cmVCbG9jaykgbm9kZS5hcHBlbmRlcnMgPSBwcm9jRGF0YS5hcHBlbmRlcnM7CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIF9vZ0lSZGVzY2VuZFN0YWNrLmNhbGwodGhpcywgYmxvY2spOwogICAgICB9CiAgICB9OwogICAgY29uc3QgX29nSVJkZXNjZW5kSW5wID0gU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0OwogICAgU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0ID0gZnVuY3Rpb24oYmxvY2spIHsKICAgICAgaWYgKGJsb2NrLm9wY29kZSA9PT0gIlNQbWJwQ1NUX2dldFBhcmFtIikgcmV0dXJuIHsga2luZDogIlNQbWJwQ1NULmdldFBhcmFtIiwgcGFyYW06IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlBBUkFNIikgfTsKICAgICAgZWxzZSByZXR1cm4gX29nSVJkZXNjZW5kSW5wLmNhbGwodGhpcywgYmxvY2spOwogICAgfTsKICAgIGNvbnN0IF9vZ0pTZGVzY2VuZFN0YWNrID0gSlNHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2s7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jayA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgc3dpdGNoIChub2RlLmtpbmQpIHsKICAgICAgICBjYXNlICJwcm9jZWR1cmVzLmNhbGwiOiB7CiAgICAgICAgICAvLyBUaGlzIGFsc28gZ2V0cyBHbG9iYWwgUHJvY2VkdXJlcyB0byB3b3JrIGZvciBzb21lIHJlYXNvbgogICAgICAgICAgY29uc3QgYXJnSW5kZXhlcyA9IFtdOwogICAgICAgICAgbGV0IGZvcmNlWWllbGQgPSBmYWxzZTsKICAgICAgICAgIGNvbnN0IG9nU291cmNlID0gdGhpcy5zb3VyY2U7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUuYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFyZyA9IG5vZGUuYXJndW1lbnRzW2ldOwogICAgICAgICAgICBpZiAoIWFyZy52YWx1ZSB8fCAhYXJnLm1icEtleSkgY29udGludWU7CiAgICAgICAgICAgIHRoaXMuc291cmNlID0gIiI7CiAgICAgICAgICAgIHRoaXMuZGVzY2VuZFN0YWNrKGFyZy52YWx1ZSwgbmV3IGV4cC5GcmFtZShmYWxzZSkpOwogICAgICAgICAgICBpZiAodGhpcy5zY3JpcHQueWllbGRzKSB7CiAgICAgICAgICAgICAgYXJnLnZhbHVlID0gYGZ1bmN0aW9uKiAoKSB7ICR7dGhpcy5zb3VyY2V9IH1gOwogICAgICAgICAgICAgIGZvcmNlWWllbGQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgYXJnLnZhbHVlID0gYCgpID0+IHsgJHt0aGlzLnNvdXJjZX0gfWA7CiAgICAgICAgICAgIGFyZ0luZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc291cmNlID0gb2dTb3VyY2U7CgogICAgICAgICAgaWYgKGFyZ0luZGV4ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIHRyYW5zZm9ybSB0aGUgYnJhbmNoIHN0cmluZyB0byBhIGZ1bmN0aW9uCiAgICAgICAgICAgIC8vIG1vZGlmaWVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1R1cmJvV2FycC9zY3JhdGNoLXZtL2Jsb2IvZGV2ZWxvcC9zcmMvY29tcGlsZXIvanNnZW4uanMKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlQ29kZSA9IG5vZGUuY29kZTsKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlVmFyaWFudCA9IG5vZGUudmFyaWFudDsKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlRGF0YSA9IHRoaXMuaXIucHJvY2VkdXJlc1twcm9jZWR1cmVWYXJpYW50XTsKICAgICAgICAgICAgaWYgKHByb2NlZHVyZURhdGEuc3RhY2sgPT09IG51bGwpIGJyZWFrOwoKICAgICAgICAgICAgY29uc3QgeWllbGRGb3JSZWN1cnNpb24gPSAhdGhpcy5pc1dhcnAgJiYgcHJvY2VkdXJlQ29kZSA9PT0gdGhpcy5zY3JpcHQucHJvY2VkdXJlQ29kZTsKICAgICAgICAgICAgaWYgKHlpZWxkRm9yUmVjdXJzaW9uKSB0aGlzLnlpZWxkTm90V2FycCgpOwogICAgICAgICAgICBpZiAocHJvY2VkdXJlRGF0YS55aWVsZHMgfHwgZm9yY2VZaWVsZCkgdGhpcy5zb3VyY2UgKz0gInlpZWxkKiAiOwoKICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYHRocmVhZC5wcm9jZWR1cmVzWyIke3Nhbml0aXplKHByb2NlZHVyZVZhcmlhbnQpfSJdKGA7CiAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gbm9kZS5hcmd1bWVudHNbaV07CiAgICAgICAgICAgICAgaWYgKGFyZ0luZGV4ZXMuaW5kZXhPZihpKSA+IC0xKSBhcmdzLnB1c2goaW5wdXQudmFsdWUpOwogICAgICAgICAgICAgIGVsc2UgYXJncy5wdXNoKHRoaXMuZGVzY2VuZElucHV0KGlucHV0KS5hc1NhZmUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYXJncy5qb2luKCIsIikgKyAiKTtcbiI7CiAgICAgICAgICAgIHRoaXMucmVzZXRWYXJpYWJsZUlucHV0cygpOwoKICAgICAgICAgICAgaWYgKGZvcmNlWWllbGQpIHRoaXMuaXIucHJvY2VkdXJlc1twcm9jZWR1cmVWYXJpYW50XS55aWVsZHMgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSByZXR1cm4gX29nSlNkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBub2RlKTsKICAgICAgICB9CiAgICAgICAgY2FzZSAiU1BtYnBDU1Quc2V0UGFyYW0iOiB7CiAgICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmRlc2NlbmRJbnB1dChub2RlLnZhbCk7CiAgICAgICAgICBjb25zdCBpID0gbm9kZS5wYXJhbUluZGV4OwogICAgICAgICAgaWYgKGkgIT09IHVuZGVmaW5lZCAmJiBpICE9PSAtMSkgdGhpcy5zb3VyY2UgKz0gYHAke2l9ID0gJHt2YWwuYXNTYWZlKCl9O1xuYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVC5ldmFsUGFyYW0iOiB7CiAgICAgICAgICBpZiAobm9kZS5pbnB1dCA9PT0gdW5kZWZpbmVkKSBicmVhazsKICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUuaW5wdXQpOwogICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYHAke25vZGUuaW5kZXh9ID0gJHt2YWwuYXNVbmtub3duKCl9O1xuYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVC5ydW5CcmFuY2giOiB7CiAgICAgICAgICBpZiAodGhpcy5pc1Byb2NlZHVyZSkgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMubG9jYWxWYXJpYWJsZXMubmV4dCgpOwogICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgY29uc3QgJHtpbmRleH0gPSAke3RoaXMuZGVzY2VuZElucHV0KG5vZGUuaW5kZXgpLmFzTnVtYmVyKCl9IC0gMTtcbmA7CiAgICAgICAgICAgIHRoaXMuc291cmNlICs9IGBzd2l0Y2ggKCR7aW5kZXh9LnRvU3RyaW5nKCkpIHtcbmA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZS5hcHBlbmRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBhcmdJbmQgPSBub2RlLmFwcGVuZGVyc1tpXVswXTsKICAgICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgY2FzZSAiJHtpfSI6IHtcbmA7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc2NyaXB0LnlpZWxkcykgdGhpcy5zb3VyY2UgKz0gYHlpZWxkKiBwJHthcmdJbmR9KCk7XG5gOwogICAgICAgICAgICAgIGVsc2UgdGhpcy5zb3VyY2UgKz0gYHAke2FyZ0luZH0oKTtcbmA7CiAgICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYGJyZWFrO1xuYDsKICAgICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgfVxuYDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgfVxuYDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBkZWZhdWx0OiByZXR1cm4gX29nSlNkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBub2RlKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IF9vZ0pTZGVzY2VuZElucCA9IEpTR2VuZXJhdG9yLnByb3RvdHlwZS5kZXNjZW5kSW5wdXQ7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0ID0gZnVuY3Rpb24obm9kZSkgewogICAgICBpZiAobm9kZS5raW5kID09PSAiU1BtYnBDU1QuZ2V0UGFyYW0iKSB7CiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS5wYXJhbSkuYXNTYWZlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBleHAuVHlwZWRJbnB1dChgKCgpID0+IHsKICAgICAgICAgIGxldCBhID0gJHtKU09OLnN0cmluZ2lmeSh0aGlzLnNjcmlwdC5hcmd1bWVudHMpfSwgdiA9ICR7dmFsfTsKICAgICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ3N0cmluZycpIHYgPSAodikudG9TdHJpbmcoKTsKICAgICAgICAgIGNvbnN0IGkgPSBhLmluZGV4T2Yodik7CiAgICAgICAgICByZXR1cm4gaSA+IC0xID8gYXJndW1lbnRzW2ldLnRvU3RyaW5nKCkgOiAiIjsKICAgICAgICB9KSgpYCwgZXhwLlRZUEVfU1RSSU5HKTsKICAgICAgfSBlbHNlIGlmIChub2RlLmtpbmQgPT09ICJwcm9jZWR1cmVzLmNhbGwiKSB7CiAgICAgICAgLy8gVGhpcyBnZXRzIEdsb2JhbCBQcm9jZWR1cmVzIHRvIHdvcmsgZm9yIHNvbWUgcmVhc29uCiAgICAgICAgcmV0dXJuIF9vZ0pTZGVzY2VuZElucC5jYWxsKHRoaXMsIG5vZGUpOwogICAgICB9IGVsc2UgcmV0dXJuIF9vZ0pTZGVzY2VuZElucC5jYWxsKHRoaXMsIG5vZGUpOwogICAgfTsKICB9CgogIC8vIFNjcmF0Y2hCbG9ja3MgYW5kIEVkaXRvciBQYXRjaGVzCiAgZnVuY3Rpb24gc3luY0ZpZWxkQ29sb3JzKGJsb2NrKSB7CiAgICBmb3IgKGNvbnN0IGlucHV0IG9mIGJsb2NrLmlucHV0TGlzdCkgewogICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGlucHV0Py5maWVsZFJvdykgewogICAgICAgIGlmIChmaWVsZC5hcnJvd18pIHsgLy8gZHJvcGRvd24gZmllbGRzCiAgICAgICAgICBpZiAoZmllbGQuc291cmNlQmxvY2tfLmlzU2hhZG93KCkpIGZpZWxkLnNvdXJjZUJsb2NrXy5jbGVhclNoYWRvd0NvbG91cigpOwogICAgICAgIH0KICAgICAgICBpZiAoZmllbGQuYm94XykgeyAvLyB0ZXh0IGlucHV0IGZpZWxkcyBhbmQgcm91bmQgZHJvcGRvd25zCiAgICAgICAgICBmaWVsZC5ib3hfLnNldEF0dHJpYnV0ZSgiZmlsbCIsIGZpZWxkLnNvdXJjZUJsb2NrXy5nZXRDb2xvdXIoKSk7CiAgICAgICAgICBpZiAoZmllbGQuYm94Xy5oYXNBdHRyaWJ1dGUoInN0cm9rZSIpKSBmaWVsZC5ib3hfLnNldEF0dHJpYnV0ZSgic3Ryb2tlIiwgZmllbGQuc291cmNlQmxvY2tfLmdldENvbG91clRlcnRpYXJ5KCkpOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyBmb3Igc2hhZG93IGJsb2NrcywgaW5oZXJpdCB0aGUgdGVydGlhcnkgY29sb3IKICAgICAgaWYgKGlucHV0Py5jb25uZWN0aW9uPy50YXJnZXRDb25uZWN0aW9uPy5zb3VyY2VCbG9ja18pIHsKICAgICAgICBjb25zdCBvdGhlckJsb2NrID0gaW5wdXQ/LmNvbm5lY3Rpb24/LnRhcmdldENvbm5lY3Rpb24/LnNvdXJjZUJsb2NrXzsKICAgICAgICBpZiAob3RoZXJCbG9jay5pc1NoYWRvdygpKSB7CiAgICAgICAgICAvLyBwZW5ndWlubW9kIGRvZXNudCBoYXZlIHF1YXRlcm5hcnkgY29sb3JzIHlldAogICAgICAgICAgaWYgKGlzUE0pIG90aGVyQmxvY2suc2V0Q29sb3VyKG90aGVyQmxvY2suZ2V0Q29sb3VyKCksIG90aGVyQmxvY2suZ2V0Q29sb3VyU2Vjb25kYXJ5KCksIGJsb2NrLmdldENvbG91clRlcnRpYXJ5KCkpOwogICAgICAgICAgZWxzZSBvdGhlckJsb2NrLnNldENvbG91cihvdGhlckJsb2NrLmdldENvbG91cigpLCBvdGhlckJsb2NrLmdldENvbG91clNlY29uZGFyeSgpLCBibG9jay5nZXRDb2xvdXJUZXJ0aWFyeSgpLCBvdGhlckJsb2NrLmdldENvbG91clF1YXRlcm5hcnkoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgIGNvbnN0IHJlY29sb3JhYmxlcyA9IFsKICAgICAgImFyZ3VtZW50X3JlcG9ydGVyX3N0cmluZ19udW1iZXIiLCAiYXJndW1lbnRfcmVwb3J0ZXJfYm9vbGVhbiIsCiAgICAgICJTUG1icENTVF9zZXRQYXJhbSIsICJTUG1icENTVF9nZXRQYXJhbSIsICJTUG1icENTVF9ydW5CcmFuY2giLAogICAgICAiU1BtYnBDU1RfZXZhbFBhcmFtIiwgInByb2NlZHVyZXNfcmV0dXJuIiwKICAgICAgLy8gcGVuZ3Vpbm1vZAogICAgICAicHJvY2VkdXJlc19kZWZpbml0aW9uX3JldHVybiIsICJwcm9jZWR1cmVzX3NldCIKICAgIF07CgogICAgbGV0IGRvbVRvQmxvY2tYbWwgPSBudWxsOwogICAgY29uc3Qgb2xkRFRCSCA9IFNCLlhtbC5kb21Ub0Jsb2NrSGVhZGxlc3NfOwogICAgU0IuWG1sLmRvbVRvQmxvY2tIZWFkbGVzc18gPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgIGRvbVRvQmxvY2tYbWwgPSBhcmdzWzBdOwogICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IG9sZERUQkguYXBwbHkodGhpcywgYXJncyk7CiAgICAgIGRvbVRvQmxvY2tYbWwgPSBudWxsOwogICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICB9CgogICAgY29uc3Qgb2xkU2Nyb2xsVG9DYXRlZ29yeSA9IFNCLlRvb2xib3gucHJvdG90eXBlLnNjcm9sbFRvQ2F0ZWdvcnlCeUlkOwogICAgU0IuVG9vbGJveC5wcm90b3R5cGUuc2Nyb2xsVG9DYXRlZ29yeUJ5SWQgPSBmdW5jdGlvbihpZCkgewogICAgICBpZiAoaWQgPT09ICJteUJsb2NrcyIgJiYgc2hvdWxkU2Nyb2xsVG9NQlApIHsKICAgICAgICBzaG91bGRTY3JvbGxUb01CUCA9IGZhbHNlOwogICAgICAgIGlkID0gIlNQbWJwQ1NUIjsKICAgICAgfQogICAgICByZXR1cm4gb2xkU2Nyb2xsVG9DYXRlZ29yeS5jYWxsKHRoaXMsIGlkKTsKICAgIH0KCiAgICBjb25zdCB1dGlscyA9IFNCLlNjcmF0Y2hCbG9ja3MuUHJvY2VkdXJlVXRpbHM7CiAgICBjb25zdCBvZ1VwZGF0ZURpc3BsYXkgPSB1dGlscy51cGRhdGVEaXNwbGF5XzsKICAgIHV0aWxzLnVwZGF0ZURpc3BsYXlfID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChleHRlbnNpb25SZW1vdmFibGUpIHJldHVybiBvZ1VwZGF0ZURpc3BsYXkuY2FsbCh0aGlzKTsKICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLlNQbWJwQ1NUX3N0b3JlIHx8IHN0b3JlR2V0KHRoaXMucHJvY0NvZGVfKTsKICAgICAgaWYgKHN0b3JlLmNvbG9yICYmICF0aGlzLmlzSW5zZXJ0aW9uTWFya2VyKCkpIHsKICAgICAgICB0aGlzLnNldENvbG91ciguLi50aGVtZWlmeUNvbG9yKHN0b3JlLmNvbG9yKSk7CiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gInByb2NlZHVyZXNfcHJvdG90eXBlIikgewogICAgICAgICAgLy8gUmVjb2xvciBhcmd1bWVudCByZXBvcnRlcnMgYW5kIHRoZSBkZWZpbmUgYmxvY2sgdG8gdGhlIGJsb2NrIGNvbG9yCiAgICAgICAgICAvLyBEaXNhYmxlIGJyYW5jaCBpbnB1dHMKICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKC4uLnRoZW1laWZ5Q29sb3Ioc3RvcmUuY29sb3IpKTsKICAgICAgICAgIC8vIFNjcmF0Y2hCbG9ja3Mgd2F5cyBvZiBnZXR0aW5nIHRoZSBwYXJlbnQgYmxvY2sgd29uJ3Qgd29yayB3aGlsZSB0aGUgYmxvY2tzIGFyZSBiZWluZyBjcmVhdGVkCiAgICAgICAgICBxdWV1ZU1pY3JvdGFzaygoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGRlZmluZUJsb2NrID0gdGhpcy5nZXRQYXJlbnQoKTsKICAgICAgICAgICAgaWYgKCFkZWZpbmVCbG9jaykgcmV0dXJuOwogICAgICAgICAgICBkZWZpbmVCbG9jay5zZXRDb2xvdXIoLi4udGhlbWVpZnlDb2xvcihzdG9yZS5jb2xvcikpOwogICAgICAgICAgICBzeW5jRmllbGRDb2xvcnMoZGVmaW5lQmxvY2spOwogICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuaW5wdXRMaXN0LmZpbHRlcigoaXRlbSwgaSkgPT4gaXRlbS5jb25uZWN0aW9uICE9PSBudWxsKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICghY2hpbGRyZW5baV0uY29ubmVjdGlvbikgY29udGludWU7CiAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXS5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7CiAgICAgICAgICAgICAgaWYgKHN0b3JlLmlucHV0cykgewogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IHN0b3JlLmlucHV0c1t0aGlzLmFyZ3VtZW50SWRzX1tpXV0/LnR5cGU7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gImJyYyIpIHsKICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0T3V0cHV0U2hhcGUoMyk7CiAgICAgICAgICAgICAgICAgIGNoaWxkLnNldE5leHRTdGF0ZW1lbnQoZmFsc2UpOwogICAgICAgICAgICAgICAgICBjaGlsZC5zZXRNb3ZhYmxlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgY2hpbGRbdGFyZ2V0UHJvY0RhdGFdID0gImJyYW5jaERyYWciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocmVjb2xvcmFibGVzLmluY2x1ZGVzKGNoaWxkLnR5cGUpKSB1cGRhdGVBcmd1bWVudFJlcG9ydGVyQ29sb3IoY2hpbGQsIGRlZmluZUJsb2NrKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIFJlY29sb3IgZHJvcGRvd25zIHRvIHRoZSBibG9jayBjb2xvcgogICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX2NhbGwiKSB7CiAgICAgICAgICBxdWV1ZU1pY3JvdGFzaygoKSA9PiB7CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5nZXRDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzU2hhZG93KCkgJiYgY2hpbGQub3V0cHV0Q29ubmVjdGlvbiAmJiAhaXNOb3JtYWxJbnB1dChjaGlsZC50eXBlKSkgY2hpbGQuc2V0Q29sb3VyKC4uLnRoZW1laWZ5Q29sb3Ioc3RvcmUuY29sb3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBEaXNjb25uZWN0IGFuZCByZWNvbm5lY3QgdGhlIHByb3RvdHlwZSBmcm9tIHRoZSBkZWZpbmUgYmxvY2sgd2hlbgogICAgICAvLyBjaGFuZ2luZyB0aGUgb3V0cHV0IHR5cGUgaW4gUE0gYmVjYXVzZSBvdGhlcndpc2UgZXJyb3JzIHdpbGwgaGFwcGVuCiAgICAgIC8vIHdlIGhhdmUgdG8gY3JlYXRlIGEgbmV3IGRlZmluZSBibG9jayB0byBjaGFuZ2UgaXRzIHR5cGUKICAgICAgbGV0IGRlZmluZUJsb2NrID0gKAogICAgICAgIGlzUE0gJiYgdGhpcy50eXBlID09PSAicHJvY2VkdXJlc19wcm90b3R5cGUiICYmIHRoaXMuZ2V0UGFyZW50KCk/LnR5cGU/LnN0YXJ0c1dpdGgoInByb2NlZHVyZXNfZGVmaW5pdGlvbiIpCiAgICAgICkgPyB0aGlzLmdldFBhcmVudCgpIDogbnVsbDsKICAgICAgbGV0IHNhdmVkRGVmQ29ubmVjdCA9IG51bGwsIHNhdmVkU2hhZG93ID0gbnVsbDsKICAgICAgY29uc3QgbmV3T3Bjb2RlID0gdGhpcy5vdXRwdXRfID8gInByb2NlZHVyZXNfZGVmaW5pdGlvbl9yZXR1cm4iIDogInByb2NlZHVyZXNfZGVmaW5pdGlvbiI7CiAgICAgIGlmIChpc1BNICYmIGRlZmluZUJsb2NrICYmIGRlZmluZUJsb2NrLnR5cGUgIT09IG5ld09wY29kZSkgewogICAgICAgIHNhdmVkRGVmQ29ubmVjdCA9ICh0aGlzLnByZXZpb3VzQ29ubmVjdGlvbiB8fCB0aGlzLm91dHB1dENvbm5lY3Rpb24pLnRhcmdldENvbm5lY3Rpb247CiAgICAgICAgc2F2ZWRTaGFkb3cgPSBzYXZlZERlZkNvbm5lY3QuZ2V0U2hhZG93RG9tKCk7CiAgICAgICAgY29uc3Qgc2F2ZWROZXh0Q29ubmVjdCA9IGRlZmluZUJsb2NrLm5leHRDb25uZWN0aW9uPy50YXJnZXRDb25uZWN0aW9uOwoKICAgICAgICAvLyBSZW1vdmUgdGhlIHNoYWRvdyBET00sIHRoZW4gZGlzY29ubmVjdCB0aGUgYmxvY2suICBPdGhlcndpc2UgYSBzaGFkb3cgYmxvY2sKICAgICAgICAvLyB3aWxsIHJlc3Bhd24gaW5zdGFudGx5LCBhbmQgd2UnZCBoYXZlIHRvIHJlbW92ZSBpdCB3aGVuIHdlIHJlbW92ZSB0aGUgaW5wdXQuCiAgICAgICAgc2F2ZWROZXh0Q29ubmVjdD8uZGlzY29ubmVjdCgpOwoKICAgICAgICAvLyBSZWNyZWF0ZSB0aGUgZGVmaW5lIGJsb2NrIHdpdGggYSBjaGFuZ2VkIHR5cGUKICAgICAgICBjb25zdCB3cyA9IGRlZmluZUJsb2NrLndvcmtzcGFjZTsKICAgICAgICBjb25zdCB4bWwgPSBTQi5YbWwuYmxvY2tUb0RvbShkZWZpbmVCbG9jayk7CiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBkZWZpbmVCbG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7CiAgICAgICAgeG1sLnNldEF0dHJpYnV0ZSgidHlwZSIsIG5ld09wY29kZSk7CiAgICAgICAgZGVmaW5lQmxvY2suZGlzcG9zZSgpOwogICAgICAgIGRlZmluZUJsb2NrID0gU0IuWG1sLmRvbVRvQmxvY2soeG1sLCB3cyk7CiAgICAgICAgZGVmaW5lQmxvY2subW92ZUJ5KHBvc2l0aW9uLngsIHBvc2l0aW9uLnkpOwogICAgICAgIGlmIChzYXZlZE5leHRDb25uZWN0KSBzYXZlZE5leHRDb25uZWN0LmNvbm5lY3QoZGVmaW5lQmxvY2submV4dENvbm5lY3Rpb24pOwogICAgICB9CiAgICAgIG9nVXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpOwoKICAgICAgLy8gdHVybiBicmFuY2ggYW5kIGltYWdlIGlucHV0cyBpbnRvIGJyYW5jaGVzIGFuZCBpbWFnZXMKICAgICAgLy8gKGRvaW5nIGl0IGluIGF0dGFjaFNoYWRvdyBtYWtlcyBpdCBub3Qgd29yayBvbiBmdXJ0aGVyIHVwZGF0ZXMpCiAgICAgIGlmIChzdG9yZT8uaW5wdXRzICYmIHRoaXMudHlwZSAhPT0gInByb2NlZHVyZXNfZGVjbGFyYXRpb24iKSBmb3IgKGxldCBpID0gdGhpcy5pbnB1dExpc3QubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsKICAgICAgICBjb25zdCB0eXBlID0gc3RvcmUuaW5wdXRzW2lucHV0Lm5hbWVdPy50eXBlOwogICAgICAgIGlmICgKICAgICAgICAgIChpbnB1dC50eXBlICE9PSBTQi5ORVhUX1NUQVRFTUVOVCAmJiB0eXBlID09PSAiYnJjIikgfHwgKGlucHV0LnR5cGUgIT09IFNCLkRVTU1ZX0lOUFVUICYmIHR5cGUgPT09ICJpbWciKQogICAgICAgICkgewogICAgICAgICAgLy8gZm9yIFByb3RvdHlwZSBibG9ja3Mgd2UganVzdCB1c2UgYSBzdGF0aWMgc3F1YXJlIGJsb2NrIGFzIGEgdmlzdWFsIHJlcHJlc2VudGF0aW9uCiAgICAgICAgICAvLyBmb3IgYnJhbmNoIGlucHV0cywgdGhpcyBpcyBkb25lIGluICd1cGRhdGVEaXNwbGF5XycKICAgICAgICAgIGlmICh0eXBlID09PSAiYnJjIiAmJiB0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIpIGNvbnRpbnVlOwogICAgICAgICAgbGV0IGNvbm5lY3Rpb24sIG5ld0lucHV0OwogICAgICAgICAgaWYgKHR5cGUgPT09ICJicmMiKSB7CiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSB0aGlzLm1ha2VDb25uZWN0aW9uXyhTQi5ORVhUX1NUQVRFTUVOVCk7CiAgICAgICAgICAgIG5ld0lucHV0ID0gbmV3IFNCLklucHV0KFNCLk5FWFRfU1RBVEVNRU5ULCBpbnB1dC5uYW1lLCB0aGlzLCBjb25uZWN0aW9uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGltYWdlVVJMID0gZ2V0U3RvcmVkSW1hZ2Uoc3RvcmUuaW5wdXRzW2lucHV0Lm5hbWVdLnNyYyk7CiAgICAgICAgICAgIG5ld0lucHV0ID0gbmV3IFNCLklucHV0KFNCLkRVTU1ZX0lOUFVULCAiIiwgdGhpcyk7CiAgICAgICAgICAgIG5ld0lucHV0LmFwcGVuZEZpZWxkKG5ldyBTY3JhdGNoQmxvY2tzLkZpZWxkSW1hZ2UoaW1hZ2VVUkwsIDI1LCAyNSkpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGlucHV0Li4uCiAgICAgICAgICBpZiAoaW5wdXQuY29ubmVjdGlvbiAmJiBpbnB1dC5jb25uZWN0aW9uLmlzQ29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgaW5wdXQuY29ubmVjdGlvbi5zZXRTaGFkb3dEb20obnVsbCk7CiAgICAgICAgICAgIHZhciBibG9jayA9IGlucHV0LmNvbm5lY3Rpb24udGFyZ2V0QmxvY2soKTsKICAgICAgICAgICAgaWYgKGJsb2NrLmlzU2hhZG93KCkpIGJsb2NrLmRpc3Bvc2UoKTsgLy8gRGVzdHJveSBhbnkgYXR0YWNoZWQgc2hhZG93IGJsb2NrCiAgICAgICAgICAgIGVsc2UgYmxvY2sudW5wbHVnKCk7IC8vIERpc2Nvbm5lY3QgYW55IGF0dGFjaGVkIG5vcm1hbCBibG9jawogICAgICAgICAgfQogICAgICAgICAgaW5wdXQuZGlzcG9zZSgpOwogICAgICAgICAgLy8gLi4uYnV0IHJlcGxhY2UgaXQgd2l0aCB0aGUgbmV3IG9uZSBpbiBwbGFjZQogICAgICAgICAgLy8gKGNhbGxpbmcgcmVtb3ZlSW5wdXQoKSBzaGlmdHMgYWxsIGVsZW1lbnRzIG9mIGlucHV0TGlzdCB3aGljaCBpcyBhIGJpdCBzbG93ZXIpCiAgICAgICAgICBpZiAodHlwZSA9PT0gImJyYyIgJiYgKGlzUE0gPyB0aGlzLm91dHB1dF8gOiB0aGlzLmdldFJldHVybigpKSkgdGhpcy5pbnB1dExpc3Quc3BsaWNlKGksIDEpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChpIHx8IHR5cGUgPT09ICJpbWciKSB0aGlzLmlucHV0TGlzdFtpXSA9IG5ld0lucHV0OwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvLyBmaXggd2VpcmQgdmlzdWFsIGdsaXRjaCB3aXRoIGEgYnJhbmNoIGFzIHRoZSBmaXJzdCBpbnB1dAogICAgICAgICAgICAgIHRoaXMuaW5wdXRMaXN0W2ldID0gdGhpcy5hcHBlbmREdW1teUlucHV0KCk7CiAgICAgICAgICAgICAgdGhpcy5pbnB1dExpc3QucHVzaChuZXdJbnB1dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzYXZlZERlZkNvbm5lY3QpIHsKICAgICAgICBzYXZlZERlZkNvbm5lY3QgPSBkZWZpbmVCbG9jay5nZXRJbnB1dCgiY3VzdG9tX2Jsb2NrIikuY29ubmVjdGlvbjsKICAgICAgICAodGhpcy5wcmV2aW91c0Nvbm5lY3Rpb24gfHwgdGhpcy5vdXRwdXRDb25uZWN0aW9uKS5jb25uZWN0KHNhdmVkRGVmQ29ubmVjdCk7CiAgICAgICAgc2F2ZWREZWZDb25uZWN0LnNldFNoYWRvd0RvbShzYXZlZFNoYWRvdyk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5pc0luc2VydGlvbk1hcmtlcigpKSB7CiAgICAgICAgLy8gU2NyYXRjaEJsb2NrcyB3YXlzIG9mIGdldHRpbmcgdGhlIG5leHQgYmxvY2sgd29uJ3Qgd29yayB3aGlsZSB0aGUgYmxvY2tzIGFyZSBiZWluZyBjcmVhdGVkCiAgICAgICAgY29uc3QgYWN0dWFsTmV4dEJsb2NrID0gdGhpcy5nZXROZXh0QmxvY2soKSB8fCB2bT8uZWRpdGluZ1RhcmdldD8uYmxvY2tzPy5nZXRCbG9jayh0aGlzLmlkKT8ubmV4dCB8fCAoZG9tVG9CbG9ja1htbCAmJiBkb21Ub0Jsb2NrWG1sLnF1ZXJ5U2VsZWN0b3IoIm5leHQiKSk7CiAgICAgICAgY29uc3QgaXNSZXR1cm5lciA9IGlzUE0gPyB0aGlzLm91dHB1dF8gOiB0aGlzLnJldHVybl87CiAgICAgICAgaWYgKCFzdG9yZS5pc1Rlcm1pbmFsICE9PSB1bmRlZmluZWQgJiYgIWlzUmV0dXJuZXIgJiYgIWFjdHVhbE5leHRCbG9jaykgdGhpcy5zZXROZXh0U3RhdGVtZW50KCFzdG9yZS5pc1Rlcm1pbmFsLCB0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIgPyB0cnVlIDogdW5kZWZpbmVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGUgaW5zZXJ0aW9uIG1hcmtlciBzaG91bGQgY29weSB0aGUgdGVybWluYWwtbmVzcyBvZiB0aGUgc291cmNlIGJsb2NrLAogICAgICAgIC8vIG90aGVyd2lzZSBCbG9ja2x5IHdpbGwgdGhyb3cgYW4gZXJyb3IKICAgICAgICBjb25zdCB0YXJnZXRCbG9jayA9IHRoaXMud29ya3NwYWNlPy5jdXJyZW50R2VzdHVyZV8/LnRhcmdldEJsb2NrXzsKICAgICAgICAvLyB0YXJnZXRCbG9jayBkb2Vzbid0IGV4aXN0IHdoZW4gZHJhZ2dpbmcgdG8gdGhlIHN0YXJ0IG9mIGEgc3RhY2sKICAgICAgICAvLyBJbiB0aGlzIGNhc2UsIGl0IHNob3VsZCBhbHdheXMgYmUgYSBzdGFjayBibG9jawogICAgICAgIHRoaXMuc2V0TmV4dFN0YXRlbWVudCh0YXJnZXRCbG9jayA/ICEhdGFyZ2V0QmxvY2s/Lm5leHRDb25uZWN0aW9uIDogdHJ1ZSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3Qgb3Bjb2RlIG9mIFsicHJvY2VkdXJlc19jYWxsIiwgInByb2NlZHVyZXNfcHJvdG90eXBlIiwgInByb2NlZHVyZXNfZGVjbGFyYXRpb24iXSkgewogICAgICBTQi5CbG9ja3Nbb3Bjb2RlXS51cGRhdGVEaXNwbGF5XyA9IHV0aWxzLnVwZGF0ZURpc3BsYXlfOwogICAgfQoKICAgIGNvbnN0IG9nQXR0YWNoU2hhZG93ID0gdXRpbHMuYXR0YWNoU2hhZG93XzsKICAgIHV0aWxzLmF0dGFjaFNoYWRvd18gPSBmdW5jdGlvbihpbnB1dCwgYXJndW1lbnRUeXBlKSB7CiAgICAgIGlmIChleHRlbnNpb25SZW1vdmFibGUpIHJldHVybiBvZ0F0dGFjaFNoYWRvdy5jYWxsKHRoaXMsIGlucHV0LCBhcmd1bWVudFR5cGUpOwogICAgICBjb25zdCBzdG9yZSA9IHRoaXMuU1BtYnBDU1Rfc3RvcmUgfHwgc3RvcmVHZXQodGhpcy5nZXRQcm9jQ29kZSgpKTsKICAgICAgaWYgKCFzdG9yZSB8fCAhc3RvcmUuaW5wdXRzIHx8ICFzdG9yZS5pbnB1dHNbaW5wdXQubmFtZV0pIHJldHVybiBvZ0F0dGFjaFNoYWRvdy5jYWxsKHRoaXMsIGlucHV0LCBhcmd1bWVudFR5cGUpOwogICAgICBjb25zdCB7IG9wY29kZSwgZmllbGROYW1lLCBkZWZhdWx0VmFsdWUgfSA9IGdldElucHV0RGF0YShzdG9yZS5pbnB1dHNbaW5wdXQubmFtZV0pOwogICAgICBpZiAoIW9wY29kZSkgcmV0dXJuIG9nQXR0YWNoU2hhZG93LmNhbGwodGhpcywgaW5wdXQsIGFyZ3VtZW50VHlwZSk7CiAgICAgIGlmIChvcGNvZGUgPT09ICJicmMiIHx8IG9wY29kZSA9PT0gImVtcCIgfHwgb3Bjb2RlID09PSAiaW1nIikgcmV0dXJuOyAvLyB0aGVzZSBhcmUgc3BlY2lhbAoKICAgICAgLy8gQWRkIGN1c3RvbSBpbnB1dHMKICAgICAgY29uc3QgYmxvY2tUeXBlID0gb3Bjb2RlOwogICAgICBTQi5FdmVudHMuZGlzYWJsZSgpOwogICAgICBsZXQgbmV3QmxvY2s7CiAgICAgIHRyeSB7CiAgICAgICAgbmV3QmxvY2sgPSB0aGlzLndvcmtzcGFjZS5uZXdCbG9jayhibG9ja1R5cGUpOwogICAgICAgIGlmIChmaWVsZE5hbWUpIG5ld0Jsb2NrLnNldEZpZWxkVmFsdWUoZGVmYXVsdFZhbHVlIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBkZWZhdWx0VmFsdWUoKSA6IGRlZmF1bHRWYWx1ZSwgZmllbGROYW1lKTsKICAgICAgICBuZXdCbG9jay5zZXRTaGFkb3codHJ1ZSk7CiAgICAgICAgaWYgKCF0aGlzLmlzSW5zZXJ0aW9uTWFya2VyKCkpIHsKICAgICAgICAgIG5ld0Jsb2NrLmluaXRTdmcoKTsKICAgICAgICAgIG5ld0Jsb2NrLnJlbmRlcihmYWxzZSk7CiAgICAgICAgfQogICAgICB9IGZpbmFsbHkgewogICAgICAgIFNCLkV2ZW50cy5lbmFibGUoKTsKICAgICAgfQogICAgICBpZiAoU0IuRXZlbnRzLmlzRW5hYmxlZCgpKSBTQi5FdmVudHMuZmlyZShuZXcgU0IuRXZlbnRzLkJsb2NrQ3JlYXRlKG5ld0Jsb2NrKSk7CiAgICAgIG5ld0Jsb2NrPy5vdXRwdXRDb25uZWN0aW9uLmNvbm5lY3QoaW5wdXQuY29ubmVjdGlvbik7CiAgICB9OwogICAgU0IuQmxvY2tzWyJwcm9jZWR1cmVzX2NhbGwiXS5hdHRhY2hTaGFkb3dfID0gdXRpbHMuYXR0YWNoU2hhZG93XzsKCiAgICBjb25zdCBvZ1BvcEFyZyA9IHV0aWxzLnBvcHVsYXRlQXJndW1lbnRPbkNhbGxlcl87CiAgICB1dGlscy5wb3B1bGF0ZUFyZ3VtZW50T25DYWxsZXJfID0gZnVuY3Rpb24odHlwZSwgaW5kZXgsIGNvbm5lY3Rpb25NYXAsIGlkLCBpbnB1dCkgewogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vVHVyYm9XYXJwL3NjcmF0Y2gtYmxvY2tzL2Jsb2IvZGV2ZWxvcC9ibG9ja3NfdmVydGljYWwvcHJvY2VkdXJlcy5qcyNMNDQ1CiAgICAgIHZhciBvbGRCbG9jayA9IG51bGwsIG9sZFNoYWRvdyA9IG51bGw7CiAgICAgIGlmIChjb25uZWN0aW9uTWFwICYmIChpZCBpbiBjb25uZWN0aW9uTWFwKSkgewogICAgICAgIHZhciBzYXZlSW5mbyA9IGNvbm5lY3Rpb25NYXBbaWRdOwogICAgICAgIG9sZEJsb2NrID0gc2F2ZUluZm9bImJsb2NrIl07CiAgICAgICAgb2xkU2hhZG93ID0gc2F2ZUluZm9bInNoYWRvdyJdOwogICAgICB9CgogICAgICBpZiAoY29ubmVjdGlvbk1hcCAmJiBvbGRCbG9jaykgewogICAgICAgIC8vIFJlYXR0YWNoIHRoZSBvbGQgYmxvY2sgYW5kIHNoYWRvdyBET00uCiAgICAgICAgY29ubmVjdGlvbk1hcFtpbnB1dC5uYW1lXSA9IG51bGw7CiAgICAgICAgaWYgKG9sZFNoYWRvdyA9PT0gbnVsbCAmJiBvbGRCbG9jay5vdXRwdXRDb25uZWN0aW9uID09PSBudWxsKSB7CiAgICAgICAgICAvLyB0aGlzIGlzIGEgYnJhbmNoCiAgICAgICAgICBjb25zdCBwYXJlbnQgPSBpbnB1dC5jb25uZWN0aW9uLnNvdXJjZUJsb2NrXzsKICAgICAgICAgIGlmIChpc1BNICYmIHRoaXMub3V0cHV0XykgcmV0dXJuOwogICAgICAgICAgY29uc3QgYnJhbmNoSW5kZXggPSBwYXJlbnQuaW5wdXRMaXN0LmluZGV4T2YoaW5wdXQpOwogICAgICAgICAgcGFyZW50LmlucHV0TGlzdFticmFuY2hJbmRleF0uY29ubmVjdGlvbi50eXBlID0gMzsKICAgICAgICAgIHBhcmVudC5pbnB1dExpc3RbYnJhbmNoSW5kZXhdLnR5cGUgPSAzOwogICAgICAgICAgcGFyZW50LmlucHV0TGlzdFticmFuY2hJbmRleF0uY29ubmVjdGlvbi5jb25uZWN0KG9sZEJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9sZEJsb2NrLm91dHB1dENvbm5lY3Rpb24uY29ubmVjdChpbnB1dC5jb25uZWN0aW9uKTsKICAgICAgICAgIGlmICh0eXBlICE9ICJiIiAmJiB0aGlzLmdlbmVyYXRlU2hhZG93c18pIHsKICAgICAgICAgICAgdmFyIHNoYWRvd0RvbSA9IG9sZFNoYWRvdyB8fCB0aGlzLmJ1aWxkU2hhZG93RG9tXyh0eXBlKTsKICAgICAgICAgICAgaW5wdXQuY29ubmVjdGlvbi5zZXRTaGFkb3dEb20oc2hhZG93RG9tKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5nZW5lcmF0ZVNoYWRvd3NfKSB7CiAgICAgICAgdGhpcy5hdHRhY2hTaGFkb3dfKGlucHV0LCB0eXBlKTsKICAgICAgfQogICAgfTsKICAgIFNCLkJsb2Nrc1sicHJvY2VkdXJlc19jYWxsIl0ucG9wdWxhdGVBcmd1bWVudF8gPSB1dGlscy5wb3B1bGF0ZUFyZ3VtZW50T25DYWxsZXJfOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUFyZ3VtZW50UmVwb3J0ZXJDb2xvcihibG9jaywgZGVmaW5lQmxvY2sgPSBudWxsKSB7CiAgICAgIC8vIEp1c3Qgc3RvcHBlZCBkcmFnZ2luZyAoYW5kIGRyb3BwaW5nKSwgdXBkYXRlIGNvbG9yIGFjY29yZGluZyB0byB0aGUgdG9wIGRlZmluZSBibG9jawogICAgICBpZiAoZXh0ZW5zaW9uUmVtb3ZhYmxlKSByZXR1cm47CiAgICAgIGlmICghZGVmaW5lQmxvY2spIHsKICAgICAgICBkZWZpbmVCbG9jayA9IGJsb2NrOwogICAgICAgIHdoaWxlIChkZWZpbmVCbG9jaz8uZ2V0UGFyZW50KCkpIHsgZGVmaW5lQmxvY2sgPSBkZWZpbmVCbG9jaz8uZ2V0UGFyZW50KCkgfQogICAgICB9CiAgICAgIGlmIChkZWZpbmVCbG9jaz8udHlwZS5zdGFydHNXaXRoKCJwcm9jZWR1cmVzX2RlZmluaXRpb24iKSkgewogICAgICAgIGlmIChibG9ja1t0YXJnZXRQcm9jRGF0YV0gPT09ICJicmFuY2hEcmFnIikgewogICAgICAgICAgYmxvY2suc2V0Q29sb3VyKGRlZmluZUJsb2NrLmNvbG91clNlY29uZGFyeV8sIGRlZmluZUJsb2NrLmNvbG91clNlY29uZGFyeV8sIGRlZmluZUJsb2NrLmNvbG91clRlcnRpYXJ5Xyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJsb2NrLnNldENvbG91cihkZWZpbmVCbG9jay5jb2xvdXJfLCBkZWZpbmVCbG9jay5jb2xvdXJTZWNvbmRhcnlfLCBkZWZpbmVCbG9jay5jb2xvdXJUZXJ0aWFyeV8pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBibG9jay5zZXRDb2xvdXIoLi4uT2JqZWN0LnZhbHVlcyhTQi5Db2xvdXJzLm1vcmUpKTsKICAgICAgfQogICAgICBzeW5jRmllbGRDb2xvcnMoYmxvY2spOwogICAgfQoKICAgIGNvbnN0IG9nU2V0RHJhZ2dpbmcgPSBTQi5CbG9ja1N2Zy5wcm90b3R5cGUuc2V0RHJhZ2dpbmc7CiAgICBjb25zdCBhcmd1bWVudFJlcG9ydGVyU2V0RHJhZ2dpbmcgPSBmdW5jdGlvbihhZGRpbmcpIHsKICAgICAgaWYgKCFhZGRpbmcgJiYgIWV4dGVuc2lvblJlbW92YWJsZSAmJiB0aGlzLnN2Z0dyb3VwXy5jbGFzc0xpc3QuY29udGFpbnMoImJsb2NrbHlEcmFnZ2luZyIpKSB7CiAgICAgICAgcXVldWVNaWNyb3Rhc2soKCkgPT4gdXBkYXRlQXJndW1lbnRSZXBvcnRlckNvbG9yKHRoaXMpKTsKICAgICAgfQogICAgICBvZ1NldERyYWdnaW5nLmNhbGwodGhpcywgYWRkaW5nKTsKICAgIH07CiAgICAvLyB0aGlzIHdvdWxkIHJ1biB3aGVuIHRoZSBibG9jayBpcyBhZGRlZCB0byB0aGUgd29ya3NwYWNlCiAgICBjb25zdCBvZ1NldFBhcmVudCA9IFNCLkJsb2NrU3ZnLnByb3RvdHlwZS5zZXRQYXJlbnQ7CiAgICBjb25zdCBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50ID0gZnVuY3Rpb24obmV3UGFyZW50KSB7CiAgICAgIGlmIChuZXdQYXJlbnQgJiYgIWV4dGVuc2lvblJlbW92YWJsZSkgcXVldWVNaWNyb3Rhc2soKCkgPT4gdXBkYXRlQXJndW1lbnRSZXBvcnRlckNvbG9yKHRoaXMpKTsKICAgICAgb2dTZXRQYXJlbnQuY2FsbCh0aGlzLCBuZXdQYXJlbnQpOwogICAgfTsKCiAgICBmb3IgKGNvbnN0IG9wY29kZSBvZiByZWNvbG9yYWJsZXMpIHsKICAgICAgaWYgKCFTQi5CbG9ja3Nbb3Bjb2RlXSkgY29udGludWU7CiAgICAgIFNCLkJsb2Nrc1tvcGNvZGVdLnNldERyYWdnaW5nID0gYXJndW1lbnRSZXBvcnRlclNldERyYWdnaW5nOwogICAgICBTQi5CbG9ja3Nbb3Bjb2RlXS5zZXRQYXJlbnQgPSBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50OwogICAgfQogICAgdHJ5IHsKICAgICAgU0IuRXh0ZW5zaW9ucy5yZWdpc3RlcigiU1BtYnBDU1RfZGVmaW5lQ29sb3JlZCIsIGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuc2V0RHJhZ2dpbmcgPSBhcmd1bWVudFJlcG9ydGVyU2V0RHJhZ2dpbmc7CiAgICAgICAgdGhpcy5zZXRQYXJlbnQgPSBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50OwogICAgICAgIHVwZGF0ZUFyZ3VtZW50UmVwb3J0ZXJDb2xvcih0aGlzKTsKICAgICAgfSk7CiAgICB9IGNhdGNoIHsvKiBhbHJlYWR5IGRlZmluZWQgKi99CgogICAgLy8gVHVybiBwcm9jZWR1cmUgY2FsbHMgbWFya2VkIGFzIGNhcCBibG9ja3MgaW50byBjYXAgYmxvY2tzIGlmIHRoZXkgY2FuIGJlIHR1cm5lZCBpbnRvIGNhcCBibG9ja3MKICAgIGZ1bmN0aW9uIGNoZWNrQ2FwQmxvY2soYmxvY2spIHsKICAgICAgaWYgKCFibG9jay5pc0luc2VydGlvbk1hcmtlcigpKSB7CiAgICAgICAgY29uc3Qgc3RvcmUgPSBzdG9yZUdldChibG9jay5wcm9jQ29kZV8pOwogICAgICAgIGlmIChzdG9yZSAmJiBzdG9yZS5pc1Rlcm1pbmFsICYmIGJsb2NrLm5leHRDb25uZWN0aW9uICYmICFibG9jay5nZXROZXh0QmxvY2soKSkKICAgICAgICAgIGJsb2NrLnNldE5leHRTdGF0ZW1lbnQoIXN0b3JlLmlzVGVybWluYWwpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBpbnNlcnRpb24gbWFya2VyIHNob3VsZCBjb3B5IHRoZSBuZXh0IGNvbm5lY3Rpb24gb2YgdGhlIHNvdXJjZSBibG9jawogICAgICAgIGJsb2NrLnNldE5leHRTdGF0ZW1lbnQoQm9vbGVhbihibG9jay5nZXROZXh0QmxvY2soKSkpOwogICAgICB9CiAgICB9CiAgICAvLyBGb3IgdGhlIHByZXZpb3VzIGJsb2NrIHdoZW4gc3RhcnRpbmcgYSBkcmFnIG9mIHRoZSBjdXJyZW50IGJsb2NrCiAgICBjb25zdCBvZ1VucGx1ZyA9IFNCLkJsb2NrLnByb3RvdHlwZS51bnBsdWc7CiAgICBjb25zdCBwcm9jQ2FsbFVucGx1ZyA9IGZ1bmN0aW9uKG9wdF9oZWFsU3RhY2spIHsKICAgICAgaWYgKGV4dGVuc2lvblJlbW92YWJsZSB8fCB0aGlzLmlzSW5zZXJ0aW9uTWFya2VyKCkgfHwgdGhpcy5nZXRQYXJlbnQoKT8uaXNJbnNlcnRpb25NYXJrZXIoKSkgcmV0dXJuIG9nVW5wbHVnLmNhbGwodGhpcywgb3B0X2hlYWxTdGFjayk7CiAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50KCk7CiAgICAgIG9nVW5wbHVnLmNhbGwodGhpcywgb3B0X2hlYWxTdGFjayk7CiAgICAgIGNoZWNrQ2FwQmxvY2sodGhpcyk7CiAgICAgIGlmIChwYXJlbnQpIGNoZWNrQ2FwQmxvY2socGFyZW50KTsKICAgIH07CiAgICBTQi5CbG9ja3NbInByb2NlZHVyZXNfY2FsbCJdLnVucGx1ZyA9IHByb2NDYWxsVW5wbHVnOwoKICAgIC8vIENvcHkgdGhlIGRlZmluZSBibG9jaydzIGFyZ3VtZW50IGNvbG9yIHdoZW4gZHJhZ2dpbmcgYW4gYXJndW1lbnQgcmVwb3J0ZXIKICAgIGNvbnN0IG9sZER1cGxpY2F0ZU9uRHJhZ18gPSBTQi5HZXN0dXJlLnByb3RvdHlwZS5kdXBsaWNhdGVPbkRyYWdfOwogICAgU0IuR2VzdHVyZS5wcm90b3R5cGUuZHVwbGljYXRlT25EcmFnXyA9IGZ1bmN0aW9uKCkgewogICAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnRhcmdldEJsb2NrXzsKICAgICAgb2xkRHVwbGljYXRlT25EcmFnXy5jYWxsKHRoaXMpOwogICAgICBjb25zdCBkdXBsaWNhdGVkID0gdGhpcy50YXJnZXRCbG9ja187CiAgICAgIGlmIChzb3VyY2UgJiYgZHVwbGljYXRlZCAmJiBzb3VyY2UudHlwZS5zdGFydHNXaXRoKCJhcmd1bWVudF9yZXBvcnRlcl8iKSkKICAgICAgICBkdXBsaWNhdGVkLnNldENvbG91cihzb3VyY2UuY29sb3VyXywgc291cmNlLmNvbG91clNlY29uZGFyeV8sIHNvdXJjZS5jb2xvdXJUZXJ0aWFyeV8pOwogICAgfTsKCiAgICAvLyBEaXNhYmxlIGJyYW5jaCBhcmd1bWVudCByZXBvcnRlciBkcmFnZ2luZwogICAgY29uc3Qgb2xkc3RhcnREcmFnZ2luZ18gPSBTQi5HZXN0dXJlLnByb3RvdHlwZS5zdGFydERyYWdnaW5nQmxvY2tfOwogICAgU0IuR2VzdHVyZS5wcm90b3R5cGUuc3RhcnREcmFnZ2luZ0Jsb2NrXyA9IGZ1bmN0aW9uKCkgewogICAgICBjb25zdCBzb3VyY2UgPSB0aGlzLnRhcmdldEJsb2NrXzsKICAgICAgaWYgKHNvdXJjZVt0YXJnZXRQcm9jRGF0YV0gPT09ICJicmFuY2hEcmFnIikgewogICAgICAgIHRoaXMuaXNEcmFnZ2luZ0Jsb2NrXyA9IGZhbHNlOwogICAgICAgIHRoaXMuZGlzcG9zZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBvbGRzdGFydERyYWdnaW5nXy5jYWxsKHRoaXMpOwogICAgfTsKCiAgICAvLyBQYXRjaCBQcm9jZWR1cmUgRWRpdCBhbmQgQ3JlYXRlIHRvIGFsc28gb3BlbiBvdXIgTW9kYWwKICAgIGNvbnN0IHByb2NzID0gU0IuUHJvY2VkdXJlczsKICAgIGNvbnN0IG9nQ3JlYXRlQ2FsbCA9IHByb2NzLmNyZWF0ZVByb2NlZHVyZURlZkNhbGxiYWNrXzsKICAgIGlmIChydW50aW1lLlNQbWJwQ1NUT2xkU3RvcmFnZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHByb2NzLmNyZWF0ZVByb2NlZHVyZURlZkNhbGxiYWNrXyA9IGZ1bmN0aW9uKHdvcmtzcGFjZSkgewogICAgICAgIGNvbnN0IHNoYXJlZFdvcmsgPSBTQi5tYWluV29ya3NwYWNlOwogICAgICAgIG9nQ3JlYXRlQ2FsbC5jYWxsKHRoaXMsIHdvcmtzcGFjZSk7CiAgICAgICAgb3BlbkJsb2NrTWFrZXIoc2hhcmVkV29yaywgZmFsc2UpOwogICAgICB9OwogICAgICBjb25zdCBvZ0VkaXRDYWxsID0gcHJvY3MuZWRpdFByb2NlZHVyZUNhbGxiYWNrXzsKICAgICAgcHJvY3MuZWRpdFByb2NlZHVyZUNhbGxiYWNrXyA9IGZ1bmN0aW9uKGJsb2NrKSB7CiAgICAgICAgaWYgKGJsb2NrLnR5cGUgPT09ICJwcm9jZWR1cmVzX2NhbGwiKSB7CiAgICAgICAgICBjb25zdCBpc0dsb2JhbCA9IGdsb2JhbEJsb2Nrc0NhY2hlW2Jsb2NrLnByb2NDb2RlX107CiAgICAgICAgICBpZiAoaXNHbG9iYWwgJiYgaXNHbG9iYWwuaWQgIT09IHZtLmVkaXRpbmdUYXJnZXQuaWQpIHsKICAgICAgICAgICAgdm0ub25jZSgid29ya3NwYWNlVXBkYXRlIiwgKCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IGJsb2NrSWQgPSB2bS5lZGl0aW5nVGFyZ2V0LmJsb2Nrcy5nZXRQcm9jZWR1cmVEZWZpbml0aW9uKGJsb2NrLnByb2NDb2RlXyk7CiAgICAgICAgICAgICAgYmxvY2sgPSBTQi5tYWluV29ya3NwYWNlLmdldEJsb2NrQnlJZChibG9ja0lkKTsKICAgICAgICAgICAgICByZXR1cm4gcHJvY3MuZWRpdFByb2NlZHVyZUNhbGxiYWNrXy5jYWxsKHRoaXMsIGJsb2NrKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZtLnNldEVkaXRpbmdUYXJnZXQoaXNHbG9iYWwuaWQpOwogICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBzaGFyZWRXb3JrID0gU0IubWFpbldvcmtzcGFjZTsKICAgICAgICBjb25zdCB2YWwgPSBvZ0VkaXRDYWxsLmNhbGwodGhpcywgYmxvY2spOwogICAgICAgIG9wZW5CbG9ja01ha2VyKHNoYXJlZFdvcmssIHRydWUpOwogICAgICAgIHJldHVybiB2YWw7CiAgICAgIH0KICAgIH0KICAgIC8vIFBhdGNoIFByb2NlZHVyZSBGbHlvdXQgdG8gYWxzbyBpbnRlcmFjdCB3aXRoIHRoZSBleHRlbnNpb24KICAgIGNvbnN0IG9nRmx5b3V0Q2FsbCA9IHByb2NzLmZseW91dENhdGVnb3J5OwogICAgcHJvY3MuZmx5b3V0Q2F0ZWdvcnkgPSBmdW5jdGlvbih3b3Jrc3BhY2UpIHsKICAgICAgY29uc3QgdmFsID0gb2dGbHlvdXRDYWxsLmNhbGwodGhpcywgd29ya3NwYWNlKTsKICAgICAgaWYgKHZhbC5sZW5ndGggIT09IG9sZExpc3RMZW5ndGgpIGxpc3ROZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICBjb21waWxlUHJvY2VkdXJlcyh2YWwsIHdvcmtzcGFjZSwgcHJvY3MpOwogICAgICByZXR1cm4gdmFsOwogICAgfQogIH0pCgogIC8vIE90aGVyIHBhdGNoZXMKICBmdW5jdGlvbiBwYXRjaFRhcmdldCgpIHsKICAgIC8vIGNyZWF0ZSBhIHRhcmdldCB0byBwYXRjaCBUYXJnZXQuQmxvY2tzCiAgICBjb25zdCB0YXJnZXQgPSBuZXcgdm0uZXhwb3J0cy5SZW5kZXJlZFRhcmdldCh7YmxvY2tzOiBudWxsfSwgcnVudGltZSk7CgogICAgY29uc3QgQmxvY2tzID0gdGFyZ2V0LmJsb2Nrcy5jb25zdHJ1Y3RvcjsKICAgIGNvbnN0IG9sZEdldFByb2NEZWYgPSBCbG9ja3MucHJvdG90eXBlLmdldFByb2NlZHVyZURlZmluaXRpb247CiAgICBCbG9ja3MucHJvdG90eXBlLmdldFByb2NlZHVyZURlZmluaXRpb24gPSBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGNvbnN0IHRoaXNEZWYgPSBvbGRHZXRQcm9jRGVmLmNhbGwodGhpcywgbmFtZSk7CiAgICAgIGlmICghdGhpc0RlZiAmJiBnbG9iYWxCbG9ja3NDYWNoZVtuYW1lXSAmJiBnbG9iYWxCbG9ja3NDYWNoZVtuYW1lXS5ibG9ja3MgIT09IHRoaXMpIHsKICAgICAgICByZXR1cm4gZ2xvYmFsQmxvY2tzQ2FjaGVbbmFtZV0uYmxvY2tzLmdldFByb2NlZHVyZURlZmluaXRpb24obmFtZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXNEZWY7CiAgICB9CiAgICBjb25zdCBvbGRHZXRCbG9jayA9IEJsb2Nrcy5wcm90b3R5cGUuZ2V0QmxvY2s7CiAgICBCbG9ja3MucHJvdG90eXBlLmdldEJsb2NrID0gZnVuY3Rpb24obmFtZSkgewogICAgICBjb25zdCB0aGlzQmxvY2sgPSBvbGRHZXRCbG9jay5jYWxsKHRoaXMsIG5hbWUpOwogICAgICBpZiAodGhpc0Jsb2NrKSByZXR1cm4gdGhpc0Jsb2NrOwogICAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiB0aGlzLnJ1bnRpbWUudGFyZ2V0cykgewogICAgICAgIGlmICghdGFyZ2V0LmlzT3JpZ2luYWwgfHwgdGFyZ2V0LmJsb2NrcyA9PT0gdGhpcykgY29udGludWU7CiAgICAgICAgY29uc3QgdGFyZ2V0QmxvY2sgPSBvbGRHZXRCbG9jay5jYWxsKHRhcmdldC5ibG9ja3MsIG5hbWUpOwogICAgICAgIGlmICh0YXJnZXRCbG9jaykgcmV0dXJuIHRhcmdldEJsb2NrOwogICAgICB9CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCBvbGRHZXRCcmFuY2ggPSBCbG9ja3MucHJvdG90eXBlLmdldEJyYW5jaDsKICAgIEJsb2Nrcy5wcm90b3R5cGUuZ2V0QnJhbmNoID0gZnVuY3Rpb24oaWQsIGJyYW5jaE51bSkgewogICAgICBjb25zdCB0aGlzQmxvY2sgPSBvbGRHZXRCcmFuY2guY2FsbCh0aGlzLCBpZCwgYnJhbmNoTnVtKTsKICAgICAgaWYgKHRoaXNCbG9jaykgcmV0dXJuIHRoaXNCbG9jazsKICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgdGhpcy5ydW50aW1lLnRhcmdldHMpIHsKICAgICAgICBpZiAoIXRhcmdldC5pc09yaWdpbmFsIHx8IHRhcmdldC5ibG9ja3MgPT09IHRoaXMpIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IHRhcmdldEJsb2NrID0gb2xkR2V0QnJhbmNoLmNhbGwodGFyZ2V0LmJsb2NrcywgaWQsIGJyYW5jaE51bSk7CiAgICAgICAgaWYgKHRhcmdldEJsb2NrKSByZXR1cm4gdGFyZ2V0QmxvY2s7CiAgICAgIH0KICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IG9sZFBvcFByb2NDYWNoZSA9IEJsb2Nrcy5wcm90b3R5cGUucG9wdWxhdGVQcm9jZWR1cmVDYWNoZTsKICAgIEJsb2Nrcy5wcm90b3R5cGUucG9wdWxhdGVQcm9jZWR1cmVDYWNoZSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5fY2FjaGUucHJvY2VkdXJlc1BvcHVsYXRlZCkgcmV0dXJuOwogICAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKICAgICAgb2xkUG9wUHJvY0NhY2hlLmNhbGwodGhpcyk7CiAgICAgIGZvciAoY29uc3QgcHJvY2NvZGUgb2YgT2JqZWN0LmtleXMoZ2xvYmFsQmxvY2tzQ2FjaGUpKSB7CiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZ2xvYmFsQmxvY2tzQ2FjaGVbcHJvY2NvZGVdOwogICAgICAgIGlmICh0YXJnZXQuYmxvY2tzID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICBvbGRQb3BQcm9jQ2FjaGUuY2FsbCh0YXJnZXQuYmxvY2tzKTsKICAgICAgICAvLyBhZGQgZ2xvYmFsIGJsb2NrcyB0byB0aGlzIGNhY2hlIGlmIHRoZXkgYXJlbid0IHByZXNlbnQgYWxyZWFkeQogICAgICAgIHRoaXMuX2NhY2hlLnByb2NlZHVyZVBhcmFtTmFtZXNbcHJvY2NvZGVdID0gdGFyZ2V0LmJsb2Nrcy5fY2FjaGUucHJvY2VkdXJlUGFyYW1OYW1lc1twcm9jY29kZV07CiAgICAgICAgdGhpcy5fY2FjaGUucHJvY2VkdXJlRGVmaW5pdGlvbnNbcHJvY2NvZGVdID0gdGFyZ2V0LmJsb2Nrcy5fY2FjaGUucHJvY2VkdXJlRGVmaW5pdGlvbnNbcHJvY2NvZGVdOwogICAgICB9CiAgICB9OwogICAgY29uc3Qgb2xkR2V0SW5wdXRzID0gQmxvY2tzLnByb3RvdHlwZS5nZXRJbnB1dHM7CiAgICBCbG9ja3MucHJvdG90eXBlLmdldElucHV0cyA9IGZ1bmN0aW9uKGJsb2NrKSB7CiAgICAgIGlmIChibG9jay5vcGNvZGUgIT09ICJwcm9jZWR1cmVzX2NhbGwiKSByZXR1cm4gb2xkR2V0SW5wdXRzLmNhbGwodGhpcywgYmxvY2spOwoKICAgICAgaWYgKHR5cGVvZiBibG9jayA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBudWxsOwogICAgICBsZXQgaW5wdXRzID0gdGhpcy5fY2FjaGUuaW5wdXRzW2Jsb2NrLmlkXTsKICAgICAgaWYgKHR5cGVvZiBpbnB1dHMgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICByZXR1cm4gaW5wdXRzOwogICAgICB9CgogICAgICBsZXQgc3RvcmVUYXJnZXQgPSB2bS5lZGl0aW5nVGFyZ2V0OwogICAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiB0aGlzLnJ1bnRpbWUudGFyZ2V0cykgewogICAgICAgIGlmICghdGFyZ2V0LmlzT3JpZ2luYWwgfHwgdGFyZ2V0LmJsb2NrcyAhPT0gdGhpcykgY29udGludWU7CiAgICAgICAgc3RvcmVUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgCiAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQoYmxvY2subXV0YXRpb24ucHJvY2NvZGUsIHN0b3JlVGFyZ2V0KTsKICAgICAgaW5wdXRzID0ge307CiAgICAgIGZvciAoY29uc3QgaW5wdXQgaW4gYmxvY2suaW5wdXRzKSB7CiAgICAgICAgICAvLyBJZ25vcmUgYmxvY2tzIHByZWZpeGVkIHdpdGggYnJhbmNoIHByZWZpeCwgYW5kIGN1c3RvbSBicmFuY2ggaW5wdXRzLgogICAgICAgICAgaWYgKGlucHV0LnN1YnN0cmluZygwLCBCbG9ja3MuQlJBTkNIX0lOUFVUX1BSRUZJWC5sZW5ndGgpICE9PSBCbG9ja3MuQlJBTkNIX0lOUFVUX1BSRUZJWAogICAgICAgICAgICAmJiAhKHN0b3JlLmlucHV0c1tpbnB1dF0gJiYgc3RvcmUuaW5wdXRzW2lucHV0XS50eXBlID09PSAiYnJjIikpIHsKICAgICAgICAgICAgICBpbnB1dHNbaW5wdXRdID0gYmxvY2suaW5wdXRzW2lucHV0XTsKICAgICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9jYWNoZS5pbnB1dHNbYmxvY2suaWRdID0gaW5wdXRzOwogICAgICByZXR1cm4gaW5wdXRzOwogICAgfQogIH0KICBwYXRjaFRhcmdldCgpOwoKICBjb25zdCBvbGRUb0pTT04gPSB2bS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9KU09OOwogIHZtLmNvbnN0cnVjdG9yLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICBpZiAoZXh0ZW5zaW9uUmVtb3ZhYmxlKSByZXR1cm4gb2xkVG9KU09OLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgaWYgKCFpc1BNKSB7CiAgICAgIC8vIHBlbmd1aW5tb2QgYXV0b21hdGljYWxseSBkb2VzIHRoaXMKICAgICAgc3VzcGVuZFJlbW92YWwgPSBmYWxzZTsKICAgICAgcmVtb3ZlVW51c2VkUHJvY3MoKTsKICAgICAgcmVtb3ZlVW51c2VkSW1hZ2VzKCk7CiAgICAgIGV4dD8uc2VyaWFsaXplKCk7CiAgICB9CgogICAgLy8gTWFrZSB0aGUgZXh0ZW5zaW9uIHN0YXkgYnkgYWRkaW5nIGEgZHVtbXkgYmxvY2sKICAgIGNvbnN0IGJsb2NrcyA9IHJ1bnRpbWUudGFyZ2V0c1swXS5ibG9ja3M7CiAgICBibG9ja3MuX2Jsb2Nrc1tURU1QX0JMT0NLX09QQ09ERV0gPSB7CiAgICAgIG9wY29kZTogVEVNUF9CTE9DS19PUENPREUsIGlkOiBURU1QX0JMT0NLX09QQ09ERSwgZmllbGRzOiB7fSwKICAgICAgbmV4dDogbnVsbCwgcGFyZW50OiBudWxsLCBzaGFkb3c6IGZhbHNlLCB0b0xldmVsOiB0cnVlLAogICAgICB4OiB1bmRlZmluZWQsIHk6IHVuZGVmaW5lZAogICAgfQogICAgY29uc3QganNvblN0ciA9IG9sZFRvSlNPTi5hcHBseSh0aGlzLCBhcmdzKTsKICAgIC8vIEJsb2NrIElEcyBtYXkgaGF2ZSBiZWVuIGNvbXByZXNzZWQgYXQgdGhpcyBwb2ludAogICAgY29uc3QgdGVtcEJsb2NrSWQgPSBPYmplY3QudmFsdWVzKGJsb2Nrcy5fYmxvY2tzKS5maW5kKG8gPT4gby5vcGNvZGUgPT09IFRFTVBfQkxPQ0tfT1BDT0RFKT8uaWQ7CiAgICBpZiAodGVtcEJsb2NrSWQpIGRlbGV0ZSBibG9ja3MuX2Jsb2Nrc1t0ZW1wQmxvY2tJZF07CiAgICByZXR1cm4ganNvblN0cjsKICB9CgogIGNvbnN0IG9sZEdldE9wY29kZSA9IHJ1bnRpbWUuZ2V0T3Bjb2RlRnVuY3Rpb247CiAgcnVudGltZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0T3Bjb2RlRnVuY3Rpb24gPSBmdW5jdGlvbihvcGNvZGUpIHsKICAgIGlmIChvcGNvZGUgPT09ICJwcm9jZWR1cmVzX2NhbGwiKSByZXR1cm4gcGF0Y2hlZENhbGxGdW5jOwogICAgcmV0dXJuIG9sZEdldE9wY29kZS5jYWxsKHRoaXMsIG9wY29kZSk7CiAgfQoKICBjb25zdCBwYXRjaGVkQ2FsbEZ1bmMgPSAoYXJncywgdXRpbCkgPT4gewogICAgLy8gUGF0Y2hlZCBCbG9jayBjb2RlIGZyb206CiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vVHVyYm9XYXJwL3NjcmF0Y2gtdm0vYmxvYi9kZXZlbG9wL3NyYy9ibG9ja3Mvc2NyYXRjaDNfcHJvY2VkdXJlcy5qcyNMMjgtTDgyCiAgICBjb25zdCB0aHJlYWQgPSB1dGlsLnRocmVhZDsKICAgIGNvbnN0IHN0YWNrRnJhbWUgPSB1dGlsLnN0YWNrRnJhbWU7CiAgICBjb25zdCBpc1JlcG9ydGVyID0gISFhcmdzLm11dGF0aW9uLnJldHVybjsKICAgIGlmIChzdGFja0ZyYW1lLmV4ZWN1dGVkKSB7CiAgICAgIGlmICh0aHJlYWQuaXNNQlBQYXRjaGVkKSB7CiAgICAgICAgLy8gcGF0Y2ggdGhpcyBmdW5jdGlvbiBmb3IgdGhlIHRocmVhZAogICAgICAgIHRocmVhZC5pc01CUFBhdGNoZWQgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhyZWFkLnRhcmdldC5ibG9ja3MuZ2V0TmV4dEJsb2NrID0gdGhyZWFkW3RhcmdldFByb2NEYXRhXS5vZ05leHQ7CiAgICAgIH0KICAgICAgaWYgKGlzUmVwb3J0ZXIpIHsKICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IHN0YWNrRnJhbWUucmV0dXJuVmFsdWU7CiAgICAgICAgY29uc3QgdGhyZWFkU3RhY2tGcmFtZSA9IHRocmVhZC5wZWVrU3RhY2tGcmFtZSgpOwogICAgICAgIHRocmVhZFN0YWNrRnJhbWUucGFyYW1zID0gbnVsbDsKICAgICAgICBkZWxldGUgc3RhY2tGcmFtZS5yZXR1cm5WYWx1ZTsKICAgICAgICBkZWxldGUgc3RhY2tGcmFtZS5leGVjdXRlZDsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHByb2NlZHVyZUNvZGUgPSBhcmdzLm11dGF0aW9uLnByb2Njb2RlOwogICAgbGV0IGlzR2xvYmFsID0gZ2xvYmFsQmxvY2tzQ2FjaGVbcHJvY2VkdXJlQ29kZV07CiAgICBpZiAoaXNHbG9iYWwgJiYgaXNHbG9iYWwuaWQgPT09IHV0aWwudGFyZ2V0LnNwcml0ZS5jbG9uZXNbMF0uaWQpIGlzR2xvYmFsID0gdW5kZWZpbmVkOwoKICAgIGNvbnN0IHBhcmFtTmFtZXNJZHNBbmREZWZhdWx0cyA9IChpc0dsb2JhbCA/IGlzR2xvYmFsLmJsb2NrcyA6IHV0aWwpLmdldFByb2NlZHVyZVBhcmFtTmFtZXNJZHNBbmREZWZhdWx0cyhwcm9jZWR1cmVDb2RlKTsKICAgIGlmIChwYXJhbU5hbWVzSWRzQW5kRGVmYXVsdHMgPT09IG51bGwpIHsKICAgICAgaWYgKGlzUmVwb3J0ZXIpIHJldHVybiAiIjsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IFtwYXJhbU5hbWVzLCBwYXJhbUlkcywgcGFyYW1EZWZhdWx0c10gPSBwYXJhbU5hbWVzSWRzQW5kRGVmYXVsdHM7CiAgICB1dGlsLmluaXRQYXJhbXMoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyYW1JZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhcmdzLCBwYXJhbUlkc1tpXSkpIHV0aWwucHVzaFBhcmFtKHBhcmFtTmFtZXNbaV0sIGFyZ3NbcGFyYW1JZHNbaV1dKTsKICAgICAgZWxzZSB1dGlsLnB1c2hQYXJhbShwYXJhbU5hbWVzW2ldLCBwYXJhbURlZmF1bHRzW2ldKTsKICAgIH0KCiAgICBjb25zdCBhZGRvbkJsb2NrID0gdXRpbC5ydW50aW1lLmdldEFkZG9uQmxvY2socHJvY2VkdXJlQ29kZSk7CiAgICBpZiAoYWRkb25CbG9jaykgewogICAgICBjb25zdCByZXN1bHQgPSBhZGRvbkJsb2NrLmNhbGxiYWNrKHRocmVhZC5nZXRBbGxwYXJhbXMoKSwgdXRpbCk7CiAgICAgIGlmICh0aHJlYWQuc3RhdHVzID09PSAxKSBzdGFja0ZyYW1lLmV4ZWN1dGVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBzdGFja0ZyYW1lLmV4ZWN1dGVkID0gdHJ1ZTsKICAgIGNvbnN0IGZyYW1lID0gdGhyZWFkLnBlZWtTdGFja0ZyYW1lKCk7CiAgICBpZiAoaXNSZXBvcnRlcikgewogICAgICBmcmFtZS53YWl0aW5nUmVwb3J0ZXIgPSB0cnVlOwogICAgICBzdGFja0ZyYW1lLnJldHVyblZhbHVlID0gIiI7CiAgICB9CiAgICB0aHJlYWRbdGFyZ2V0UHJvY0RhdGFdID0gewogICAgICBvZ05leHQ6IHRocmVhZC50YXJnZXQuYmxvY2tzLmdldE5leHRCbG9jaywKICAgICAgYmxvY2s6IGZyYW1lLm9wLCBmcmFtZSwKICAgICAgcGFyYW1zOiBwYXJhbU5hbWVzSWRzQW5kRGVmYXVsdHMKICAgIH07CiAgICB1dGlsLnN0YXJ0UHJvY2VkdXJlKHsgcHJvYzogcHJvY2VkdXJlQ29kZSwgaXNHbG9iYWwgfSk7CiAgfTsKCiAgY29uc3Qgb2xkU3RlcDJQcm9jID0gcnVudGltZS5zZXF1ZW5jZXIuc3RlcFRvUHJvY2VkdXJlOwogIHJ1bnRpbWUuc2VxdWVuY2VyLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5zdGVwVG9Qcm9jZWR1cmUgPSBmdW5jdGlvbih0aHJlYWQsIHByb2NlZHVyZUNvZGUpIHsKICAgIGlmIChwcm9jZWR1cmVDb2RlLmlzR2xvYmFsID09PSB1bmRlZmluZWQpIG9sZFN0ZXAyUHJvYy5jYWxsKHRoaXMsIHRocmVhZCwgcHJvY2VkdXJlQ29kZS5wcm9jKTsKICAgIGVsc2UgewogICAgICBjb25zdCBvZ1RhcmdldCA9IHByb2NlZHVyZUNvZGUuaXNHbG9iYWw7CiAgICAgIGNvbnN0IGRlZiA9IG9nVGFyZ2V0LmJsb2Nrcy5nZXRQcm9jZWR1cmVEZWZpbml0aW9uKHByb2NlZHVyZUNvZGUucHJvYyk7CiAgICAgIGlmICghZGVmKSByZXR1cm47CiAgICAgIGlmICh0aHJlYWQuaXNNQlBQYXRjaGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyBwYXRjaCB0aGlzIGZ1bmN0aW9uIGZvciB0aGUgdGhyZWFkCiAgICAgICAgdGhyZWFkLmlzTUJQUGF0Y2hlZCA9IHRydWU7CiAgICAgICAgY29uc3Qgb2dHZXROZXh0ID0gdGhyZWFkLnRhcmdldC5ibG9ja3MuZ2V0TmV4dEJsb2NrOwogICAgICAgIHRocmVhZC50YXJnZXQuYmxvY2tzLmdldE5leHRCbG9jayA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICBjb25zdCBibG9jayA9IG9nR2V0TmV4dC5jYWxsKHRoaXMsIGlkKTsKICAgICAgICAgIGlmIChibG9jaykgcmV0dXJuIGJsb2NrOwogICAgICAgICAgZWxzZSByZXR1cm4gb2dUYXJnZXQuYmxvY2tzLmdldE5leHRCbG9jayhpZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBpc1JlY3Vyc2l2ZSA9IHRocmVhZC5pc1JlY3Vyc2l2ZUNhbGwocHJvY2VkdXJlQ29kZS5wcm9jKTsKICAgICAgdGhyZWFkLnB1c2hTdGFjayhkZWYpOwogICAgICBpZiAodGhyZWFkLnBlZWtTdGFja0ZyYW1lKCkud2FycE1vZGUgJiYgdGhyZWFkLndhcnBUaW1lci50aW1lRWxhcHNlZCgpID4gU2VxdWVuY2VyLldBUlBfVElNRSkgdGhyZWFkLnN0YXR1cyA9IFRocmVhZC5TVEFUVVNfWUlFTEQ7CiAgICAgIGVsc2UgewogICAgICAgIGNvbnN0IGRlZkJsb2NrID0gb2dUYXJnZXQuYmxvY2tzLmdldEJsb2NrKGRlZik7CiAgICAgICAgY29uc3QgaW5uZXJCbG9jayA9IG9nVGFyZ2V0LmJsb2Nrcy5nZXRCbG9jayhkZWZCbG9jay5pbnB1dHMuY3VzdG9tX2Jsb2NrLmJsb2NrKTsKICAgICAgICBsZXQgZG9XYXJwID0gZmFsc2U7CiAgICAgICAgaWYgKGlubmVyQmxvY2sgJiYgaW5uZXJCbG9jay5tdXRhdGlvbikgewogICAgICAgICAgY29uc3Qgd2FycCA9IGlubmVyQmxvY2subXV0YXRpb24ud2FycDsKICAgICAgICAgIGlmICh0eXBlb2Ygd2FycCA9PT0gImJvb2xlYW4iKSBkb1dhcnAgPSB3YXJwOwogICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHdhcnAgPT09ICJzdHJpbmciKSBkb1dhcnAgPSBKU09OLnBhcnNlKHdhcnApOwogICAgICAgIH0KICAgICAgICBpZiAoZG9XYXJwKSB0aHJlYWQucGVla1N0YWNrRnJhbWUoKS53YXJwTW9kZSA9IHRydWU7CiAgICAgICAgZWxzZSBpZiAoaXNSZWN1cnNpdmUpIHRocmVhZC5zdGF0dXMgPSBUaHJlYWQuU1RBVFVTX1lJRUxEOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBJbnRlcm5hbHMKICAvLyBSZW1vdmUgdW51c2VkIHByb2NlZHVyZXMgYmVmb3JlIHNhdmluZwogIGZ1bmN0aW9uIHJlbW92ZVVudXNlZFByb2NzKCkgewogICAgaWYgKHN1c3BlbmRSZW1vdmFsKSByZXR1cm47CiAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiBydW50aW1lLnRhcmdldHMpIHsKICAgICAgZm9yIChjb25zdCBwcm9jY29kZSBvZiBPYmplY3Qua2V5cyhzdG9yYWdlW3RhcmdldC5pZF0gfHwge30pKSB7CiAgICAgICAgaWYgKCF0YXJnZXQuYmxvY2tzLmdldFByb2NlZHVyZURlZmluaXRpb24ocHJvY2NvZGUpKSBkZWxldGUgc3RvcmFnZVt0YXJnZXQuaWRdW3Byb2Njb2RlXTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmVtb3ZlIHVudXNlZCBpbWFnZXMgYmVmb3JlIHNhdmluZwogIGZ1bmN0aW9uIHJlbW92ZVVudXNlZEltYWdlcygpIHsKICAgIGlmIChzdXNwZW5kUmVtb3ZhbCkgcmV0dXJuOwogICAgY29uc3QgdXNlZElkcyA9IG5ldyBTZXQoKTsKICAgIE9iamVjdC52YWx1ZXMoc3RvcmFnZSkuZm9yRWFjaChwcm9jID0+IE9iamVjdC52YWx1ZXMocHJvYyA/PyB7fSkuZm9yRWFjaChkYXRhID0+IHsKICAgICAgaWYgKCFkYXRhLmlucHV0cykgcmV0dXJuOwogICAgICBPYmplY3QudmFsdWVzKGRhdGEuaW5wdXRzKS5mb3JFYWNoKGlucHV0ID0+IHsKICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gImltZyIpIHVzZWRJZHMuYWRkKGlucHV0LnNyYyk7CiAgICAgIH0pOwogICAgfSkpOwoKICAgIGZvciAobGV0IGkgPSAxOyBpIDwgaW1nU3RvcmVTaXplOyBpKyspIHsKICAgICAgaWYgKCF1c2VkSWRzLmhhcyhpKSkgZGVsZXRlIGltZ1N0b3JhZ2VbaV07CiAgICB9CiAgfQoKICAvLyByZXNldCB0aGUgY29tcGlsZWQgY29kZSBjYWNoZSBmb3IgZ2xvYmFsIGJsb2NrcyB0aGF0IGdldCBjaGFuZ2VkCiAgZnVuY3Rpb24gcmVzZXRHbG9iYWxDb21waWxlckNhY2hlKHByb2Njb2RlKSB7CiAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiBydW50aW1lLnRhcmdldHMpIHsKICAgICAgY29uc3QgYmxvY2tzID0gdGFyZ2V0LmJsb2NrczsKICAgICAgY29uc3QgY29tcGlsZWRQcm9jcyA9IE9iamVjdC5rZXlzKGJsb2Nrcy5fY2FjaGUuY29tcGlsZWRQcm9jZWR1cmVzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21waWxlZFByb2NzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGNvbXBpbGVkUHJvY3NbaV0uaW5jbHVkZXMocHJvY2NvZGUpKSB7CiAgICAgICAgICBibG9ja3MucmVzZXRDYWNoZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gSXMtaW4tRWRpdG9yIENoZWNrZXIKICBsZXQgc3RhcnRlZEVkaXRvcldvcmtlciA9IGZhbHNlOwogIGZ1bmN0aW9uIHN0YXJ0RWRpdG9yTGlzdGVuZXIoKSB7CiAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKICAgIGlmIChzdGFydGVkRWRpdG9yV29ya2VyKSByZXR1cm47CiAgICBzdGFydGVkRWRpdG9yV29ya2VyID0gZmFsc2U7CiAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgICAgY29uc3Qgd29ya3NwYWNlID0gU0IubWFpbldvcmtzcGFjZTsKICAgICAgaWYgKCFpc1BNKSB3b3Jrc3BhY2UuZW5hYmxlUHJvY2VkdXJlUmV0dXJucygpOwogICAgICB2bS5vbigid29ya3NwYWNlVXBkYXRlIiwgKCkgPT4gewogICAgICAgIGlmICghZXh0ZW5zaW9uUmVtb3ZhYmxlKSB7CiAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgIGlmICh3b3Jrc3BhY2U/LnJlbmRlcmVkKSBTQi5Qcm9jZWR1cmVzLmZseW91dENhdGVnb3J5KHdvcmtzcGFjZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgLy8gQmxvY2sgRXZlbnRzIEhhbmRsZXIKICBmdW5jdGlvbiBpbml0QmxvY2tFdmVudHMoKSB7CiAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgICAgY29uc3QgeyBFdmVudHMsIG1haW5Xb3Jrc3BhY2UgfSA9IFNCOwogICAgICBpZiAoIW1haW5Xb3Jrc3BhY2U/LnJlbmRlcmVkKSByZXR1cm47CiAgICAgIGxldCBwYXRjaGVkID0gZmFsc2U7CiAgICAgIGNvbnN0IHdvcmtzcGFjZUV2ZW50cyA9IChlKSA9PiB7CiAgICAgICAgaWYgKG1haW5Xb3Jrc3BhY2UuaWQgPT09IGUud29ya3NwYWNlSWQpIHsKICAgICAgICAgIGlmICghaXNQTSAmJiAhcGF0Y2hlZCkgewogICAgICAgICAgICBjb25zdCBvZ1JldHVybnNXaWxsQ2hhbmdlID0gbWFpbldvcmtzcGFjZS5wcm9jZWR1cmVSZXR1cm5zV2lsbENoYW5nZTsKICAgICAgICAgICAgbWFpbldvcmtzcGFjZS5wcm9jZWR1cmVSZXR1cm5zV2lsbENoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG9nUmV0dXJuc1dpbGxDaGFuZ2UuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgICBwYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSBFdmVudHMuQ0hBTkdFOiB7CiAgICAgICAgICAgICAgbGV0IGJsb2NrID0gbWFpbldvcmtzcGFjZS5nZXRCbG9ja0J5SWQoZS5ibG9ja0lkKTsKICAgICAgICAgICAgICB3aGlsZSAoYmxvY2sgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChibG9jayAmJiBibG9jay50eXBlID09PSAicHJvY2VkdXJlc19kZWZpbml0aW9uIikgewogICAgICAgICAgICAgICAgICBjb25zdCBwcm90byA9IGJsb2NrLmdldElucHV0KCJjdXN0b21fYmxvY2siKT8uY29ubmVjdGlvbj8udGFyZ2V0QmxvY2soKTsKICAgICAgICAgICAgICAgICAgaWYgKCFwcm90bykgcmV0dXJuOwogICAgICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHN0b3JlR2V0KHByb3RvLnByb2NDb2RlXyk7CiAgICAgICAgICAgICAgICAgIGlmIChzdG9yZS5nbG9iYWwpIHJlc2V0R2xvYmFsQ29tcGlsZXJDYWNoZShwcm90by5wcm9jQ29kZV8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYmxvY2sgPSBibG9jay5nZXRQYXJlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSBFdmVudHMuTU9WRTogewogICAgICAgICAgICAgIGxldCBibG9jayA9IG1haW5Xb3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKGUuYmxvY2tJZCksIHBhcmVudCA9IG1haW5Xb3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKGUubmV3UGFyZW50SWQpOwoKICAgICAgICAgICAgICAvLyBmaXggZmllbGQgY29sb3VycwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUubmV3SW5wdXROYW1lICYmIGJsb2NrPy5jYXRlZ29yeV8gPT09IG51bGwgJiYKICAgICAgICAgICAgICAgIGJsb2NrLmlucHV0TGlzdFswXS5maWVsZFJvd1swXS5hcnJvd18gIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgICAgcGFyZW50Py50eXBlID09PSAicHJvY2VkdXJlc19jYWxsIgogICAgICAgICAgICAgICkgYmxvY2suc2V0Q29sb3VyKHBhcmVudC5jb2xvdXJfKTsKCiAgICAgICAgICAgICAgLy8gdXBkYXRlIGdsb2JhbCBibG9jayBjYWNoZSBmb3IgcmV0dXJucwogICAgICAgICAgICAgIGlmICghaXNQTSkgewogICAgICAgICAgICAgICAgaWYgKHBhcmVudD8udHlwZSA9PT0gInByb2NlZHVyZXNfcmV0dXJuIikgewogICAgICAgICAgICAgICAgICBibG9jayA9IHBhcmVudDsKICAgICAgICAgICAgICAgICAgcGFyZW50ID0gYmxvY2suZ2V0UGFyZW50KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlR2xvYmFsUmV0dXJuID0gKHBhcmVudCwgcmV0dXJucykgPT4gewogICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQudHlwZSA9PT0gInByb2NlZHVyZXNfZGVmaW5pdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3RvID0gcGFyZW50LmdldElucHV0KCJjdXN0b21fYmxvY2siKT8uY29ubmVjdGlvbj8udGFyZ2V0QmxvY2soKTsKICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvdG8pIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQocHJvdG8ucHJvY0NvZGVfKTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9jaz8udHlwZSA9PT0gInByb2NlZHVyZXNfcmV0dXJuIikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2bVByb3RvID0gdm0uZWRpdGluZ1RhcmdldC5ibG9ja3MuZ2V0QmxvY2socHJvdG8uaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0dXJucykgdm1Qcm90by5tdXRhdGlvbi5yZXR1cm4gPSBTQi5Qcm9jZWR1cmVzLmdldEJsb2NrUmV0dXJuVHlwZShwYXJlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHZtUHJvdG8ubXV0YXRpb24ucmV0dXJuID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3ROZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmUuZ2xvYmFsKSBzdG9yZS5yZXR1cm4gPSB2bVByb3RvLm11dGF0aW9uLnJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG9yZS5nbG9iYWwpIHJlc2V0R2xvYmFsQ29tcGlsZXJDYWNoZShwcm90by5wcm9jQ29kZV8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuZ2V0UGFyZW50KCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY2hhbmdlR2xvYmFsUmV0dXJuKHBhcmVudCwgdHJ1ZSk7IC8vIGhhbmRsZSBuZXcgZGVmaW5pdGlvbgogICAgICAgICAgICAgICAgaWYgKGUub2xkUGFyZW50SWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBjb25zdCBvbGRQYXJlbnQgPSBtYWluV29ya3NwYWNlLmdldEJsb2NrQnlJZChlLm9sZFBhcmVudElkKTsKICAgICAgICAgICAgICAgICAgY2hhbmdlR2xvYmFsUmV0dXJuKG9sZFBhcmVudCwgZmFsc2UpOyAvLyBoYW5kbGUgb2xkIGRlZmluaXRpb24KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICAgIG1haW5Xb3Jrc3BhY2UuYWRkQ2hhbmdlTGlzdGVuZXIod29ya3NwYWNlRXZlbnRzKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBzdGFydEJsb2NrTGlzdGVuZXIoKSB7CiAgICBydW50aW1lLm9uKCJCTE9DS19EUkFHX0VORCIsIChuZXdTdGFjaywgb2xkSUQpID0+IHsKICAgICAgLy8gYXBwZW5kIG9sZCBkYXRhIHRvIG5ldyBibG9ja3MKICAgICAgaWYgKG5ld1N0YWNrWzBdLm9wY29kZSAhPT0gInByb2NlZHVyZXNfZGVmaW5pdGlvbiIpIHJldHVybjsKICAgICAgY29uc3QgcHJvY2NvZGUgPSBuZXdTdGFja1sxXS5tdXRhdGlvbi5wcm9jY29kZTsKICAgICAgY29uc3QgdGhpc1RhcmdldCA9IHZtLmVkaXRpbmdUYXJnZXQ7CiAgICAgIGNvbnN0IGNvcHlTdG9yZSA9IHN0b3JlR2V0KHByb2Njb2RlLCB0aGlzVGFyZ2V0KTsKICAgICAgaWYgKGNvcHlTdG9yZSkgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gdGltZW91dCB3b3JrcyBiZXR0ZXIgdGhhbiBxdWV1ZU1pY3JvdGFzayBmb3IgdGhpcz8KICAgICAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiBydW50aW1lLnRhcmdldHMpIHsKICAgICAgICAgIGlmICghdGFyZ2V0LmlzT3JpZ2luYWwgfHwgdGFyZ2V0LmlkID09PSB0aGlzVGFyZ2V0LmlkKSBjb250aW51ZTsKICAgICAgICAgIGNvbnN0IGRlZiA9IHRhcmdldC5ibG9ja3MuZ2V0UHJvY2VkdXJlRGVmaW5pdGlvbihwcm9jY29kZSk7CiAgICAgICAgICBpZiAoZGVmKSBzdG9yZVNldChwcm9jY29kZSwgc3RydWN0dXJlZENsb25lKGNvcHlTdG9yZSksIHRhcmdldCk7CiAgICAgICAgfQogICAgICB9LCAxMCk7CiAgICB9KTsKCiAgICBjb25zdCBjaGVja0luRWRpdG9yID0gKCkgPT4gIVJlZHV4U3RvcmUuZ2V0U3RhdGUoKS5zY3JhdGNoR3VpLm1vZGUuaXNQbGF5ZXJPbmx5OwogICAgbGV0IGluRWRpdG9yID0gY2hlY2tJbkVkaXRvcigpOwogICAgaWYgKGluRWRpdG9yKSBpbml0QmxvY2tFdmVudHMoKTsKICAgIFJlZHV4U3RvcmUuc3Vic2NyaWJlKCgpID0+IHsKICAgICAgY29uc3QgY3VycmVudEluRWRpdG9yID0gY2hlY2tJbkVkaXRvcigpOwogICAgICBpZiAoaW5FZGl0b3IgIT09IGN1cnJlbnRJbkVkaXRvcikgewogICAgICAgIGluRWRpdG9yID0gY3VycmVudEluRWRpdG9yOwogICAgICAgIGlmIChpbkVkaXRvcikgaW5pdEJsb2NrRXZlbnRzKCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAodHlwZW9mIHNjYWZmb2xkaW5nID09PSAidW5kZWZpbmVkIikgc3RhcnRCbG9ja0xpc3RlbmVyKCk7CgogIC8vIEN1c3RvbSBCbG9ja3MgSW50ZXJuYWxzCiAgZnVuY3Rpb24gc3RvcmVHZXQobmFtZSwgdGFyZ2V0ID0gbnVsbCkgewogICAgLy8gZmlyc3QgY2hlY2sgaWYgaXRzIGEgZ2xvYmFsIGJsb2NrIHByb2Njb2RlCiAgICBjb25zdCBnbG9iYWxTdG9yZSA9IGdsb2JhbEJsb2Nrc0NhY2hlW25hbWVdOwogICAgaWYgKGdsb2JhbFN0b3JlICE9PSB1bmRlZmluZWQpIHJldHVybiBzdG9yYWdlW2dsb2JhbFN0b3JlLmlkXT8uW25hbWVdID8/IHt9OwoKICAgIGNvbnN0IGlkID0gKHRhcmdldCB8fCB2bS5lZGl0aW5nVGFyZ2V0KS5pZDsKICAgIHJldHVybiBzdG9yYWdlW2lkXT8uW25hbWVdID8/IHt9OwogIH0KICBmdW5jdGlvbiBzdG9yZURlbChuYW1lLCB0YXJnZXQgPSBudWxsKSB7CiAgICBjb25zdCBpZCA9ICh0YXJnZXQgfHwgdm0uZWRpdGluZ1RhcmdldCkuaWQ7CiAgICBkZWxldGUgc3RvcmFnZVtpZF1bbmFtZV07CiAgfQogIGZ1bmN0aW9uIHN0b3JlU2V0KG5hbWUsIHZhbHVlLCB0YXJnZXQgPSBudWxsKSB7CiAgICBjb25zdCBpZCA9ICh0YXJnZXQgfHwgdm0uZWRpdGluZ1RhcmdldCkuaWQ7CiAgICBpZiAoIXN0b3JhZ2VbaWRdKSBzdG9yYWdlW2lkXSA9IHt9OwogICAgc3RvcmFnZVtpZF1bbmFtZV0gPSB2YWx1ZTsKICAgIHJ1bnRpbWUuU1BtYnBDU1RPbGRTdG9yYWdlID0gc3RvcmFnZTsKICB9CgogIGZ1bmN0aW9uIHN0b3JlSW1hZ2UodXJsKSB7CiAgICBjb25zdCB1cmxFeGlzdHMgPSBPYmplY3QudmFsdWVzKGltZ1N0b3JhZ2UpLmluZGV4T2YodXJsKTsKICAgIGlmICh1cmxFeGlzdHMgPiAtMSkgcmV0dXJuIHVybEV4aXN0cyArIDE7CgogICAgaW1nU3RvcmVTaXplKys7CiAgICBpbWdTdG9yYWdlW2ltZ1N0b3JlU2l6ZV0gPSB1cmw7CiAgICByZXR1cm4gaW1nU3RvcmVTaXplOwogIH0KICBmdW5jdGlvbiBnZXRTdG9yZWRJbWFnZShpbmRleCkgewogICAgcmV0dXJuIGltZ1N0b3JhZ2VbaW5kZXhdID8/ICIiOwogIH0KCiAgZnVuY3Rpb24gZGVzZXJpYWxpemVTdG9yYWdlKGRhdGEpIHsKICAgIGlmIChpc1BNKSB7CiAgICAgIHN0b3JhZ2UgPSBkYXRhLlNQbWJwQ1NUIHx8IHt9OwogICAgICBpbWdTdG9yYWdlID0gZGF0YS5TUG1icENTVC5pbWdTdG9yYWdlID8/IHt9OwogICAgICBpbWdTdG9yZVNpemUgPSBPYmplY3Qua2V5cyhpbWdTdG9yYWdlKS5sZW5ndGg7CiAgICAgIHN0YXJ0RWRpdG9yTGlzdGVuZXIoKTsKICAgICAgaWYgKFNjcmF0Y2guZ3VpKSBTY3JhdGNoLmd1aS5nZXRCbG9ja2x5KCkudGhlbihTQiA9PiB7CiAgICAgICAgcnVudGltZS5vbmNlKCJQUk9KRUNUX0xPQURFRCIsICgpID0+IHsKICAgICAgICAgIGlmIChTQi5tYWluV29ya3NwYWNlLnJlbmRlcmVkKSBTQi5Qcm9jZWR1cmVzLmZseW91dENhdGVnb3J5KFNCLm1haW5Xb3Jrc3BhY2UpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHN1c3BlbmRSZW1vdmFsID0gdHJ1ZTsKCiAgICAgIGltZ1N0b3JhZ2UgPSBydW50aW1lLmV4dGVuc2lvblN0b3JhZ2VbIlNQbWJwQ1NUIl0uaW1nU3RvcmFnZSA/PyB7fTsKICAgICAgaW1nU3RvcmVTaXplID0gT2JqZWN0LmtleXMoaW1nU3RvcmFnZSkubGVuZ3RoOwogICAgICBzdG9yYWdlID0ge307IC8vIHRhcmdldCBJRCdzIGNoYW5nZSB3aGVuIHNhdmluZyA6KAogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJ1bnRpbWUudGFyZ2V0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHRhcmdldCA9IHJ1bnRpbWUudGFyZ2V0c1tpXTsKICAgICAgICBjb25zdCBzdG9yZSA9IHRhcmdldC5leHRlbnNpb25TdG9yYWdlPy5TUG1icENTVDsKICAgICAgICBpZiAoc3RvcmUgIT09IHVuZGVmaW5lZCkgc3RvcmFnZVt0YXJnZXQuaWRdID0geyAuLi5zdG9yZSB9OwogICAgICB9CiAgICAgIGNvbnN0IHRlbXBTdG9yZSA9IHN0cnVjdHVyZWRDbG9uZShzdG9yYWdlKTsKICAgICAgcnVudGltZS5TUG1icENTVE9sZFN0b3JhZ2UgPSB0ZW1wU3RvcmU7CiAgICAgIHN0YXJ0RWRpdG9yTGlzdGVuZXIoKTsKICAgICAgdm0ub25jZSgid29ya3NwYWNlVXBkYXRlIiwgKCkgPT4geyBzdG9yYWdlID0gdGVtcFN0b3JlIH0pOwogICAgICB2bS5lbWl0V29ya3NwYWNlVXBkYXRlKCk7CiAgICAgIGlmIChTY3JhdGNoLmd1aSkgU2NyYXRjaC5ndWkuZ2V0QmxvY2tseSgpLnRoZW4oU0IgPT4gewogICAgICAgIFNCLlByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkoU0IubWFpbldvcmtzcGFjZSk7CiAgICAgIH0pOwogICAgfQogIH0KICAvLyB1c2UgZXhpc3Rpbmcgc3RvcmFnZSB3aGVuIGxvYWRlZCB0d2ljZQogIHN0b3JhZ2UgPSBydW50aW1lLlNQbWJwQ1NUT2xkU3RvcmFnZSB8fCB7fTsKICBpZiAoIWlzUE0pIHJ1bnRpbWUub25jZSgiUFJPSkVDVF9MT0FERUQiLCAoKSA9PiBkZXNlcmlhbGl6ZVN0b3JhZ2UoKSk7CgogIGZ1bmN0aW9uIHJlZnJlc2hHbG9iYWxCbG9ja3NDYWNoZSgpIHsKICAgIGdsb2JhbEJsb2Nrc0NhY2hlID0ge307CiAgICB2bS5nbG9iYWxCbG9ja3NDYWNoZSA9IGdsb2JhbEJsb2Nrc0NhY2hlOwogICAgZm9yIChjb25zdCB0YXJnZXRJZCBvZiBPYmplY3Qua2V5cyhzdG9yYWdlKSkgewogICAgICBjb25zdCB0YXJnZXQgPSBydW50aW1lLmdldFRhcmdldEJ5SWQodGFyZ2V0SWQpOwogICAgICBpZiAoIXRhcmdldCkgY29udGludWU7CiAgICAgIGZvciAoY29uc3QgcHJvY2NvZGUgb2YgT2JqZWN0LmtleXMoc3RvcmFnZVt0YXJnZXRJZF0gPz8ge30pKSB7CiAgICAgICAgaWYgKHN0b3JhZ2VbdGFyZ2V0SWRdW3Byb2Njb2RlXT8uZ2xvYmFsKSBnbG9iYWxCbG9ja3NDYWNoZVtwcm9jY29kZV0gPSB0YXJnZXQ7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldEJsb2NrUHJvdG90eXBlKHRhcmdldCwgcHJvY2NvZGUpIHsKICAgIGZvciAoY29uc3QgaWQgaW4gdGFyZ2V0LmJsb2Nrcy5fYmxvY2tzKSB7CiAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRhcmdldC5ibG9ja3MuX2Jsb2NrcywgaWQpKSBjb250aW51ZTsKICAgICAgY29uc3QgYmxvY2sgPSB0YXJnZXQuYmxvY2tzLl9ibG9ja3NbaWRdOwogICAgICBpZiAoYmxvY2sub3Bjb2RlID09PSAicHJvY2VkdXJlc19wcm90b3R5cGUiICYmIGJsb2NrLm11dGF0aW9uICYmIGJsb2NrLm11dGF0aW9uLnByb2Njb2RlID09PSBwcm9jY29kZSkgewogICAgICAgIHJldHVybiBibG9jazsKICAgICAgfQogICAgfQogICAgcmV0dXJuOwogIH0KCiAgZnVuY3Rpb24gY29tcGlsZVByb2NlZHVyZXMoeG1sTGlzdCwgd29ya3NwYWNlLCB1dGlscykgewogICAgaWYgKCFsaXN0TmVlZHNSZWZyZXNoKSByZXR1cm47CiAgICBjb25zdCByZXR1cm5hYmxlcyA9IGlzUE0gPyB7fSA6IHV0aWxzLmdldEFsbFByb2NlZHVyZVJldHVyblR5cGVzKHdvcmtzcGFjZSk7CiAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKCiAgICAvLyBnZXQgcHJpdmF0ZSBwcm9jZWR1cmVzCiAgICBwcm9jZWR1cmVzWE1MID0gIiI7CiAgICBjb25zdCBnbG9iYWxQcm9jcyA9IG5ldyBTZXQoT2JqZWN0LmtleXMoZ2xvYmFsQmxvY2tzQ2FjaGUpKTsKICAgIGNvbnN0IHRlbXBDYWNoZSA9IHt9OwogICAgb2xkTGlzdExlbmd0aCA9IHhtbExpc3QubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvbGRMaXN0TGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgcHJvYyA9IHhtbExpc3RbaV07CiAgICAgIGlmIChwcm9jLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAicHJvY2VkdXJlc19jYWxsIikgewogICAgICAgIGNvbnN0IHByb2Njb2RlID0gcHJvYy5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgicHJvY2NvZGUiKTsKICAgICAgICBpZiAoZ2xvYmFsUHJvY3MuaGFzKHByb2Njb2RlKSkgdGVtcENhY2hlW3Byb2Njb2RlXSA9IHByb2Mub3V0ZXJIVE1MOwogICAgICAgIGVsc2UgcHJvY2VkdXJlc1hNTCArPSBwcm9jLm91dGVySFRNTDsKICAgICAgfQogICAgfQoKICAgIGlmIChnbG9iYWxQcm9jcy5zaXplID4gMCkgewogICAgICBsZXQgdGVtcExpc3QgPSBgPHNlcCBnYXA9IjEyIi8+PGxhYmVsIHRleHQ9Ikdsb2JhbCBCbG9ja3MiLz48c2VwIGdhcD0iNiIvPmA7CiAgICAgIGZvciAoY29uc3QgcHJvY2NvZGUgb2YgZ2xvYmFsUHJvY3MpIHsKICAgICAgICBjb25zdCB0YXJnZXQgPSBnbG9iYWxCbG9ja3NDYWNoZVtwcm9jY29kZV07CiAgICAgICAgaWYgKHRhcmdldC5pZCA9PT0gdm0uZWRpdGluZ1RhcmdldD8uaWQpIHsKICAgICAgICAgIHRlbXBMaXN0ICs9IHRlbXBDYWNoZVtwcm9jY29kZV07CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHByb3RvID0gZ2V0QmxvY2tQcm90b3R5cGUodGFyZ2V0LCBwcm9jY29kZSk7CiAgICAgICAgaWYgKHByb3RvKSB7CiAgICAgICAgICBpZiAocHJvdG8ubXV0YXRpb24ucmV0dXJuID09PSB1bmRlZmluZWQpIHByb3RvLm11dGF0aW9uLnJldHVybiA9IHN0b3JlR2V0KHByb2Njb2RlKS5yZXR1cm47CiAgICAgICAgICBjb25zdCBuZXdNdXRhdGlvbiA9IHsuLi5wcm90by5tdXRhdGlvbn07CiAgICAgICAgICBuZXdNdXRhdGlvbi5nZW5lcmF0ZXNoYWRvd3MgPSB0cnVlOwogICAgICAgICAgdGVtcExpc3QgKz0gYDxibG9jayB0eXBlPSJwcm9jZWR1cmVzX2NhbGwiIGdhcD0iMTIiPiR7dGFyZ2V0LmJsb2Nrcy5tdXRhdGlvblRvWE1MKG5ld011dGF0aW9uKX08L2Jsb2NrPmA7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRlbXBMaXN0ICs9IGA8c2VwIGdhcD0iNiIvPjxsYWJlbCB0ZXh0PSJQcml2YXRlIEJsb2NrcyIvPjxzZXAgZ2FwPSI2Ii8+YDsKICAgICAgcHJvY2VkdXJlc1hNTCA9IHRlbXBMaXN0ICsgcHJvY2VkdXJlc1hNTDsKICAgIH0KICAgIHZtLmV4dGVuc2lvbk1hbmFnZXIucmVmcmVzaEJsb2NrcygiU1BtYnBDU1QiKTsKICAgIGxpc3ROZWVkc1JlZnJlc2ggPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUV4dGVuc2lvbigpIHsKICAgIGV4dGVuc2lvblJlbW92YWJsZSA9IHRydWU7CiAgICBzaG91bGRTY3JvbGxUb01CUCA9IGZhbHNlOyAvLyBqdXN0IGluIGNhc2UKICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHJ1bnRpbWUudGFyZ2V0cykgewogICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIE9iamVjdC52YWx1ZXModGFyZ2V0LmJsb2Nrcy5fYmxvY2tzKSkgewogICAgICAgIGlmIChibG9jay5vcGNvZGUuc3RhcnRzV2l0aCgiU1BtYnBDU1RfIikpIGRlbGV0ZUJsb2NrKHRhcmdldCwgYmxvY2suaWQpOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBpbiBzdG9yYWdlKSBkZWxldGUgc3RvcmFnZVtrZXldOwogICAgZm9yIChjb25zdCBrZXkgaW4gdGVtcFN0b3JlKSBkZWxldGUgdGVtcFN0b3JlW2tleV07CiAgICBydW50aW1lLlNQbWJwQ1NUT2xkU3RvcmFnZSA9IHN0b3JhZ2U7CiAgICB2bS5yZWZyZXNoV29ya3NwYWNlKCk7CiAgICBhbGVydCgiU2F2ZSBhbmQgcmVsb2FkIHRoZSBwcm9qZWN0IGZvciB0aGUgZXh0ZW5zaW9uIHRvIGZ1bGx5IGJlIHJlbW92ZWQuIik7CiAgfQoKICBmdW5jdGlvbiBkZWxldGVCbG9jayh0YXJnZXQsIGJsb2NrSWQpIHsKICAgIGlmICh0YXJnZXQgPT09IHZtLmVkaXRpbmdUYXJnZXQgJiYgU2NyYXRjaC5ndWkpIHsKICAgICAgU2NyYXRjaC5ndWkuZ2V0QmxvY2tseSgpLnRoZW4oU0IgPT4gewogICAgICAgIFNCLmdldE1haW5Xb3Jrc3BhY2UoKS5nZXRCbG9ja0J5SWQoYmxvY2tJZCk/LmRpc3Bvc2UodHJ1ZSwgZmFsc2UpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRhcmdldC5ibG9ja3MuZGVsZXRlQmxvY2soYmxvY2tJZCk7CiAgICB9CiAgfQoKICBjb25zdCBvbGRpbnN0YWxsVGFyZ2V0cyA9IHZtLmluc3RhbGxUYXJnZXRzOwogIHZtLmluc3RhbGxUYXJnZXRzID0gZnVuY3Rpb24oLi4uYXJncykgewogICAgLy8gUmVtb3ZlIHRoZSBkdW1teSBibG9jawogICAgaWYgKGFyZ3NbMF0gJiYgYXJnc1swXVswXSkgewogICAgICBjb25zdCB0ZW1wQmxvY2tJZCA9IE9iamVjdC52YWx1ZXMoYXJnc1swXVswXS5ibG9ja3MuX2Jsb2NrcykuZmluZChvID0+IG8ub3Bjb2RlID09PSBURU1QX0JMT0NLX09QQ09ERSk/LmlkOwogICAgICBpZiAodGVtcEJsb2NrSWQpIGRlbGV0ZSBhcmdzWzBdWzBdLmJsb2Nrcy5fYmxvY2tzW3RlbXBCbG9ja0lkXTsKICAgIH0KICAgIHJldHVybiBvbGRpbnN0YWxsVGFyZ2V0cy5hcHBseSh0aGlzLCBhcmdzKTsKICB9CgogIGNvbnN0IG9nRHVwU3ByaXRlID0gdm0uZHVwbGljYXRlU3ByaXRlOwogIHZtLmR1cGxpY2F0ZVNwcml0ZSA9IGZ1bmN0aW9uKHRhcmdldElkKSB7CiAgICByZXR1cm4gb2dEdXBTcHJpdGUuY2FsbCh0aGlzLCB0YXJnZXRJZCkudGhlbigoKSA9PiB7CiAgICAgIGNvbnN0IG5ld1RhcmdldCA9IHRoaXMucnVudGltZS50YXJnZXRzW3RoaXMucnVudGltZS50YXJnZXRzLmxlbmd0aCAtIDFdOwogICAgICBpZiAoIXN0b3JhZ2VbbmV3VGFyZ2V0LmlkXSkgewogICAgICAgIHN0b3JhZ2VbbmV3VGFyZ2V0LmlkXSA9IHN0cnVjdHVyZWRDbG9uZShzdG9yYWdlW3RhcmdldElkXSk7CiAgICAgICAgdGhpcy5lbWl0V29ya3NwYWNlVXBkYXRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ld1RhcmdldDsKICAgIH0pOwogIH0KCiAgY29uc3Qgb2dFeHBvcnRCbG9ja3MgPSB2bS5leHBvcnRTdGFuZGFsb25lQmxvY2tzOwogIHZtLmV4cG9ydFN0YW5kYWxvbmVCbG9ja3MgPSBmdW5jdGlvbihibG9ja09iamVjdHMpIHsKICAgIGNvbnN0IGV4cG9ydGVkID0gb2dFeHBvcnRCbG9ja3MuY2FsbCh0aGlzLCBibG9ja09iamVjdHMpOwogICAgbGV0IHN0YWNrOwoKICAgIC8vIGFwcGVuZCBjdXN0b20gYmxvY2sgZGF0YSBmb3IgaW1wb3J0aW5nIGlmIHRoZXJlcyBhIGRlZmluaXRpb24KICAgIGlmIChleHBvcnRlZC5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCIpIHN0YWNrID0gZXhwb3J0ZWQuYmxvY2tzOwogICAgZWxzZSBzdGFjayA9IGV4cG9ydGVkOwogICAgZm9yIChjb25zdCBibG9jayBvZiBzdGFjaykgewogICAgICBpZiAoYmxvY2sub3Bjb2RlICE9PSAicHJvY2VkdXJlc19wcm90b3R5cGUiKSBjb250aW51ZTsKICAgICAgY29uc3Qgc3RvcmUgPSBzdG9yZUdldChibG9jay5tdXRhdGlvbi5wcm9jY29kZSk7CiAgICAgIGlmICghc3RvcmUpIGNvbnRpbnVlOwogICAgICBibG9jay5NeUJsb2Nrc1BsdXNEYXRhID0gc3RvcmU7CiAgICB9CiAgICByZXR1cm4gZXhwb3J0ZWQ7CiAgfQoKICBjb25zdCBvZ1NoYXJlQmxvY2tzID0gdm0uc2hhcmVCbG9ja3NUb1RhcmdldDsKICB2bS5zaGFyZUJsb2Nrc1RvVGFyZ2V0ID0gZnVuY3Rpb24oYmxvY2tzLCB0YXJnZXRJZCwgb3B0RnJvbVRhcmdldElkKSB7CiAgICAvLyBsb2FkIHBvdGVudGlhbCBjdXN0b20gYmxvY2sgZGF0YQogICAgbGV0IHJlYWxCbG9ja3M7CiAgICBpZiAoYmxvY2tzLmNvbnN0cnVjdG9yPy5uYW1lID09PSAiT2JqZWN0IikgcmVhbEJsb2NrcyA9IGJsb2Nrcy5ibG9ja3M7CiAgICBlbHNlIHJlYWxCbG9ja3MgPSBibG9ja3M7CgogICAgZm9yIChjb25zdCBibG9jayBvZiByZWFsQmxvY2tzKSB7CiAgICAgIGlmIChibG9jay5vcGNvZGUgIT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIpIGNvbnRpbnVlOwogICAgICBpZiAoYmxvY2suTXlCbG9ja3NQbHVzRGF0YSkgewogICAgICAgIGNvbnN0IHRhcmdldCA9IHJ1bnRpbWUuZ2V0VGFyZ2V0QnlJZCh0YXJnZXRJZCk7CiAgICAgICAgc3RvcmVTZXQoYmxvY2subXV0YXRpb24ucHJvY2NvZGUsIGJsb2NrLk15QmxvY2tzUGx1c0RhdGEsIHRhcmdldCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvZ1NoYXJlQmxvY2tzLmNhbGwodGhpcywgYmxvY2tzLCB0YXJnZXRJZCwgb3B0RnJvbVRhcmdldElkKTsKICB9CgogIGNsYXNzIFNQbWJwQ1NUIHsKICAgIGNvbnN0cnVjdG9yKCkge30KICAgIGdldEluZm8oKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6ICJTUG1icENTVCIsCiAgICAgICAgbmFtZTogIk15IEJsb2NrcysiLAogICAgICAgIGNvbG9yMTogIiNGRjY2ODAiLAogICAgICAgIG1lbnVJY29uVVJJLAogICAgICAgIGJsb2NrczogWwogICAgICAgICAgewogICAgICAgICAgICBmdW5jOiAiY3JlYXRlQmxvY2siLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJVVFRPTiwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIHRleHQ6ICJNYWtlIGEgQmxvY2srIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGZ1bmM6ICJyZW1vdmVFeHQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJVVFRPTiwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIHRleHQ6ICJSZW1vdmUgVGhpcyBFeHRlbnNpb24iLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAic2V0UGFyYW0iLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJzZXQgW1BBUkFNXSB0byBbVkFMVUVdIiwKICAgICAgICAgICAgZXh0ZW5zaW9uczogWyJTUG1icENTVF9kZWZpbmVDb2xvcmVkIl0sCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBQQVJBTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJwcm9jZWR1cmVQYXJhbU1lbnUiIH0sCiAgICAgICAgICAgICAgVkFMVUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJ2YWx1ZSIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZXZhbFBhcmFtIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAicmVldmFsdWF0ZSBbUEFSQU1dIiwKICAgICAgICAgICAgZXh0ZW5zaW9uczogWyJTUG1icENTVF9kZWZpbmVDb2xvcmVkIl0sCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBQQVJBTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJwcm9jZWR1cmVQYXJhbU1lbnUiIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImdldFBhcmFtIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImdldCBbUEFSQU1dIiwKICAgICAgICAgICAgZXh0ZW5zaW9uczogWyJTUG1icENTVF9kZWZpbmVDb2xvcmVkIl0sCiAgICAgICAgICAgIGFsbG93RHJvcEFueXdoZXJlOiB0cnVlLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IGV4dGVuc2lvblJlbW92YWJsZSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgUEFSQU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJwYXJhbWV0ZXIgbmFtZSIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAicnVuQnJhbmNoIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAic3RhcnQgYnJhbmNoIFtJTkRFWF0gW0lDT05dIiwKICAgICAgICAgICAgZXh0ZW5zaW9uczogWyJTUG1icENTVF9kZWZpbmVDb2xvcmVkIl0sCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJTkRFWDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMSB9LAogICAgICAgICAgICAgIElDT046IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuSU1BR0UsIGRhdGFVUkk6IGd1aVVSSXMoImJyYW5jaFN0YXJ0IikgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAic3RvcENhbGxlclNjcmlwdCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInN0b3AgY2FsbGVyIHNjcmlwdCIsCiAgICAgICAgICAgIGV4dGVuc2lvbnM6IFsiU1BtYnBDU1RfZGVmaW5lQ29sb3JlZCJdLAogICAgICAgICAgICBpc1Rlcm1pbmFsOiB0cnVlLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IGV4dGVuc2lvblJlbW92YWJsZQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5YTUwsCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlLAogICAgICAgICAgICB4bWw6IGA8YmxvY2sgdHlwZT0icHJvY2VkdXJlc19yZXR1cm4iPjx2YWx1ZSBuYW1lPSIke2lzUE0gPyAicmV0dXJuIiA6ICJWQUxVRSJ9Ij48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj48L2ZpZWxkPjwvc2hhZG93PjwvdmFsdWU+PC9ibG9jaz5gLAogICAgICAgICAgfSwKICAgICAgICAgICItLS0iLAogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlhNTCwgeG1sOiBwcm9jZWR1cmVzWE1MLCBoaWRlRnJvbVBhbGV0dGU6IGV4dGVuc2lvblJlbW92YWJsZSB9CiAgICAgICAgXSwKICAgICAgICBtZW51czogewogICAgICAgICAgcHJvY2VkdXJlUGFyYW1NZW51OiB7CiAgICAgICAgICAgIGFjY2VwdFJlcG9ydGVyczogZmFsc2UsIGl0ZW1zOiAiZ2V0UHJvY2VkdXJlUGFyYW1NZW51IgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIH07CiAgICB9CgogICAgY3JlYXRlQmxvY2soKSB7CiAgICAgIGNvbnN0IHdvcmtzcGFjZSA9IFNjcmF0Y2hCbG9ja3MubWFpbldvcmtzcGFjZTsKICAgICAgU2NyYXRjaEJsb2Nrcy5Qcm9jZWR1cmVzLmNyZWF0ZVByb2NlZHVyZURlZkNhbGxiYWNrXyh3b3Jrc3BhY2UpOwogICAgfQoKICAgIHJlbW92ZUV4dCgpIHsKICAgICAgaWYgKGNvbmZpcm0oIlJlbW92ZSB0aGlzIGV4dGVuc2lvbj8gVGhpcyB3aWxsIHJlbW92ZSBhbGwgbmV3IGZlYXR1cmVzIGF0dHJpYnV0ZWQgdG8gTXkgQmxvY2tzKyIpKQogICAgICAgIHJlbW92ZUV4dGVuc2lvbigpOwogICAgfQoKICAgIGdldFByb2NlZHVyZVBhcmFtTWVudSgpIHsKICAgICAgaWYgKAogICAgICAgICFTY3JhdGNoQmxvY2tzIHx8ICFTY3JhdGNoQmxvY2tzLnNlbGVjdGVkIHx8IFNjcmF0Y2hCbG9ja3Muc2VsZWN0ZWQuaXNJbkZseW91dCB8fAogICAgICAgIChTY3JhdGNoQmxvY2tzLnNlbGVjdGVkLnR5cGUgIT09ICJTUG1icENTVF9zZXRQYXJhbSIgJiYgU2NyYXRjaEJsb2Nrcy5zZWxlY3RlZC50eXBlICE9PSAiU1BtYnBDU1RfZXZhbFBhcmFtIikKICAgICAgKSByZXR1cm4gWyJwYXJhbWV0ZXIgbmFtZSJdOwogICAgICBsZXQgdG9wQmxvY2sgPSBTY3JhdGNoQmxvY2tzLnNlbGVjdGVkLCBwYXJlbnQgPSBudWxsOwogICAgICB3aGlsZSAoKHBhcmVudCA9IHRvcEJsb2NrPy5nZXRQYXJlbnQoKSkpIHsgdG9wQmxvY2sgPSBwYXJlbnQgfQogICAgICBpZiAoIXRvcEJsb2NrIHx8ICF0b3BCbG9jay50eXBlLnN0YXJ0c1dpdGgoInByb2NlZHVyZXNfZGVmaW5pdGlvbiIpKSByZXR1cm4gWyIobm90IGluIGEgZGVmaW5lIHNjcmlwdCEpIl07CiAgICAgIGNvbnN0IGlubmVyQmxvY2sgPSB0b3BCbG9jay5nZXRJbnB1dCgiY3VzdG9tX2Jsb2NrIik/LmNvbm5lY3Rpb24/LnRhcmdldEJsb2NrKCk7CiAgICAgIGlmICghaW5uZXJCbG9jayB8fCAhaW5uZXJCbG9jay50eXBlID09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIpIHJldHVybiBbIihpbnZhbGlkIGRlZmluZSBibG9jayEpIl07CgogICAgICBpZiAoaW5uZXJCbG9jay5kaXNwbGF5TmFtZXNfLmxlbmd0aCkgewogICAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQoaW5uZXJCbG9jay5wcm9jQ29kZV8pOwogICAgICAgIGlmICghc3RvcmUgfHwgIXN0b3JlLmlucHV0cykgcmV0dXJuIGlubmVyQmxvY2suZGlzcGxheU5hbWVzXzsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGNvbnN0IG5hbWVzID0gc3RydWN0dXJlZENsb25lKGlubmVyQmxvY2suZGlzcGxheU5hbWVzXyk7CiAgICAgICAgICBjb25zdCBhbGxJbnB1dHMgPSBPYmplY3QuZW50cmllcyhzdG9yZS5pbnB1dHMpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxJbnB1dHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFsbElucHV0c1tpXVsxXS50eXBlID09PSAiYnJjIikgewogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gaW5uZXJCbG9jay5hcmd1bWVudElkc18uaW5kZXhPZihhbGxJbnB1dHNbaV1bMF0pOwogICAgICAgICAgICAgIG5hbWVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuYW1lcy5sZW5ndGggPyBuYW1lcyA6IFsiIl07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBbIiJdOwogICAgfQoKICAgIHNldFBhcmFtKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgdGhyZWFkID0gdXRpbC50aHJlYWQ7CiAgICAgIGNvbnN0IHBhcmFtID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuUEFSQU0pOwogICAgICBmb3IgKGxldCBpID0gdGhyZWFkLnN0YWNrRnJhbWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgY29uc3QgZnJhbWUgPSB0aHJlYWQuc3RhY2tGcmFtZXNbaV07CiAgICAgICAgaWYgKGZyYW1lLnBhcmFtcyA9PT0gbnVsbCkgY29udGludWU7CiAgICAgICAgZnJhbWUucGFyYW1zW3BhcmFtXSA9IGFyZ3MuVkFMVUU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIFBhcmFtZXRlcnMgbm90IHByZXNlbnQuIFByb2JhYmx5IGEgbG9uZSBzY3JpcHQgb3IgYSBzdGFjay1jbGlja2VkIGRlZmluZSBibG9jay4KICAgICAgLy8gSW4gdGhpcyBjYXNlLCBhZGQgdGhlIHBhcmFtcyB0byB0aGUgYm90dG9tIG9mIHRoZSBzdGFjawogICAgICAvLyAoYW5kIHB1c2ggdGhlIGN1cnJlbnQgYmxvY2sgdG8gaXQgc28gdGhleSBhcmVuJ3QgcmVzZXQgZm9yIHNvbWUgcmVhc29uKQogICAgICB0aHJlYWQuc3RhY2tGcmFtZXNbMF0ucGFyYW1zID0geyBbcGFyYW1dOiBhcmdzLlZBTFVFIH07CiAgICAgIHRocmVhZC5wdXNoU3RhY2sodGhyZWFkLnBlZWtTdGFjaygpKTsKICAgICAgLy8gTWFrZSB0aGUgYm90dG9tIG9mIHRoZSBzdGFjayBwb2ludCB0byBhIG5vbmV4aXN0ZW50IGJsb2NrIHNvIHRoZSBzY3JpcHQganVzdCBlbmRzCiAgICAgIC8vIGluc3RlYWQgb2YgcnVubmluZyBwYXJ0IG9mIGl0IGFnYWluCiAgICAgIHRocmVhZC5zdGFja1swXSA9ICIiOwogICAgfQoKICAgIGV2YWxQYXJhbShhcmdzLCB1dGlsKSB7CiAgICAgIGlmICghVGhyZWFkIHx8ICFleGVjdXRlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiTXkgQmxvY2tzKyBjb3VsZCBub3QgYWNjZXNzIEV4cG9ydHMhIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB0aHJlYWQgPSB1dGlsLnRocmVhZDsKICAgICAgaWYgKCF0aHJlYWRbdGFyZ2V0UHJvY0RhdGFdKSByZXR1cm47CgogICAgICBjb25zdCB7IHBhcmFtcywgYmxvY2ssIGZyYW1lIH0gPSB0aHJlYWRbdGFyZ2V0UHJvY0RhdGFdOwogICAgICBjb25zdCBwYXJhbSA9IFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLlBBUkFNKTsKICAgICAgY29uc3QgaW5kZXggPSBwYXJhbXNbMF0uaW5kZXhPZihwYXJhbSk7CiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHJldHVybjsKCiAgICAgIGNvbnN0IGJsb2NrVmFsdWUgPSBibG9jay5pbnB1dHNbcGFyYW1zWzFdW2luZGV4XV07CiAgICAgIGlmICghYmxvY2tWYWx1ZSkgcmV0dXJuOwoKICAgICAgY29uc3QgdGVtcFRocmVhZCA9IG5ldyBUaHJlYWQ7CiAgICAgIHRlbXBUaHJlYWQudG9wQmxvY2sgPSBibG9ja1ZhbHVlLmJsb2NrOwogICAgICB0ZW1wVGhyZWFkLnB1c2hTdGFjayhibG9ja1ZhbHVlLmJsb2NrKQogICAgICB0ZW1wVGhyZWFkLmJsb2NrQ29udGFpbmVyID0gdGhyZWFkLmJsb2NrQ29udGFpbmVyOwogICAgICB0ZW1wVGhyZWFkLnRhcmdldCA9IHRocmVhZC50YXJnZXQ7CiAgICAgIHRlbXBUaHJlYWQucHVzaFJlcG9ydGVkVmFsdWUgPSAodmFsdWUpID0+IHsgZnJhbWUucGFyYW1zW3BhcmFtXSA9IHZhbHVlIH07CiAgICAgIGV4ZWN1dGUocnVudGltZS5zZXF1ZW5jZXIsIHRlbXBUaHJlYWQpOwogICAgfQoKICAgIGdldFBhcmFtKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgcGFyYW0gPSB1dGlsLnRocmVhZC5nZXRQYXJhbShTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5QQVJBTSkpOwogICAgICByZXR1cm4gcGFyYW0gPz8gIiI7CiAgICB9CgogICAgc3RvcENhbGxlclNjcmlwdChfLCB1dGlsKSB7CiAgICAgIC8vIHN0b3BzIHRocmVhZHMgZW50aXJlbHksIGluY2x1ZGluZyBjdXN0b20gYmxvY2tzIGNvbnRleHRzCiAgICAgIC8vIG1vcmUgcG93ZXJmdWwgdGhhbiAndXRpbC5zdG9wVGhpc1NjcmlwdCgpJwogICAgICB1dGlsLnRocmVhZC5zdGF0dXMgPSA0OwogICAgfQoKICAgIHJ1bkJyYW5jaChhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IHRocmVhZCA9IHV0aWwudGhyZWFkOwogICAgICBpZiAoIXV0aWwudGhyZWFkW3RhcmdldFByb2NEYXRhXSkgcmV0dXJuOwoKICAgICAgY29uc3QgcHJvY0Jsb2NrID0gdXRpbC50aHJlYWRbdGFyZ2V0UHJvY0RhdGFdLmJsb2NrOwogICAgICBjb25zdCBzdG9yZSA9IHN0b3JlR2V0KHByb2NCbG9jay5tdXRhdGlvbi5wcm9jY29kZSwgdGhyZWFkLnRhcmdldCk7CiAgICAgIGlmICghc3RvcmUgfHwgIXN0b3JlLmlucHV0cykgcmV0dXJuOwoKICAgICAgY29uc3QgYWxsSW5wdXRzID0gdXRpbC50aHJlYWRbdGFyZ2V0UHJvY0RhdGFdLnBhcmFtc1sxXTsKICAgICAgY29uc3QgYnJhbmNoZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxJbnB1dHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoc3RvcmUuaW5wdXRzW2FsbElucHV0c1tpXV0/LnR5cGUgPT09ICJicmMiKSBicmFuY2hlcy5wdXNoKGFsbElucHV0c1tpXSk7CiAgICAgIH0KCiAgICAgIGlmIChicmFuY2hlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5JTkRFWCkgLSAxOwogICAgICAgIGNvbnN0IHJlYWxQcm9jQmxvY2sgPSB0aHJlYWQuYmxvY2tDb250YWluZXIuZ2V0QmxvY2socHJvY0Jsb2NrLmlkKTsKICAgICAgICBjb25zdCBicmFuY2ggPSByZWFsUHJvY0Jsb2NrLmlucHV0c1ticmFuY2hlc1tpbmRleF1dPy5ibG9jazsKICAgICAgICBpZiAoYnJhbmNoKSB1dGlsLnRocmVhZC5wdXNoU3RhY2soYnJhbmNoKTsKICAgICAgfQogICAgfQoKICAgIC8vIFN0b3JhZ2Ugc2V0L2dldAogICAgc2VyaWFsaXplKCkgewogICAgICBpZiAoaXNQTSkgewogICAgICAgIHN1c3BlbmRSZW1vdmFsID0gZmFsc2U7CiAgICAgICAgcmVtb3ZlVW51c2VkUHJvY3MoKTsKICAgICAgICByZW1vdmVVbnVzZWRJbWFnZXMoKTsKICAgICAgICByZXR1cm4geyBTUG1icENTVDogeyAuLi5zdG9yYWdlLCBpbWdTdG9yYWdlIH0gfTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB0YXJnZXQgSUQncyBjaGFuZ2Ugd2hlbiBzYXZpbmcgOigKICAgICAgICBydW50aW1lLmV4dGVuc2lvblN0b3JhZ2VbIlNQbWJwQ1NUIl0gPSB7IGxvYWRlZDogdHJ1ZSwgaW1nU3RvcmFnZSB9OwogICAgICAgIGZvciAoY29uc3QgW2lkLCBwcm9jc10gb2YgT2JqZWN0LmVudHJpZXMoc3RvcmFnZSkpIHsKICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHJ1bnRpbWUuZ2V0VGFyZ2V0QnlJZChpZCk7CiAgICAgICAgICBpZiAoIXRhcmdldCkgY29udGludWU7CiAgICAgICAgICB0YXJnZXQuZXh0ZW5zaW9uU3RvcmFnZVsiU1BtYnBDU1QiXSA9IHsgLi4ucHJvY3MgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGRlc2VyaWFsaXplKGRhdGEpIHsKICAgICAgZGVzZXJpYWxpemVTdG9yYWdlKGRhdGEpOwogICAgfQogIH0KCiAgZXh0ID0gbmV3IFNQbWJwQ1NUKCk7CiAgU2NyYXRjaC5leHRlbnNpb25zLnJlZ2lzdGVyKGV4dCk7Cn0pKFNjcmF0Y2gpOwo=","https://extensions.turbowarp.org/gamejolt.js","https://extensions.turbowarp.org/SharkPool/Camera.js","https://extensions.turbowarp.org/Lily/LooksPlus.js","https://extensions.turbowarp.org/Lily/ClonesPlus.js","https://extensions.turbowarp.org/lab/text.js","data:text/javascript;base64,Ly8gTmFtZTogSlNPTiBhbmQgQXJyYXkKLy8gSUQ6IFNQanNvbgovLyBEZXNjcmlwdGlvbjogU3VwZXIgRmFzdCBKU09OIGFuZCBBcnJheSBFeHRlbnNpb24KLy8gQnk6IFNoYXJrUG9vbAovLyBMaWNlbmNlOiBNSVQKCi8vIFZlcnNpb24gVi4xLjEuMDMKCihmdW5jdGlvbiAoU2NyYXRjaCkgewogICJ1c2Ugc3RyaWN0IjsKICBpZiAoIVNjcmF0Y2guZXh0ZW5zaW9ucy51bnNhbmRib3hlZCkgdGhyb3cgbmV3IEVycm9yKCJKU09OIGFuZCBBcnJheSBtdXN0IHJ1biB1bnNhbmRib3hlZCEiKTsKCiAgY29uc3QgbWVudUljb25VUkkgPQoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0k0TXk0eU1qY2lJR2hsYVdkb2REMGlPRE11TWpJM0lpQjJhV1YzUW05NFBTSXdJREFnT0RNdU1qSTNJRGd6TGpJeU55SStQSEJoZEdnZ1pEMGlUVEFnTkRFdU5qRTBRekFnTVRndU5qTXhJREU0TGpZek1TQXdJRFF4TGpZeE5DQXdjelF4TGpZeE5DQXhPQzQyTXpFZ05ERXVOakUwSURReExqWXhOQzB4T0M0Mk16RWdOREV1TmpFMExUUXhMall4TkNBME1TNDJNVFJUTUNBMk5DNDFPVGNnTUNBME1TNDJNVFFpSUdacGJHdzlJaU0xTVRZeFlUWWlMejQ4Y0dGMGFDQmtQU0pOTkM0ek5EUWdOREV1TmpFMFl6QXRNakF1TlRjZ01UWXVOamczTFRNM0xqSTNJRE0zTGpJM0xUTTNMakkzY3pNM0xqSTNJREUyTGpZNE55QXpOeTR5TnlBek55NHlOeTB4TlM0M09ETWdNemN1TWpjdE16Y3VNamNnTXpjdU1qY3RNemN1TWpjdE1UWXVOeTB6Tnk0eU55MHpOeTR5TnlJZ1ptbHNiRDBpSXpjME9HSmxaU0l2UGp4d1lYUm9JR1E5SWswek5pNDNPVGdnTmpRdU1qazBZVEl1TVRrMUlESXVNVGsxSURBZ01DQXhMVEl1TVRrMUlESXVNVGswU0RJNExqYzFZVFV1TVRJM0lEVXVNVEkzSURBZ01DQXhMVFV1TVRJdE5TNHhNbFkxTUM0eE5qTnNMVFl1TkRrM0xUWXVPVGszWVRJdU1UazFJREl1TVRrMUlEQWdNQ0F4SURBdE15NHhNRFJzTmk0ME9UWXROaTQ1T1RkV01qRXVPRFl4WVRVdU1USTNJRFV1TVRJM0lEQWdNQ0F4SURVdU1USXhMVFV1TVRJeGFEVXVPRFV6WVRJdU1UazFJREl1TVRrMUlEQWdNU0F4SURBZ05DNHpPVWd5T0M0M05XRXVOek11TnpNZ01DQXdJREF0TGpjek1TNDNNM1l4TWk0eE1UUmpNQ0F1TlRnekxTNHlNekVnTVM0eE5DMHVOalF6SURFdU5UVXliQzAxTGpVNE9DQTJMakE0T0NBMUxqVTRPQ0EyTGpBNE9HTXVOREV5TGpReE1TNDJORE11T1RjdU5qUXpJREV1TlRVeWRqRXlMakV4TTJNd0lDNDBNRE11TXpJNExqY3pNaTQzTXpFdU56TXlhRFV1T0RVell6RXVNakV5SURBZ01pNHhPVFV1T1RneUlESXVNVGsxSURJdU1UazBlaUlnWm1sc2JEMGlJMlptWmlJZ2MzUnliMnRsUFNJalptWm1JaTgrUEhCaGRHZ2daRDBpVFRNM0xqQXhPQ0EyTkM0eU9UUmhNaTR4T1RVZ01pNHhPVFVnTUNBd0lERXRNaTR4T1RVZ01pNHhPVFJvTFRVdU9EVXlZVFV1TVRJM0lEVXVNVEkzSURBZ01DQXhMVFV1TVRJeUxUVXVNVEpXTlRBdU1UWXpiQzAyTGpRNU5pMDJMams1TjJFeUxqRTVOU0F5TGpFNU5TQXdJREFnTVNBd0xUTXVNVEEwYkRZdU5EazJMVFl1T1RrM1ZqSXhMamcyTVdFMUxqRXlOeUExTGpFeU55QXdJREFnTVNBMUxqRXlNUzAxTGpFeU1XZzFMamcxTTJFeUxqRTVOU0F5TGpFNU5TQXdJREVnTVNBd0lEUXVNemxvTFRVdU9EVXlZUzQzTXk0M015QXdJREFnTUMwdU56TXlMamN6ZGpFeUxqRXhOR013SUM0MU9ETXRMakl6TVNBeExqRTBMUzQyTkRNZ01TNDFOVEpzTFRVdU5UZzRJRFl1TURnNElEVXVOVGc0SURZdU1EZzRZeTQwTVRJdU5ERXhMalkwTXk0NU55NDJORE1nTVM0MU5USjJNVEl1TVRFell6QWdMalF3TXk0ek1qZ3VOek15TGpjek1TNDNNekpvTlM0NE5UTmpNUzR5TVRJZ01DQXlMakU1TlM0NU9ESWdNaTR4T1RVZ01pNHhPVFI2YlRFeExqTTROaTB5TGpFNU5XZzFMamcxTTJFdU56TXVOek1nTUNBd0lEQWdMamN6TWkwdU56TXlWalE1TGpJMU5HTXdMUzQxT0RNdU1qTXhMVEV1TVRRdU5qUXpMVEV1TlRVeWJEVXVOVGc0TFRZdU1EZzRMVFV1TlRnNExUWXVNRGc0WVRJdU1pQXlMaklnTUNBd0lERXRMalkwTXkweExqVTFNbFl5TVM0NE5qRmhMamN6TGpjeklEQWdNQ0F3TFM0M016SXRMamN6TW1ndE5TNDROVEpoTWk0eE9UVWdNaTR4T1RVZ01DQXdJREVnTUMwMExqTTVhRFV1T0RVeVlUVXVNVEkzSURVdU1USTNJREFnTUNBeElEVXVNVEl5SURVdU1USXlkakV4TGpJd05HdzJMalE1TmlBMkxqazVOMkV5TGpFNU5TQXlMakU1TlNBd0lEQWdNU0F3SURNdU1UQTBiQzAyTGpRNU5pQTJMams1TjNZeE1TNHlNRFJoTlM0eE1qY2dOUzR4TWpjZ01DQXdJREV0TlM0eE1qSWdOUzR4TWpGb0xUVXVPRFV5WVRJdU1UazFJREl1TVRrMUlEQWdNQ0F4SURBdE5DNHpPWG9pSUdacGJHdzlJaU5tWm1ZaUlITjBjbTlyWlQwaUkyWm1aaUlnYzNSeWIydGxMWGRwWkhSb1BTSXlMalVpTHo0OEwzTjJaejQ9IjsKCiAgY29uc3QgYXJyb3dVUkkgPQoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4TlM0NE9UTWlJR2hsYVdkb2REMGlNVFV1T0RreklpQjJhV1YzUW05NFBTSXdJREFnTVRVdU9Ea3pJREUxTGpnNU15SStQSEJoZEdnZ1pEMGlUVGt1TURJeElERXlMakk1TkhZdE1pNHhNRGRzTFRZdU9ETTVMUzQ1TURWRE1TNHpPVGdnT1M0eE9EUXVPRFEySURndU5EZzJMamsyTWlBM0xqY3lOMk11TURrdExqWXhNaTQyTURNdE1TNHdPU0F4TGpJeUxURXVNVFkwYkRZdU9ETTVMUzQ1TURWV015NDJZekF0TGpVNE5pNDNNekl0TGpnMk9TQXhMakUxTmkwdU5EWTBiRFF1TlRjMklEUXVNelExWVM0Mk5ETXVOalF6SURBZ01DQXhJREFnTGpreE9Hd3ROQzQxTnpZZ05DNHpObU10TGpReU5DNDBNRFF0TVM0eE5UWXVNVEV0TVM0eE5UWXRMalEyTlNJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bExXOXdZV05wZEhrOUlpNHhOU0lnYzNSeWIydGxQU0lqTURBd0lpQnpkSEp2YTJVdGQybGtkR2c5SWpFdU56VWlMejQ4Y0dGMGFDQmtQU0pOT1M0d01qRWdNVEl1TWprMGRpMHlMakV3TjJ3dE5pNDRNemt0TGprd05VTXhMak01T0NBNUxqRTROQzQ0TkRZZ09DNDBPRFl1T1RZeUlEY3VOekkzWXk0d09TMHVOakV5TGpZd015MHhMakE1SURFdU1qSXRNUzR4TmpSc05pNDRNemt0TGprd05WWXpMalpqTUMwdU5UZzJMamN6TWkwdU9EWTVJREV1TVRVMkxTNDBOalJzTkM0MU56WWdOQzR6TkRWaExqWTBNeTQyTkRNZ01DQXdJREVnTUNBdU9URTRiQzAwTGpVM05pQTBMak0yWXkwdU5ESTBMalF3TkMweExqRTFOaTR4TVMweExqRTFOaTB1TkRZMUlpQm1hV3hzUFNJalptWm1JaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpTHo0OGNHRjBhQ0JrUFNKTk1DQXhOUzQ0T1RKV01HZ3hOUzQ0T1RKMk1UVXVPRGt5ZWlJZ1ptbHNiRDBpYm05dVpTSXZQand2YzNablBnPT0iOwoKICBjb25zdCB2bSA9IFNjcmF0Y2gudm07CiAgY29uc3QgcnVudGltZSA9IHZtLnJ1bnRpbWU7CiAgY29uc3QgaXNQTSA9IFNjcmF0Y2guZXh0ZW5zaW9ucy5pc1Blbmd1aW5Nb2Q7CgogIGNvbnN0IGhhc093biA9IChvYmosIHByb3ApID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOwogIGxldCBleHRDbGFzczsKCiAgLy8gQ3VzdG9tIFNxdWFyZSBCbG9jayBTaGFwZXMKICBjb25zdCBvZ0NvbnZlcnRlciA9IHJ1bnRpbWUuX2NvbnZlcnRCbG9ja0ZvclNjcmF0Y2hCbG9ja3MuYmluZChydW50aW1lKTsKICBydW50aW1lLl9jb252ZXJ0QmxvY2tGb3JTY3JhdGNoQmxvY2tzID0gZnVuY3Rpb24gKGJsb2NrSW5mbywgY2F0ZWdvcnlJbmZvKSB7CiAgICBjb25zdCByZXMgPSBvZ0NvbnZlcnRlcihibG9ja0luZm8sIGNhdGVnb3J5SW5mbyk7CiAgICBpZiAoYmxvY2tJbmZvLm91dHB1dFNoYXBlKSByZXMuanNvbi5vdXRwdXRTaGFwZSA9IGJsb2NrSW5mby5vdXRwdXRTaGFwZTsKICAgIHJldHVybiByZXM7CiAgfQoKICBjb25zdCByZWdlblJlcG9ydGVycyA9IFsiU1Bqc29uX29iaktleSIsICJTUGpzb25fb2JqVmFsdWUiLCAiU1Bqc29uX2FyclZhbHVlQSIsICJTUGpzb25fYXJyVmFsdWVCIl07CiAgY29uc3QganNvbkJsb2NrcyA9IFsiU1Bqc29uX29ialZhbGlkIiwgIlNQanNvbl9qc29uQnVpbGRlciIsICJTUGpzb25fZ2V0S2V5IiwgIlNQanNvbl9nZXRQYXRoIiwgIlNQanNvbl9zZXRLZXkiLCAiU1Bqc29uX3NldFBhdGgiLCAiU1Bqc29uX2RlbGV0ZUtleSIsICJTUGpzb25fanNvblNpemUiLCAiU1Bqc29uX2tleUluZGV4IiwgIlNQanNvbl9nZXRFbnRyeSIsICJTUGpzb25fZXh0cmFjdEpzb24iLCAiU1Bqc29uX21lcmdlSnNvbiIsICJTUGpzb25fanNvbk1hcCJdOwogIGlmIChTY3JhdGNoLmd1aSkgU2NyYXRjaC5ndWkuZ2V0QmxvY2tseSgpLnRoZW4oU0IgPT4gewogICAgLy8gUmVnZW4gUmVwb3J0ZXJzCiAgICBjb25zdCBvZ0NoZWNrID0gU0Iuc2NyYXRjaEJsb2Nrc1V0aWxzLmlzU2hhZG93QXJndW1lbnRSZXBvcnRlcjsKICAgIFNCLnNjcmF0Y2hCbG9ja3NVdGlscy5pc1NoYWRvd0FyZ3VtZW50UmVwb3J0ZXIgPSBmdW5jdGlvbiAoYmxvY2spIHsKICAgICAgY29uc3QgcmVzdWx0ID0gb2dDaGVjayhibG9jayk7CiAgICAgIGlmIChyZXN1bHQpIHJldHVybiB0cnVlOwogICAgICByZXR1cm4gYmxvY2suaXNTaGFkb3coKSAmJiByZWdlblJlcG9ydGVycy5pbmNsdWRlcyhibG9jay50eXBlKTsKICAgIH07CgogICAgLy8gQ3VzdG9tIEpTT04gQmxvY2sgU2hhcGUKICAgIGNvbnN0IG1ha2VTaGFwZSA9ICh3aWR0aCkgPT4gewogICAgICB3aWR0aCAtPSAzNTsKICAgICAgcmV0dXJuIChgCiAgICAgICAgbTIwIDBoJHt3aWR0aH1DJHt3aWR0aCArIDMwfSAwICR7d2lkdGggKyAzMH0gNCAke3dpZHRoICsgMzB9IDEyCiAgICAgICAgYzAgMCAyIDAgMyAwIDEgMCAzIDIgMyAzIDAgMSAwIDggMCAxMCAwIDItMSAzLTMgMy0yIDAtMyAwLTMgMAogICAgICAgIEMke3dpZHRoICsgMzB9IDM3ICR7d2lkdGggKyAzMH0gNDAgJHt3aWR0aCArIDIwfSA0MGgkeyh3aWR0aCArIDEwKSAqIC0xfQogICAgICAgIEM1IDQwIDUgMzYgNCAyOGMwIDAtMSAwLTIgMC0yIDAtMy0xLTMtM2wwLTEwYzAgMCAwLTMgNC0zIDAgMCAxIDAgMSAwQzUgNCA1IDAgMTAgMHoKICAgICAgYCkucmVwbGFjZUFsbCgiXG4iLCAiIikudHJpbSgpOwogICAgfTsKCiAgICBjb25zdCBvZ1JlbmRlciA9IFNCLkJsb2NrU3ZnLnByb3RvdHlwZS5yZW5kZXI7CiAgICBTQi5CbG9ja1N2Zy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHsKICAgICAgY29uc3QgZGF0YSA9IG9nUmVuZGVyLmNhbGwodGhpcywgLi4uYXJncyk7CiAgICAgIGlmICh0aGlzLnN2Z1BhdGhfICYmIGpzb25CbG9ja3MuaW5jbHVkZXModGhpcy50eXBlKSkgewogICAgICAgIGlmICh0aGlzLnR5cGUgIT09ICJTUGpzb25fanNvblZhbGlkIiAmJiB0aGlzLnR5cGUgIT09ICJTUGpzb25fb2JqVmFsaWQiKSB7CiAgICAgICAgICBjb25zdCBmaXhlZFdpZHRoID0gdGhpcy53aWR0aCAtIDM1OwogICAgICAgICAgdGhpcy5zdmdQYXRoXy5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIGBzY2FsZSgxLCAke3RoaXMuaGVpZ2h0IC8gNDB9KWApOwogICAgICAgICAgdGhpcy5zdmdQYXRoXy5zZXRBdHRyaWJ1dGUoImQiLCBtYWtlU2hhcGUodGhpcy53aWR0aCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLmlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4gewogICAgICAgICAgaWYgKGlucHV0Lm5hbWUuc3RhcnRzV2l0aCgiT0JKIikpIHsKICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBpbnB1dC5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7CiAgICAgICAgICAgIGlmIChibG9jayAmJiBibG9jay50eXBlID09PSAidGV4dCIgJiYgYmxvY2suc3ZnUGF0aF8pIHsKICAgICAgICAgICAgICBibG9jay5zdmdQYXRoXy5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIGBzY2FsZSgxLCAke2Jsb2NrLmhlaWdodCAvIDQwfSlgKTsKICAgICAgICAgICAgICBibG9jay5zdmdQYXRoXy5zZXRBdHRyaWJ1dGUoImQiLCBtYWtlU2hhcGUoYmxvY2sud2lkdGgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogIH0pOwoKICAvLyBQYXRjaCBTYXZpbmcgUHVyZSBPYmplY3RzIHRvIFZhcmlhYmxlcwogIC8vIFdlIG11c3Qgc3RyaW5naWZ5IHRoZW0gZm9yIGl0IHRvIHdvcmsKICBjb25zdCBvZzJKU09OID0gdm0uY29uc3RydWN0b3IucHJvdG90eXBlLnRvSlNPTjsKICB2bS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKG9wdFRhcmdldElkLCBzZXJpYWxpemF0aW9uT3B0aW9ucykgewogICAgc3RyaW5naWZ5VmFyaWFibGVzKCk7CiAgICByZXR1cm4gb2cySlNPTi5jYWxsKHRoaXMsIG9wdFRhcmdldElkLCBzZXJpYWxpemF0aW9uT3B0aW9ucyk7CiAgfQoKICBmdW5jdGlvbiBzdHJpbmdpZnlWYXJpYWJsZXMoKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJ1bnRpbWUudGFyZ2V0cy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB0YXJnZXQgPSBydW50aW1lLnRhcmdldHNbaV07CiAgICAgIGNvbnN0IHZhcnMgPSBPYmplY3QudmFsdWVzKHRhcmdldC52YXJpYWJsZXMpOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHZhcnMubGVuZ3RoOyBqKyspIHsKICAgICAgICBjb25zdCBkYXRhID0gdmFyc1tqXTsKICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAiYnJvYWRjYXN0X21zZyIpIHsKICAgICAgICAgIGNvbnN0IHZhbCA9IGRhdGEudmFsdWU7CiAgICAgICAgICBpZiAoZGF0YS50eXBlID09PSAibGlzdCIpIHsKICAgICAgICAgICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggbGlzdCBpdGVtCiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdmFsLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWxba10gPT09ICJvYmplY3QiKSB2YWxba10gPSBKU09OLnN0cmluZ2lmeSh2YWxba10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gIm9iamVjdCIpIGRhdGEudmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gTW9kaWZ5IFZpc3VhbCBSZXBvcnQgdG8gc3RyaW5naWZ5IEpTT04KICBjb25zdCBvZ1Zpc1JlcG9ydCA9IHJ1bnRpbWUudmlzdWFsUmVwb3J0OwogIGlmIChpc1BNKSB7CiAgICBydW50aW1lLnZpc3VhbFJlcG9ydCA9IGZ1bmN0aW9uIChibG9ja0lkLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUuY29uc3RydWN0b3I/Lm5hbWUgPT09ICJPYmplY3QiIHx8IHZhbHVlLmNvbnN0cnVjdG9yPy5uYW1lID09PSAiQXJyYXkiKSB7CiAgICAgICAgLy8gUE0gY3VzdG9tIHJldHVybiBjb25zdHJ1Y3RvcnMgaGF2ZSBhIGRpZmZlcmVudCBuYW1lCiAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG9nVmlzUmVwb3J0LmNhbGwodGhpcywgYmxvY2tJZCwgdmFsdWUpOwogICAgfQogIH0gZWxzZSB7CiAgICBydW50aW1lLnZpc3VhbFJlcG9ydCA9IGZ1bmN0aW9uICh0YXJnZXQsIGJsb2NrSWQsIHZhbHVlKSB7CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKICAgICAgcmV0dXJuIG9nVmlzUmVwb3J0LmNhbGwodGhpcywgdGFyZ2V0LCBibG9ja0lkLCB2YWx1ZSk7CiAgICB9CiAgfQoKICAvLyBNb2RpZnkgTW9uaXRvcnMgdG8gc3RyaW5naWZ5IEpTT04KICBpZiAodHlwZW9mIHNjYWZmb2xkaW5nID09PSAidW5kZWZpbmVkIikgewogICAgY29uc3Qgb2dMaXN0ZW5lciA9IHZtLmxpc3RlbmVycygiTU9OSVRPUlNfVVBEQVRFIikuZmluZCgoZikgPT4gZi5uYW1lID09PSAib25Nb25pdG9yc1VwZGF0ZSIpOwogICAgaWYgKG9nTGlzdGVuZXIpIHZtLnJlbW92ZUxpc3RlbmVyKCJNT05JVE9SU19VUERBVEUiLCBvZ0xpc3RlbmVyKTsKICAgIHZtLm9uKCJNT05JVE9SU19VUERBVEUiLCAobW9uaXRvcnMpID0+IHsKICAgICAgY29uc3QgaXRlcmF0b3JzID0gbW9uaXRvcnMuX2xpc3Q/Ll90YWlsPy5hcnJheTsKICAgICAgaWYgKGl0ZXJhdG9ycykgaXRlcmF0b3JzLmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGVudHJ5WzFdLl9tYXAuX3Jvb3Q/LmVudHJpZXMgfHwgZW50cnlbMV0uX21hcC5fcm9vdC5ub2RlczsKICAgICAgICBjb25zdCB2YWx1ZUluZCA9IGRhdGEuZmluZEluZGV4KChlKSA9PiB7IHJldHVybiBlLmVudHJ5ICYmIGUuZW50cnlbMF0gPT09ICJ2YWx1ZSIgfSk7CiAgICAgICAgaWYgKHZhbHVlSW5kID09PSAtMSkgcmV0dXJuOwoKICAgICAgICBpZiAoZGF0YVswXT8uZW50cnkgJiYgZGF0YVswXT8uZW50cnlbMV0gPT09ICJsaXN0IikgewogICAgICAgICAgZGF0YVt2YWx1ZUluZF0uZW50cnlbMV0gPSBkYXRhW3ZhbHVlSW5kXT8uZW50cnlbMV0/Lm1hcCgoaXRlbSkgPT4gewogICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICJvYmplY3QiKSBpdGVtID0gSlNPTi5zdHJpbmdpZnkoaXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVt2YWx1ZUluZF0uZW50cnlbMV07CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAib2JqZWN0IikgZGF0YVt2YWx1ZUluZF0uZW50cnlbMV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIFJlZHV4U3RvcmUuZGlzcGF0Y2goewogICAgICAgIHR5cGU6ICJzY3JhdGNoLWd1aS9tb25pdG9ycy9VUERBVEVfTU9OSVRPUlMiLAogICAgICAgIG1vbml0b3JzCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICAvLyBDb21waWxlciBQYXRjaGVzCiAgLy8gVE9ETyByZW1vdmUgdGhpcyB3aGVuIHRoZXJlIGlzIGEgZGVkaWNhdGVkIEFQSSBmb3IgcmVmcmVzaGluZyBibG9jayBhcmd1bWVudHMKICBjb25zdCBnZW5lcmF0ZVBhcnNlciA9ICh0eXBlLCBhbHdheXNUcnlQYXJzZSkgPT4gewogICAgaWYgKCFhbHdheXNUcnlQYXJzZSkgcmV0dXJuIGAobykgPT4ge3JldHVybiBvfWA7CgogICAgY29uc3QgZGVmYXVsdFYgPSB0eXBlID09PSB1bmRlZmluZWQgPyAibyIgOiB0eXBlID09PSAwID8gInt9IiA6ICJbXSI7CiAgICBsZXQgZnVuY1N0cmluZyA9IGAobykgPT4ge1xuYDsKCiAgICBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSBmdW5jU3RyaW5nICs9IGBpZiAodHlwZW9mIG8gPT09ICJvYmplY3QiKSByZXR1cm4gbztcbmA7CiAgICBlbHNlIGlmICh0eXBlID09PSAwKSBmdW5jU3RyaW5nICs9IGBpZiAoby5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCIpIHJldHVybiBvO1xuYDsKICAgIGVsc2UgZnVuY1N0cmluZyArPSBgaWYgKEFycmF5LmlzQXJyYXkobykpIHJldHVybiBvO1xuYDsKCiAgICBmdW5jU3RyaW5nICs9IGB0cnkge1xuYDsKICAgIGZ1bmNTdHJpbmcgKz0gYGNvbnN0IHAgPSBKU09OLnBhcnNlKG8pO1xuYDsKICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIGZ1bmNTdHJpbmcgKz0gYHJldHVybiBwO1xuYDsKICAgIGVsc2UgaWYgKHR5cGUgPT09IDApIGZ1bmNTdHJpbmcgKz0gYHJldHVybiBwLmNvbnN0cnVjdG9yPy5uYW1lID09PSAiT2JqZWN0IiA/IHAgOiAke2RlZmF1bHRWfTtcbmA7CiAgICBlbHNlIGZ1bmNTdHJpbmcgKz0gYHJldHVybiBBcnJheS5pc0FycmF5KHApID8gcCA6ICR7ZGVmYXVsdFZ9O1xuYDsKICAgIGZ1bmNTdHJpbmcgKz0gYH0gY2F0Y2gge3JldHVybiAke2RlZmF1bHRWfX1cbmA7CiAgICByZXR1cm4gZnVuY1N0cmluZyArICJ9IjsKICB9CiAgY29uc3QgZ2VuZXJhdGVDbGVhbnNlciA9ICh0eXBlKSA9PiB7CiAgICBsZXQgZnVuY1N0cmluZyA9IGAoKCkgPT4ge1xuYDsKICAgIGZ1bmNTdHJpbmcgKz0gYGNvbnN0IHQgPSB0eXBlb2YgJHt0eXBlfTtcbmA7CiAgICBmdW5jU3RyaW5nICs9IGBpZiAodCA9PT0gInVuZGVmaW5lZCIpIHJldHVybiAiIjtcbmA7CiAgICBmdW5jU3RyaW5nICs9IGBlbHNlIGlmICh0ID09PSAib2JqZWN0IikgcmV0dXJuIEpTT04uc3RyaW5naWZ5KCR7dHlwZX0pO1xuYDsKICAgIGZ1bmNTdHJpbmcgKz0gYGVsc2UgcmV0dXJuICR7dHlwZX0udG9TdHJpbmcoKTtcbmA7CiAgICByZXR1cm4gZnVuY1N0cmluZyArICJ9KSgpIjsKICB9CgogIGZ1bmN0aW9uIGdldENvbXBpbGVyKCkgewogICAgaWYgKHZtLmV4cG9ydHMuaV93aWxsX25vdF9hc2tfZm9yX2hlbHBfd2hlbl90aGVzZV9icmVhaykgcmV0dXJuIHZtLmV4cG9ydHMuaV93aWxsX25vdF9hc2tfZm9yX2hlbHBfd2hlbl90aGVzZV9icmVhaygpOwogICAgZWxzZSBpZiAodm0uZXhwb3J0cy5KU0dlbmVyYXRvciAmJiB2bS5leHBvcnRzLklSR2VuZXJhdG9yPy5leHBvcnRzKSByZXR1cm4gewogICAgICAuLi52bS5leHBvcnRzLCBTY3JpcHRUcmVlR2VuZXJhdG9yOiB2bS5leHBvcnRzLklSR2VuZXJhdG9yLmV4cG9ydHMuU2NyaXB0VHJlZUdlbmVyYXRvcgogICAgfTsKICB9CiAgY29uc3QgY29tcGlsZXIgPSBnZXRDb21waWxlcigpOwogIGlmIChjb21waWxlcikgewogICAgY29uc3QgeyBKU0dlbmVyYXRvciwgU2NyaXB0VHJlZUdlbmVyYXRvciB9ID0gY29tcGlsZXI7CiAgICBjb25zdCBleHAgPSBKU0dlbmVyYXRvci5leHBvcnRzID09PSB1bmRlZmluZWQgPyBKU0dlbmVyYXRvci51bnN0YWJsZV9leHBvcnRzIDogSlNHZW5lcmF0b3IuZXhwb3J0czsKICAgIGNvbnN0IF9vZ0lSZGVzY2VuZFN0YWNrID0gU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jazsKICAgIFNjcmlwdFRyZWVHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2sgPSBmdW5jdGlvbiAoYmxvY2spIHsKICAgICAgc3dpdGNoIChibG9jay5vcGNvZGUpIHsKICAgICAgICBjYXNlICJTUGpzb25fZm9yRWFjaCI6CiAgICAgICAgICB0aGlzLmFuYWx5emVMb29wKCk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBraW5kOiAiU1Bqc29uLmZvckVhY2giLAogICAgICAgICAgICBvYmo6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIk9CSiIpLCBicmFuY2g6IHRoaXMuZGVzY2VuZFN1YnN0YWNrKGJsb2NrLCAiU1VCU1RBQ0siKQogICAgICAgICAgfTsKICAgICAgICBkZWZhdWx0OiByZXR1cm4gX29nSVJkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBibG9jayk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IF9vZ0pTZGVzY2VuZFN0YWNrID0gSlNHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2s7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jayA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgIHN3aXRjaCAobm9kZS5raW5kKSB7CiAgICAgICAgY2FzZSAiU1Bqc29uLmZvckVhY2giOgogICAgICAgICAgY29uc3Qgc2FmZU9iaiA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUub2JqKS5hc1Vua25vd24oKTsKICAgICAgICAgIGNvbnN0IG9ialZhciA9IHRoaXMubG9jYWxWYXJpYWJsZXMubmV4dCgpOwogICAgICAgICAgY29uc3QgaXNBcnJheSA9IHRoaXMubG9jYWxWYXJpYWJsZXMubmV4dCgpOwogICAgICAgICAgY29uc3QgaSA9IHRoaXMubG9jYWxWYXJpYWJsZXMubmV4dCgpOwoKICAgICAgICAgIHRoaXMuc291cmNlICs9IGBsZXQgJHtvYmpWYXJ9ID0gKCR7Z2VuZXJhdGVQYXJzZXIodW5kZWZpbmVkLCBleHRDbGFzcy5hbHdheXNUcnlQYXJzZSl9KSgke3NhZmVPYmp9KVxuO2A7CiAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgY29uc3QgJHtpc0FycmF5fSA9IEFycmF5LmlzQXJyYXkoJHtvYmpWYXJ9KVxuO2A7CiAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgJHtvYmpWYXJ9ID0gT2JqZWN0LmVudHJpZXMoJHtvYmpWYXJ9KVxuO2A7CiAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgZm9yIChsZXQgJHtpfSA9IDA7ICR7aX0gPCAke29ialZhcn0ubGVuZ3RoOyAke2l9KyspIHtcbjtgOwogICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYGxldCBbU1BvYmpLLCBTUG9ialZdID0gJHtvYmpWYXJ9WyR7aX1dO1xuYDsKICAgICAgICAgIHRoaXMuc291cmNlICs9IGBpZiAoJHtpc0FycmF5fSkgU1BvYmpLKytcbmA7CiAgICAgICAgICB0aGlzLmRlc2NlbmRTdGFjayhub2RlLmJyYW5jaCwgbmV3IGV4cC5GcmFtZSh0cnVlKSk7CiAgICAgICAgICB0aGlzLnlpZWxkTG9vcCgpOwogICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYH1cbmA7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OiByZXR1cm4gX29nSlNkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBub2RlKTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IF9vZ0lSZGVzY2VuZElucCA9IFNjcmlwdFRyZWVHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRJbnB1dDsKICAgIFNjcmlwdFRyZWVHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRJbnB1dCA9IGZ1bmN0aW9uIChibG9jaykgewogICAgICBzd2l0Y2ggKGJsb2NrLm9wY29kZSkgewogICAgICAgIGNhc2UgIlNQanNvbl9hcnJWYWx1ZUEiOiByZXR1cm4geyBraW5kOiAiU1Bqc29uLmFyclZhbEEiIH07CiAgICAgICAgY2FzZSAiU1Bqc29uX2FyclZhbHVlQiI6IHJldHVybiB7IGtpbmQ6ICJTUGpzb24uYXJyVmFsQiIgfTsKICAgICAgICBjYXNlICJTUGpzb25fb2JqS2V5IjogcmV0dXJuIHsga2luZDogIlNQanNvbi5vYmpLZXkiIH07CiAgICAgICAgY2FzZSAiU1Bqc29uX29ialZhbHVlIjogcmV0dXJuIHsga2luZDogIlNQanNvbi5vYmpWYWwiIH07CiAgICAgICAgY2FzZSAiU1Bqc29uX2pzb25NYXAiOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAga2luZDogIlNQanNvbi5qc29uTWFwIiwKICAgICAgICAgICAgb2JqOiB0aGlzLmRlc2NlbmRJbnB1dE9mQmxvY2soYmxvY2ssICJPQkoiKSwgdmFsdWU6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlZBTFVFIikKICAgICAgICAgIH07CiAgICAgICAgY2FzZSAiU1Bqc29uX2FyckNoZWNrIjoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGtpbmQ6ICJTUGpzb24uYXJyQ2hlY2siLCB0eXBlOiBibG9jay5maWVsZHMuVFlQRS52YWx1ZSwKICAgICAgICAgICAgYXJyYXk6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIkFSUiIpLCBib29sOiB0aGlzLmRlc2NlbmRJbnB1dE9mQmxvY2soYmxvY2ssICJCT09MIiksCiAgICAgICAgICB9OwogICAgICAgIGNhc2UgIlNQanNvbl9hcnJNYXAiOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAga2luZDogIlNQanNvbi5hcnJNYXAiLAogICAgICAgICAgICBhcnJheTogdGhpcy5kZXNjZW5kSW5wdXRPZkJsb2NrKGJsb2NrLCAiQVJSIiksIHZhbHVlOiB0aGlzLmRlc2NlbmRJbnB1dE9mQmxvY2soYmxvY2ssICJWQUxVRSIpCiAgICAgICAgICB9OwogICAgICAgIGNhc2UgIlNQanNvbl9hcnJTb3J0IjoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGtpbmQ6ICJTUGpzb24uYXJyU29ydCIsCiAgICAgICAgICAgIGFycmF5OiB0aGlzLmRlc2NlbmRJbnB1dE9mQmxvY2soYmxvY2ssICJBUlIiKSwgdmFsdWU6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlZBTFVFIikKICAgICAgICAgIH07CiAgICAgICAgY2FzZSAiU1Bqc29uX2ZpbHRlck5ldyI6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBraW5kOiAiU1Bqc29uLmZpbHRlciIsIHR5cGU6IGJsb2NrLmZpZWxkcy5UWVBFLnZhbHVlLAogICAgICAgICAgICBvYmo6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIk9CSiIpLCBib29sOiB0aGlzLmRlc2NlbmRJbnB1dE9mQmxvY2soYmxvY2ssICJCT09MIikKICAgICAgICAgIH07CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIF9vZ0lSZGVzY2VuZElucC5jYWxsKHRoaXMsIGJsb2NrKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IF9vZ0pTZGVzY2VuZElucCA9IEpTR2VuZXJhdG9yLnByb3RvdHlwZS5kZXNjZW5kSW5wdXQ7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0ID0gZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgaWYgKG5vZGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICBzd2l0Y2ggKG5vZGUua2luZCkgewogICAgICAgIGNhc2UgIlNQanNvbi5hcnJWYWxBIjogcmV0dXJuIG5ldyBleHAuVHlwZWRJbnB1dChnZW5lcmF0ZUNsZWFuc2VyKCJTUGFyckEiKSwgZXhwLlRZUEVfU1RSSU5HKTsKICAgICAgICBjYXNlICJTUGpzb24uYXJyVmFsQiI6IHJldHVybiBuZXcgZXhwLlR5cGVkSW5wdXQoZ2VuZXJhdGVDbGVhbnNlcigiU1BhcnJCIiksIGV4cC5UWVBFX1NUUklORyk7CiAgICAgICAgY2FzZSAiU1Bqc29uLm9iaktleSI6IHJldHVybiBuZXcgZXhwLlR5cGVkSW5wdXQoZ2VuZXJhdGVDbGVhbnNlcigiU1BvYmpLIiksIGV4cC5UWVBFX1NUUklORyk7CiAgICAgICAgY2FzZSAiU1Bqc29uLm9ialZhbCI6IHJldHVybiBuZXcgZXhwLlR5cGVkSW5wdXQoZ2VuZXJhdGVDbGVhbnNlcigiU1BvYmpWIiksIGV4cC5UWVBFX1NUUklORyk7CiAgICAgICAgY2FzZSAiU1Bqc29uLmpzb25NYXAiOiB7CiAgICAgICAgICBjb25zdCBzYWZlT2JqID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS5vYmopLmFzVW5rbm93bigpOwogICAgICAgICAgY29uc3Qgc2FmZVZhbHVlID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS52YWx1ZSkuYXNVbmtub3duKCk7CiAgICAgICAgICByZXR1cm4gbmV3IGV4cC5UeXBlZElucHV0KGAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uKiBnZW5lcmF0b3IoKSB7CiAgICAgICAgICAgICAgY29uc3QgcCA9ICgke2dlbmVyYXRlUGFyc2VyKDAsIGV4dENsYXNzLmFsd2F5c1RyeVBhcnNlKX0pKCR7c2FmZU9ian0pOwogICAgICAgICAgICAgIGNvbnN0IGUgPSBPYmplY3QuZW50cmllcyhwKTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtTUG9iakssIFNQb2JqVl0gb2YgZSkgeWllbGQgW1NQb2JqSywgJHtzYWZlVmFsdWV9XTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKGdlbmVyYXRvcigpKTsKICAgICAgICAgIH0pKClgLCBleHAuVFlQRV9VTktOT1dOKTsKICAgICAgICB9CiAgICAgICAgY2FzZSAiU1Bqc29uLmFyckNoZWNrIjogewogICAgICAgICAgY29uc3Qgc2FmZU9iaiA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUuYXJyYXkpLmFzVW5rbm93bigpOwogICAgICAgICAgY29uc3Qgc2FmZUJvb2wgPSB0aGlzLmRlc2NlbmRJbnB1dChub2RlLmJvb2wpLmFzQm9vbGVhbigpOwogICAgICAgICAgcmV0dXJuIG5ldyBleHAuVHlwZWRJbnB1dChgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmdW5jdGlvbiogZ2VuZXJhdG9yKCkgewogICAgICAgICAgICAgIGNvbnN0IHAgPSAoJHtnZW5lcmF0ZVBhcnNlcigxLCBleHRDbGFzcy5hbHdheXNUcnlQYXJzZSl9KSgke3NhZmVPYmp9KTsKICAgICAgICAgICAgICB5aWVsZCBwLiR7bm9kZS50eXBlID09PSAic29tZSIgPyAic29tZSIgOiAiZXZlcnkifSgoU1BvYmpWLCBTUG9iakspID0+IHsKICAgICAgICAgICAgICAgIFNQb2JqSysrOwogICAgICAgICAgICAgICAgcmV0dXJuICR7c2FmZUJvb2x9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbLi4uZ2VuZXJhdG9yKCldWzBdOwogICAgICAgICAgfSkoKWAsIGV4cC5UWVBFX0JPT0xFQU4pOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUGpzb24uYXJyTWFwIjogewogICAgICAgICAgY29uc3Qgc2FmZU9iaiA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUuYXJyYXkpLmFzVW5rbm93bigpOwogICAgICAgICAgY29uc3Qgc2FmZVZhbHVlID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS52YWx1ZSkuYXNVbmtub3duKCk7CiAgICAgICAgICByZXR1cm4gbmV3IGV4cC5UeXBlZElucHV0KGAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uKiBnZW5lcmF0b3IoKSB7CiAgICAgICAgICAgICAgY29uc3QgcCA9ICgke2dlbmVyYXRlUGFyc2VyKDEsIGV4dENsYXNzLmFsd2F5c1RyeVBhcnNlKX0pKCR7c2FmZU9ian0pOwogICAgICAgICAgICAgIGxldCBTUG9iaksgPSAxOwogICAgICAgICAgICAgIGZvciAoY29uc3QgU1BvYmpWIG9mIHApIHsKICAgICAgICAgICAgICAgIHlpZWxkICR7c2FmZVZhbHVlfTsKICAgICAgICAgICAgICAgIFNQb2JqSysrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gWy4uLmdlbmVyYXRvcigpXTsKICAgICAgICAgIH0pKClgLCBleHAuVFlQRV9VTktOT1dOKTsKICAgICAgICB9CiAgICAgICAgY2FzZSAiU1Bqc29uLmFyclNvcnQiOiB7CiAgICAgICAgICBjb25zdCBzYWZlT2JqID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS5hcnJheSkuYXNVbmtub3duKCk7CiAgICAgICAgICBjb25zdCBzYWZlVmFsdWUgPSB0aGlzLmRlc2NlbmRJbnB1dChub2RlLnZhbHVlKS5hc1Vua25vd24oKTsKICAgICAgICAgIC8vIHRoaXMgaXMgYSByb3VnaCBjaGVjaywgYnV0IGl0cyB0aGUgYmVzdCB3ZSBjYW4gZG8KICAgICAgICAgIGlmIChzYWZlVmFsdWUuaW5jbHVkZXMoYHlpZWxkKiBleGVjdXRlSW5Db21wYXRgKSAmJiAhc2FmZVZhbHVlLmluY2x1ZGVzKGAieWllbGQqIGV4ZWN1dGVJbkNvbXBhdGApKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgZXhwLlR5cGVkSW5wdXQoYChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBmdW5jdGlvbiogZ2VuZXJhdG9yKCkgewogICAgICAgICAgICAgICAgY29uc3Qgc3RyaW5nZXIgPSAodikgPT4geyByZXR1cm4gdHlwZW9mIHYgPT09ICJvYmplY3QiID8gSlNPTi5zdHJpbmdpZnkodikgOiB2LnRvU3RyaW5nKCkgfTsKICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB7fTsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSAoJHtnZW5lcmF0ZVBhcnNlcigxLCBleHRDbGFzcy5hbHdheXNUcnlQYXJzZSl9KSgke3NhZmVPYmp9KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHAubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBTUGFyckEgPSBwW2ldLCBTUGFyckIgPSBwW2pdOwogICAgICAgICAgICAgICAgICAgIHNbc3RyaW5nZXIocFtpXSkgKyBzdHJpbmdlcihwW2pdKV0gPSAke3NhZmVWYWx1ZX07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5wXS5zb3J0KChhLCBiKSA9PiB7IHJldHVybiBzW3N0cmluZ2VyKGEpICsgc3RyaW5nZXIoYildID8/IDAgfSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygc29ydGVkKSB5aWVsZCBpdGVtOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gWy4uLmdlbmVyYXRvcigpXTsKICAgICAgICAgICAgfSkoKWAsIGV4cC5UWVBFX1VOS05PV04pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBleHAuVHlwZWRJbnB1dChgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGZ1bmN0aW9uKiBnZW5lcmF0b3IoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gKCR7Z2VuZXJhdGVQYXJzZXIoMSwgZXh0Q2xhc3MuYWx3YXlzVHJ5UGFyc2UpfSkoJHtzYWZlT2JqfSk7CiAgICAgICAgICAgICAgICBjb25zdCBzb3J0ZWQgPSBbLi4ucF0uc29ydCgoU1BhcnJBLCBTUGFyckIpID0+IHsgcmV0dXJuICR7c2FmZVZhbHVlfTsgfSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygc29ydGVkKSB5aWVsZCBpdGVtOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gWy4uLmdlbmVyYXRvcigpXTsKICAgICAgICAgICAgfSkoKWAsIGV4cC5UWVBFX1VOS05PV04pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXNlICJTUGpzb24uZmlsdGVyIjogewogICAgICAgICAgY29uc3Qgc2FmZU9iaiA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUub2JqKS5hc1Vua25vd24oKTsKICAgICAgICAgIGNvbnN0IHNhZmVCb29sID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS5ib29sKS5hc0Jvb2xlYW4oKTsKICAgICAgICAgIHJldHVybiBuZXcgZXhwLlR5cGVkSW5wdXQoYChmdW5jdGlvbigpIHsKICAgICAgICAgICAgZnVuY3Rpb24qIGdlbmVyYXRvcigpIHsKICAgICAgICAgICAgICBjb25zdCBwID0gKCR7Z2VuZXJhdGVQYXJzZXIodW5kZWZpbmVkLCBleHRDbGFzcy5hbHdheXNUcnlQYXJzZSl9KSgke3NhZmVPYmp9KTsKICAgICAgICAgICAgICBjb25zdCBlID0gT2JqZWN0LmVudHJpZXMocCk7CiAgICAgICAgICAgICAgY29uc3QgaXNPID0gcC5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCI7CgogICAgICAgICAgICAgIGlmICgke25vZGUudHlwZSA9PT0gImZpbHRlciJ9KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNPKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9OwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBbU1BvYmpLLCBTUG9ialZdIG9mIGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHtzYWZlQm9vbH0pIHJlc3VsdFtTUG9iaktdID0gU1BvYmpWOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHlpZWxkIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGxldCBbU1BvYmpLLCBTUG9ialZdIG9mIGUpIHsKICAgICAgICAgICAgICAgICAgICBTUG9iaksrKzsKICAgICAgICAgICAgICAgICAgICBpZiAoJHtzYWZlQm9vbH0pIHJlc3VsdC5wdXNoKFNQb2JqVik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgeWllbGQgcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBuID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBbU1BvYmpLLCBTUG9ialZdIG9mIGUpIHsKICAgICAgICAgICAgICAgICAgaWYgKGlzTykgewogICAgICAgICAgICAgICAgICAgIGlmICgke3NhZmVCb29sfSkgbi51bnNoaWZ0KFtTUG9iakssIFNQb2JqVl0pOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugbi5wdXNoKFtTUG9iakssIFNQb2JqVl0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFNQb2JqSysrOwogICAgICAgICAgICAgICAgICAgIGlmICgke3NhZmVCb29sfSkgbi51bnNoaWZ0KFNQb2JqVik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBuLnB1c2goU1BvYmpWKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeWllbGQgaXNPID8gT2JqZWN0LmZyb21FbnRyaWVzKG4pIDogbjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFsuLi5nZW5lcmF0b3IoKV1bMF07CiAgICAgICAgICB9KSgpYCwgZXhwLlRZUEVfVU5LTk9XTik7CiAgICAgICAgfQogICAgICAgIGRlZmF1bHQ6IHJldHVybiBfb2dKU2Rlc2NlbmRJbnAuY2FsbCh0aGlzLCBub2RlKTsKICAgICAgfQogICAgfTsKICB9CgogIGNsYXNzIFNQanNvbiB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zZXR0aW5ncyA9IFsKICAgICAgICB7IHRleHQ6ICJhbHdheXMgY2FzdCB2YWx1ZXMiLCB2YWx1ZTogImFsd2F5c0Nhc3QiIH0sCiAgICAgICAgeyB0ZXh0OiAiYWx3YXlzIHBhcnNlIHRleHQgb2JqZWN0cyIsIHZhbHVlOiAiYWx3YXlzUGFyc2UiIH0sCiAgICAgICAgeyB0ZXh0OiAiYWx3YXlzIHRyeSBwYXJzaW5nIiwgdmFsdWU6ICJhbHdheXNUcnlQYXJzZSIgfSwKICAgICAgICB7IHRleHQ6ICJkb250IGVkaXQgc291cmNlIG9iamVjdHMiLCB2YWx1ZTogInVzZU5ld09iaiIgfSwKICAgICAgXTsKICAgICAgdGhpcy5hbHdheXNDYXN0ID0gdHJ1ZTsgdGhpcy5hbHdheXNQYXJzZSA9IHRydWU7CiAgICAgIHRoaXMuYWx3YXlzVHJ5UGFyc2UgPSB0cnVlOyB0aGlzLnVzZU5ld09iaiA9IHRydWU7CiAgICB9CiAgICBnZXRJbmZvKCkgewogICAgICByZXR1cm4gewogICAgICAgIGlkOiAiU1Bqc29uIiwKICAgICAgICBuYW1lOiAiSlNPTiBhbmQgQXJyYXkiLAogICAgICAgIGNvbG9yMTogIiM3NDhiZWUiLAogICAgICAgIG1lbnVJY29uVVJJLAogICAgICAgIGJsb2NrczogWwogICAgICAgICAgewogICAgICAgICAgICBmdW5jOiAid2FybiIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQlVUVE9OLAogICAgICAgICAgICB0ZXh0OiAiVXNhZ2UgV2FybmluZyIKICAgICAgICAgIH0sCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6ICJKU09OIiB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJvYmpWYWxpZCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgdGV4dDogImlzIG9iamVjdCBbT0JKXSB2YWxpZD8iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6InZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAianNvbkJ1aWxkZXIiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAieyBbS0VZXSA6IFtWQUxdIH0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBLRVk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJrZXkiIH0sCiAgICAgICAgICAgICAgVkFMOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidmFsdWUiLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImdldEtleSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJnZXQgW0tFWV0gZnJvbSBbT0JKXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEtFWTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImtleSIgfSwKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6InZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJnZXRQYXRoIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImdldCBwYXRoIFtQQVRIXSBmcm9tIFtPQkpdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgUEFUSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsia2V5IiwgInZhbHVlMSJdYCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6eyJ2YWx1ZTEiOjEsICJ2YWx1ZTIiOjJ9fWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInNldEtleSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJzZXQgW0tFWV0gdG8gW1ZBTF0gaW4gW09CSl0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBLRVk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJrZXkiIH0sCiAgICAgICAgICAgICAgVkFMOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidmFsdWUiLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInt9IiwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAic2V0UGF0aCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJzZXQgcGF0aCBbUEFUSF0gdG8gW1ZBTF0gaW4gW09CSl0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBQQVRIOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgWyJrZXkxIiwgImtleTIiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgVkFMOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidmFsdWUiLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5MSI6e319YCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZGVsZXRlS2V5IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImRlbGV0ZSBbS0VZXSBmcm9tIFtPQkpdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgS0VZOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAia2V5IiB9LAogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5IjoidmFsdWUifWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImpzb25TaXplIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogInNpemUgb2YgW09CSl0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6InZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImtleUluZGV4IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImluZGV4IG9mIFtLRVldIGluIFtPQkpdIiwKICAgICAgICAgICAgYWxsb3dEcm9wQW55d2hlcmU6IHRydWUsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEtFWTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImtleSIgfSwKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6InZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJnZXRFbnRyeSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJnZXQgW0tFWV0gZW50cnkgZnJvbSBbT0JKXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEtFWTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImtleSIgfSwKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGB7ImtleSI6InZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJleHRyYWN0SnNvbiIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJhbGwgW1RZUEVdIGZyb20gW09CSl0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIk9CSl9FWFRSQUNUIiB9LAogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5IjoidmFsdWUiLCJrZXkyIjoidmFsdWUyIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJtZXJnZUpzb24iLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAibWVyZ2UgW09CSjFdIGFuZCBbT0JKMl0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBPQkoxOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgeyJrZXkiOiJ2YWx1ZSJ9YCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBPQkoyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgeyJrZXkyIjoidmFsdWUyIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImpzb25NYXAiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAibWFwIFtPQkpdIHVzaW5nIHJ1bGUgW0lORF0gW1ZBTF0gW0lNR10gW1ZBTFVFXSIsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgT0JKOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBJTkQ6IHt9LCBWQUw6IHt9LAogICAgICAgICAgICAgIFZBTFVFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBJTUc6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuSU1BR0UsIGRhdGFVUkk6IGFycm93VVJJIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuWE1MLAogICAgICAgICAgICB4bWw6IGAKICAgICAgICAgICAgICA8YmxvY2sgdHlwZT0iU1Bqc29uX2pzb25NYXAiPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9Ik9CSiI+PHNoYWRvdyB0eXBlPSJ0ZXh0Ij48ZmllbGQgbmFtZT0iVEVYVCI+eyJrZXkiOiJ2YWx1ZSJ9PC9maWVsZD48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IklORCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqS2V5Ij48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IlZBTCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqVmFsdWUiPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iVkFMVUUiPjxzaGFkb3cgdHlwZT0idGV4dCI+PGZpZWxkIG5hbWU9IlRFWFQiPnZhbHVlLTI8L2ZpZWxkPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgPC9ibG9jaz5gCiAgICAgICAgICB9LAogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiQXJyYXlzIiB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJWYWxpZCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgdGV4dDogImlzIGFycmF5IFtBUlJdIHZhbGlkPyIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsiYSIsICJiIiwgImMiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJCdWlsZGVyIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogIu+8uyBbVkFMXSDvvL0iLAogICAgICAgICAgICBvdXRwdXRTaGFwZTogMywKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVkFMOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAidmFsdWUiLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFyckFkZCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJhZGQgW0lURU1dIHRvIFtBUlJdIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElURU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJ0aGluZyIsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgQVJSOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiW10iLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJJbnNlcnQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiaW5zZXJ0IFtJVEVNXSBhdCBbSU5EXSBpbiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJVEVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYiIsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSU5EOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAyIH0sCiAgICAgICAgICAgICAgQVJSOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgWyJhIiwgImMiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFyclJlcGxhY2UiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAicmVwbGFjZSBpdGVtIFtJTkRdIHdpdGggW0lURU1dIGluIFtBUlJdIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElORDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMSB9LAogICAgICAgICAgICAgIElURU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhIiwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbInoiLCAiYiIsICJjIl1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJTd2FwIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogInN3YXAgaXRlbSBbSU5EMV0gd2l0aCBpdGVtIFtJTkQyXSBpbiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJTkQxOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxIH0sCiAgICAgICAgICAgICAgSU5EMjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogMyB9LAogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsiYSIsICJiIiwgImMiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFyckRlbGV0ZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJkZWxldGUgaXRlbSBbSU5EXSBpbiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJTkQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEgfSwKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiIsICJjIl1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJHZXQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiaXRlbSBbSU5EXSBpbiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJTkQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEgfSwKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiIsICJjIl1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJTbGljZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJpdGVtcyBbSU5EMV0gdG8gW0lORDJdIGluIFtBUlJdIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElORDE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDIgfSwKICAgICAgICAgICAgICBJTkQyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAzIH0sCiAgICAgICAgICAgICAgQVJSOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgWyJhIiwgImIiLCAiYyJdYCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYXJyTGVuZ3RoIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImxlbmd0aCBvZiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiIsICJjIl1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogIml0ZW1FeGlzdHMiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgIHRleHQ6ICJbQVJSXSBjb250YWlucyBbSVRFTV0gPyIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsiYSIsICJiIiwgImMiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSVRFTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImIiIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFyck1hdGNoZXMiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiIyBvZiB0aW1lcyBbSVRFTV0gYXBwZWFycyBpbiBbQVJSXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJVEVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYSIgfSwKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiIsICJiIiwgImEiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogIml0ZW1JbmRleCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJpbmRleCAjIFtJTkRdIG9mIGl0ZW0gW0lURU1dIGluIFtBUlJdIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElORDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMSB9LAogICAgICAgICAgICAgIElURU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhIiB9LAogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsiYSIsICJiIiwgImIiLCAiYSJdYCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgICItLS0iLAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJtZXJnZUFycmF5IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogIm1lcmdlIGFycmF5IFtBUlIxXSBhbmQgW0FSUjJdIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEFSUjE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiJdYCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBBUlIyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgWyJjIiwgImQiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInJlcGVhdEFycmF5IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogInJlcGVhdCBhcnJheSBbQVJSXSBbTlVNXSB0aW1lcyIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IGBbImEiLCAiYiJdYCwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBOVU06IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDMgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZmlsbEFycmF5IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImZpbGwgYXJyYXkgW0FSUl0gdG8gbGVuZ3RoIFtOVU1dIiwKICAgICAgICAgICAgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYFsiYSIsICJiIl1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICAgIE5VTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJPcmRlciIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJvcmRlciBbQVJSXSBieSBbT1JERVJFUl0iLAogICAgICAgICAgICBvdXRwdXRTaGFwZTogMywKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgQVJSOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiBgWyIyIiwgIml0ZW0xIiwgIjEiLCAiaXRlbTEyIiwgIjEiXWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgT1JERVJFUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJPUkRFUklORyIgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFyckNoZWNrIiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAiY2hlY2sgW0FSUl0gaWYgW1RZUEVdIGl0ZW0gW0lORF0gW1ZBTF0gW0lNR10gW0JPT0xdIiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkFSUkFZX0NIRUNLIiB9LAogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSU5EOiB7fSwgVkFMOiB7fSwgQk9PTDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5CT09MRUFOIH0sCiAgICAgICAgICAgICAgSU1HOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLklNQUdFLCBkYXRhVVJJOiBhcnJvd1VSSSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJNYXAiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLCBvdXRwdXRTaGFwZTogMywKICAgICAgICAgICAgdGV4dDogIm1hcCBbQVJSXSB1c2luZyBydWxlIFtJTkRdIFtWQUxdIFtJTUddIFtWQUxVRV0iLCBoaWRlRnJvbVBhbGV0dGU6IHRydWUsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIEFSUjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSU5EOiB7fSwgVkFMOiB7fSwKICAgICAgICAgICAgICBWQUxVRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSU1HOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLklNQUdFLCBkYXRhVVJJOiBhcnJvd1VSSSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJWYWx1ZUEiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IHRydWUsIGFsbG93RHJvcEFueXdoZXJlOiB0cnVlLAogICAgICAgICAgICB0ZXh0OiAidmFsdWUgQSIsIGNvbG9yMTogIiM2NzdjZDYiCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJWYWx1ZUIiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IHRydWUsIGFsbG93RHJvcEFueXdoZXJlOiB0cnVlLAogICAgICAgICAgICB0ZXh0OiAidmFsdWUgQiIsIGNvbG9yMTogIiM2NzdjZDYiCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhcnJTb3J0IiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwgb3V0cHV0U2hhcGU6IDMsCiAgICAgICAgICAgIHRleHQ6ICJzb3J0IFtBUlJdIHVzaW5nIHJ1bGUgW0FdIFtCXSBbSU1HXSBbVkFMVUVdIiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBBUlI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9LAogICAgICAgICAgICAgIEE6IHt9LCBCOiB7fSwKICAgICAgICAgICAgICBWQUxVRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfSwKICAgICAgICAgICAgICBJTUc6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuSU1BR0UsIGRhdGFVUkk6IGFycm93VVJJIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuWE1MLAogICAgICAgICAgICB4bWw6IGAKICAgICAgICAgICAgICA8YmxvY2sgdHlwZT0iU1Bqc29uX2FyckNoZWNrIj4KICAgICAgICAgICAgICAgIDxmaWVsZCBuYW1lPSJUWVBFIj5ldmVyeTwvZmllbGQ+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iQVJSIj48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj5bImEiLCAiYiIsICJjIl08L2ZpZWxkPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iSU5EIj48c2hhZG93IHR5cGU9IlNQanNvbl9vYmpLZXkiPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iVkFMIj48c2hhZG93IHR5cGU9IlNQanNvbl9vYmpWYWx1ZSI+PC9zaGFkb3c+PC92YWx1ZT4KICAgICAgICAgICAgICA8L2Jsb2NrPgogICAgICAgICAgICAgIDxibG9jayB0eXBlPSJTUGpzb25fYXJyTWFwIj4KICAgICAgICAgICAgICAgIDx2YWx1ZSBuYW1lPSJBUlIiPjxzaGFkb3cgdHlwZT0idGV4dCI+PGZpZWxkIG5hbWU9IlRFWFQiPlsiYSIsICJiIiwgImMiXTwvZmllbGQ+PC9zaGFkb3c+PC92YWx1ZT4KICAgICAgICAgICAgICAgIDx2YWx1ZSBuYW1lPSJJTkQiPjxzaGFkb3cgdHlwZT0iU1Bqc29uX29iaktleSI+PC9zaGFkb3c+PC92YWx1ZT4KICAgICAgICAgICAgICAgIDx2YWx1ZSBuYW1lPSJWQUwiPjxzaGFkb3cgdHlwZT0iU1Bqc29uX29ialZhbHVlIj48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IlZBTFVFIj48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj5kPC9maWVsZD48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgIDwvYmxvY2s+CiAgICAgICAgICAgICAgPGJsb2NrIHR5cGU9IlNQanNvbl9hcnJTb3J0Ij4KICAgICAgICAgICAgICAgIDx2YWx1ZSBuYW1lPSJBUlIiPjxzaGFkb3cgdHlwZT0idGV4dCI+PGZpZWxkIG5hbWU9IlRFWFQiPlsxLCAyLCAzXTwvZmllbGQ+PC9zaGFkb3c+PC92YWx1ZT4KICAgICAgICAgICAgICAgIDx2YWx1ZSBuYW1lPSJBIj48c2hhZG93IHR5cGU9IlNQanNvbl9hcnJWYWx1ZUEiPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iQiI+PHNoYWRvdyB0eXBlPSJTUGpzb25fYXJyVmFsdWVCIj48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IlZBTFVFIj48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj48L2ZpZWxkPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgPC9ibG9jaz5gCiAgICAgICAgICB9LAogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiVXRpbGl0aWVzIiB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJqc29uVmFsaWQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgIHRleHQ6ICJpcyBKU09OIFtPQkpdIHZhbGlkPyIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5IjoidmFsdWUifWAsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJwYXJzZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJwYXJzZSBbT0JKXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5IjogInZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJjbG9uZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJjb3B5IFtPQkpdIHRvIG5ldyIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogYHsia2V5IjogInZhbHVlIn1gLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJjb252ZXJ0IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogIltPQkpdIHRvIFtUWVBFXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInt9IiwgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkNPTlZFUlRTIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImpzb25NYWtlIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogIltUWFRdIHNwbGl0IGJ5IFtTUExJVF0gd2l0aCBkZWxpbWl0ZXIgW0RFTElNXSB0byBKU09OIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVFhUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYToxLGI6MixjOjMiIH0sCiAgICAgICAgICAgICAgU1BMSVQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICIsIiB9LAogICAgICAgICAgICAgIERFTElNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiOiIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYXJyTWFrZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJbVFhUXSBzcGxpdCBieSBbU1BMSVRdIHRvIFtUWVBFXSIsCiAgICAgICAgICAgIG91dHB1dFNoYXBlOiAzLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBUWFQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhLGIsYyIsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgU1BMSVQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICIsIiB9LAogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiQ09OVkVSVFMyIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogIm9iaktleSIsIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwgYWxsb3dEcm9wQW55d2hlcmU6IHRydWUsCiAgICAgICAgICAgIHRleHQ6ICJrZXkiLCBjb2xvcjE6ICIjNjc3Y2Q2IgogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAib2JqVmFsdWUiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IHRydWUsIGFsbG93RHJvcEFueXdoZXJlOiB0cnVlLAogICAgICAgICAgICB0ZXh0OiAidmFsdWUiLCBjb2xvcjE6ICIjNjc3Y2Q2IgogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZmlsdGVyIiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT05ESVRJT05BTCwgYnJhbmNoQ291bnQ6IC0xLCAvLyBkZXByZWNhdGVkCiAgICAgICAgICAgIHRleHQ6ICJpbiB0aHJlYWQgW1RZUEVdIFtPQkpdIGJ5IFtJTkRdIFtWQUxdIFtJTUddIFtCT09MXSIsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVFlQRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJDVVNUX09SREVSIiB9LAogICAgICAgICAgICAgIE9CSjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGV4ZW1wdEZyb21Ob3JtYWxpemF0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgICAgSU5EOiB7fSwgVkFMOiB7fSwgQk9PTDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5CT09MRUFOIH0sCiAgICAgICAgICAgICAgSU1HOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLklNQUdFLCBkYXRhVVJJOiBhcnJvd1VSSSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJmaWx0ZXJSZXN1bHQiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLCAvLyBkZXByZWNhdGVkCiAgICAgICAgICAgIGRpc2FibGVNb25pdG9yOiB0cnVlLCBoaWRlRnJvbVBhbGV0dGU6IHRydWUsIHRleHQ6ICJ0aHJlYWQgZmlsdGVyIHJlc3VsdCIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImZpbHRlck5ldyIsIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJbVFlQRV0gW09CSl0gYnkgW0lORF0gW1ZBTF0gW0lNR10gW0JPT0xdIiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkNVU1RfT1JERVIiIH0sCiAgICAgICAgICAgICAgT0JKOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZXhlbXB0RnJvbU5vcm1hbGl6YXRpb246IHRydWUgfSwKICAgICAgICAgICAgICBJTkQ6IHt9LCBWQUw6IHt9LCBCT09MOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLkJPT0xFQU4gfSwKICAgICAgICAgICAgICBJTUc6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuSU1BR0UsIGRhdGFVUkk6IGFycm93VVJJIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImZvckVhY2giLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxPT1AsCiAgICAgICAgICAgIHRleHQ6ICJmb3IgZWFjaCBbSU5EXSBbVkFMXSBpbiBbT0JKXSIsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgSU5EOiB7fSwgVkFMOiB7fSwKICAgICAgICAgICAgICBPQko6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBleGVtcHRGcm9tTm9ybWFsaXphdGlvbjogdHJ1ZSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlhNTCwKICAgICAgICAgICAgeG1sOiBgCiAgICAgICAgICAgICAgPGJsb2NrIHR5cGU9IlNQanNvbl9maWx0ZXJOZXciPgogICAgICAgICAgICAgICAgPGZpZWxkIG5hbWU9IlRZUEUiPmZpbHRlcjwvZmllbGQ+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iT0JKIj48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj57IkpTT04iOiJvciBhcnJheSJ9PC9maWVsZD48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IklORCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqS2V5Ij48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IlZBTCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqVmFsdWUiPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgPC9ibG9jaz4KICAgICAgICAgICAgICA8c2VwIGdhcD0iMzYiPjwvc2VwPgogICAgICAgICAgICAgIDxibG9jayB0eXBlPSJTUGpzb25fZm9yRWFjaCI+CiAgICAgICAgICAgICAgICA8dmFsdWUgbmFtZT0iT0JKIj48c2hhZG93IHR5cGU9InRleHQiPjxmaWVsZCBuYW1lPSJURVhUIj57IkpTT04iOiJvciBhcnJheSJ9PC9maWVsZD48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IklORCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqS2V5Ij48L3NoYWRvdz48L3ZhbHVlPgogICAgICAgICAgICAgICAgPHZhbHVlIG5hbWU9IlZBTCI+PHNoYWRvdyB0eXBlPSJTUGpzb25fb2JqVmFsdWUiPjwvc2hhZG93PjwvdmFsdWU+CiAgICAgICAgICAgICAgPC9ibG9jaz5gCiAgICAgICAgICB9LAogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiU2FmZXR5IFNldHRpbmdzIiB9LAogICAgICAgICAgewogICAgICAgICAgICBmdW5jOiAib3B0aW1pemVXYXJuIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CVVRUT04sCiAgICAgICAgICAgIHRleHQ6ICJPcHRpbWl6YXRpb24gV2FybmluZyIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImlzU2V0dGluZ09uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAiaXMgW1RISU5HXSBlbmFibGVkPyIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIFRISU5HOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlNFVFRJTkdTIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJ0b2dnbGVTZXR0aW5nIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAic2V0IFtUSElOR10gdG8gW1RZUEVdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVEhJTkc6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiU0VUVElOR1MiIH0sCiAgICAgICAgICAgICAgVFlQRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUT0dHTEVSIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBtZW51czogewogICAgICAgICAgVE9HR0xFUjogWyJlbmFibGVkIiwgImRpc2FibGVkIl0sCiAgICAgICAgICBDVVNUX09SREVSOiBbImZpbHRlciIsICJvcmRlciJdLAogICAgICAgICAgQVJSQVlfQ0hFQ0s6IFsiZXZlcnkiLCAic29tZSJdLAogICAgICAgICAgT0JKX0VYVFJBQ1Q6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogWyJrZXlzIiwgInZhbHVlcyJdIH0sCiAgICAgICAgICBDT05WRVJUUzogeyBhY2NlcHRSZXBvcnRlcnM6IHRydWUsIGl0ZW1zOiBbInN0cmluZyIsICJhcnJheSIsICJKU09OIl0gfSwKICAgICAgICAgIENPTlZFUlRTMjogeyBhY2NlcHRSZXBvcnRlcnM6IHRydWUsIGl0ZW1zOiBbImFycmF5IiwgInRleHQiXSB9LAogICAgICAgICAgU0VUVElOR1M6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogdGhpcy5zZXR0aW5ncyB9LAogICAgICAgICAgT1JERVJJTkc6IHsKICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLAogICAgICAgICAgICBpdGVtczogWwogICAgICAgICAgICAgICJyYW5kb20iLCAicmV2ZXJzZSIsICJhc2NlbmRpbmciLCAiZGVzY2VuZGluZyIsCiAgICAgICAgICAgICAgImFzY2VuZGluZyBieSBsZW5ndGgiLCAiZGVzY2VuZGluZyBieSBsZW5ndGgiLAogICAgICAgICAgICAgICJBLXoiLCAiei1BIiwgIm1vc3QgY29tbW9uIiwgImxlYXN0IGNvbW1vbiIKICAgICAgICAgICAgXQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIH07CiAgICB9CgogICAgLy8gSGVscGVyIEZ1bmNzCiAgICB0cnlQYXJzZShvYmosIG9wdFR5cGUpIHsKICAgICAgaWYgKCF0aGlzLmFsd2F5c1RyeVBhcnNlKSByZXR1cm4gb2JqOwogICAgICBpZiAoCiAgICAgICAgKG9wdFR5cGUgPT09IDEgJiYgQXJyYXkuaXNBcnJheShvYmopKSB8fAogICAgICAgIChvcHRUeXBlID09PSAwICYmIG9iai5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCIpIHx8CiAgICAgICAgKG9wdFR5cGUgPT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb2JqID09PSAib2JqZWN0IikKICAgICAgKSByZXR1cm4gdGhpcy51c2VOZXdPYmogPyBzdHJ1Y3R1cmVkQ2xvbmUob2JqKSA6IG9iajsKICAgICAgY29uc3QgZGVmYXVsdFYgPSBvcHRUeXBlID09PSB1bmRlZmluZWQgPyBvYmogOiBvcHRUeXBlID09PSAwID8ge30gOiBbXTsKICAgICAgdHJ5IHsKICAgICAgICBpZiAodGhpcy5hbHdheXNQYXJzZSkgewogICAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShvYmopOwogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKG9wdFR5cGUgPT09IDEgJiYgQXJyYXkuaXNBcnJheShwYXJzZWQpKSB8fAogICAgICAgICAgICAob3B0VHlwZSA9PT0gMCAmJiBwYXJzZWQuY29uc3RydWN0b3I/Lm5hbWUgPT09ICJPYmplY3QiKSB8fAogICAgICAgICAgICBvcHRUeXBlID09PSB1bmRlZmluZWQKICAgICAgICAgICkgPyBwYXJzZWQgOiBkZWZhdWx0VjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlZmF1bHRWOwogICAgICB9IGNhdGNoIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFY7CiAgICAgIH0KICAgIH0KCiAgICB0b0FyckluZChudW0pIHsgcmV0dXJuIFNjcmF0Y2guQ2FzdC50b051bWJlcihudW0pIC0gMSB9CgogICAgdG9TYWZlKHZhbCkgewogICAgICBpZiAodGhpcy5hbHdheXNDYXN0KSB7CiAgICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICJvYmplY3QiKSByZXR1cm4gdmFsOwogICAgICAgIGlmIChpc05hTih2YWwpIHx8IHZhbCA9PT0gSW5maW5pdHkgfHwgdmFsID09PSAtSW5maW5pdHkpIHJldHVybiBTY3JhdGNoLkNhc3QudG9TdHJpbmcodmFsKTsKICAgICAgfQogICAgICByZXR1cm4gdmFsOwogICAgfQoKICAgIHJlcG9ydGVyWWllbGQodXRpbCwgd2FzQ29tcGlsZWQpIHsKICAgICAgY29uc3QgdGhpc0Jsb2NrID0gdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0ubXlJRCA/PyB1dGlsLnRocmVhZC5ibG9ja0NvbnRhaW5lci5nZXRCbG9jaygKICAgICAgICB3YXNDb21waWxlZCA/IHV0aWwudGhyZWFkLnBlZWtTdGFjaygpIDogdXRpbC50aHJlYWQucGVla1N0YWNrRnJhbWUoKS5vcD8uaWQKICAgICAgKTsKICAgICAgaWYgKCF0aGlzQmxvY2spIHJldHVybiB0cnVlOyAvLyBhYm9ydCEKCiAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLm15SUQgPSB0aGlzQmxvY2s7CiAgICAgIHV0aWwudGhyZWFkLnBlZWtTdGFja0ZyYW1lKCkuaXNMb29wID0gdHJ1ZTsKCiAgICAgIGNvbnN0IHB1c2hCbG9jayA9IHRoaXNCbG9jay5pbnB1dHMuQk9PTD8uYmxvY2sgfHwgdGhpc0Jsb2NrLmlucHV0cy5WQUxVRT8uYmxvY2s7CiAgICAgIGlmIChwdXNoQmxvY2spIHV0aWwudGhyZWFkLnB1c2hTdGFjayhwdXNoQmxvY2spOwogICAgICB1dGlsLnlpZWxkKCk7CiAgICB9CgogICAgZmlsdGVySGFuZGxlcihhcmdzLCB1dGlsLCBmaW5pc2hGdW5jLCB5aWVsZEZ1bmMsIG9wdEluaXRZaWVsZCkgewogICAgICBjb25zdCBoYW5kbGVDb24gPSAoaXNBcnJheSwgaXRlbSkgPT4gewogICAgICAgIGlmICghaXRlbSkgcmV0dXJuOwogICAgICAgIGNvbnN0IHRoaW5nID0gaXNBcnJheSA/IGl0ZW1bMV0gfHwgIiIgOiBpdGVtIHx8IHt9OwogICAgICAgIGlmIChhcmdzLkJPT0wpIHV0aWwuc3RhY2tGcmFtZS5uZXdPYmoudW5zaGlmdCh0aGluZyk7CiAgICAgICAgZWxzZSBpZiAoYXJncy5UWVBFID09PSAib3JkZXIiKSB1dGlsLnN0YWNrRnJhbWUubmV3T2JqLnB1c2godGhpbmcpOwogICAgICB9OwogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnN0IHBhcnNlID0gdGhpcy50cnlQYXJzZShhcmdzLk9CSik7CiAgICAgICAgY29uc3QgZW50cnkgPSBPYmplY3QuZW50cmllcyhwYXJzZSk7CiAgICAgICAgaWYgKGVudHJ5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIHBhcnNlOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5uZXdPYmogPSBbXTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9IHRydWU7CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmVudHJ5ID0gZW50cnk7CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmluZGV4ID0gZW50cnkubGVuZ3RoOwogICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLmlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHBhcnNlKTsKICAgICAgICAvLyBJbml0aWFsaXplIEpTT04gaW4gc3RhY2tmcmFtZXMKICAgICAgICBpZiAoIW9wdEluaXRZaWVsZCkgeWllbGRGdW5jKHV0aWwpOwogICAgICAgIGVsc2UgewogICAgICAgICAgY29uc3Qgc3RhdHVzID0gb3B0SW5pdFlpZWxkKHV0aWwpOwogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gdHJ1ZSkgcmV0dXJuIEFycmF5LmlzQXJyYXkocGFyc2UpID8gW10gOiB7fTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgeyBpbmRleCwgZW50cnkgfSA9IHV0aWwuc3RhY2tGcmFtZTsKICAgICAgICBpZiAoaW5kZXggPCAwKSB1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9ICJkb25lIjsKICAgICAgICBlbHNlIHsKICAgICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbiA9IGVudHJ5W2luZGV4IC0gMV07CiAgICAgICAgICBoYW5kbGVDb24odXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uaXNBcnJheSwgZW50cnlbaW5kZXhdKTsKICAgICAgICB9CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmluZGV4LS07CiAgICAgIH0KICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID09PSAiZG9uZSIpIHJldHVybiBmaW5pc2hGdW5jKHV0aWwpOwogICAgICBlbHNlIHlpZWxkRnVuYyh1dGlsKTsKICAgIH0KCiAgICAvLyBCdXR0b25zIGFuZCBTZXR0aW5ncwogICAgd2FybigpIHsKICAgICAgd2luZG93LmFsZXJ0KFsKICAgICAgICAiVGhpcyBleHRlbnNpb24gaXMgZmFzdCBiZWNhdXNlIGl0IHdvcmtzIHdpdGggcmF3IG9iamVjdHMgaW5zdGVhZCBvZiByZXBlYXRlZGx5IHBhcnNpbmcgdGhlbS4iLAogICAgICAgICJIb3dldmVyLCB0aGlzIG1heSBsZWFkIHRvIGNvbmZ1c2lvbiBvciBpbmNvcnJlY3QgYXNzdW1wdGlvbnMgdGhhdCBjZXJ0YWluIGJlaGF2aW9ycyBhcmUgYnVncy4iLAogICAgICAgICJGb3IgZXhhbXBsZSwgaXQncyBpbnRlbnRpb25hbCB0aGF0IHRleHQtYmFzZWQgY29tcG9uZW50cyBtYXkgbm90IHByb3Blcmx5IGRpc3BsYXkgd2hlbiBoYW5kbGluZyByYXcgb2JqZWN0cy4iLAogICAgICAgICJUbyByZXNvbHZlIHRoaXMsIHNpbXBseSB1c2UgdGhlICgoe30pIHRvIChzdHJpbmcgdikpIGJsb2NrIHRvIGNvbnZlcnQgdGhlIG9iamVjdCB0byBhIHN0cmluZy4iCiAgICAgIF0uam9pbigiXG5cbiIpKTsKICAgIH0KCiAgICBvcHRpbWl6ZVdhcm4oKSB7CiAgICAgIHdpbmRvdy5hbGVydCgiRGlzYWJsaW5nIHRoZXNlIFNldHRpbmdzIGNhbiBpbXByb3ZlIHBlcmZvcm1hbmNlLCBidXQgbWF5IGxlYWQgdG8gdW5leHBlY3RlZCBidWdzIG9yIGlzc3VlcyIpOwogICAgfQoKICAgIHRvZ2dsZVNldHRpbmcoYXJncykgewogICAgICBjb25zdCBvcHQgPSB0aGlzLnNldHRpbmdzLmZpbmQoaXRlbSA9PiBpdGVtLnZhbHVlID09PSBhcmdzLlRISU5HKT8udmFsdWU7CiAgICAgIGlmIChvcHQpIHRoaXNbb3B0XSA9IGFyZ3MuVFlQRSA9PT0gImVuYWJsZWQiOwogICAgfQoKICAgIGlzU2V0dGluZ09uKGFyZ3MpIHsKICAgICAgY29uc3Qgb3B0ID0gdGhpcy5zZXR0aW5ncy5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gYXJncy5USElORyk/LnZhbHVlOwogICAgICByZXR1cm4gb3B0ID8gdGhpc1tvcHRdIDogZmFsc2U7CiAgICB9CgogICAgLy8gSlNPTiBGdW5jcwogICAgb2JqVmFsaWQoYXJncykgewogICAgICBjb25zdCBvYmogPSB0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKKTsKICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJvYmplY3QiICYmIG9iai5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCI7CiAgICB9CgogICAganNvbkJ1aWxkZXIoYXJncykgeyByZXR1cm4geyBbYXJncy5LRVldIDogdGhpcy50b1NhZmUoYXJncy5WQUwpIH0gfQoKICAgIGdldEtleShhcmdzKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMudHJ5UGFyc2UoYXJncy5PQkosIDApOwogICAgICBjb25zdCBrZXkgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5LRVkpOwogICAgICBpZiAoaGFzT3duKG9iaiwga2V5KSkgcmV0dXJuIG9ialtrZXldID8/ICIiOwogICAgICByZXR1cm4gIiI7CiAgICB9CgogICAgZ2V0UGF0aChhcmdzKSB7CiAgICAgIGNvbnN0IHBhdGggPSB0aGlzLnRyeVBhcnNlKGFyZ3MuUEFUSCwgMSk7CiAgICAgIGxldCB2YWwgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKLCAwKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qga2V5ID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKHBhdGhbaV0pOwogICAgICAgIGlmIChoYXNPd24odmFsLCBrZXkpKSB2YWwgPSB2YWxba2V5XTsKICAgICAgICBlbHNlIHZhbCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhbCA9ICIiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2YWwgPz8gIiI7CiAgICB9CgogICAgc2V0S2V5KGFyZ3MpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCk7CiAgICAgIG9ialtTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5LRVkpXSA9IHRoaXMudG9TYWZlKGFyZ3MuVkFMKTsKICAgICAgcmV0dXJuIG9iajsKICAgIH0KCiAgICBzZXRQYXRoKGFyZ3MpIHsKICAgICAgY29uc3QgcGF0aCA9IHRoaXMudHJ5UGFyc2UoYXJncy5QQVRILCAxKTsKICAgICAgbGV0IG9iaiA9IHRoaXMudHJ5UGFyc2UoYXJncy5PQkosIDApOwogICAgICBwYXRoLnJlZHVjZSgoYWNjLCBwYXJ0LCBpKSA9PiB7CiAgICAgICAgaWYgKGkgPT09IHBhdGgubGVuZ3RoIC0gMSkgYWNjW3BhcnRdID0gdGhpcy50b1NhZmUoYXJncy5WQUwpOwogICAgICAgIGVsc2UgYWNjW3BhcnRdID0gYWNjW3BhcnRdIHx8IHt9OwogICAgICAgIHJldHVybiBhY2NbcGFydF07CiAgICAgIH0sIG9iaik7CiAgICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgZGVsZXRlS2V5KGFyZ3MpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCk7CiAgICAgIGRlbGV0ZSBvYmpbU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuS0VZKV07CiAgICAgIHJldHVybiBvYmo7CiAgICB9CgogICAganNvblNpemUoYXJncykgeyByZXR1cm4gT2JqZWN0LmtleXModGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCkpLmxlbmd0aCB9CgogICAga2V5SW5kZXgoYXJncykgewogICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCkpCiAgICAgICAgLmluZGV4T2YoU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuS0VZKSkgKyAxOwogICAgfQoKICAgIGdldEVudHJ5KGFyZ3MpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCk7CiAgICAgIGNvbnN0IGtleSA9IFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLktFWSk7CiAgICAgIGlmIChoYXNPd24ob2JqLCBrZXkpKSByZXR1cm4geyBba2V5XSA6IG9ialtrZXldIH0gfHwge307CiAgICAgIHJldHVybiB7fTsKICAgIH0KCiAgICBleHRyYWN0SnNvbihhcmdzKSB7CiAgICAgIHJldHVybiBPYmplY3RbYXJncy5UWVBFID09PSAia2V5cyIgPyAia2V5cyIgOiAidmFsdWVzIl0odGhpcy50cnlQYXJzZShhcmdzLk9CSiwgMCkpOwogICAgfQoKICAgIG1lcmdlSnNvbihhcmdzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgLi4udGhpcy50cnlQYXJzZShhcmdzLk9CSjEsIDApLCAuLi50aGlzLnRyeVBhcnNlKGFyZ3MuT0JKMiwgMCkKICAgICAgfQogICAgfQoKICAgIGpzb25NYXAoYXJncywgdXRpbCkgewogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyh0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKLCAwKSk7CiAgICAgICAgaWYgKGVudHJpZXMubGVuZ3RoID09PSAwKSByZXR1cm4gW107CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPSB0cnVlOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5lbnRyaWVzID0gZW50cmllczsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaW5kZXggPSBlbnRyaWVzLmxlbmd0aCAtIDE7CiAgICAgICAgaWYgKHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZCA9IHV0aWwudGhyZWFkLmlzQ29tcGlsZWQ7CiAgICAgICAgICB1dGlsLnRocmVhZC5pc0NvbXBpbGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHlpZWxkRmFpbCA9IHRoaXMucmVwb3J0ZXJZaWVsZCh1dGlsLCB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUHdhc0NvbXBpbGVkKTsgLy8gSW5pdGlhbGl6ZSBKU09OIGluIHN0YWNrZnJhbWVzCiAgICAgICAgaWYgKHlpZWxkRmFpbCA9PT0gdHJ1ZSkgcmV0dXJuIHt9OwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsgaW5kZXgsIGVudHJpZXMgfSA9IHV0aWwuc3RhY2tGcmFtZTsKICAgICAgICBpZiAoaW5kZXggPCAwKSB1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9ICJkb25lIjsKICAgICAgICBlbHNlIGlmIChlbnRyaWVzW2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25zdCBmaXhlZGluZGV4ID0gaW5kZXggLSAxIDwgMCA/IGVudHJpZXMubGVuZ3RoIC0gMSA6IGluZGV4IC0gMTsKICAgICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbiA9IGVudHJpZXNbaW5kZXhdOwogICAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmVudHJpZXNbZml4ZWRpbmRleF1bMV0gPSBhcmdzLlZBTFVFOwogICAgICAgIH0KICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaW5kZXgtLTsKICAgICAgfQogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPT09ICJkb25lIikgewogICAgICAgIHV0aWwudGhyZWFkLmlzQ29tcGlsZWQgPSB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUHdhc0NvbXBpbGVkOwoKICAgICAgICBjb25zdCBmaXhlZEVudHJpZXMgPSB1dGlsLnN0YWNrRnJhbWUuZW50cmllczsKICAgICAgICBmaXhlZEVudHJpZXMudW5zaGlmdChmaXhlZEVudHJpZXMucG9wKCkpOwogICAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoZml4ZWRFbnRyaWVzKTsKICAgICAgfSBlbHNlIHRoaXMucmVwb3J0ZXJZaWVsZCh1dGlsKTsKICAgIH0KCiAgICAvLyBBcnJheSBGdW5jcwogICAgYXJyVmFsaWQoYXJncykgeyByZXR1cm4gQXJyYXkuaXNBcnJheSh0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSKSkgfQoKICAgIGFyckJ1aWxkZXIoYXJncykgeyByZXR1cm4gW3RoaXMudG9TYWZlKGFyZ3MuVkFMKV0gfQoKICAgIGFyckFkZChhcmdzKSB7CiAgICAgIGNvbnN0IGFyciA9IHRoaXMudHJ5UGFyc2UoYXJncy5BUlIsIDEpOwogICAgICBhcnIucHVzaCh0aGlzLnRvU2FmZShhcmdzLklURU0pKTsKICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICBhcnJJbnNlcnQoYXJncykgewogICAgICBjb25zdCBhcnIgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKTsKICAgICAgY29uc3QgaW5kID0gTWF0aC5tYXgoMCwgdGhpcy50b0FyckluZChhcmdzLklORCkpOwogICAgICBpZiAoaW5kKSBhcnIuc3BsaWNlKGluZCwgMCwgdGhpcy50b1NhZmUoYXJncy5JVEVNKSk7CiAgICAgIGVsc2UgYXJyLnVuc2hpZnQodGhpcy50b1NhZmUoYXJncy5JVEVNKSk7CiAgICAgIHJldHVybiBhcnI7CiAgICB9CgogICAgYXJyUmVwbGFjZShhcmdzKSB7CiAgICAgIGNvbnN0IGFyciA9IHRoaXMudHJ5UGFyc2UoYXJncy5BUlIsIDEpOwogICAgICBjb25zdCBpbmQgPSB0aGlzLnRvQXJySW5kKGFyZ3MuSU5EKTsKICAgICAgaWYgKGFyci5sZW5ndGggPiBpbmQpIGFycltpbmRdID0gdGhpcy50b1NhZmUoYXJncy5JVEVNKTsKICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICBhcnJTd2FwKGFyZ3MpIHsKICAgICAgY29uc3QgYXJyID0gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSk7CiAgICAgIGNvbnN0IGluZDEgPSB0aGlzLnRvQXJySW5kKGFyZ3MuSU5EMSk7CiAgICAgIGNvbnN0IGluZDIgPSB0aGlzLnRvQXJySW5kKGFyZ3MuSU5EMik7CiAgICAgIGNvbnN0IG1heEluZCA9IE1hdGgubWF4KGluZDEsIGluZDIpOwogICAgICB3aGlsZSAoYXJyLmxlbmd0aCA8PSBtYXhJbmQpIGFyci5wdXNoKCIiKTsKCiAgICAgIFthcnJbaW5kMV0sIGFycltpbmQyXV0gPSBbYXJyW2luZDJdLCBhcnJbaW5kMV1dOwogICAgICByZXR1cm4gYXJyOwogICAgfQoKICAgIGFyckRlbGV0ZShhcmdzKSB7CiAgICAgIGNvbnN0IGFyciA9IHRoaXMudHJ5UGFyc2UoYXJncy5BUlIsIDEpOwogICAgICBhcnIuc3BsaWNlKHRoaXMudG9BcnJJbmQoYXJncy5JTkQpLCAxKTsKICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICBhcnJHZXQoYXJncykgewogICAgICBjb25zdCBhcnIgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKTsKICAgICAgY29uc3QgaW5kID0gdGhpcy50b0FyckluZChhcmdzLklORCk7CiAgICAgIHJldHVybiBhcnJbaW5kID4gLTEgPyBpbmQgOiBpbmQgPCAwID8gYXJyLmxlbmd0aCArIGluZCArIDEgOiAtMV0gPz8gIiI7CiAgICB9CgogICAgYXJyU2xpY2UoYXJncykgewogICAgICByZXR1cm4gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSkuc2xpY2UoCiAgICAgICAgdGhpcy50b0FyckluZChhcmdzLklORDEpLCBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5JTkQyKQogICAgICApOwogICAgfQoKICAgIGFyckxlbmd0aChhcmdzKSB7IHJldHVybiB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKS5sZW5ndGggfQoKICAgIGl0ZW1FeGlzdHMoYXJncykgeyByZXR1cm4gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSkuaW5kZXhPZih0aGlzLnRvU2FmZShhcmdzLklURU0pKSA+IC0xIH0KCiAgICBhcnJNYXRjaGVzKGFyZ3MpIHsKICAgICAgY29uc3QgYXJyID0gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSk7CiAgICAgIHJldHVybiBhcnIuZmlsdGVyKChpdGVtKSA9PiBpdGVtID09IHRoaXMudG9TYWZlKGFyZ3MuSVRFTSkpLmxlbmd0aDsKICAgIH0KCiAgICBpdGVtSW5kZXgoYXJncykgewogICAgICBjb25zdCBhcnIgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKTsKICAgICAgY29uc3QgaW5kID0gU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuSU5EKTsKICAgICAgY29uc3Qgc2FmZSA9IHRoaXMudG9TYWZlKGFyZ3MuSVRFTSkKICAgICAgaWYgKGluZCA9PT0gMCkgcmV0dXJuIGFyci5pbmRleE9mKHNhZmUpICsgMTsgLy8gU2VjcmV0IEJlaGF2aW91cgogICAgICBlbHNlIHsKICAgICAgICBsZXQgaW5kZXhlcyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoYXJyW2ldID09IHNhZmUpIGluZGV4ZXMucHVzaChpKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsID0gaW5kZXhlc1tpbmQgLSAxXSArIDE7CiAgICAgICAgcmV0dXJuIGlzTmFOKHZhbCkgPyAwIDogdmFsOwogICAgICB9CiAgICB9CgogICAgbWVyZ2VBcnJheShhcmdzKSB7CiAgICAgIHJldHVybiB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSMSwgMSkuY29uY2F0KHRoaXMudHJ5UGFyc2UoYXJncy5BUlIyLCAxKSk7CiAgICB9CgogICAgcmVwZWF0QXJyYXkoYXJncykgewogICAgICBjb25zdCB0aW1lcyA9IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLk5VTSk7CiAgICAgIHJldHVybiBBcnJheSh0aW1lcykuZmlsbCh0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKSkuZmxhdCgpOwogICAgfQoKICAgIGZpbGxBcnJheShhcmdzKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLk5VTSk7CiAgICAgIGNvbnN0IGFyciA9IHRoaXMudHJ5UGFyc2UoYXJncy5BUlIsIDEpOwogICAgICByZXR1cm4gYXJyLmNvbmNhdChBcnJheShNYXRoLm1heCgwLCBsZW5ndGggLSBhcnIubGVuZ3RoKSkuZmlsbCgiIikpOwogICAgfQoKICAgIGFyck9yZGVyKGFyZ3MpIHsKICAgICAgbGV0IGFyciA9IHRoaXMudHJ5UGFyc2UoYXJncy5BUlIsIDEpOwogICAgICBjb25zdCBzb3J0RnJlcSA9IChhcnJheSwgbW9zdENvbW0pID0+IHsKICAgICAgICBjb25zdCBmcmVxTWFwID0ge307CiAgICAgICAgYXJyYXkuZm9yRWFjaChpID0+IHsgZnJlcU1hcFtpXSA9IChmcmVxTWFwW2ldIHx8IDApICsgMSB9KTsKICAgICAgICByZXR1cm4gYXJyYXkuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgaWYgKG1vc3RDb21tKSByZXR1cm4gZnJlcU1hcFtiXSAtIGZyZXFNYXBbYV0gfHwgYXJyYXkuaW5kZXhPZihhKSAtIGFycmF5LmluZGV4T2YoYik7CiAgICAgICAgICBlbHNlIHJldHVybiBmcmVxTWFwW2FdIC0gZnJlcU1hcFtiXSB8fCBhcnJheS5pbmRleE9mKGEpIC0gYXJyYXkuaW5kZXhPZihiKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBzd2l0Y2ggKGFyZ3MuT1JERVJFUikgewogICAgICAgIGNhc2UgInJldmVyc2UiOiByZXR1cm4gYXJyLnJldmVyc2UoKTsKICAgICAgICBjYXNlICJhc2NlbmRpbmciOiByZXR1cm4gYXJyLnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKICAgICAgICBjYXNlICJkZXNjZW5kaW5nIjogcmV0dXJuIGFyci5zb3J0KChhLCBiKSA9PiBiIC0gYSk7CiAgICAgICAgY2FzZSAiZGVzY2VuZGluZyBieSBsZW5ndGgiOiByZXR1cm4gYXJyLnNvcnQoKGEsIGIpID0+IGIubGVuZ3RoIC0gYS5sZW5ndGgpOwogICAgICAgIGNhc2UgImFzY2VuZGluZyBieSBsZW5ndGgiOiByZXR1cm4gYXJyLnNvcnQoKGEsIGIpID0+IGEubGVuZ3RoIC0gYi5sZW5ndGgpOwogICAgICAgIGNhc2UgIkEteiI6IHJldHVybiBhcnIuc29ydCgoYSwgYikgPT4gYS5sb2NhbGVDb21wYXJlKGIpKTsKICAgICAgICBjYXNlICJ6LUEiOiByZXR1cm4gYXJyLnNvcnQoKGEsIGIpID0+IGIubG9jYWxlQ29tcGFyZShhKSk7CiAgICAgICAgY2FzZSAibW9zdCBjb21tb24iOiByZXR1cm4gc29ydEZyZXEoYXJyLCB0cnVlKTsKICAgICAgICBjYXNlICJsZWFzdCBjb21tb24iOiByZXR1cm4gc29ydEZyZXEoYXJyLCBmYWxzZSk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGZvciAobGV0IGkgPSBhcnIubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkgewogICAgICAgICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7CiAgICAgICAgICAgIFthcnJbaV0sIGFycltqXV0gPSBbYXJyW2pdLCBhcnJbaV1dOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycjsgLy8gcmFuZG9tCiAgICAgIH0KICAgIH0KCiAgICBhcnJDaGVjayhhcmdzLCB1dGlsKSB7CiAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29uc3QgYXJyYXkgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuQVJSLCAxKTsKICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmNoZWNrcyA9IFtdOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gdHJ1ZTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuYXJyYXkgPSBhcnJheTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaW5kZXggPSBhcnJheS5sZW5ndGggLSAxOwogICAgICAgIGlmICh1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUHdhc0NvbXBpbGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQgPSB1dGlsLnRocmVhZC5pc0NvbXBpbGVkOwogICAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBjb25zdCB5aWVsZEZhaWwgPSB0aGlzLnJlcG9ydGVyWWllbGQodXRpbCwgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZCk7IC8vIEluaXRpYWxpemUgSlNPTiBpbiBzdGFja2ZyYW1lcwogICAgICAgIGlmICh5aWVsZEZhaWwgPT09IHRydWUpIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IGluZGV4LCBhcnJheSB9ID0gdXRpbC5zdGFja0ZyYW1lOwogICAgICAgIGlmIChpbmRleCA8IDApIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gImRvbmUiOwogICAgICAgIGVsc2UgaWYgKGFycmF5W2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUGpzb24gPSBbaW5kZXggKyAxLCBhcnJheVtpbmRleF1dOwogICAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmNoZWNrcy5wdXNoKFNjcmF0Y2guQ2FzdC50b0Jvb2xlYW4oYXJncy5CT09MKSk7CiAgICAgICAgfQogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5pbmRleC0tOwogICAgICB9CiAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9PT0gImRvbmUiKSB7CiAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQ7CgogICAgICAgIGlmIChhcmdzLlRZUEUgPT09ICJldmVyeSIpIHJldHVybiB1dGlsLnN0YWNrRnJhbWUuY2hlY2tzLmluZGV4T2YoZmFsc2UpIDwgMDsKICAgICAgICBlbHNlIHJldHVybiB1dGlsLnN0YWNrRnJhbWUuY2hlY2tzLmluZGV4T2YodHJ1ZSkgPiAtMTsKICAgICAgfSBlbHNlIHRoaXMucmVwb3J0ZXJZaWVsZCh1dGlsKTsKICAgIH0KCiAgICBhcnJNYXAoYXJncywgdXRpbCkgewogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSk7CiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gdHJ1ZTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuYXJyYXkgPSBhcnJheTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaW5kZXggPSBhcnJheS5sZW5ndGggLSAxOwogICAgICAgIGlmICh1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUHdhc0NvbXBpbGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQgPSB1dGlsLnRocmVhZC5pc0NvbXBpbGVkOwogICAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBjb25zdCB5aWVsZEZhaWwgPSB0aGlzLnJlcG9ydGVyWWllbGQodXRpbCwgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZCk7IC8vIEluaXRpYWxpemUgSlNPTiBpbiBzdGFja2ZyYW1lcwogICAgICAgIGlmICh5aWVsZEZhaWwgPT09IHRydWUpIHJldHVybiBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB7IGluZGV4LCBhcnJheSB9ID0gdXRpbC5zdGFja0ZyYW1lOwogICAgICAgIGlmIChpbmRleCA8IDApIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gImRvbmUiOwogICAgICAgIGVsc2UgaWYgKGFycmF5W2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUGpzb24gPSBbaW5kZXggKyAxLCBhcnJheVtpbmRleF1dOwogICAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmFycmF5W2luZGV4XSA9IGFyZ3MuVkFMVUU7CiAgICAgICAgfQogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5pbmRleC0tOwogICAgICB9CiAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZSA9PT0gImRvbmUiKSB7CiAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQ7CgogICAgICAgIGNvbnN0IGZpeGVkQXJyYXkgPSB1dGlsLnN0YWNrRnJhbWUuYXJyYXk7CiAgICAgICAgZml4ZWRBcnJheS51bnNoaWZ0KGZpeGVkQXJyYXkucG9wKCkpOwogICAgICAgIHJldHVybiBmaXhlZEFycmF5OwogICAgICB9IGVsc2UgdGhpcy5yZXBvcnRlcllpZWxkKHV0aWwpOwogICAgfQoKICAgIGFyclNvcnQoYXJncywgdXRpbCkgewogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy50cnlQYXJzZShhcmdzLkFSUiwgMSk7CiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gdHJ1ZTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuYXJyYXkgPSBhcnJheTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuc29ydGVkVmFscyA9IHt9OwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5pID0gMDsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaiA9IDA7CiAgICAgICAgaWYgKHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZCA9IHV0aWwudGhyZWFkLmlzQ29tcGlsZWQ7CiAgICAgICAgICB1dGlsLnRocmVhZC5pc0NvbXBpbGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHlpZWxkRmFpbCA9IHRoaXMucmVwb3J0ZXJZaWVsZCh1dGlsLCB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUHdhc0NvbXBpbGVkKTsgLy8gSW5pdGlhbGl6ZSBKU09OIGluIHN0YWNrZnJhbWVzCiAgICAgICAgaWYgKHlpZWxkRmFpbCA9PT0gdHJ1ZSkgcmV0dXJuIFtdOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsgaSwgaiwgYXJyYXkgfSA9IHV0aWwuc3RhY2tGcmFtZTsKICAgICAgICBpZiAoaSA+IGFycmF5Lmxlbmd0aCAtIDEpIHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID0gImRvbmUiOwogICAgICAgIGVsc2UgewogICAgICAgICAgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1Bqc29uID0gW2FycmF5W2ldLCBhcnJheVtqXV07CiAgICAgICAgICBjb25zdCBwcm9wTmFtZSA9IGogPiBhcnJheS5sZW5ndGggLSAxID8gYDAke2FycmF5W2ldfWAgOiBpIDwgMSA/IGAke2FycmF5W2pdfSR7YXJyYXlbYXJyYXkubGVuZ3RoIC0gMV19YCA6IGAke2FycmF5W2pdfSR7YXJyYXlbaSAtIDFdfWA7CiAgICAgICAgICB1dGlsLnN0YWNrRnJhbWUuc29ydGVkVmFsc1twcm9wTmFtZV0gPSBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5WQUxVRSk7CiAgICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaisrOwogICAgICAgICAgaWYgKGogPiBhcnJheS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHV0aWwuc3RhY2tGcmFtZS5pKys7CiAgICAgICAgICAgIHV0aWwuc3RhY2tGcmFtZS5qID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlID09PSAiZG9uZSIpIHsKICAgICAgICB1dGlsLnRocmVhZC5pc0NvbXBpbGVkID0gdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZDsKCiAgICAgICAgY29uc3Qgc29ydGVkID0gdXRpbC5zdGFja0ZyYW1lLnNvcnRlZFZhbHM7CiAgICAgICAgcmV0dXJuIHV0aWwuc3RhY2tGcmFtZS5hcnJheS5zb3J0KChhLCBiKSA9PiBzb3J0ZWRbYCR7YX0ke2J9YF0pOwogICAgICB9IGVsc2UgdGhpcy5yZXBvcnRlcllpZWxkKHV0aWwpOwogICAgfQoKICAgIC8vIFV0aWwgRnVuY3MKICAgIGpzb25WYWxpZChhcmdzKSB7CiAgICAgIGNvbnN0IG9iaiA9IGFyZ3MuT0JKOwogICAgICBjb25zdCB0eXBlID0gdHlwZW9mIG9iajsKICAgICAgaWYgKHR5cGUgPT09ICJvYmplY3QiKSByZXR1cm4gdHJ1ZTsKICAgICAgaWYgKHRoaXMuYWx3YXlzUGFyc2UpIHsKICAgICAgICBpZiAodHlwZSAhPSAic3RyaW5nIikgcmV0dXJuIGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBKU09OLnBhcnNlKG9iaik7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHBhcnNlKGFyZ3MpIHsKICAgICAgY29uc3Qgb2JqID0gYXJncy5PQko7CiAgICAgIGlmICh0eXBlb2Ygb2JqID09PSAib2JqZWN0IikgcmV0dXJuIG9iajsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShvYmopOwogICAgICB9IGNhdGNoIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0KCiAgICBjbG9uZShhcmdzKSB7CiAgICAgIGNvbnN0IG9iaiA9IGFyZ3MuT0JKOwogICAgICBpZiAodHlwZW9mIG9iaiA9PT0gIm9iamVjdCIpIHJldHVybiBzdHJ1Y3R1cmVkQ2xvbmUob2JqKTsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShvYmopOwogICAgICB9IGNhdGNoIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0KCiAgICBjb252ZXJ0KGFyZ3MpIHsKICAgICAgc3dpdGNoIChhcmdzLlRZUEUpIHsKICAgICAgICBjYXNlICJhcnJheSI6IHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKLCAwKSk7CiAgICAgICAgY2FzZSAiSlNPTiI6IHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKLCAwKSk7CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudHJ5UGFyc2UoYXJncy5PQkopKTsKICAgICAgfQogICAgfQoKICAgIGpzb25NYWtlKGFyZ3MpIHsKICAgICAgY29uc3QgYXJyID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuVFhUKS5zcGxpdChhcmdzLlNQTElUKTsKICAgICAgY29uc3Qgb2JqID0ge307CiAgICAgIGFyci5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBpdGVtLnNwbGl0KGFyZ3MuREVMSU0pOwogICAgICAgIG9ialt2YWx1ZVswXV0gPSB2YWx1ZVsxXSA/PyAiIjsKICAgICAgfSk7CiAgICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgYXJyTWFrZShhcmdzKSB7CiAgICAgIGlmIChhcmdzLlRZUEUgPT09ICJhcnJheSIpIHJldHVybiBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5UWFQpLnNwbGl0KGFyZ3MuU1BMSVQpOwogICAgICBlbHNlIHJldHVybiB0aGlzLnRyeVBhcnNlKGFyZ3MuVFhULCAxKS5qb2luKGFyZ3MuU1BMSVQpOwogICAgfQoKICAgIG9iaktleShhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFyciA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbjsKICAgICAgaWYgKGFycikgewogICAgICAgIGlmICh1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5pc0FycmF5KSByZXR1cm4gU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyclswXSkgKyAxID8/ICIiOwogICAgICAgIGVsc2UgcmV0dXJuIGFyclswXSA/PyAiIjsKICAgICAgfQogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBvYmpWYWx1ZShhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFyciA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbjsKICAgICAgcmV0dXJuIGFyciA/IGFyclsxXSA/PyAiIiA6ICIiOwogICAgfQoKICAgIGFyclZhbHVlQShhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFyciA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbjsKICAgICAgcmV0dXJuIGFyciA/IGFyclswXSA/PyAiIiA6ICIiOwogICAgfQogICAgYXJyVmFsdWVCKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgYXJyID0gdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1Bqc29uOwogICAgICByZXR1cm4gYXJyID8gYXJyWzFdID8/ICIiIDogIiI7CiAgICB9CgogICAgLy8gZGVwcmVjYXRlZCBzdGFjayBmaWx0ZXIgYmxvY2sKICAgIGZpbHRlclJlc3VsdChfLCB1dGlsKSB7IHJldHVybiB1dGlsLnRocmVhZC5TUGpzb25GaWx0ZXJSZXMgPz8gIiIgfQogICAgZmlsdGVyKGFyZ3MsIHV0aWwpIHsKICAgICAgdGhpcy5maWx0ZXJIYW5kbGVyKAogICAgICAgIGFyZ3MsIHV0aWwsCiAgICAgICAgKHV0aWwpID0+IHsKICAgICAgICAgIGlmICh1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5pc0FycmF5KSB1dGlsLnRocmVhZC5TUGpzb25GaWx0ZXJSZXMgPSB1dGlsLnN0YWNrRnJhbWUubmV3T2JqOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IG5ld09iaiA9IHt9OwogICAgICAgICAgICBjb25zdCBzdG9yZWQgPSB1dGlsLnN0YWNrRnJhbWUubmV3T2JqOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0b3JlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBzdG9yZWRbaV07CiAgICAgICAgICAgICAgbmV3T2JqW2l0ZW1bMF1dID0gaXRlbVsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1dGlsLnRocmVhZC5TUGpzb25GaWx0ZXJSZXMgPSBuZXdPYmo7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAodXRpbCkgPT4gdXRpbC5zdGFydEJyYW5jaCgxLCB0cnVlKQogICAgICApOwogICAgfQoKICAgIGZpbHRlck5ldyhhcmdzLCB1dGlsKSB7CiAgICAgIHJldHVybiB0aGlzLmZpbHRlckhhbmRsZXIoCiAgICAgICAgYXJncywgdXRpbCwKICAgICAgICAodXRpbCkgPT4gewogICAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA9IHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQ7CiAgICAgICAgICBpZiAodXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uaXNBcnJheSkgcmV0dXJuIHV0aWwuc3RhY2tGcmFtZS5uZXdPYmo7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc3QgbmV3T2JqID0ge307CiAgICAgICAgICAgIGNvbnN0IHN0b3JlZCA9IHV0aWwuc3RhY2tGcmFtZS5uZXdPYmo7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RvcmVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHN0b3JlZFtpXTsKICAgICAgICAgICAgICBuZXdPYmpbaXRlbVswXV0gPSBpdGVtWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXdPYmo7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAodXRpbCkgPT4gdGhpcy5yZXBvcnRlcllpZWxkKHV0aWwpLAogICAgICAgICh1dGlsKSA9PiB7CiAgICAgICAgICBpZiAodXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uU1B3YXNDb21waWxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQd2FzQ29tcGlsZWQgPSB1dGlsLnRocmVhZC5pc0NvbXBpbGVkOwogICAgICAgICAgICB1dGlsLnRocmVhZC5pc0NvbXBpbGVkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB5aWVsZEZhaWwgPSB0aGlzLnJlcG9ydGVyWWllbGQodXRpbCwgdXRpbC5zdGFja0ZyYW1lLndhc0NvbXBpbGVkKTsKICAgICAgICAgIGlmICh5aWVsZEZhaWwgPT09IHRydWUpIHJldHVybiB0cnVlOyAvLyBpbml0aWF0ZSBhIG92ZXJyaWRlCiAgICAgICAgfQogICAgICApOwogICAgfQoKICAgIGZvckVhY2goYXJncywgdXRpbCkgewogICAgICBpZiAodXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUpIHsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuaW5kZXgrKzsKICAgICAgICBjb25zdCB7IGluZGV4LCBlbnRyeSB9ID0gdXRpbC5zdGFja0ZyYW1lOwogICAgICAgIGlmIChpbmRleCA+IGVudHJ5Lmxlbmd0aCAtIDEpIHJldHVybjsKICAgICAgICB1dGlsLnRocmVhZC5zdGFja0ZyYW1lc1swXS5TUGpzb24gPSBlbnRyeVtpbmRleF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgcGFyc2UgPSB0aGlzLnRyeVBhcnNlKGFyZ3MuT0JKKTsKICAgICAgICBjb25zdCBlbnRyeSA9IE9iamVjdC5lbnRyaWVzKHBhcnNlKTsKICAgICAgICBpZiAoZW50cnkubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmVudHJ5ID0gZW50cnk7CiAgICAgICAgdXRpbC5zdGFja0ZyYW1lLmV4ZWN1dGUgPSB0cnVlOwogICAgICAgIHV0aWwuc3RhY2tGcmFtZS5pbmRleCA9IDA7CiAgICAgICAgdXRpbC50aHJlYWQuc3RhY2tGcmFtZXNbMF0uaXNBcnJheSA9IEFycmF5LmlzQXJyYXkocGFyc2UpOwogICAgICAgIHV0aWwudGhyZWFkLnN0YWNrRnJhbWVzWzBdLlNQanNvbiA9IGVudHJ5WzBdOwogICAgICB9CiAgICAgIHV0aWwuc3RhcnRCcmFuY2goMSwgdHJ1ZSk7CiAgICB9CiAgfQoKICBleHRDbGFzcyA9IG5ldyBTUGpzb24oKTsKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIoZXh0Q2xhc3MpOwp9KShTY3JhdGNoKTsK","https://extensions.turbowarp.org/Xeltalliv/clippingblending.js","https://extensions.turbowarp.org/Lily/lmsutils.js","https://extensions.turbowarp.org/qxsck/var-and-list.js","https://extensions.turbowarp.org/Lily/MoreTimers.js","https://extensions.turbowarp.org/obviousAlexC/newgroundsIO.js","data:text/javascript;base64,Ly8gTmFtZTogU2NyaXB0IENvbnRyb2wKLy8gSUQ6IFNQc2NyaXB0cwovLyBEZXNjcmlwdGlvbjogQ29udHJvbCBTY3JpcHRzCi8vIEJ5OiBTaGFya1Bvb2wKLy8gTGljZW5zZTogTUlUCgovLyBWZXJzaW9uIFYuMi4wLjAKCihmdW5jdGlvbiAoU2NyYXRjaCkgewogICJ1c2Ugc3RyaWN0IjsKICBpZiAoIVNjcmF0Y2guZXh0ZW5zaW9ucy51bnNhbmRib3hlZCkgdGhyb3cgbmV3IEVycm9yKCJTY3JpcHQgQ29udHJvbCBtdXN0IGJlIHJ1biB1bnNhbmRib3hlZCIpOwoKICBjb25zdCBtZW51SWNvblVSSSA9CiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhNVGd1TVRVNElpQm9aV2xuYUhROUlqRXhPQzR4TlRnaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TVRndU1UVTRJREV4T0M0eE5UZ2lQanhrWldaelBqeHNhVzVsWVhKSGNtRmthV1Z1ZENCNE1UMGlNVGs0TGpJeU5TSWdlVEU5SWpFek9DNHlNalVpSUhneVBTSXlPREV1TnpjMUlpQjVNajBpTWpJeExqYzNOU0lnWjNKaFpHbGxiblJWYm1sMGN6MGlkWE5sY2xOd1lXTmxUMjVWYzJVaUlHbGtQU0poSWo0OGMzUnZjQ0J2Wm1aelpYUTlJakFpSUhOMGIzQXRZMjlzYjNJOUlpTXhNelV6TkRjaUx6NDhjM1J2Y0NCdlptWnpaWFE5SWpFaUlITjBiM0F0WTI5c2IzSTlJaU14WmpNek16UWlMejQ4TDJ4cGJtVmhja2R5WVdScFpXNTBQanhzYVc1bFlYSkhjbUZrYVdWdWRDQjRNVDBpTWpBeUxqQTVOU0lnZVRFOUlqRTBNaTR3T1RVaUlIZ3lQU0l5TnpjdU9UQTFJaUI1TWowaU1qRTNMamt3TlNJZ1ozSmhaR2xsYm5SVmJtbDBjejBpZFhObGNsTndZV05sVDI1VmMyVWlJR2xrUFNKaUlqNDhjM1J2Y0NCdlptWnpaWFE5SWpBaUlITjBiM0F0WTI5c2IzSTlJaU14WlRnek56QWlMejQ4YzNSdmNDQnZabVp6WlhROUlqRWlJSE4wYjNBdFkyOXNiM0k5SWlNellUWXdOaklpTHo0OEwyeHBibVZoY2tkeVlXUnBaVzUwUGp3dlpHVm1jejQ4WnlCemRISnZhMlV0YldsMFpYSnNhVzFwZEQwaU1UQWlQanh3WVhSb0lHUTlJazB4T1RndU1qSTFJREl5TVM0M056VmpMVEl6TGpBM01pMHlNeTR3TnpJdE1qTXVNRGN5TFRZd0xqUTNPQ0F3TFRnekxqVTFjell3TGpRM09DMHlNeTR3TnpJZ09ETXVOVFVnTUNBeU15NHdOeklnTmpBdU5EYzRJREFnT0RNdU5UVXROakF1TkRjNElESXpMakEzTWkwNE15NDFOU0F3SWlCbWFXeHNQU0oxY213b0kyRXBJaUIwY21GdWMyWnZjbTA5SW5SeVlXNXpiR0YwWlNndE1UZ3dMamt5TVNBdE1USXdMamt5TVNraUx6NDhjR0YwYUNCa1BTSk5NakF5TGpBNU5TQXlNVGN1T1RBMVl5MHlNQzQ1TXpRdE1qQXVPVE0wTFRJd0xqa3pOQzAxTkM0NE56WWdNQzAzTlM0NE1YTTFOQzQ0TnpZdE1qQXVPVE0wSURjMUxqZ3hJREFnTWpBdU9UTTBJRFUwTGpnM05pQXdJRGMxTGpneExUVTBMamczTmlBeU1DNDVNelF0TnpVdU9ERWdNQ0lnWm1sc2JEMGlkWEpzS0NOaUtTSWdkSEpoYm5ObWIzSnRQU0owY21GdWMyeGhkR1VvTFRFNE1DNDVNakVnTFRFeU1DNDVNakVwSWk4K1BIQmhkR2dnWkQwaVRURXdNaTQyTVRFZ05qY3VORGMyWXk0eU1pQXlMakUxTmkweExqQTBOaUEwTGpBMU5DMHlMamd5TnlBMExqSXpObXd0TXpRdU1Ua3lJRE11TldNdExqZzFPQzR3T0RndE1TNDJNell1TlRjNExUSXVNVFlnTVM0ek56UnNMVE11T1RRM0lEVXVPVEV6WXkwdU5USTFMamM0T0MweExqTXdNeUF4TGpJNE5TMHlMakUySURFdU16Y3pURFF3TGpZek9DQTROUzQxT0dNdExqZzFPQzR3T0RndE1TNDNNaTB1TWpReUxUSXVOREF4TFM0NU1EWnNMVFV1TURVMkxUUXVPVGt5WXkwdU5qZ3hMUzQyTnpJdE1TNDFOREl0TGprNU5TMHlMak01TkMwdU9UQTRiQzA0TGpRd09DNDROakZqTFRFdU56Z3VNVGd5TFRNdU5EQTFMVEV1TkRJdE15NDJNall0TXk0MU56VnNMVE11TWpBMkxUTXhMak15TTJNdExqSXlMVEl1TVRVMklERXVNRFEyTFRRdU1EVTBJREl1T0RJM0xUUXVNak0yYkRndU16UXpMUzQ0TlRSakxqZzFPQzB1TURnNElERXVOekl1TWpReUlESXVNemswTGprd04ydzFMakV5T0NBMUxqQTJOR011TmpneExqWTJOQ0F4TGpVME15NDVPVFFnTWk0ME1ERXVPVEEyYkRFMkxqWTROeTB4TGpjd09HTXVPRFU0TFM0d09EZ2dNUzQyTXpVdExqVTROU0F5TGpFMkxURXVNemN6YkRNdU9UazNMVFV1T1RrNFl5NDFNekl0TGpjNE9DQXhMak13T1MweExqSTROaUF5TGpFMk55MHhMak0zTkd3ek5DNHhNamd0TXk0ME9USmpNUzQzT0MwdU1UZ3lJRE11TkRBMUlERXVORElnTXk0Mk1qWWdNeTQxTnpWNlRUZ3dMakF3T0NBek9TNHpPRFJzTFRFeUxqVXlOQ0F4TGpJNE1tTXRPQzR3Tnk0NE1qWXRNVE11T1RReUlEZ3VNRE0zTFRFekxqRXhOaUF4Tmk0eE1EZHpPQzR3TXpnZ01UTXVPVFF5SURFMkxqRXdOeUF4TXk0eE1UWnNNVEl1TlRJMExURXVNamd5WXpndU1EY3RMamd5TmlBeE15NDVOREV0T0M0d016Y2dNVE11TVRFMUxURTJMakV3TjNNdE9DNHdNemN0TVRNdU9UUXhMVEUyTGpFd05pMHhNeTR4TVRadExTNHpNVGtnTVRRdU56azNZeTQxT1NBMUxqYzJOQzB6TGpZd05TQXhNQzQ1TVRVdE9TNHpOamtnTVRFdU5UQTFZVEV3TGpRNU1pQXhNQzQwT1RJZ01DQXhJREV0TWk0eE16UXRNakF1T0RjMVl6VXVOelkwTFM0MU9Ea2dNVEF1T1RFMElETXVOakEySURFeExqVXdNeUE1TGpNM0lpQm1hV3hzUFNJalptWm1JaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpTHo0OEwyYytQQzl6ZG1jKyI7CgogIGNvbnN0IHZtID0gU2NyYXRjaC52bTsKICBjb25zdCBDYXN0ID0gU2NyYXRjaC5DYXN0OwogIGNvbnN0IHJ1bnRpbWUgPSB2bS5ydW50aW1lOwogIGNvbnN0IHRyYW5zbGF0ZWQgPSB7CiAgICBzY3JpcHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzY3JpcHQtMSIpCiAgfTsKCiAgY29uc3QgY29udHJvbEtleSA9IFN5bWJvbCgiU1BzY3JpcHRzRGF0YSIpOwogIGxldCBtYXJrZWRTY3JpcHRzID0gbmV3IE1hcCgpOwoKICBjb25zdCBvZ1N0ZXBUaHJlYWRzID0gcnVudGltZS5zZXF1ZW5jZXIuc3RlcFRocmVhZHM7CiAgcnVudGltZS5zZXF1ZW5jZXIuc3RlcFRocmVhZHMgPSBmdW5jdGlvbigpIHsKICAgIG1hcmtlZFNjcmlwdHMuZm9yRWFjaCgoc2NyaXB0KSA9PiB7CiAgICAgIGNvbnN0IHRocmVhZCA9IHNjcmlwdC50aHJlYWRDdHg7CiAgICAgIGlmICh0aHJlYWRbY29udHJvbEtleV0pIHsKICAgICAgICBpZiAodGhyZWFkLnN0YXR1cyAhPT0gNSkgdGhyZWFkW2NvbnRyb2xLZXldID0gdGhyZWFkLnN0YXR1czsKICAgICAgICB0aHJlYWQuc3RhdHVzID0gNQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvZ1N0ZXBUaHJlYWRzLmNhbGwodGhpcyk7CiAgfTsKCiAgY29uc3QgZXhwUmVuZGVyZWRUYXJnZXQgPSBuZXcgdm0uZXhwb3J0cy5SZW5kZXJlZFRhcmdldCh7IGJsb2NrczogbnVsbCB9LCBydW50aW1lKTsKICBjb25zdCBCbG9ja3MgPSBleHBSZW5kZXJlZFRhcmdldC5ibG9ja3MuY29uc3RydWN0b3I7CiAgY29uc3Qgb2dHZXROZXh0ID0gQmxvY2tzLnByb3RvdHlwZS5nZXROZXh0QmxvY2s7CiAgQmxvY2tzLnByb3RvdHlwZS5nZXROZXh0QmxvY2sgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBjb25zdCB0aGlzQmxvY2sgPSBvZ0dldE5leHQuY2FsbCh0aGlzLCBuYW1lKTsKICAgIGlmICh0aGlzQmxvY2spIHJldHVybiB0aGlzQmxvY2s7CiAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiB0aGlzLnJ1bnRpbWUudGFyZ2V0cykgewogICAgICBpZiAoIXRhcmdldC5pc09yaWdpbmFsIHx8IHRhcmdldC5ibG9ja3MgPT09IHRoaXMpIGNvbnRpbnVlOwogICAgICBjb25zdCB0YXJnZXRCbG9jayA9IG9nR2V0TmV4dC5jYWxsKHRhcmdldC5ibG9ja3MsIG5hbWUpOwogICAgICBpZiAodGFyZ2V0QmxvY2spIHJldHVybiB0YXJnZXRCbG9jazsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIGNvbnN0IG9nR2V0QnJhbmNoID0gQmxvY2tzLnByb3RvdHlwZS5nZXRCcmFuY2g7CiAgQmxvY2tzLnByb3RvdHlwZS5nZXRCcmFuY2ggPSBmdW5jdGlvbihpZCwgYnJhbmNoTnVtKSB7CiAgICBjb25zdCB0aGlzQmxvY2sgPSBvZ0dldEJyYW5jaC5jYWxsKHRoaXMsIGlkLCBicmFuY2hOdW0pOwogICAgaWYgKHRoaXNCbG9jaykgcmV0dXJuIHRoaXNCbG9jazsKICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHRoaXMucnVudGltZS50YXJnZXRzKSB7CiAgICAgIGlmICghdGFyZ2V0LmlzT3JpZ2luYWwgfHwgdGFyZ2V0LmJsb2NrcyA9PT0gdGhpcykgY29udGludWU7CiAgICAgIGNvbnN0IHRhcmdldEJsb2NrID0gb2dHZXRCcmFuY2guY2FsbCh0YXJnZXQuYmxvY2tzLCBpZCwgYnJhbmNoTnVtKTsKICAgICAgaWYgKHRhcmdldEJsb2NrKSByZXR1cm4gdGFyZ2V0QmxvY2s7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgY2xhc3MgU1BzY3JpcHRzIHsKICAgIGdldEluZm8oKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6ICJTUHNjcmlwdHMiLAogICAgICAgIG5hbWU6IFNjcmF0Y2gudHJhbnNsYXRlKCJTY3JpcHQgQ29udHJvbCIpLAogICAgICAgIGNvbG9yMTogIiMzYTYwNjIiLAogICAgICAgIGNvbG9yMjogIiMxMjRkNDIiLAogICAgICAgIGNvbG9yMzogIiMxYzJlMmYiLAogICAgICAgIG1lbnVJY29uVVJJLAogICAgICAgIGJsb2NrczogWwogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiTWFya2VycyIpIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImxvZ1NjcmlwdCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImxvZyB0aGlzIHNjcmlwdCB3aXRoIGN1c3RvbSBJRCBbSURdIiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInJlbW92ZUxvZyIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoImVyYXNlIHNjcmlwdCB3aXRoIGN1c3RvbSBJRCBbSURdIiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInJlbW92ZUxvZ3MiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJyZW1vdmUgYWxsIGxvZ2dlZCBzY3JpcHRzIikKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFsbExvZ3MiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiYWxsIGxvZ2dlZCBzY3JpcHRzIikKICAgICAgICAgIH0sCiAgICAgICAgICAiLS0tIiwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiaW5kZXhMb2ciLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiaW5kZXggb2YgbG9nIGluIHNjcmlwdCB3aXRoIGN1c3RvbSBJRCBbSURdIiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJDb250cm9sIikgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZG9TY3JpcHRzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgiW1RZUEVdIHNjcmlwdCB3aXRoIElEIFtJRF0iKSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVFlQRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJDT05UUk9MIiB9LAogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInNraXBCbG9ja3MiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzdGFydCBzY3JpcHQgd2l0aCBJRCBbSURdIGF0IGJsb2NrIGluZGV4IFtOVU1dIiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5VTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNSB9LAogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInNraXBNeUJsb2NrcyIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInNraXAgbmV4dCBbTlVNXSBibG9ja3MiKSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTlVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1IH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICItLS0iLAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJkb1NjcmlwdFRhcmdldCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInN0YXJ0IHNjcmlwdCB3aXRoIElEIFtJRF0gaW4gW1RBUkdFVF0iKSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgVEFSR0VUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0sCiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IHRyYW5zbGF0ZWQuc2NyaXB0IH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZG9TY3JpcHRDbG9uZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInN0YXJ0IHNjcmlwdCB3aXRoIElEIFtJRF0gaW4gY2xvbmVzIG9mIFtUQVJHRVRdIHdpdGggW1ZBUl0gc2V0IHRvIFtWQUxdIiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9LAogICAgICAgICAgICAgIFRBUkdFVDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTMiIgfSwKICAgICAgICAgICAgICBWQVI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJteSB2YXJpYWJsZSIgfSwKICAgICAgICAgICAgICBWQUw6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICIwIiB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJPcGVyYXRpb25zIikgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAid2hpbGVTY3JpcHQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxPT1AsCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJ3aGlsZSBzY3JpcHQgd2l0aCBJRCBbSURdIGlzIHJ1bm5pbmciKSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6IHRyYW5zbGF0ZWQuc2NyaXB0IH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiaXNTY3JpcHQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgIHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzY3JpcHQgd2l0aCBJRCBbSURdIHJ1bm5pbmc/IiksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiB0cmFuc2xhdGVkLnNjcmlwdCB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImlzTWFudWFsIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgic2NyaXB0IHdpdGggSUQgW0lEXSBtYW51YWxseSBydW5uaW5nPyIpLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBJRDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogdHJhbnNsYXRlZC5zY3JpcHQgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgLyogRGVwcmVjYXRpb24gTWFya2VyICovCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogIm1hcmtTY3JpcHQiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJsb2cgdGhpcyBzY3JpcHQgYmxvY2sgd2l0aCBjdXN0b20gSUQgW0lEXSIsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyogTWFya2VyIEVuZCAqLwogICAgICAgIF0sCiAgICAgICAgbWVudXM6IHsKICAgICAgICAgIFRBUkdFVFM6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogdGhpcy5nZXRUYXJnZXRzKGZhbHNlKSB9LAogICAgICAgICAgVEFSR0VUUzI6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogdGhpcy5nZXRUYXJnZXRzKHRydWUpIH0sCiAgICAgICAgICBDT05UUk9MOiB7CiAgICAgICAgICAgIGFjY2VwdFJlcG9ydGVyczogdHJ1ZSwKICAgICAgICAgICAgaXRlbXM6IFsKICAgICAgICAgICAgICB7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJzdGFydCIpLCB2YWx1ZTogInN0YXJ0IiB9LAogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInN0b3AiKSwgdmFsdWU6ICJzdG9wIiB9LAogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInJlc3RhcnQiKSwgdmFsdWU6ICJyZXN0YXJ0IiB9LAogICAgICAgICAgICAgIHsgdGV4dDogU2NyYXRjaC50cmFuc2xhdGUoInBhdXNlIiksIHZhbHVlOiAicGF1c2UiIH0sCiAgICAgICAgICAgICAgeyB0ZXh0OiBTY3JhdGNoLnRyYW5zbGF0ZSgidW5wYXVzZSIpLCB2YWx1ZTogInVucGF1c2UiIH0KICAgICAgICAgICAgXQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgIH07CiAgICB9CgogICAgLy8gSGVscGVyIEZ1bmNzCiAgICBnZXRUYXJnZXRzKHNwcml0ZXNPbmx5KSB7CiAgICAgIGNvbnN0IHNwcml0ZU5hbWVzID0gW107CiAgICAgIGlmIChzcHJpdGVzT25seSkgc3ByaXRlTmFtZXMucHVzaCh7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJteXNlbGYiKSwgdmFsdWU6ICJfbXlzZWxmXyIgfSk7CiAgICAgIGVsc2Ugc3ByaXRlTmFtZXMucHVzaCh7IHRleHQ6IFNjcmF0Y2gudHJhbnNsYXRlKCJTdGFnZSIpLCB2YWx1ZTogIl9zdGFnZV8iIH0pOwogICAgICBjb25zdCB0YXJnZXRzID0gcnVudGltZS50YXJnZXRzOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRhcmdldHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB0YXJnZXQgPSB0YXJnZXRzW2ldOwogICAgICAgIGlmICh0YXJnZXQuaXNPcmlnaW5hbCkgc3ByaXRlTmFtZXMucHVzaCh7IHRleHQ6IHRhcmdldC5nZXROYW1lKCksIHZhbHVlOiB0YXJnZXQuZ2V0TmFtZSgpIH0pOwogICAgICB9CiAgICAgIHJldHVybiBzcHJpdGVOYW1lcy5sZW5ndGggPiAwID8gc3ByaXRlTmFtZXMgOiBbIiJdOwogICAgfQoKICAgIGdldFRhcmdldChuYW1lLCB1dGlsKSB7CiAgICAgIGlmIChuYW1lID09PSAiX215c2VsZl8iKSByZXR1cm4gdXRpbC50YXJnZXQ7CiAgICAgIGlmIChuYW1lID09PSAiX3N0YWdlXyIpIHJldHVybiBydW50aW1lLmdldFRhcmdldEZvclN0YWdlKCk7CiAgICAgIHJldHVybiBydW50aW1lLmdldFNwcml0ZVRhcmdldEJ5TmFtZShuYW1lKTsKICAgIH0KCiAgICBnZXRUaGlzQmxvY2sodXRpbCkgewogICAgICByZXR1cm4gdXRpbC50aHJlYWQuYmxvY2tDb250YWluZXIuZ2V0QmxvY2soCiAgICAgICAgdXRpbC50aHJlYWQuaXNDb21waWxlZCA/IHV0aWwudGhyZWFkLnBlZWtTdGFjaygpIDogdXRpbC50aHJlYWQucGVla1N0YWNrRnJhbWUoKS5vcC5pZAogICAgICApOwogICAgfQoKICAgIGdldEJsb2NrSW5kZXgodGhyZWFkLCBpZCkgewogICAgICBjb25zdCBjb250YWluZXIgPSB0aHJlYWQuYmxvY2tDb250YWluZXI7CiAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgIHdoaWxlIChpZCkgewogICAgICAgIGluZGV4Kys7CiAgICAgICAgaWQgPSBjb250YWluZXIuZ2V0QmxvY2soaWQpPy5wYXJlbnQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGluZGV4OwogICAgfQoKICAgIHRhcmdldEhhc0Jsb2NrKGlkLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldC5ibG9ja3MuX2Jsb2Nrc1tpZF0pIHJldHVybiB0cnVlOwogICAgICBlbHNlIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdXNoVGhyZWFkQXNUYXJnZXQoaWQsIG5ld1QsIG9sZFQpIHsKICAgICAgY29uc3QgdGhyZWFkID0gcnVudGltZS5fcHVzaFRocmVhZChpZCwgb2xkVCk7CiAgICAgIHRocmVhZC50YXJnZXQgPSBuZXdUOwogICAgICB0aHJlYWQub2dUYXJnZXQgPSBvbGRUOwogICAgICBpZiAocnVudGltZS5jb21waWxlck9wdGlvbnMuZW5hYmxlZCkgdGhyZWFkLnRyeUNvbXBpbGUoKTsKICAgICAgcmV0dXJuIHRocmVhZDsKICAgIH0KCiAgICBhZGRNaXNzaW5nRGF0YShzcmNPYmosIG5ld09iaikgewogICAgICAvLyByZS1hZGQgYW55IG1pc3NpbmcgY3VzdG9tIHRocmVhZCBkYXRhCiAgICAgIFJlZmxlY3Qub3duS2V5cyhzcmNPYmopLmZvckVhY2goa2V5ID0+IHsKICAgICAgICBpZiAoIShrZXkgaW4gbmV3T2JqKSkgbmV3T2JqW2tleV0gPSBzcmNPYmpba2V5XTsKICAgICAgfSk7CiAgICAgIFJlZmxlY3Qub3duS2V5cyhzcmNPYmouc3RhY2tGcmFtZXNbMF0pLmZvckVhY2goa2V5ID0+IHsKICAgICAgICBpZiAoIShrZXkgaW4gbmV3T2JqLnN0YWNrRnJhbWVzWzBdKSkgbmV3T2JqLnN0YWNrRnJhbWVzWzBdW2tleV0gPSBzcmNPYmouc3RhY2tGcmFtZXNbMF1ba2V5XTsKICAgICAgfSk7CiAgICB9CgogICAgLy8gQmxvY2sgRnVuY3MKICAgIGxvZ1NjcmlwdChhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IHRoaXNCbG9jayA9IHRoaXMuZ2V0VGhpc0Jsb2NrKHV0aWwpOwogICAgICBpZiAoIXRoaXNCbG9jaykgcmV0dXJuOwogICAgICAKICAgICAgY29uc3QgdGhyZWFkID0gdXRpbC50aHJlYWQ7CiAgICAgIG1hcmtlZFNjcmlwdHMuc2V0KENhc3QudG9TdHJpbmcoYXJncy5JRCksIHsKICAgICAgICB0aHJlYWRDdHg6IHRocmVhZCwgdGFyZ2V0OiB0aHJlYWQub2dUYXJnZXQgPz8gdGhyZWFkLnRhcmdldCwKICAgICAgICBsb2dJbmRleDogdGhpcy5nZXRCbG9ja0luZGV4KHRocmVhZCwgdGhpc0Jsb2NrLmlkKQogICAgICB9KTsKICAgIH0KCiAgICByZW1vdmVMb2coYXJncykgewogICAgICBtYXJrZWRTY3JpcHRzLmRlbGV0ZShDYXN0LnRvU3RyaW5nKGFyZ3MuSUQpKTsKICAgIH0KCiAgICByZW1vdmVMb2dzKCkgewogICAgICBtYXJrZWRTY3JpcHRzID0gbmV3IE1hcCgpOwogICAgfQoKICAgIGFsbExvZ3MoKSB7CiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShtYXJrZWRTY3JpcHRzLmtleXMoKS50b0FycmF5KCkpOwogICAgfQoKICAgIGluZGV4TG9nKGFyZ3MpIHsKICAgICAgY29uc3Qgc2NyaXB0ID0gbWFya2VkU2NyaXB0cy5nZXQoQ2FzdC50b1N0cmluZyhhcmdzLklEKSk7CiAgICAgIHJldHVybiBzY3JpcHQgPyBzY3JpcHQubG9nSW5kZXggOiAwOwogICAgfQoKICAgIGRvU2NyaXB0cyhhcmdzKSB7CiAgICAgIGNvbnN0IHNjcmlwdCA9IG1hcmtlZFNjcmlwdHMuZ2V0KENhc3QudG9TdHJpbmcoYXJncy5JRCkpOwogICAgICBpZiAoIXNjcmlwdCkgcmV0dXJuOwoKICAgICAgY29uc3QgY3R4ID0gc2NyaXB0LnRocmVhZEN0eDsKICAgICAgc3dpdGNoIChhcmdzLlRZUEUpIHsKICAgICAgICBjYXNlICJzdGFydCI6CiAgICAgICAgICBpZiAodGhpcy50YXJnZXRIYXNCbG9jayhjdHgudG9wQmxvY2ssIHNjcmlwdC50YXJnZXQpKSBydW50aW1lLl9wdXNoVGhyZWFkKGN0eC50b3BCbG9jaywgc2NyaXB0LnRhcmdldCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyZXN0YXJ0IjoKICAgICAgICAgIGlmICh0aGlzLnRhcmdldEhhc0Jsb2NrKGN0eC50b3BCbG9jaywgc2NyaXB0LnRhcmdldCkpIHJ1bnRpbWUuX3Jlc3RhcnRUaHJlYWQoY3R4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInN0b3AiOgogICAgICAgICAgcnVudGltZS5fc3RvcFRocmVhZChjdHgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicGF1c2UiOgogICAgICAgICAgaWYgKHRoaXMuaXNTY3JpcHQoYXJncykgJiYgY3R4W2NvbnRyb2xLZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY3R4W2NvbnRyb2xLZXldID0gY3R4LnN0YXR1czsKICAgICAgICAgICAgY3R4LnN0YXR1cyA9IDU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ1bnBhdXNlIjoKICAgICAgICAgIGlmICh0aGlzLmlzU2NyaXB0KGFyZ3MpICYmIGN0eFtjb250cm9sS2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGN0eC5zdGF0dXMgPSBjdHhbY29udHJvbEtleV07CiAgICAgICAgICAgIGN0eFtjb250cm9sS2V5XSA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6IHJldHVybjsKICAgICAgfQogICAgfQoKICAgIHNraXBCbG9ja3MoYXJncykgewogICAgICBjb25zdCBzY3JpcHQgPSBtYXJrZWRTY3JpcHRzLmdldChDYXN0LnRvU3RyaW5nKGFyZ3MuSUQpKTsKICAgICAgaWYgKCFzY3JpcHQpIHJldHVybjsKCiAgICAgIGNvbnN0IGN0eCA9IHNjcmlwdC50aHJlYWRDdHg7CiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGN0eC5ibG9ja0NvbnRhaW5lcjsKICAgICAgY29uc3QgaW5kZXggPSBDYXN0LnRvTnVtYmVyKGFyZ3MuTlVNKTsKCiAgICAgIGxldCBjdXJJRCA9IGNvbnRhaW5lci5nZXRCbG9jayhjdHgudG9wQmxvY2spPy5pZDsKICAgICAgaWYgKCFjdXJJRCkgcmV0dXJuOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGluZGV4OyBpKyspIHsKICAgICAgICBjdXJJRCA9IGNvbnRhaW5lci5nZXROZXh0QmxvY2soY3VySUQpOwogICAgICAgIGlmICghY3VySUQpIHJldHVybjsKICAgICAgfQogICAgICBydW50aW1lLl9wdXNoVGhyZWFkKGN1cklELCBzY3JpcHQudGFyZ2V0KTsKICAgIH0KCiAgICBza2lwTXlCbG9ja3MoYXJncywgdXRpbCkgewogICAgICBjb25zdCB0aGlzQmxvY2sgPSB0aGlzLmdldFRoaXNCbG9jayh1dGlsKTsKICAgICAgaWYgKCF0aGlzQmxvY2spIHJldHVybjsKCiAgICAgIGNvbnN0IHRocmVhZCA9IHV0aWwudGhyZWFkOwogICAgICBjb25zdCBjb250YWluZXIgPSB0aHJlYWQuYmxvY2tDb250YWluZXI7CiAgICAgIGNvbnN0IGluZGV4ID0gQ2FzdC50b051bWJlcihhcmdzLk5VTSkgKyAxOwoKICAgICAgbGV0IGN1cklEID0gdGhpc0Jsb2NrOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4OyBpKyspIHsKICAgICAgICBjdXJJRCA9IGNvbnRhaW5lci5nZXROZXh0QmxvY2soY3VySUQpOwogICAgICAgIGlmICghY3VySUQpIGJyZWFrOwogICAgICB9CgogICAgICBpZiAodGhyZWFkLmlzQ29tcGlsZWQpIHRoaXMuYWRkTWlzc2luZ0RhdGEodGhyZWFkLCBydW50aW1lLl9wdXNoVGhyZWFkKGN1cklELCB0aHJlYWQudGFyZ2V0KSk7CiAgICAgIGVsc2UgdGhyZWFkLnJldXNlU3RhY2tGb3JOZXh0QmxvY2soY3VySUQpOwogICAgfQoKICAgIGRvU2NyaXB0VGFyZ2V0KGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3Qgc2NyaXB0ID0gbWFya2VkU2NyaXB0cy5nZXQoQ2FzdC50b1N0cmluZyhhcmdzLklEKSk7CiAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KGFyZ3MuVEFSR0VULCB1dGlsKTsKICAgICAgaWYgKCF0YXJnZXQgfHwgIXNjcmlwdCkgcmV0dXJuOwoKICAgICAgY29uc3QgY3R4ID0gc2NyaXB0LnRocmVhZEN0eDsKICAgICAgdGhpcy5wdXNoVGhyZWFkQXNUYXJnZXQoY3R4LnRvcEJsb2NrLCB0YXJnZXQsIHNjcmlwdC50YXJnZXQpOwogICAgfQoKICAgIGRvU2NyaXB0Q2xvbmUoYXJncywgdXRpbCkgewogICAgICBjb25zdCBzY3JpcHQgPSBtYXJrZWRTY3JpcHRzLmdldChDYXN0LnRvU3RyaW5nKGFyZ3MuSUQpKTsKICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoYXJncy5UQVJHRVQsIHV0aWwpOwogICAgICBpZiAoIXRhcmdldCB8fCAhc2NyaXB0KSByZXR1cm47CgogICAgICBjb25zdCB2YXJOYW1lID0gQ2FzdC50b1N0cmluZyhhcmdzLlZBUik7CiAgICAgIGNvbnN0IGN0eCA9IHNjcmlwdC50aHJlYWRDdHg7CiAgICAgIGNvbnN0IGNsb25lcyA9IHRhcmdldC5zcHJpdGUuY2xvbmVzOwogICAgICBpZiAoIXZhck5hbWUpIHsKICAgICAgICBmb3IgKGNvbnN0IGNsb25lIG9mIGNsb25lcykgewogICAgICAgICAgaWYgKCFjbG9uZS5pc09yaWdpbmFsKSB0aGlzLnB1c2hUaHJlYWRBc1RhcmdldChjdHgudG9wQmxvY2ssIGNsb25lLCBzY3JpcHQudGFyZ2V0KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBjbG9uZSBvZiBjbG9uZXMpIHsKICAgICAgICAgIGNvbnN0IHZhcmlhYmxlID0gY2xvbmUubG9va3VwVmFyaWFibGVCeU5hbWVBbmRUeXBlKHZhck5hbWUsICIiLCB0cnVlKTsKICAgICAgICAgIGlmICh2YXJpYWJsZSAmJiBDYXN0LnRvU3RyaW5nKHZhcmlhYmxlLnZhbHVlKSA9PT0gQ2FzdC50b1N0cmluZyhhcmdzLlZBTCkpIHsKICAgICAgICAgICAgdGhpcy5wdXNoVGhyZWFkQXNUYXJnZXQoY3R4LnRvcEJsb2NrLCBjbG9uZSwgc2NyaXB0LnRhcmdldCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgd2hpbGVTY3JpcHQoYXJncywgdXRpbCkgewogICAgICBpZiAodGhpcy5pc1NjcmlwdChhcmdzKSkgdXRpbC5zdGFydEJyYW5jaCgxLCB0cnVlKTsKICAgIH0KCiAgICBpc1NjcmlwdChhcmdzKSB7CiAgICAgIGNvbnN0IHNjcmlwdCA9IG1hcmtlZFNjcmlwdHMuZ2V0KENhc3QudG9TdHJpbmcoYXJncy5JRCkpOwogICAgICByZXR1cm4gc2NyaXB0ID8gc2NyaXB0LnRocmVhZEN0eC5zdGF0dXMgIT09IDQgOiBmYWxzZTsKICAgIH0KCiAgICBpc01hbnVhbChhcmdzKSB7CiAgICAgIGNvbnN0IHNjcmlwdCA9IG1hcmtlZFNjcmlwdHMuZ2V0KENhc3QudG9TdHJpbmcoYXJncy5JRCkpOwogICAgICBpZiAoIXNjcmlwdCkgcmV0dXJuIGZhbHNlOwoKICAgICAgY29uc3QgdGhyZWFkID0gc2NyaXB0LnRocmVhZEN0eDsKICAgICAgcmV0dXJuIHRocmVhZC5zdGFja0NsaWNrICYmIHRocmVhZC5zdGF0dXMgIT09IDQ7CiAgICB9CgogICAgLyogRGVwcmVjYXRpb24gTWFya2VyICovCiAgICBtYXJrU2NyaXB0KGFyZ3MsIHV0aWwpIHsKICAgICAgdGhpcy5sb2dTY3JpcHQoYXJncywgdXRpbCk7CiAgICB9CiAgICAvKiBNYXJrZXIgRW5kICovCiAgfQoKICBmdW5jdGlvbiBhZGQyQm9keSgpIHsKICAgIHZhciBncmFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBncmFkLmlubmVySFRNTCA9IGAKICAgICAgPHN2Zz48ZGVmcz4KICAgICAgICA8bGluZWFyR3JhZGllbnQgeDE9IjIwMCIgeTE9IjAiIHgyPSIyNDAiIHkyPSIxMDAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBpZD0iU1BzY3JpcHRzLUdSQUQxIj4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiMxZTgzNzAiLz48c3RvcCBvZmZzZXQ9IjAuNSIgc3RvcC1jb2xvcj0iIzNhNjA2MiIvPjwvbGluZWFyR3JhZGllbnQ+CiAgICAgIDwvZGVmcz48L3N2Zz5gOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoZ3JhZCk7CiAgfQogIGlmIChTY3JhdGNoLmd1aSkgU2NyYXRjaC5ndWkuZ2V0QmxvY2tseSgpLnRoZW4oKFNCKSA9PiB7CiAgICBhZGQyQm9keSgpOwogICAgaWYgKCFTQj8uU1BncmFkaWVudHM/LnBhdGNoZWQpIHsKICAgICAgLy8gR3JhZGllbnQgUGF0Y2ggYnkgMHpuencgJiBTaGFya1Bvb2wKICAgICAgU0IuU1BncmFkaWVudHMgPSB7IGdyYWRpZW50VXJsczoge30sIHBhdGNoZWQ6IGZhbHNlIH07CiAgICAgIGNvbnN0IEJTUCA9IFNCLkJsb2NrU3ZnLnByb3RvdHlwZSwgQlNQUiA9IEJTUC5yZW5kZXI7CiAgICAgIEJTUC5yZW5kZXIgPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgICAgY29uc3QgYmxvY2tUaGVtZSA9IFJlZHV4U3RvcmUuZ2V0U3RhdGUoKS5zY3JhdGNoR3VpPy50aGVtZT8udGhlbWU/LmJsb2NrczsKICAgICAgICBjb25zdCByZXMgPSBCU1BSLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgIGxldCBjYXRlZ29yeTsKICAgICAgICBpZiAodGhpcz8uc3ZnUGF0aF8gJiYgdGhpcz8uY2F0ZWdvcnlfICYmIChjYXRlZ29yeSA9IHRoaXMudHlwZS5zbGljZSgwLCB0aGlzLnR5cGUuaW5kZXhPZigiXyIpKSkgJiYgU0IuU1BncmFkaWVudHMuZ3JhZGllbnRVcmxzW2NhdGVnb3J5XSkgewogICAgICAgICAgY29uc3QgdXJscyA9IFNCLlNQZ3JhZGllbnRzLmdyYWRpZW50VXJsc1tjYXRlZ29yeV07CiAgICAgICAgICBpZiAodXJscykgewogICAgICAgICAgICB0aGlzLnN2Z1BhdGhfLnNldEF0dHJpYnV0ZSgiZmlsbCIsIHVybHNbMF0pOwogICAgICAgICAgICBpZiAoYmxvY2tUaGVtZSA9PT0gImRhcmsiKSB7CiAgICAgICAgICAgICAgdGhpcy5zdmdQYXRoXy5zZXRBdHRyaWJ1dGUoImZpbGwtb3BhY2l0eSIsICIuNSIpOwogICAgICAgICAgICAgIHRoaXMuc3ZnUGF0aF8uc2V0QXR0cmlidXRlKCJzdHJva2UiLCAiIzMxZDZiNyIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgU0IuU1BncmFkaWVudHMucGF0Y2hlZCA9IHRydWU7CiAgICB9CiAgICBTY3JhdGNoQmxvY2tzLlNQZ3JhZGllbnRzLmdyYWRpZW50VXJsc1siU1BzY3JpcHRzIl0gPSBbInVybCgjU1BzY3JpcHRzLUdSQUQxKSJdOwogIH0pOwoKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IFNQc2NyaXB0cygpKTsKfSkoU2NyYXRjaCk7Cg==","data:text/javascript;base64,Ly8gTmFtZTogU3BlZWNoIEJ1YmJsZXMNCi8vIElEOiBzcGVlY2hTUA0KLy8gRGVzY3JpcHRpb246IEN1c3RvbWl6YWJsZSBTcGVlY2ggQnViYmxlcw0KLy8gQnk6IFNoYXJrUG9vbA0KDQovLyBWZXJzaW9uIFYuMS4zLjAxDQoNCihmdW5jdGlvbiAoU2NyYXRjaCkgew0KICAidXNlIHN0cmljdCI7DQogIGlmICghU2NyYXRjaC5leHRlbnNpb25zLnVuc2FuZGJveGVkKSB0aHJvdyBuZXcgRXJyb3IoIlNwZWVjaCBCdWJibGVzIG11c3QgcnVuIHVuc2FuZGJveGVkIik7DQoNCiAgY29uc3QgbWVudUljb25VUkkgPQ0KImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMk55NHdOVGdpSUdobGFXZG9kRDBpTmpjdU1EVTRJaUIyYVdWM1FtOTRQU0l3SURBZ05qY3VNRFU0SURZM0xqQTFPQ0krUEhCaGRHZ2daRDBpVFRFdU56VWdNek11TlROak1DMHhOeTQxTlRFZ01UUXVNakk1TFRNeExqYzRJRE14TGpjNExUTXhMamM0Y3pNeExqYzRJREUwTGpJeU9TQXpNUzQzT0NBek1TNDNPQzB4TkM0eU1qa2dNekV1TnpndE16RXVOemdnTXpFdU56aFRNUzQzTlNBMU1TNHdPREVnTVM0M05TQXpNeTQxTTNvaUlHWnBiR3c5SWlNNU5tWWlJSE4wY205clpUMGlJemMzTkdSallpSWdjM1J5YjJ0bExYZHBaSFJvUFNJekxqVWlMejQ4Y0dGMGFDQmtQU0pOT1M0eE5URWdNemt1TVRVMll5MHlMak0zTFRndU5UVTNJREV1T0RZM0xURXlMalUzTXlBMUxqVTROeTB4TXk0MU1qSWdOQzQxTWpndE1TNHhOVFlnTVRRdU5EZzBMVE11T1RjMUlESXlMakkyTnkwMUxqWTRNeUF6TGpndExqZ3pOQ0F4TUM0d01ETXVOakkySURFeExqazFPQ0E1TGpBME5TQXhMamcxSURjdU9UWTNMVE11TmpRNElERXhMamswTFRZdU5EZzJJREV5TGpZMk5Hd3RNVEV1T0RBeklETXVNREV5WXkweExqSTVOaTR6TXpFdE15NHhPQ0E0TGpBNU55MDVMakUxTXlBNUxqUXdOQzAwTGpJek5pNDVNamN1TmprMExUY3VNalExTFM0NU9URXROaTQ0TVRVdE5DNDVPVGdnTVM0eU56WXRPUzQzTXkweUxqRTBPUzB4TVM0ek56a3RPQzR4TURVaUlHWnBiR3c5SWlObVptWWlMejQ4Y0dGMGFDQmtQU0pOTkRrdU1qWTNJRFEwTGpFeU9HRXlMalExSURJdU5EVWdNQ0F3SURBZ01pNDBOVE1nTUd3eExqY3lOaTB1T1RrMVl5NDRNVGN0TGpRM0lERXVOek11TkRReklERXVNallnTVM0eU5td3RMams1TlNBeExqY3lOMkV5TGpRMklESXVORFlnTUNBd0lEQWdNQ0F5TGpRMU1td3VPVGswSURFdU56STJZeTQwTnk0NE1UY3RMalEwTXlBeExqY3pMVEV1TWpZZ01TNHlObXd0TVM0M01qWXRMams1TldFeUxqUTJJREl1TkRZZ01DQXdJREF0TWk0ME5URWdNR3d0TVM0M01qZ3VPVGswWXkwdU9ERTJMalEzTFRFdU56STRMUzQwTkRJdE1TNHlOVGt0TVM0eU5UbHNMams1TlMweExqY3lObUV5TGpRMklESXVORFlnTUNBd0lEQWdNQzB5TGpRMU1td3RMams1TmkweExqY3lOMk10TGpRM0xTNDRNVGN1TkRRekxURXVOek1nTVM0eU5pMHhMakkyZWswek5DNHhNeklnTVRBdU56a3hZVEl1TnpVZ01pNDNOU0F3SURBZ01DQXVOVGN6SURJdU5qZzRiREV1TkRreklERXVOalpqTGpjd05pNDNPRFV0TGpBNE1TQXhMams1T0MweExqQTROU0F4TGpZM05Hd3RNaTR4TWpVdExqWTRObUV5TGpjMUlESXVOelVnTUNBd0lEQXRNaTQyT0RjdU5UY3liQzB4TGpZMklERXVORGswWXkwdU56ZzFMamN3TlMweExqazVPQzB1TURneUxURXVOamMxTFRFdU1EZzNiQzQyT0RjdE1pNHhNalJoTWk0M05TQXlMamMxSURBZ01DQXdMUzQxTnpNdE1pNDJPRFpzTFRFdU5Ea3lMVEV1TmpaakxTNDNNRGN0TGpjNE5TNHdPQzB4TGprNU9DQXhMakE0TlMweExqWTNOR3d5TGpFeU5DNDJPRFpoTWk0M05TQXlMamMxSURBZ01DQXdJREl1TmpnM0xTNDFOelJzTVM0Mk5pMHhMalE1TTJNdU56ZzFMUzQzTURVZ01TNDVPVGd1TURneElERXVOamMwSURFdU1EZzJlazAxTlM0MU9UZ2dNak11T0RaakxqTXhOUzQxT1RFdU9USXlMamszSURFdU5Ua3lMams1TW13eExqVXlNeTR3TlRKakxqY3lMakF5Tmk0NU5EUXVPVGczTGpNd09TQXhMak15TjJ3dE1TNHpORFF1TnpKakxTNDFPVEV1TXpFMUxTNDVOeTQ1TWpJdExqazVNaUF4TGpVNU1Xd3RMakExTXlBeExqVXlNMk10TGpBeU5TNDNNaTB1T1RnM0xqazBOQzB4TGpNeU55NHpNRGxzTFM0M01Ua3RNUzR6TkRSaE1TNDRPQ0F4TGpnNElEQWdNQ0F3TFRFdU5Ua3hMUzQ1T1RGc0xURXVOVEkwTFM0d05UUmpMUzQzTWkwdU1ESTBMUzQ1TkRNdExqazROaTB1TXpBNExURXVNekkyYkRFdU16UTBMUzQzTVRsakxqVTVMUzR6TVRVdU9UWTRMUzQ1TWpJdU9Ua3hMVEV1TlRreWJDNHdOVEl0TVM0MU1qUmpMakF5TmkwdU56SXVPVGczTFM0NU5ETWdNUzR6TWpndExqTXdPSG9pSUdacGJHdzlJaU5tWm1ZaUlHWnBiR3d0Y25Wc1pUMGlaWFpsYm05a1pDSXZQand2YzNablBnPT0iOw0KICBjb25zdCBibG9ja0ljb25VUkkgPQ0KImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMk1TNHlPRGdpSUdobGFXZG9kRDBpTmpFdU1qZzRJaUIyYVdWM1FtOTRQU0l3SURBZ05qRXVNamc0SURZeExqSTRPQ0krUEhCaGRHZ2daRDBpVFRBZ05qRXVNamc0VmpCb05qRXVNamc0ZGpZeExqSTRPSG9pSUdacGJHdzlJbTV2Ym1VaUx6NDhjR0YwYUNCa1BTSk5OaTR5TmpVZ016WXVNamRqTFRJdU16Y3RPQzQxTlRjZ01TNDROamN0TVRJdU5UY3pJRFV1TlRnM0xURXpMalV5TWlBMExqVXlPQzB4TGpFMU5pQXhOQzQwT0RRdE15NDVOelVnTWpJdU1qWTNMVFV1TmpneklETXVPQzB1T0RNMElERXdMakF3TXk0Mk1qWWdNVEV1T1RVNElEa3VNRFExSURFdU9EVWdOeTQ1TmpjdE15NDJORGdnTVRFdU9UUXROaTQwT0RZZ01USXVOalkwYkMweE1TNDRNRE1nTXk0d01USmpMVEV1TWprMkxqTXpNUzB6TGpFNElEZ3VNRGszTFRrdU1UVXpJRGt1TkRBMExUUXVNak0yTGpreU55NDJPVFF0Tnk0eU5EVXRMams1TVMwMkxqZ3hOUzAwTGprNU9DQXhMakkzTmkwNUxqY3pMVEl1TVRRNUxURXhMak0zT1MwNExqRXdOU0lnWm1sc2JEMGlJMlptWmlJdlBqeHdZWFJvSUdROUlrMDBOaTR6T0RFZ05ERXVNalF5WVRJdU5EVWdNaTQwTlNBd0lEQWdNQ0F5TGpRMU15QXdiREV1TnpJMkxTNDVPVFZqTGpneE55MHVORGNnTVM0M015NDBORE1nTVM0eU5pQXhMakkyYkMwdU9UazFJREV1TnpJM1lUSXVORFlnTWk0ME5pQXdJREFnTUNBd0lESXVORFV5YkM0NU9UUWdNUzQzTWpaakxqUTNMamd4TnkwdU5EUXpJREV1TnpNdE1TNHlOaUF4TGpJMmJDMHhMamN5TmkwdU9UazFZVEl1TkRZZ01pNDBOaUF3SURBZ01DMHlMalExTVNBd2JDMHhMamN5T0M0NU9UUmpMUzQ0TVRZdU5EY3RNUzQzTWpndExqUTBNaTB4TGpJMU9TMHhMakkxT1d3dU9UazFMVEV1TnpJMllUSXVORFlnTWk0ME5pQXdJREFnTUNBd0xUSXVORFV5YkMwdU9UazJMVEV1TnpJM1l5MHVORGN0TGpneE55NDBORE10TVM0M015QXhMakkyTFRFdU1qWjZUVE14TGpJME5pQTNMamt3TldFeUxqYzFJREl1TnpVZ01DQXdJREFnTGpVM015QXlMalk0T0d3eExqUTVNeUF4TGpZMll5NDNNRFl1TnpnMUxTNHdPREVnTVM0NU9UZ3RNUzR3T0RVZ01TNDJOelJzTFRJdU1USTFMUzQyT0RaaE1pNDNOU0F5TGpjMUlEQWdNQ0F3TFRJdU5qZzNMalUzTW13dE1TNDJOaUF4TGpRNU5HTXRMamM0TlM0M01EVXRNUzQ1T1RndExqQTRNaTB4TGpZM05TMHhMakE0TjJ3dU5qZzNMVEl1TVRJMFlUSXVOelVnTWk0M05TQXdJREFnTUMwdU5UY3pMVEl1TmpnMmJDMHhMalE1TWkweExqWTJZeTB1TnpBM0xTNDNPRFV1TURndE1TNDVPVGdnTVM0d09EVXRNUzQyTnpSc01pNHhNalF1TmpnMllUSXVOelVnTWk0M05TQXdJREFnTUNBeUxqWTROeTB1TlRjMGJERXVOall0TVM0ME9UTmpMamM0TlMwdU56QTFJREV1T1RrNExqQTRNU0F4TGpZM05DQXhMakE0Tm5wdE1qRXVORFkySURFekxqQTJPV011TXpFMUxqVTVNUzQ1TWpJdU9UY2dNUzQxT1RJdU9Ua3liREV1TlRJekxqQTFNbU11TnpJdU1ESTJMamswTkM0NU9EY3VNekE1SURFdU16STNiQzB4TGpNME5DNDNNbU10TGpVNU1TNHpNVFV0TGprM0xqa3lNaTB1T1RreUlERXVOVGt4YkMwdU1EVXpJREV1TlRJell5MHVNREkxTGpjeUxTNDVPRGN1T1RRMExURXVNekkzTGpNd09Xd3RMamN4T1MweExqTTBOR0V4TGpnNElERXVPRGdnTUNBd0lEQXRNUzQxT1RFdExqazVNV3d0TVM0MU1qUXRMakExTkdNdExqY3lMUzR3TWpRdExqazBNeTB1T1RnMkxTNHpNRGd0TVM0ek1qWnNNUzR6TkRRdExqY3hPV011TlRrdExqTXhOUzQ1TmpndExqa3lNaTQ1T1RFdE1TNDFPVEpzTGpBMU1pMHhMalV5TkdNdU1ESTJMUzQzTWk0NU9EY3RMamswTXlBeExqTXlPQzB1TXpBNGVpSWdabWxzYkQwaUkyWm1aaUlnWm1sc2JDMXlkV3hsUFNKbGRtVnViMlJrSWk4K1BDOXpkbWMrIjsNCg0KICBjb25zdCB2bSA9IFNjcmF0Y2gudm07DQogIGNvbnN0IHJ1bnRpbWUgPSB2bS5ydW50aW1lOw0KICBjb25zdCByZW5kZXIgPSB2bS5yZW5kZXJlcjsNCg0KICBjb25zdCBmb250TWVudSA9IFsNCiAgICAiU2NyYXRjaCIsICJTYW5zIFNlcmlmIiwgIlNlcmlmIiwNCiAgICAiSGFuZHdyaXRpbmciLCAiTWFya2VyIiwgIkN1cmx5IiwgIlBpeGVsIg0KICBdOw0KDQogIGxldCBhbGxCdWJibGVzID0ge307DQoNCiAgY29uc3QgeG1sRXNjYXBlID0gZnVuY3Rpb24gKHVuc2FmZSkgew0KICAgIHVuc2FmZSA9IFN0cmluZyh1bnNhZmUpOw0KICAgIHJldHVybiB1bnNhZmUucmVwbGFjZSgvWzw+JiciXS9nLCBjID0+IHsNCiAgICAgIHN3aXRjaCAoYykgew0KICAgICAgICBjYXNlICI8IjogcmV0dXJuICImbHQ7IjsNCiAgICAgICAgY2FzZSAiPiI6IHJldHVybiAiJmd0OyI7DQogICAgICAgIGNhc2UgIiYiOiByZXR1cm4gIiZhbXA7IjsNCiAgICAgICAgY2FzZSAiJyI6IHJldHVybiAiJmFwb3M7IjsNCiAgICAgICAgY2FzZSAiXCIiOiByZXR1cm4gIiZxdW90OyI7DQogICAgICB9DQogICAgfSk7DQogIH07DQoNCiAgY2xhc3Mgc3BlZWNoU1Agew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgcnVudGltZS5vbigiUFJPSkVDVF9TVEFSVCIsICgpID0+IHsgdGhpcy5zaHV0VXAoeyBTUFJJVEU6ICJfYWxsXyIgfSkgfSk7DQogICAgICBydW50aW1lLm9uKCJQUk9KRUNUX1NUT1BfQUxMIiwgKCkgPT4geyB0aGlzLnNodXRVcCh7IFNQUklURTogIl9hbGxfIiB9KSB9KTsNCiAgICAgIHJ1bnRpbWUub24oIkFGVEVSX0VYRUNVVEUiLCAoKSA9PiB7DQogICAgICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoYWxsQnViYmxlcyk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgY29uc3Qgb2JqID0gdmFsdWVzW2ldOw0KICAgICAgICAgIGxldCB0YXJnZXQgPSBydW50aW1lLmdldFRhcmdldEJ5SWQob2JqLmlkKTsNCiAgICAgICAgICBpZiAoIXRhcmdldCkgdGFyZ2V0ID0gcnVudGltZS5nZXRTcHJpdGVUYXJnZXRCeU5hbWUob2JqLmlkKTsNCiAgICAgICAgICBpZiAoIXRhcmdldCkgY29udGludWU7DQogICAgICAgICAgbGV0IGVsZW1lbnQgPSBvYmouZWxlbWVudDsNCiAgICAgICAgICBpZiAoIWVsZW1lbnQpIGNvbnRpbnVlOw0KICAgICAgICAgIGNvbnN0IGNvbXB1dGVkID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCk7DQogICAgICAgICAgY29uc3QgeCA9IG9iai5vZmZzZXRbMF0gLSAocGFyc2VGbG9hdChjb21wdXRlZC53aWR0aCkgLyAyKTsNCiAgICAgICAgICBjb25zdCB5ID0gb2JqLm9mZnNldFsxXSArIChwYXJzZUZsb2F0KGNvbXB1dGVkLmhlaWdodCkgLyAyKTsNCiAgICAgICAgICBsZXQgY3VyVHJhbnNmb3JtID0gZWxlbWVudC5wYXJlbnROb2RlLnN0eWxlLnRyYW5zZm9ybSB8fCAiIjsNCiAgICAgICAgICBjdXJUcmFuc2Zvcm0gPSBjdXJUcmFuc2Zvcm0ucmVwbGFjZSgvdHJhbnNsYXRlXChbXildKlwpL2csICIiKTsNCiAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuc3R5bGUudHJhbnNmb3JtID0gYCR7Y3VyVHJhbnNmb3JtfSB0cmFuc2xhdGUoJHt0YXJnZXQueCArIHh9cHgsICR7KHRhcmdldC55ICsgeSkgKiAtMX1weClgOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQogICAgZ2V0SW5mbygpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIGlkOiAic3BlZWNoU1AiLA0KICAgICAgICBuYW1lOiAiU3BlZWNoIEJ1YmJsZXMiLA0KICAgICAgICBjb2xvcjE6ICIjOTk2NmZmIiwNCiAgICAgICAgY29sb3IyOiAiIzc3NGRjYiIsDQogICAgICAgIG1lbnVJY29uVVJJLA0KICAgICAgICBibG9ja0ljb25VUkksDQogICAgICAgIGJsb2NrczogWw0KICAgICAgICAgIHsgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5MQUJFTCwgdGV4dDogIlNwZWVjaCIgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzYXlUaGlzIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJzYXkgW1NQRUVDSF0gaG9va2VkIHRvIFtTUFJJVEVdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBTUEVFQ0g6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJoZWxsbyEiIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTIiB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzaHV0VXAiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInRlbGwgW1NQUklURV0gdG8gc2h1dCB1cCIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgU1BSSVRFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImlzWWFwcGluZyIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sDQogICAgICAgICAgICB0ZXh0OiAiaXMgW1NQUklURV0geWFwcGluZz8iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTMiIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiQnViYmxlIFRleHQiIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnViYmxlRm9udCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAic2V0IGJ1YmJsZSBmb250IG9mIFtTUFJJVEVdIHRvIFtGT05UXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgRk9OVDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJGT05UUyIgfSwNCiAgICAgICAgICAgICAgU1BSSVRFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImJ1YmJsZUZvbnRTaXplIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJzZXQgYnViYmxlIGZvbnQgc2l6ZSBvZiBbU1BSSVRFXSB0byBbTlVNXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTlVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxNSB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUyIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnViYmxlQm9sZCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAic2V0IGJ1YmJsZSBib2xkbmVzcyBvZiBbU1BSSVRFXSB0byBbTlVNXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTlVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgbWVudTogIlRISUNLIiB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUyIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnViYmxlQWxpZ24iLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInNldCBidWJibGUgdGV4dCBhbGlnbm1lbnQgb2YgW1NQUklURV0gdG8gW1RZUEVdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkFMSUdOTUVOVFMiIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTIiB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJidWJibGVXaWR0aCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAic2V0IGJ1YmJsZSB3aWR0aCBvZiBbU1BSSVRFXSB0byBbV0lEVEhdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBXSURUSDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMzAwIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTIiB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6ICJCdWJibGUgRm9ybWF0dGluZyIgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJidWJibGVQYWRzIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJzZXQgYnViYmxlIFtUWVBFXSBvZiBbU1BSSVRFXSB0byBbTlVNXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTlVNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxNSB9LA0KICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkZPQ1VTIiB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUyIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnViYmxlQ29sb3IiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInNldCBidWJibGUgW1RZUEVdIGNvbG9yIG9mIFtTUFJJVEVdIHRvIFtDT0xPUl0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIENPTE9SOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLkNPTE9SIH0sDQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiQ09MT1IiIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTIiB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJidWJibGVJbWciLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInNldCBidWJibGUgaW1hZ2Ugb2YgW1NQUklURV0gdG8gW1VSTF0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFVSTDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImh0dHBzOi8vZXh0ZW5zaW9ucy50dXJib3dhcnAub3JnL2RhbmdvLnBuZyIgfSwNCiAgICAgICAgICAgICAgU1BSSVRFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgICItLS0iLA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImFycm93UG9zIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJzZXQgYXJyb3cgcG9zaXRpb24gb2YgW1NQUklURV0gdG8geCBbeF0geSBbeV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIHg6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDAgfSwNCiAgICAgICAgICAgICAgeTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMCB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUyIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnViYmxlT2Zmc2V0IiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJzZXQgYnViYmxlIG9mZnNldCBvZiBbU1BSSVRFXSB0byB4IFt4XSB5IFt5XSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgeDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMTAgfSwNCiAgICAgICAgICAgICAgeTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMTAgfSwNCiAgICAgICAgICAgICAgU1BSSVRFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImdldE9mZnNldCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLA0KICAgICAgICAgICAgdGV4dDogImJ1YmJsZSBvZmZzZXQgW1BPU10gb2YgW1NQUklURV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFBPUzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJQT1MiIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTMiIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiQnViYmxlIFN0eWxpbmciIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAic2V0U3RyZXRjaCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAic3RyZXRjaCBbVFlQRV0gb2YgW1NQUklURV0gdG8geCBbeF0geSBbeV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiRUxFTUVOVCIgfSwNCiAgICAgICAgICAgICAgeDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMjAwIH0sDQogICAgICAgICAgICAgIHk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDEwMCB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUzIiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInNldEdsb3ciLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInNldCBnbG93IG9mIFtTUFJJVEVdIHRvIHggW3hdIHkgW3ldIHogW3pdIGNvbG9yIFtDT0xPUl0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIHg6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDAgfSwNCiAgICAgICAgICAgICAgeTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMCB9LA0KICAgICAgICAgICAgICB6OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiA1IH0sDQogICAgICAgICAgICAgIENPTE9SOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLkNPTE9SIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTIiB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICAiLS0tIiwNCiAgICAgICAgICB7DQogICAgICAgICAgICBvcGNvZGU6ICJzZXRFZmZlY3QiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInNldCBbVFlQRV0gW0VGRkVDVF0gb2YgW1NQUklURV0gdG8gW05VTV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiRUxFTUVOVCIgfSwNCiAgICAgICAgICAgICAgRUZGRUNUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkVGRkVDVFMiIH0sDQogICAgICAgICAgICAgIE5VTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNSB9LA0KICAgICAgICAgICAgICBTUFJJVEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiVEFSR0VUUzIiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImdldEVmZmVjdCIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLA0KICAgICAgICAgICAgdGV4dDogImdldCBbRUZGRUNUXSBvZiBbVFlQRV0gaW4gW1NQUklURV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiRUxFTUVOVCIgfSwNCiAgICAgICAgICAgICAgRUZGRUNUOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkVGRkVDVFNBTEwiIH0sDQogICAgICAgICAgICAgIFNQUklURTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJUQVJHRVRTMiIgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAicmVzZXRFZmZlY3QiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogInJlc2V0IGFsbCBidWJibGUgc3R5bGluZyBvZiBbU1BSSVRFXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgU1BSSVRFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIlRBUkdFVFMiIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIF0sDQogICAgICAgIG1lbnVzOiB7DQogICAgICAgICAgVEFSR0VUUzogeyBhY2NlcHRSZXBvcnRlcnM6IHRydWUsIGl0ZW1zOiB0aGlzLmdldFRhcmdldHModHJ1ZSkgfSwNCiAgICAgICAgICBUQVJHRVRTMjogeyBhY2NlcHRSZXBvcnRlcnM6IHRydWUsIGl0ZW1zOiB0aGlzLmdldFRhcmdldHMoZmFsc2UpIH0sDQogICAgICAgICAgRk9OVFM6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogImFsbEZvbnRzIiB9LA0KICAgICAgICAgIEVGRkVDVFM6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogdGhpcy5nZXRFZmZlY3RzKGZhbHNlKSB9LA0KICAgICAgICAgIEVGRkVDVFNBTEw6IHsgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLCBpdGVtczogdGhpcy5nZXRFZmZlY3RzKHRydWUpIH0sDQogICAgICAgICAgUE9TOiBbIngiLCAieSJdLA0KICAgICAgICAgIEFMSUdOTUVOVFM6IFsibGVmdCIsICJyaWdodCIsICJjZW50ZXIiXSwNCiAgICAgICAgICBDT0xPUjogWyJiYWNrZ3JvdW5kIiwgImFycm93IiwgInRleHQiXSwNCiAgICAgICAgICBFTEVNRU5UOiBbImJ1YmJsZSIsICJhcnJvdyJdLA0KICAgICAgICAgIEZPQ1VTOiBbInBhZGRpbmciLCAiYm9yZGVyIHJhZGl1cyJdLA0KICAgICAgICAgIFRISUNLOiBbDQogICAgICAgICAgICB7IHRleHQ6ICJ0aGljayIsIHZhbHVlOiAiOTAwIiB9LA0KICAgICAgICAgICAgeyB0ZXh0OiAibWVkaXVtIiwgdmFsdWU6ICI2MDAiIH0sDQogICAgICAgICAgICB7IHRleHQ6ICJub25lIiwgdmFsdWU6ICIxIiB9LA0KICAgICAgICAgIF0NCiAgICAgICAgfSwNCiAgICAgIH07DQogICAgfQ0KDQogICAgYWxsRm9udHMoKSB7DQogICAgICBjb25zdCBjdXN0b21Gb250cyA9IHJ1bnRpbWUuZm9udE1hbmFnZXIgPyBydW50aW1lLmZvbnRNYW5hZ2VyLmdldEZvbnRzKCkubWFwKChpKSA9PiAoeyB0ZXh0OiBpLm5hbWUsIHZhbHVlOiBpLmZhbWlseSB9KSkgOiBbXTsNCiAgICAgIHJldHVybiBbLi4uZm9udE1lbnUsIC4uLmN1c3RvbUZvbnRzXTsNCiAgICB9DQoNCiAgICBnZXRUYXJnZXRzKG9wdEFsbCkgew0KICAgICAgY29uc3Qgc3ByaXRlTmFtZXMgPSBbeyB0ZXh0OiAibXlzZWxmIiwgdmFsdWU6ICJfbXlzZWxmXyIgfV07DQogICAgICBpZiAob3B0QWxsKSBzcHJpdGVOYW1lcy5wdXNoKHsgdGV4dDogImFsbCBzcHJpdGVzIiwgdmFsdWU6ICJfYWxsXyIgfSk7DQogICAgICBjb25zdCB0YXJnZXRzID0gcnVudGltZS50YXJnZXRzOw0KICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IHRhcmdldCA9IHRhcmdldHNbaV07DQogICAgICAgIGlmICh0YXJnZXQuaXNPcmlnaW5hbCkgc3ByaXRlTmFtZXMucHVzaCh7IHRleHQ6IHRhcmdldC5nZXROYW1lKCksIHZhbHVlOiB0YXJnZXQuZ2V0TmFtZSgpIH0pOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNwcml0ZU5hbWVzLmxlbmd0aCA+IDAgPyBzcHJpdGVOYW1lcyA6IFsiIl07DQogICAgfQ0KDQogICAgZ2V0RWZmZWN0cyhlbmFibGUpIHsNCiAgICAgIHJldHVybiBbDQogICAgICAgICJibHVyIiwgInNhdHVyYXRpb24iLCAiY29udHJhc3QiLA0KICAgICAgICAiYnJpZ2h0bmVzcyIsICJodWUiLCAib3BhY2l0eSIsDQogICAgICAgICJzZXBpYSIsICJpbnZlcnQiLCAiZGlyZWN0aW9uIiwNCiAgICAgICAgLi4uKGVuYWJsZSA/IFsic2NhbGUgeCIsICJzY2FsZSB5Il0gOiBbXSksDQogICAgICAgICJza2V3IHgiLCAic2tldyB5Ig0KICAgICAgXTsNCiAgICB9DQoNCiAgICBzcGVlY2godHh0LCBpZCkgew0KICAgICAgY29uc3QgZW5jb2RlZElkID0gdGhpcy5tYWtlRW5jb2RlZElEKGlkKTsNCiAgICAgIGlmICghZW5jb2RlZElkKSByZXR1cm47DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGRpdltpZD0iU1BfU3BlZWNoLUV4dC0ke2VuY29kZWRJZH0iXSBkaXZbaWQ9InRleHQtSUQiXWApOw0KICAgICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID4gMCkgZWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4geyBlbGVtZW50LmlubmVySFRNTCA9IHhtbEVzY2FwZSh0eHQpLnJlcGxhY2UoL1xuL2csICI8YnI+IikgfSk7DQogICAgICAgIGVsc2UgdGhpcy5zYXlTcGVlY2godHh0LCBlbmNvZGVkSWQsIGlkKTsNCiAgICAgIH0gY2F0Y2ggeyByZXR1cm4gfQ0KICAgIH0NCg0KICAgIHNheVNwZWVjaCh0eHQsIGVuY29kZWRJZCwgaWQpIHsNCiAgICAgIGlmICghYWxsQnViYmxlc1tlbmNvZGVkSWRdKSB0aGlzLmFkZERlZmF1bHQoaWQpOw0KICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICBjb25zdCB0eHRQYXJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgIGNvbnN0IHN0eWxlcyA9IGFsbEJ1YmJsZXNbZW5jb2RlZElkXS5zdHlsZXM7DQogICAgICBPYmplY3QuYXNzaWduKHR4dFBhcmVudC5zdHlsZSwgc3R5bGVzKTsNCg0KICAgICAgY29uc3QgdGV4dEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICB0ZXh0RWwuaWQgPSAidGV4dC1JRCI7DQogICAgICB0ZXh0RWwuaW5uZXJIVE1MID0geG1sRXNjYXBlKHR4dCkucmVwbGFjZSgvXG4vZywgIjxicj4iKTsNCiAgICAgIHR4dFBhcmVudC5hcHBlbmRDaGlsZCh0ZXh0RWwpOw0KDQogICAgICBjb25zdCBhcnJvd0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgIGFycm93RWxlbWVudC5pZCA9ICJhcnJvdy1JRCI7DQogICAgICBjb25zdCBhcnJvd1N0eWxlcyA9IGFsbEJ1YmJsZXNbZW5jb2RlZElkXS5hcnJvd1N0eWxlczsNCiAgICAgIE9iamVjdC5hc3NpZ24oYXJyb3dFbGVtZW50LnN0eWxlLCBhcnJvd1N0eWxlcyk7DQoNCiAgICAgIHR4dFBhcmVudC5hcHBlbmRDaGlsZChhcnJvd0VsZW1lbnQpOw0KICAgICAgdHh0UGFyZW50LmlkID0gYFNQX1NwZWVjaC1FeHQtJHtlbmNvZGVkSWR9YDsNCiAgICAgIHR4dFBhcmVudC5jbGFzc0xpc3QuYWRkKGVuY29kZWRJZCk7DQogICAgICBkaXYuYXBwZW5kQ2hpbGQodHh0UGFyZW50KTsNCiAgICAgIHJlbmRlci5hZGRPdmVybGF5KGRpdiwgInNjYWxlLWNlbnRlcmVkIik7DQogICAgICBhbGxCdWJibGVzW2VuY29kZWRJZF0uZWxlbWVudCA9IHR4dFBhcmVudDsNCiAgICB9DQoNCiAgICBhZGREZWZhdWx0KGlkKSB7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGFsbEJ1YmJsZXNbZW5jb2RlZElkXSA9IHsNCiAgICAgICAgaWQsIG9mZnNldDogWzc1LCAwXSwNCiAgICAgICAgc3R5bGVzOiB7DQogICAgICAgICAgd2lkdGg6ICIxNTBweCIsDQogICAgICAgICAgYmFja2dyb3VuZDogIiMwMGJmYjYiLA0KICAgICAgICAgIGJhY2tncm91bmRTaXplOiAiY292ZXIiLA0KICAgICAgICAgIHBhZGRpbmc6ICIxMHB4IiwNCiAgICAgICAgICBib3JkZXJSYWRpdXM6ICIxMnB4IiwNCiAgICAgICAgICB0ZXh0QWxpZ246ICJjZW50ZXIiLA0KICAgICAgICAgIGZvbnRXZWlnaHQ6ICI5MDAiLA0KICAgICAgICAgIGZvbnRTaXplOiAiMTVweCIsDQogICAgICAgICAgY29sb3I6ICIjZmZmIiwNCiAgICAgICAgICBmb250RmFtaWx5OiAiYXJpYWwiLA0KICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLA0KICAgICAgICAgIHBvaW50ZXJFdmVudHM6ICJub25lIiwNCiAgICAgICAgICBib3hTaGFkb3c6ICIwcHggMHB4IDBweCAjMDAwMDAwMDAiLA0KICAgICAgICAgIHRyYW5zZm9ybTogInNjYWxlKDEsMSkgc2tld1goMGRlZykgc2tld1koMGRlZykgcm90YXRlKDBkZWcpIiwNCiAgICAgICAgICBmaWx0ZXI6ICJibHVyKDBweCkgYnJpZ2h0bmVzcygxKSBjb250cmFzdCgxKSBodWUtcm90YXRlKDBkZWcpIGludmVydCgwKSBvcGFjaXR5KDEpIHNhdHVyYXRlKDEpIHNlcGlhKDApIg0KICAgICAgICB9LA0KICAgICAgICBhcnJvd1N0eWxlczogew0KICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLA0KICAgICAgICAgIHdpZHRoOiAiMHB4IiwNCiAgICAgICAgICBoZWlnaHQ6ICIwcHgiLA0KICAgICAgICAgIGJvcmRlckxlZnQ6ICIxMHB4IHNvbGlkICMwMGJmYjYiLA0KICAgICAgICAgIGJvcmRlclJpZ2h0OiAiMTBweCBzb2xpZCB0cmFuc3BhcmVudCIsDQogICAgICAgICAgYm9yZGVyVG9wOiAiMTBweCBzb2xpZCAjMDBiZmI2IiwNCiAgICAgICAgICBib3JkZXJCb3R0b206ICIxMHB4IHNvbGlkIHRyYW5zcGFyZW50IiwNCiAgICAgICAgICBsZWZ0OiAiLTEwcHgiLA0KICAgICAgICAgIHRvcDogIi0xMHB4IiwNCiAgICAgICAgICB0cmFuc2Zvcm06ICJzY2FsZSgxLDEpIHNrZXdYKDBkZWcpIHNrZXdZKDBkZWcpIHJvdGF0ZSgwZGVnKSIsDQogICAgICAgICAgZmlsdGVyOiAiYmx1cigwcHgpIGJyaWdodG5lc3MoMSkgY29udHJhc3QoMSkgaHVlLXJvdGF0ZSgwZGVnKSBpbnZlcnQoMCkgb3BhY2l0eSgxKSBzYXR1cmF0ZSgxKSBzZXBpYSgwKSINCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICB9DQoNCiAgICBzZXRCdWJibGVBdHQodHlwZSwgdmFsdWUsIGlkLCBmb2N1cykgew0KICAgICAgY29uc3QgYXBwbHlVcGRhdGUgPSAoa2V5KSA9PiB7DQogICAgICAgIGNvbnN0IGVuY29kZWRJZCA9IHRoaXMubWFrZUVuY29kZWRJRChpZCk7DQogICAgICAgIGlmICghZW5jb2RlZElkKSByZXR1cm47DQogICAgICAgIGlmICghYWxsQnViYmxlc1tlbmNvZGVkSWRdKSB0aGlzLmFkZERlZmF1bHQoaWQpOw0KICAgICAgICBhbGxCdWJibGVzW2VuY29kZWRJZF1bZm9jdXNdW3R5cGVdID0gdmFsdWU7DQogICAgICAgIHRoaXMudXBkYXRlRWxlbWVudChlbmNvZGVkSWQsIGFsbEJ1YmJsZXNbZW5jb2RlZElkXSk7DQogICAgICB9Ow0KICAgICAgaWYgKGlkICE9PSAiX2FsbF8iKSBhcHBseVVwZGF0ZShpZCk7DQogICAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbGlzdCA9IHRoaXMuZ2V0VGFyZ2V0cyhmYWxzZSk7DQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgYXBwbHlVcGRhdGUobGlzdFtpXS52YWx1ZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgdXBkYXRlRWxlbWVudChpZCwgb2JqKSB7DQogICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2lkPSJTUF9TcGVlY2gtRXh0LSR7aWR9Il1gKTsNCiAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuOw0KICAgICAgT2JqZWN0LmFzc2lnbihlbGVtZW50LnN0eWxlLCBvYmouc3R5bGVzKTsNCiAgICAgIGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gb2JqLnN0eWxlcy50cmFuc2Zvcm07DQogICAgICBlbGVtZW50LnN0eWxlLmZpbHRlciA9IG9iai5zdHlsZXMuZmlsdGVyOw0KICAgICAgY29uc3QgYXJyb3dFbGVtZW50ID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKGBkaXZbaWQ9ImFycm93LUlEIl1gKTsNCiAgICAgIE9iamVjdC5hc3NpZ24oYXJyb3dFbGVtZW50LnN0eWxlLCBvYmouYXJyb3dTdHlsZXMpOw0KICAgICAgYXJyb3dFbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9IG9iai5hcnJvd1N0eWxlcy50cmFuc2Zvcm07DQogICAgICBhcnJvd0VsZW1lbnQuc3R5bGUuZmlsdGVyID0gb2JqLmFycm93U3R5bGVzLmZpbHRlcjsNCiAgICB9DQoNCiAgICBnZXRUYXJnZXRJZCh0eHQsIHV0aWwsIGFsbG93QWxsKSB7DQogICAgICBpZiAodHh0ID09PSAiX2FsbF8iICYmIGFsbG93QWxsKSByZXR1cm4gIl9hbGxfIjsNCiAgICAgIGVsc2UgaWYgKHR4dCA9PT0gIl9teXNlbGZfIikgcmV0dXJuIHV0aWwudGFyZ2V0LmlkOw0KICAgICAgZWxzZSB7DQogICAgICAgIGNvbnN0IGlkVGFyZyA9IHJ1bnRpbWUuZ2V0VGFyZ2V0QnlJZCh0eHQpOw0KICAgICAgICBpZiAoaWRUYXJnICE9PSB1bmRlZmluZWQpIHJldHVybiBpZFRhcmcuaWQ7DQogICAgICAgIHJldHVybiBydW50aW1lLmdldFNwcml0ZVRhcmdldEJ5TmFtZSh0eHQpPy5pZCB8fCB1bmRlZmluZWQ7DQogICAgICB9DQogICAgfQ0KDQogICAgbWFrZUVuY29kZWRJRChpZCkgew0KICAgICAgaWYgKGlkID09PSB1bmRlZmluZWQpIHJldHVybiB1bmRlZmluZWQ7DQogICAgICB0cnkgew0KICAgICAgICByZXR1cm4gYnRvYShpZCkucmVwbGFjZUFsbCgiPSIsICJfIikucmVwbGFjZUFsbCgiLyIsICItIik7DQogICAgICB9IGNhdGNoIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvL1NwZWVjaA0KICAgIHNheVRoaXMoYXJncywgdXRpbCkgew0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKTsNCiAgICAgIGlmIChpZCAhPT0gIl9hbGxfIikgdGhpcy5zcGVlY2goYXJncy5TUEVFQ0gsIGlkKTsNCiAgICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBsaXN0ID0gdGhpcy5nZXRUYXJnZXRzKGZhbHNlKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB0aGlzLnNwZWVjaChhcmdzLlNQRUVDSCwgbGlzdFtpXS52YWx1ZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgc2h1dFVwKGFyZ3MsIHV0aWwpIHsNCiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSk7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGNvbnN0IHNodXRUYXJnZXQgPSAoa2V5KSA9PiB7DQogICAgICAgIGNvbnN0IHJlbW92YWJsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBkaXZbaWQ9IlNQX1NwZWVjaC1FeHQtJHtrZXl9Il1gKTsNCiAgICAgICAgcmVtb3ZhYmxlcy5mb3JFYWNoKChlbGVtZW50KSA9PiByZW5kZXIucmVtb3ZlT3ZlcmxheShlbGVtZW50LnBhcmVudE5vZGUpKTsNCiAgICAgIH07DQogICAgICBpZiAoaWQgPT09ICJfYWxsXyIpIE9iamVjdC5rZXlzKGFsbEJ1YmJsZXMpLmZvckVhY2goc2h1dFRhcmdldCk7DQogICAgICBlbHNlIHNodXRUYXJnZXQoZW5jb2RlZElkKTsNCiAgICB9DQoNCiAgICBpc1lhcHBpbmcoYXJncywgdXRpbCkgew0KICAgICAgbGV0IGlkID0gdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgZmFsc2UpOw0KICAgICAgaWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFpZCkgcmV0dXJuIGZhbHNlOw0KICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltpZD0iU1BfU3BlZWNoLUV4dC0ke2lkfSJdYCkgIT09IG51bGw7DQogICAgfQ0KDQogICAgLy9Qb3NpdGlvbnMNCiAgICBidWJibGVPZmZzZXQoYXJncywgdXRpbCkgew0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKTsNCiAgICAgIGNvbnN0IGVuY29kZWRJZCA9IHRoaXMubWFrZUVuY29kZWRJRChpZCk7DQogICAgICBpZiAoIWVuY29kZWRJZCkgcmV0dXJuOw0KICAgICAgaWYgKCFhbGxCdWJibGVzW2VuY29kZWRJZF0pIHRoaXMuYWRkRGVmYXVsdChpZCk7DQogICAgICBjb25zdCBzZXRPZmYgPSAoa2V5KSA9PiB7DQogICAgICAgIGFsbEJ1YmJsZXNba2V5XS5vZmZzZXQgPSBbU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueCksIFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnkpXTsNCiAgICAgIH07DQogICAgICBpZiAoaWQgPT09ICJfYWxsXyIpIE9iamVjdC5rZXlzKGFsbEJ1YmJsZXMpLmZvckVhY2goc2V0T2ZmKTsNCiAgICAgIGVsc2Ugc2V0T2ZmKGVuY29kZWRJZCk7DQogICAgfQ0KDQogICAgZ2V0T2Zmc2V0KGFyZ3MsIHV0aWwpIHsNCiAgICAgIGxldCBpZCA9IHRoaXMuZ2V0VGFyZ2V0SWQoYXJncy5TUFJJVEUsIHV0aWwsIGZhbHNlKTsNCiAgICAgIGlkID0gdGhpcy5tYWtlRW5jb2RlZElEKGlkKTsNCiAgICAgIGlmICghaWQpIHJldHVybiAwOw0KICAgICAgcmV0dXJuIGFsbEJ1YmJsZXNbaWRdPy5vZmZzZXRbYXJncy5QT1MgPT09ICJ4IiA/IDAgOiAxXSB8fCAwOw0KICAgIH0NCg0KICAgIC8vQ3VzdG9taXphdGlvbg0KICAgIGJ1YmJsZVdpZHRoKGFyZ3MsIHV0aWwpIHsNCiAgICAgIHRoaXMuc2V0QnViYmxlQXR0KA0KICAgICAgICAid2lkdGgiLCBgJHtNYXRoLmFicyhTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5XSURUSCkpfXB4YCwNCiAgICAgICAgdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSksICJzdHlsZXMiDQogICAgICApOw0KICAgIH0NCg0KICAgIGJ1YmJsZVBhZHMoYXJncywgdXRpbCkgew0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgIGFyZ3MuVFlQRSA9PT0gInBhZGRpbmciID8gInBhZGRpbmciIDogImJvcmRlclJhZGl1cyIsIA0KICAgICAgICBgJHtTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5OVU0pfXB4YCwgdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSksDQogICAgICAgICJzdHlsZXMiDQogICAgICApOw0KICAgIH0NCg0KICAgIGJ1YmJsZUZvbnQoYXJncywgdXRpbCkgew0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgICJmb250RmFtaWx5IiwgYXJncy5GT05ULCB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKSwgInN0eWxlcyINCiAgICAgICk7DQogICAgfQ0KDQogICAgYnViYmxlRm9udFNpemUoYXJncywgdXRpbCkgew0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgICJmb250U2l6ZSIsIGAke01hdGguYWJzKFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLk5VTSkpfXB4YCwNCiAgICAgICAgdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSksICJzdHlsZXMiDQogICAgICApOw0KICAgIH0NCg0KICAgIGJ1YmJsZUJvbGQoYXJncywgdXRpbCkgew0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgICJmb250V2VpZ2h0IiwgYXJncy5OVU0sIHRoaXMuZ2V0VGFyZ2V0SWQoYXJncy5TUFJJVEUsIHV0aWwsIHRydWUpLCAic3R5bGVzIg0KICAgICAgKTsNCiAgICB9DQoNCiAgICBidWJibGVBbGlnbihhcmdzLCB1dGlsKSB7DQogICAgICB0aGlzLnNldEJ1YmJsZUF0dCgNCiAgICAgICAgInRleHRBbGlnbiIsIGFyZ3MuVFlQRSwgdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSksICJzdHlsZXMiDQogICAgICApOw0KICAgIH0NCg0KICAgIGJ1YmJsZUNvbG9yKGFyZ3MsIHV0aWwpIHsNCiAgICAgIGlmIChhcmdzLlRZUEUgPT09ICJhcnJvdyIpIHsNCiAgICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgICAgImJvcmRlckxlZnQiLCBgMTBweCBzb2xpZCAke2FyZ3MuQ09MT1J9YCwNCiAgICAgICAgICB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKSwgImFycm93U3R5bGVzIg0KICAgICAgICApOw0KICAgICAgICB0aGlzLnNldEJ1YmJsZUF0dCgNCiAgICAgICAgICAiYm9yZGVyVG9wIiwgYDEwcHggc29saWQgJHthcmdzLkNPTE9SfWAsDQogICAgICAgICAgdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSksICJhcnJvd1N0eWxlcyINCiAgICAgICAgKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuc2V0QnViYmxlQXR0KA0KICAgICAgICAgIGFyZ3MuVFlQRSA9PT0gImJhY2tncm91bmQiID8gImJhY2tncm91bmQiIDogImNvbG9yIiwgYXJncy5DT0xPUiwNCiAgICAgICAgICB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKSwgInN0eWxlcyINCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBidWJibGVJbWcoYXJncywgdXRpbCkgew0KICAgICAgU2NyYXRjaC5jYW5GZXRjaChlbmNvZGVVUkkoYXJncy5VUkwpKS50aGVuKChjYW5GZXRjaCkgPT4gew0KICAgICAgICBpZiAoY2FuRmV0Y2gpIHsNCiAgICAgICAgICB0aGlzLnNldEJ1YmJsZUF0dCgNCiAgICAgICAgICAgICJiYWNrZ3JvdW5kIiwgYHVybCgke2VuY29kZVVSSShhcmdzLlVSTCl9KWAsDQogICAgICAgICAgICB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKSwgInN0eWxlcyINCiAgICAgICAgICApOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBhcnJvd1BvcyhhcmdzLCB1dGlsKSB7DQogICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKTsNCiAgICAgIHRoaXMuc2V0QnViYmxlQXR0KCJsZWZ0IiwgYCR7U2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueCl9cHhgLCB0YXJnZXQsICJhcnJvd1N0eWxlcyIpOw0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoInRvcCIsIGAke1NjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnkpICogLTF9cHhgLCB0YXJnZXQsICJhcnJvd1N0eWxlcyIpOw0KICAgIH0NCg0KICAgIHNldFN0cmV0Y2goYXJncywgdXRpbCkgew0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCBmYWxzZSk7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGlmICghYWxsQnViYmxlc1tlbmNvZGVkSWRdKSB0aGlzLmFkZERlZmF1bHQoaWQpOw0KICAgICAgbGV0IGVsZW1lbnQgPSBhbGxCdWJibGVzW2VuY29kZWRJZF0uZWxlbWVudDsNCiAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuOw0KICAgICAgY29uc3Qgc2V0dGVyID0gYXJncy5UWVBFID09PSAiYXJyb3ciID8gZWxlbWVudC5xdWVyeVNlbGVjdG9yKGBkaXZbaWQ9ImFycm93LUlEIl1gKSA6IGVsZW1lbnQ7DQogICAgICBsZXQgY3VyVHJhbnNmb3JtID0gc2V0dGVyLnN0eWxlLnRyYW5zZm9ybSB8fCAiIjsNCiAgICAgIGN1clRyYW5zZm9ybSA9IGN1clRyYW5zZm9ybS5yZXBsYWNlKC9zY2FsZVwoW14pXSpcKS9nLCAiIik7DQogICAgICBjb25zdCB2YWx1ZSA9IGBzY2FsZSgke1NjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLngpIC8gMTAwfSwke1NjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnkpIC8gMTAwfSlgOw0KICAgICAgc2V0dGVyLnN0eWxlLnRyYW5zZm9ybSA9IGAke2N1clRyYW5zZm9ybX0gJHt2YWx1ZX1gOw0KICAgICAgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgICJ0cmFuc2Zvcm0iLCAoYCR7Y3VyVHJhbnNmb3JtfSAke3ZhbHVlfWApLnRyaW0oKSwgaWQsDQogICAgICAgIGFyZ3MuVFlQRSA9PT0gImFycm93IiA/ICJhcnJvd1N0eWxlcyIgOiAic3R5bGVzIg0KICAgICAgKTsNCiAgICB9DQoNCiAgICBzZXRHbG93KGFyZ3MsIHV0aWwpIHsNCiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRUYXJnZXRJZChhcmdzLlNQUklURSwgdXRpbCwgdHJ1ZSk7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGNvbnN0IGNvbG9yID0gYXJncy56ID09PSAwID8gIm5vbmUiIDogYCR7YXJncy54fXB4ICR7YXJncy55ICogLTF9cHggJHthcmdzLnp9cHggJHthcmdzLkNPTE9SfWA7DQogICAgICBjb25zdCBhcHBseUdsb3cgPSAoa2V5KSA9PiB7DQogICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgZGl2W2lkPSJTUF9TcGVlY2gtRXh0LSR7a2V5fSJdYCk7DQogICAgICAgIGVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHsNCiAgICAgICAgICBlbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9IGNvbG9yOw0KICAgICAgICAgIGFsbEJ1YmJsZXNba2V5XS5zdHlsZXMuYm94U2hhZG93ID0gY29sb3I7DQogICAgICAgIH0pOw0KICAgICAgfTsNCiAgICAgIGlmIChpZCA9PT0gIl9hbGxfIikgT2JqZWN0LmtleXMoYWxsQnViYmxlcykuZm9yRWFjaChhcHBseUdsb3cpOw0KICAgICAgZWxzZSBhcHBseUdsb3coZW5jb2RlZElkKTsNCiAgICB9DQoNCiAgICBzZXRFZmZlY3QoYXJncywgdXRpbCkgew0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCBmYWxzZSk7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGlmICghYWxsQnViYmxlc1tlbmNvZGVkSWRdKSB0aGlzLmFkZERlZmF1bHQoaWQpOw0KICAgICAgbGV0IGVsZW1lbnQgPSBhbGxCdWJibGVzW2VuY29kZWRJZF0uZWxlbWVudDsNCiAgICAgIGlmICghZWxlbWVudCkgcmV0dXJuOw0KICAgICAgaWYgKGFyZ3MuVFlQRSA9PT0gImFycm93IikgZWxlbWVudCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2lkPSJhcnJvdy1JRCJdYCk7DQogICAgICBsZXQgZWZmZWN0ID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuRUZGRUNUKS5yZXBsYWNlQWxsKCIgIiwgIiIpOw0KICAgICAgbGV0IHRlcm0gPSAiIjsNCiAgICAgIGNvbnN0IHNvdXJjZSA9IGVmZmVjdC5pbmNsdWRlcygic2tldyIpIHx8IGVmZmVjdCA9PT0gImRpcmVjdGlvbiIgPyAidHJhbnNmb3JtIiA6ICJmaWx0ZXIiOw0KICAgICAgaWYgKGVmZmVjdCA9PT0gImJsdXIiKSB0ZXJtID0gInB4IjsNCiAgICAgIGVsc2UgaWYgKGVmZmVjdCA9PT0gInNhdHVyYXRpb24iKSBlZmZlY3QgPSAic2F0dXJhdGUiOw0KICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAiaHVlIikgeyBlZmZlY3QgPSAiaHVlLXJvdGF0ZSI7IHRlcm0gPSAiZGVnIiB9DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJkaXJlY3Rpb24iKSB7IGVmZmVjdCA9ICJyb3RhdGUiOyB0ZXJtID0gImRlZyIgfQ0KICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAic2tld3giKSB7IGVmZmVjdCA9ICJza2V3WCI7IHRlcm0gPSAiZGVnIiB9DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJza2V3eSIpIHsgZWZmZWN0ID0gInNrZXdZIjsgdGVybSA9ICJkZWciIH0NCiAgICAgIGxldCB2YWx1ZSA9IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLk5VTSk7DQogICAgICBpZiAoZWZmZWN0ID09PSAic2F0dXJhdGUiIHx8IGVmZmVjdCA9PT0gImludmVydCIgfHwgZWZmZWN0ID09PSAic2VwaWEiKSB2YWx1ZSA9IHZhbHVlIC8gMTAwOw0KICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAiY29udHJhc3QiIHx8IGVmZmVjdCA9PT0gImJyaWdodG5lc3MiKSB2YWx1ZSA9ICh2YWx1ZSArIDEwMCkgLyAxMDA7DQogICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJvcGFjaXR5IikgdmFsdWUgPSAoMTAwIC0gdmFsdWUpIC8gMTAwOw0KICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAicm90YXRlIikgdmFsdWUgPSB2YWx1ZSAtIDkwOw0KICAgICAgdmFsdWUgPSBgJHtlZmZlY3R9KCR7dmFsdWV9JHt0ZXJtfSlgOw0KDQogICAgICBjb25zdCBzZXR0ZXIgPSBlZmZlY3QuaW5jbHVkZXMoInNrZXciKSA/IGVsZW1lbnQucGFyZW50Tm9kZSA6IGVsZW1lbnQ7DQogICAgICBsZXQgY3VyU291cmNlID0gc2V0dGVyLnN0eWxlW3NvdXJjZV0gfHwgIiI7DQogICAgICBjdXJTb3VyY2UgPSBjdXJTb3VyY2UucmVwbGFjZShuZXcgUmVnRXhwKGAke2VmZmVjdH1cXChbXildKlxcKWAsICJnIiksICIiKTsNCiAgICAgIHNldHRlci5zdHlsZVtzb3VyY2VdID0gYCR7Y3VyU291cmNlfSAke3ZhbHVlfWA7DQogICAgICBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICJjZW50ZXIiOw0KICAgICAgaWYgKCFlZmZlY3QuaW5jbHVkZXMoInNrZXciKSkgdGhpcy5zZXRCdWJibGVBdHQoDQogICAgICAgIHNvdXJjZSwgKGAke2N1clNvdXJjZX0gJHt2YWx1ZX1gKS50cmltKCksIGlkLCBhcmdzLlRZUEUgPT09ICJhcnJvdyIgPyAiYXJyb3dTdHlsZXMiIDogInN0eWxlcyINCiAgICAgICk7DQogICAgfQ0KDQogICAgZ2V0RWZmZWN0KGFyZ3MsIHV0aWwpIHsNCiAgICAgIGxldCBlZmZlY3QgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5FRkZFQ1QpLnJlcGxhY2VBbGwoIiAiLCAiIik7DQogICAgICBpZiAoZWZmZWN0ID09PSAic2F0dXJhdGlvbiIpIGVmZmVjdCA9ICJzYXR1cmF0ZSI7DQogICAgICBpZiAoZWZmZWN0ID09PSAiaHVlIikgZWZmZWN0ID0gImh1ZS1yb3RhdGUiOw0KICAgICAgaWYgKGVmZmVjdCA9PT0gImRpcmVjdGlvbiIpIGVmZmVjdCA9ICJyb3RhdGUiOw0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCBmYWxzZSk7DQogICAgICBjb25zdCBlbmNvZGVkSWQgPSB0aGlzLm1ha2VFbmNvZGVkSUQoaWQpOw0KICAgICAgaWYgKCFlbmNvZGVkSWQpIHJldHVybjsNCiAgICAgIGlmICghYWxsQnViYmxlc1tlbmNvZGVkSWRdKSB0aGlzLmFkZERlZmF1bHQoaWQpOw0KICAgICAgbGV0IHBhdGggPSBhbGxCdWJibGVzW2VuY29kZWRJZF1bYXJncy5UWVBFID09PSAiYXJyb3ciID8gImFycm93U3R5bGVzIiA6ICJzdHlsZXMiXTsNCiAgICAgIHBhdGggPSBwYXRoW2VmZmVjdC5pbmNsdWRlcygic2NhbGUiKSB8fCBlZmZlY3QuaW5jbHVkZXMoInNrZXciKSB8fCBlZmZlY3QgPT09ICJyb3RhdGUiID8gInRyYW5zZm9ybSIgOiAiZmlsdGVyIl07DQogICAgICBjb25zdCBmaWx0ZXJQcm9wcyA9IHBhdGgubWF0Y2goL1tcdy1dK1woW14pXStcKS9nKSB8fCBbXTsNCiAgICAgIGNvbnN0IGZpbHRlck9iaiA9IHt9Ow0KICAgICAgZmlsdGVyUHJvcHMuZm9yRWFjaChwcm9wZXJ0eSA9PiB7DQogICAgICAgIGNvbnN0IFtuYW1lLCB2YWx1ZV0gPSBwcm9wZXJ0eS5zcGxpdCgiKCIpOw0KICAgICAgICBmaWx0ZXJPYmpbbmFtZS50b0xvd2VyQ2FzZSgpXSA9IHZhbHVlLnJlcGxhY2UoL1wpJC8sICIiKTsNCiAgICAgIH0pOw0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKGVmZmVjdC5pbmNsdWRlcygic2NhbGUiKSkgew0KICAgICAgICAgIGNvbnN0IHZhbHVlID0gZmlsdGVyT2JqWyJzY2FsZSJdLnNwbGl0KCIsIik7DQogICAgICAgICAgcmV0dXJuIHZhbHVlW2VmZmVjdC5pbmNsdWRlcygieCIpID8gMCA6IDFdICogMTAwOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGxldCBudW1iZXIgPSBTY3JhdGNoLkNhc3QudG9OdW1iZXIoZmlsdGVyT2JqW2VmZmVjdF0ucmVwbGFjZSgicHgiLCAiIikucmVwbGFjZSgiZGVnIiwgIiIpKTsNCiAgICAgICAgICBpZiAoZWZmZWN0ID09PSAic2F0dXJhdGUiIHx8IGVmZmVjdCA9PT0gImludmVydCIgfHwgZWZmZWN0ID09PSAic2VwaWEiKSBudW1iZXIgPSBudW1iZXIgKiAxMDA7DQogICAgICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAiY29udHJhc3QiIHx8IGVmZmVjdCA9PT0gImJyaWdodG5lc3MiKSBudW1iZXIgPSBudW1iZXIgKiAxMDAgLSAxMDA7DQogICAgICAgICAgZWxzZSBpZiAoZWZmZWN0ID09PSAib3BhY2l0eSIpIG51bWJlciA9IChudW1iZXIgKiAtMTAwKSArIDEwMDsNCiAgICAgICAgICBlbHNlIGlmIChlZmZlY3QgPT09ICJyb3RhdGUiKSBudW1iZXIgPSBudW1iZXIgKyA5MDsNCiAgICAgICAgICByZXR1cm4gbnVtYmVyOw0KICAgICAgICB9DQogICAgICB9IGNhdGNoIHsgcmV0dXJuICIiIH0NCiAgICB9DQoNCiAgICByZXNldEVmZmVjdChhcmdzLCB1dGlsKSB7DQogICAgICBjb25zdCBlZmZlY3RzID0gdGhpcy5nZXRFZmZlY3RzKGZhbHNlKTsNCiAgICAgIGNvbnN0IGRlZmF1bHRWYWxzID0gWzAsIDEwMCwgMCwgMCwgMCwgMCwgMCwgMCwgOTAsIDAsIDBdOw0KICAgICAgY29uc3QgaWQgPSB0aGlzLmdldFRhcmdldElkKGFyZ3MuU1BSSVRFLCB1dGlsLCB0cnVlKTsNCiAgICAgIGNvbnN0IHJlc2V0ZXIgPSAob2JqKSA9PiB7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVmYXVsdFZhbHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB0aGlzLnNldEVmZmVjdCh7IFRZUEU6ICJidWJibGUiLCBFRkZFQ1Q6IGVmZmVjdHNbaV0sIE5VTTogZGVmYXVsdFZhbHNbaV0sIFNQUklURTogb2JqLmlkIH0pOw0KICAgICAgICAgIHRoaXMuc2V0RWZmZWN0KHsgVFlQRTogImFycm93IiwgRUZGRUNUOiBlZmZlY3RzW2ldLCBOVU06IGRlZmF1bHRWYWxzW2ldLCBTUFJJVEU6IG9iai5pZCB9KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNldFN0cmV0Y2goeyBUWVBFOiAiYnViYmxlIiwgeDogMTAwLCB5OiAxMDAsIFNQUklURTogb2JqLmlkIH0pOw0KICAgICAgICB0aGlzLnNldFN0cmV0Y2goeyBUWVBFOiAiYXJyb3ciLCB4OiAxMDAsIHk6IDEwMCwgU1BSSVRFOiBvYmouaWQgfSk7DQogICAgICB9Ow0KICAgICAgaWYgKGlkID09PSAiX2FsbF8iKSBPYmplY3QudmFsdWVzKGFsbEJ1YmJsZXMpLmZvckVhY2gocmVzZXRlcik7DQogICAgICBlbHNlIHJlc2V0ZXIoeyBpZCB9KTsNCiAgICB9DQogIH0NCg0KICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IHNwZWVjaFNQKCkpOw0KfSkoU2NyYXRjaCk7DQo=","data:text/javascript;base64,Ly8gTmFtZTogQWR2YW5jZWQgTWVzc2FnZXMNCi8vIElEOiBTUG1lc3NhZ2VzDQovLyBEZXNjcmlwdGlvbjogTW9yZSBNZXNzYWdlIEJsb2NrcyB0aGF0IGRvIGNvb2wgc3R1ZmYhDQovLyBCeTogU2hhcmtQb29sDQovLyBMaWNlbnNlOiBNSVQNCg0KLy8gVmVyc2lvbiBWLjIuMC4wDQoNCihmdW5jdGlvbiAoU2NyYXRjaCkgew0KICAidXNlIHN0cmljdCI7DQogIGlmICghU2NyYXRjaC5leHRlbnNpb25zLnVuc2FuZGJveGVkKSB0aHJvdyBuZXcgRXJyb3IoIkFkdmFuY2VkIE1lc3NhZ2VzIG11c3QgcnVuIHVuc2FuZGJveGVkISIpOw0KDQogIGNvbnN0IG1lbnVJY29uVVJJID0NCiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTNOUzQ1TWpFaUlHaGxhV2RvZEQwaU56VXVPVEl4SWlCMmFXVjNRbTk0UFNJd0lEQWdOelV1T1RJeElEYzFMamt5TVNJK1BIQmhkR2dnWkQwaVRUSWdNemN1T1RaRE1pQXhPQzR4SURFNExqRWdNaUF6Tnk0NU5pQXljek0xTGprMklERTJMakVnTXpVdU9UWWdNelV1T1RZdE1UWXVNU0F6TlM0NU5pMHpOUzQ1TmlBek5TNDVObE15SURVM0xqZ3lJRElnTXpjdU9UWjZJaUJtYVd4c1BTSWpabVppWmpBd0lpQnpkSEp2YTJVOUlpTmpPVEFpSUhOMGNtOXJaUzEzYVdSMGFEMGlOQ0l2UGp4d1lYUm9JR1E5SWsweE15NHpORFVnTXpRdU5UVTRZeTB1TWpFM0xURXdMall6TnlBMUxqZzVNaTB4TkM0d05EUWdNVEF1TkRrekxURTBMakEwTkNBMUxqVTVPQ0F3SURFM0xqazVNeTB1TXpJeklESTNMalV6TkNBd0lEUXVOall1TVRVNElERXhMalF5T0NBekxqWTVJREV4TGpJd05DQXhOQzR3TkRRdExqSXhNeUE1TGpjNU9DMDNMamMzTXlBeE1pNDNPQzB4TVM0eU9ESWdNVEl1TnpoSU16WXVOams0WXkweExqWXdNeUF3TFRZdU1Ea3hJRGd1TkRVNExURXpMalF4TXlBNExqSXdOaTAxTGpFNU1pMHVNVGdnTWk0NU5USXRPQzR5TURVdU9EWTRMVGd1TWpBMUxUWXVNVGdnTUMweE1DNDJOVGd0TlM0ek56Z3RNVEF1T0RBNExURXlMamM0TVNJZ1ptbHNiRDBpSTJabVppSXZQand2YzNablBnPT0iOw0KICBjb25zdCBibG9ja0ljb25VUkkgPQ0KImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJM01TNDVNakVpSUdobGFXZG9kRDBpTnpFdU9USXhJaUIyYVdWM1FtOTRQU0l3SURBZ056RXVPVEl4SURjeExqa3lNU0krUEhCaGRHZ2daRDBpVFRBZ056RXVPVEpXTUdnM01TNDVNblkzTVM0NU1ub2lJR1pwYkd3OUltNXZibVVpTHo0OGNHRjBhQ0JrUFNKTk5pNHdPVE1nTWpFdU1UY3pZeTB1TVRrMkxUa3VOakkxSURVdU16TXhMVEV5TGpjd09DQTVMalE1TlMweE1pNDNNRGdnTlM0d05qWWdNQ0F4Tmk0eU9ESXRMakk1TWlBeU5DNDVNVFlnTUNBMExqSXhOaTR4TkRNZ01UQXVNelFnTXk0ek5DQXhNQzR4TXpjZ01USXVOekE0TFM0eE9USWdPQzQ0TmpZdE55NHdNek1nTVRFdU5UWTJMVEV3TGpJd09TQXhNUzQxTmpaSU1qY3VNakkxWXkweExqUTFJREF0TlM0MU1USWdOeTQyTlRNdE1USXVNVE0zSURjdU5ESTFMVFF1TmprNUxTNHhOaklnTWk0Mk56RXROeTQwTWpVdU56ZzFMVGN1TkRJMUxUVXVOVGt5SURBdE9TNDJORFF0TkM0NE5qY3RPUzQzT0MweE1TNDFOalpOTlRndU1USWdOVGN1TnpJNVl5MHhMalE0TmlBd0lEUXVNekl5SURVdU56STBMall4T1NBMUxqZzFNaTAxTGpJeU1pNHhPQzA0TGpReU15MDFMamcxTWkwNUxqVTJOUzAxTGpnMU1tZ3RNVEF1TkRGakxUSXVOVEF5SURBdE55NDRPVFF0TWk0eE1qY3RPQzR3TkRZdE9TNHhNVFV0TGpFMkxUY3VNemcwSURRdU5qWTNMVGt1T1RBeklEY3VPVGt0TVRBdU1ERTJJRFl1T0RBMUxTNHlNeUF4TlM0Mk5EUWdNQ0F4T1M0Mk16Y2dNQ0F6TGpJNE1TQXdJRGN1TmpNNElESXVORE1nTnk0ME9EUWdNVEF1TURFMkxTNHhNRGdnTlM0eU9DMHpMak13TWlBNUxqRXhOUzAzTGpjd09TQTVMakV4TlNJZ1ptbHNiRDBpSTJabVppSXZQand2YzNablBnPT0iOw0KDQogIGNvbnN0IHZtID0gU2NyYXRjaC52bTsNCiAgY29uc3QgcnVudGltZSA9IHZtLnJ1bnRpbWU7DQogIGxldCBtZXNzYWdlQmFuayA9IHt9Ow0KDQogIGNsYXNzIFNQbWVzc2FnZXMgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgcnVudGltZS5vbigiUFJPSkVDVF9TVEFSVCIsICgpID0+IHsgbWVzc2FnZUJhbmsgPSB7fSB9KTsNCiAgICAgIHJ1bnRpbWUub24oIlBST0pFQ1RfU1RPUF9BTEwiLCAoKSA9PiB7IG1lc3NhZ2VCYW5rID0ge30gfSk7DQogICAgfQ0KICAgIGdldEluZm8oKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBpZDogIlNQbWVzc2FnZXMiLA0KICAgICAgICBuYW1lOiAiQWR2YW5jZWQgTWVzc2FnZXMiLA0KICAgICAgICBjb2xvcjE6ICIjRkZCRjAwIiwNCiAgICAgICAgY29sb3IyOiAiI0U2QUMwMCIsDQogICAgICAgIGNvbG9yMzogIiNDQzk5MDAiLA0KICAgICAgICBtZW51SWNvblVSSSwNCiAgICAgICAgYmxvY2tJY29uVVJJLA0KICAgICAgICBibG9ja3M6IFsNCiAgICAgICAgICB7DQogICAgICAgICAgICBmdW5jOiAiV0FSTiIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJVVFRPTiwNCiAgICAgICAgICAgIHRleHQ6ICJXQVJOSU5HIg0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYnJvYWRjYXN0TXNnIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJicm9hZGNhc3QgW01TR10gd2l0aCBkYXRhIFtEQVRBXSBhbmQgW1dBSVRdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBNU0c6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJtZXNzYWdlIDEiIH0sDQogICAgICAgICAgICAgIERBVEE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJoZWxsbyB3b3JsZCIgfSwNCiAgICAgICAgICAgICAgV0FJVDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIG1lbnU6ICJTSE9VTERfV0FJVCIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImJyb2FkY2FzdE1zZ1JldHVybiIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLA0KICAgICAgICAgICAgdGV4dDogImJyb2FkY2FzdCBbTVNHXSB3aXRoIGRhdGEgW0RBVEFdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBNU0c6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJtZXNzYWdlIDEiIH0sDQogICAgICAgICAgICAgIERBVEE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJoZWxsbyB3b3JsZCIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgICItLS0iLA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogIndoZW5SZWNlaXZlMSIsDQogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkhBVCwNCiAgICAgICAgICAgIGlzRWRnZUFjdGl2YXRlZDogZmFsc2UsDQogICAgICAgICAgICB0ZXh0OiAid2hlbiBJIHJlY2VpdmUgW01TR10iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogIm1lc3NhZ2UgMSIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogIndoZW5SZWNlaXZlRGF0YTEiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5IQVQsDQogICAgICAgICAgICBpc0VkZ2VBY3RpdmF0ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgdGV4dDogIndoZW4gSSByZWNlaXZlIFtNU0ddIHdpdGggZGF0YSBbREFUQV0iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogIm1lc3NhZ2UgMSIgfSwNCiAgICAgICAgICAgICAgREFUQTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImhlbGxvIHdvcmxkIiB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAid2hlblJlY2VpdmUyIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwNCiAgICAgICAgICAgIHRleHQ6ICJ3YXMgW01TR10gW1RZUEVdID8iLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAiTVNHX1RZUEUiIH0sDQogICAgICAgICAgICAgIE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogIm1lc3NhZ2UgMSIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogIndoZW5SZWNlaXZlRGF0YTIiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLA0KICAgICAgICAgICAgdGV4dDogIndhcyBbTVNHXSB3aXRoIGRhdGEgW0RBVEFdIFtUWVBFXSA/IiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIk1TR19UWVBFIiB9LA0KICAgICAgICAgICAgICBNU0c6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJtZXNzYWdlIDEiIH0sDQogICAgICAgICAgICAgIERBVEE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJoZWxsbyB3b3JsZCIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogInJldHVybkRhdGEiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgaXNUZXJtaW5hbDogdHJ1ZSwNCiAgICAgICAgICAgIHRleHQ6ICJyZXR1cm4gW0RBVEFdIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBEQVRBOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiaGVsbG8hIiB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgIi0tLSIsDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAicmVjZWl2ZWREYXRhIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsDQogICAgICAgICAgICB0ZXh0OiAicmVjZWl2ZWQgZGF0YSBpbiBbTVNHXSIsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgTVNHOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAibWVzc2FnZSAxIiB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiZ2V0UmVjaWV2ZXJzIiwNCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsDQogICAgICAgICAgICB0ZXh0OiAiW1RZUEVdIG9mIFtNU0ddIiwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogIkRBVEFfVFlQRSIgfSwNCiAgICAgICAgICAgICAgTVNHOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAibWVzc2FnZSAxIiB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0sDQogICAgICAgICAgew0KICAgICAgICAgICAgb3Bjb2RlOiAiYWxsb3dTZW5kZXIiLA0KICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogImxldCBzZW5kZXIgb2YgW01TR10gY29udGludWUiLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogIm1lc3NhZ2UgMSIgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LA0KICAgICAgICAgIC8qIERlcHJlY2F0aW9uIE1hcmtlciAqLw0KICAgICAgICAgIHsNCiAgICAgICAgICAgIG9wY29kZTogImJyb2FkY2FzdDEiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAiYnJvYWRjYXN0IFtNU0ddIiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7IE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfSB9LA0KICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgIG9wY29kZTogImJyb2FkY2FzdDIiLCBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICB0ZXh0OiAiYnJvYWRjYXN0IFtNU0ddIGFuZCB3YWl0IiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7IE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfSB9LA0KICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgIG9wY29kZTogImJyb2FkY2FzdERhdGExIiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogImJyb2FkY2FzdCBbTVNHXSB3aXRoIGRhdGEgW0RBVEFdIiwgaGlkZUZyb21QYWxldHRlOiB0cnVlLA0KICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgIE1TRzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfSwgREFUQTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LCB7DQogICAgICAgICAgICBvcGNvZGU6ICJicm9hZGNhc3REYXRhMiIsIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJicm9hZGNhc3QgW01TR10gd2l0aCBkYXRhIFtEQVRBXSBhbmQgd2FpdCIsIGhpZGVGcm9tUGFsZXR0ZTogdHJ1ZSwNCiAgICAgICAgICAgIGFyZ3VtZW50czogew0KICAgICAgICAgICAgICBNU0c6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HIH0sIERBVEE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSwgew0KICAgICAgICAgICAgb3Bjb2RlOiAiZGVsZXRlTWVzc2FnZSIsIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgIHRleHQ6ICJkZWxldGUgW01TR10iLCBoaWRlRnJvbVBhbGV0dGU6IHRydWUsDQogICAgICAgICAgICBhcmd1bWVudHM6IHsgTVNHOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORyB9IH0sDQogICAgICAgICAgfSwgew0KICAgICAgICAgICAgb3Bjb2RlOiAiZGVsZXRlQWxsIiwgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgdGV4dDogImRlbGV0ZSBhbGwgbWVzc2FnZXMiLCBoaWRlRnJvbVBhbGV0dGU6IHRydWUNCiAgICAgICAgICB9DQogICAgICAgICAgLyogTWFya2VyIEVuZCAqLw0KICAgICAgICBdLA0KICAgICAgICBtZW51czogew0KICAgICAgICAgIFNIT1VMRF9XQUlUOiBbImNvbnRpbnVlIiwgIndhaXQiXSwNCiAgICAgICAgICBNU0dfVFlQRTogWyJyZWNlaXZlZCIsICJ3YWl0aW5nIl0sDQogICAgICAgICAgREFUQV9UWVBFOiBbInJlY2VpdmVycyIsICJzZW5kZXIiXQ0KICAgICAgICB9LA0KICAgICAgfTsNCiAgICB9DQoNCiAgICAvLyBIZWxwZXIgRnVuY3MNCiAgICBXQVJOKCkgeyBhbGVydCgiVGhpcyBFeHRlbnNpb24gaXMgTk9UIENvbXBhdGlibGUgd2l0aCB0aGUgVmFuaWxsYSBCcm9hZGNhc3QgQmxvY2tzIikgfQ0KDQogICAgc2VuZE1lc3NhZ2Uob3Bjb2RlLCBtc2csIGRhdGEsIHNlbmRlcikgew0KICAgICAgY29uc3Qgb2xkVGhyZWFkcyA9IG1lc3NhZ2VCYW5rW21zZ107DQogICAgICBsZXQgbmV3VGhyZWFkcyA9IG9sZFRocmVhZHMgIT09IHVuZGVmaW5lZCA/IG9sZFRocmVhZHMudGhyZWFkcyA6IFtdOw0KICAgICAgcnVudGltZS5hbGxTY3JpcHRzQnlPcGNvZGVEbyhvcGNvZGUsIChzY3JpcHQsIHRhcmdldCkgPT4gew0KICAgICAgICBjb25zdCB0b3BCbG9ja0lkID0gc2NyaXB0LmJsb2NrSWQ7DQogICAgICAgIGNvbnN0IHRocmVhZCA9IHJ1bnRpbWUuX3B1c2hUaHJlYWQoc2NyaXB0LmJsb2NrSWQsIHRhcmdldCk7DQogICAgICAgIHRocmVhZC5TUGFkdk1zZyA9IHsgZGF0YSwgbXNnLCBzZW5kZXIsIHBhc3M6IGZhbHNlIH07DQogICAgICAgIG5ld1RocmVhZHMucHVzaCh0aHJlYWQpOw0KICAgICAgfSk7DQogICAgICBtZXNzYWdlQmFua1ttc2ddID0gew0KICAgICAgICBzZW5kVGltZSA6IE1hdGgucm91bmQoRGF0ZS5ub3coKSAvIDEwMCksIGZvcmNlIDogZmFsc2UsDQogICAgICAgIHRocmVhZHMgOiBuZXdUaHJlYWRzLCByZWNlaXZlcnMgOiBbXSwgZGF0YSwgc2VuZGVyDQogICAgICB9Ow0KICAgICAgcmV0dXJuIG5ld1RocmVhZHM7DQogICAgfQ0KDQogICAgLy8gQmxvY2tzDQogICAgYnJvYWRjYXN0TXNnKGFyZ3MsIHV0aWwpIHsNCiAgICAgIGlmICghdXRpbC5zdGFja0ZyYW1lLlNQbXNnKSB1dGlsLnN0YWNrRnJhbWUuU1Btc2cgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5NU0cpOw0KICAgICAgY29uc3QgZGF0YSA9IFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLkRBVEEpOw0KICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5TUG1zZykgew0KICAgICAgICBjb25zdCB0YXJnZXQgPSBgJHt1dGlsLnRhcmdldC5nZXROYW1lKCl9JHt1dGlsLnRhcmdldC5pc09yaWdpbmFsID8gIiIgOiAiIChDbG9uZSkifWA7DQogICAgICAgIGNvbnN0IG5hbWUgPSB1dGlsLnN0YWNrRnJhbWUuU1Btc2c7DQogICAgICAgIGlmICghdXRpbC5zdGFja0ZyYW1lLm5ld1RocmVhZHMpIHsNCiAgICAgICAgICB1dGlsLnN0YWNrRnJhbWUubmV3VGhyZWFkcyA9IFsNCiAgICAgICAgICAgIC4uLnRoaXMuc2VuZE1lc3NhZ2UoIlNQbWVzc2FnZXNfd2hlblJlY2VpdmUxIiwgbmFtZSwgZGF0YSwgdGFyZ2V0KSwNCiAgICAgICAgICAgIC4uLnRoaXMuc2VuZE1lc3NhZ2UoIlNQbWVzc2FnZXNfd2hlblJlY2VpdmVEYXRhMSIsIG5hbWUsIGRhdGEsIHRhcmdldCkNCiAgICAgICAgICBdOw0KICAgICAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUubmV3VGhyZWFkcy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB3YWl0aW5nID0gdXRpbC5zdGFja0ZyYW1lLm5ld1RocmVhZHMuc29tZSgodGhyZWFkKSA9PiBydW50aW1lLnRocmVhZHMuaW5kZXhPZih0aHJlYWQpICE9PSAtMSk7DQogICAgICAgIGlmIChhcmdzLldBSVQgPT09ICJ3YWl0IiAmJiB3YWl0aW5nICYmICFtZXNzYWdlQmFua1tuYW1lXS5mb3JjZSkgew0KICAgICAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUubmV3VGhyZWFkcy5ldmVyeSgodGhyZWFkKSA9PiBydW50aW1lLmlzV2FpdGluZ1RocmVhZCh0aHJlYWQpKSkgdXRpbC55aWVsZFRpY2soKTsNCiAgICAgICAgICBlbHNlIHV0aWwueWllbGQoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGJyb2FkY2FzdE1zZ1JldHVybihhcmdzLCB1dGlsKSB7DQogICAgICBpZiAoIXV0aWwuc3RhY2tGcmFtZS5TUG1zZykgdXRpbC5zdGFja0ZyYW1lLlNQbXNnID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuTVNHKTsNCiAgICAgIGNvbnN0IGRhdGEgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5EQVRBKTsNCiAgICAgIGxldCByZXNwb25zZSA9ICIiOw0KICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5TUG1zZykgew0KICAgICAgICBjb25zdCB0YXJnZXQgPSBgJHt1dGlsLnRhcmdldC5nZXROYW1lKCl9JHt1dGlsLnRhcmdldC5pc09yaWdpbmFsID8gIiIgOiAiIChDbG9uZSkifWA7DQogICAgICAgIGNvbnN0IG5hbWUgPSB1dGlsLnN0YWNrRnJhbWUuU1Btc2c7DQogICAgICAgIGlmICghdXRpbC5zdGFja0ZyYW1lLm5ld1RocmVhZHMpIHsNCiAgICAgICAgICB1dGlsLnN0YWNrRnJhbWUubmV3VGhyZWFkcyA9IFsNCiAgICAgICAgICAgIC4uLnRoaXMuc2VuZE1lc3NhZ2UoIlNQbWVzc2FnZXNfd2hlblJlY2VpdmUxIiwgbmFtZSwgZGF0YSwgdGFyZ2V0KSwNCiAgICAgICAgICAgIC4uLnRoaXMuc2VuZE1lc3NhZ2UoIlNQbWVzc2FnZXNfd2hlblJlY2VpdmVEYXRhMSIsIG5hbWUsIGRhdGEsIHRhcmdldCkNCiAgICAgICAgICBdOw0KICAgICAgICAgIGlmICh1dGlsLnN0YWNrRnJhbWUubmV3VGhyZWFkcy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB3YWl0aW5nID0gdXRpbC5zdGFja0ZyYW1lLm5ld1RocmVhZHMuc29tZSgodGhyZWFkKSA9PiBydW50aW1lLnRocmVhZHMuaW5kZXhPZih0aHJlYWQpICE9PSAtMSk7DQogICAgICAgIGZvciAoY29uc3QgdGhyZWFkIG9mIHV0aWwuc3RhY2tGcmFtZS5uZXdUaHJlYWRzKSB7DQogICAgICAgICAgaWYgKHRocmVhZC5qdXN0UmVwb3J0ZWQpIHsNCiAgICAgICAgICAgIHJlc3BvbnNlID0gdGhyZWFkLmp1c3RSZXBvcnRlZDsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXJlc3BvbnNlICYmIHdhaXRpbmcgJiYgIW1lc3NhZ2VCYW5rW25hbWVdLmZvcmNlKSB7DQogICAgICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5uZXdUaHJlYWRzLmV2ZXJ5KCh0aHJlYWQpID0+IHJ1bnRpbWUuaXNXYWl0aW5nVGhyZWFkKHRocmVhZCkpKSB1dGlsLnlpZWxkVGljaygpOw0KICAgICAgICAgIGVsc2UgdXRpbC55aWVsZCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzcG9uc2UgPyByZXNwb25zZSA6ICIiOw0KICAgIH0NCg0KICAgIHdoZW5SZWNlaXZlMShhcmdzLCB1dGlsKSB7DQogICAgICBjb25zdCBkYXRhID0gdXRpbC50aHJlYWQuU1BhZHZNc2c7DQogICAgICBjb25zdCBtc2cgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5NU0cpOw0KICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlOw0KICAgICAgY29uc3QgY29uID0gbXNnID09PSBkYXRhLm1zZzsNCiAgICAgIGlmIChjb24pIHsNCiAgICAgICAgdXRpbC50aHJlYWQuU1BhZHZNc2cucGFzcyA9IHRydWU7DQogICAgICAgIG1lc3NhZ2VCYW5rW21zZ10ucmVjZWl2ZXJzLnB1c2goYCR7dXRpbC50YXJnZXQuZ2V0TmFtZSgpfSR7dXRpbC50YXJnZXQuaXNPcmlnaW5hbCA/ICIiIDogIiAoQ2xvbmUpIn1gKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBjb247DQogICAgfQ0KDQogICAgd2hlblJlY2VpdmVEYXRhMShhcmdzLCB1dGlsKSB7DQogICAgICBjb25zdCBkYXRhID0gdXRpbC50aHJlYWQuU1BhZHZNc2c7DQogICAgICBjb25zdCBtc2cgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5NU0cpOw0KICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlOw0KICAgICAgY29uc3QgY29uID0gbXNnID09PSBkYXRhLm1zZyAmJiBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5EQVRBKSA9PT0gZGF0YS5kYXRhOw0KICAgICAgaWYgKGNvbikgew0KICAgICAgICB1dGlsLnRocmVhZC5TUGFkdk1zZy5wYXNzID0gdHJ1ZTsNCiAgICAgICAgbWVzc2FnZUJhbmtbbXNnXS5yZWNlaXZlcnMucHVzaChgJHt1dGlsLnRhcmdldC5nZXROYW1lKCl9JHt1dGlsLnRhcmdldC5pc09yaWdpbmFsID8gIiIgOiAiIChDbG9uZSkifWApOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGNvbjsNCiAgICB9DQoNCiAgICB3aGVuUmVjZWl2ZTIoYXJncykgew0KICAgICAgY29uc3QgbXNnRGF0YSA9IG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXTsNCiAgICAgIGlmIChtc2dEYXRhICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaWYgKGFyZ3MuVFlQRSA9PT0gInJlY2VpdmVkIikgcmV0dXJuIG1zZ0RhdGEuc2VuZFRpbWUgPT09IE1hdGgucm91bmQoRGF0ZS5ub3coKSAvIDEwMCk7DQogICAgICAgIGVsc2UgcmV0dXJuIG1zZ0RhdGEudGhyZWFkcy5zb21lKCh0aHJlYWQpID0+IHJ1bnRpbWUuaXNBY3RpdmVUaHJlYWQodGhyZWFkKSk7DQogICAgICB9DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgd2hlblJlY2VpdmVEYXRhMihhcmdzKSB7DQogICAgICBjb25zdCBtc2dEYXRhID0gbWVzc2FnZUJhbmtbYXJncy5NU0ddOw0KICAgICAgaWYgKG1zZ0RhdGEgIT09IHVuZGVmaW5lZCAmJiBtc2dEYXRhLmRhdGEgPT09IGFyZ3MuREFUQSkgew0KICAgICAgICBpZiAoYXJncy5UWVBFID09PSAicmVjZWl2ZWQiKSByZXR1cm4gbXNnRGF0YS5zZW5kVGltZSA9PT0gTWF0aC5yb3VuZChEYXRlLm5vdygpIC8gMTAwKTsNCiAgICAgICAgZWxzZSByZXR1cm4gbXNnRGF0YS50aHJlYWRzLnNvbWUoKHRocmVhZCkgPT4gcnVudGltZS5pc0FjdGl2ZVRocmVhZCh0aHJlYWQpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICByZXR1cm5EYXRhKGFyZ3MsIHV0aWwpIHsNCiAgICAgIHV0aWwudGhyZWFkLmp1c3RSZXBvcnRlZCA9IFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLkRBVEEpOw0KICAgICAgLy8gRGVsYXkgRGVsZXRpb24gb2YgVGhyZWFkDQogICAgICBpZiAodXRpbC5zdGFja1RpbWVyTmVlZHNJbml0KCkpIHsNCiAgICAgICAgdXRpbC5zdGFydFN0YWNrVGltZXIoMCk7DQogICAgICAgIHJ1bnRpbWUucmVxdWVzdFJlZHJhdygpOw0KICAgICAgICB1dGlsLnlpZWxkKCk7DQogICAgICB9IGVsc2UgaWYgKCF1dGlsLnN0YWNrVGltZXJGaW5pc2hlZCgpKSB1dGlsLnlpZWxkKCk7DQogICAgICB1dGlsLnRocmVhZC5zdG9wVGhpc1NjcmlwdCgpOw0KICAgIH0NCg0KICAgIHJlY2VpdmVkRGF0YShhcmdzKSB7IHJldHVybiBtZXNzYWdlQmFua1thcmdzLk1TR10gPyBtZXNzYWdlQmFua1thcmdzLk1TR10uZGF0YSA6ICIiIH0NCg0KICAgIGdldFJlY2lldmVycyhhcmdzKSB7DQogICAgICBpZiAoYXJncy5UWVBFID09PSAicmVjZWl2ZXJzIikgcmV0dXJuIG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXSA/IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXS5yZWNlaXZlcnMpIDogIltdIjsNCiAgICAgIGVsc2UgcmV0dXJuIG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXSA/IG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXS5zZW5kZXIgOiAiIjsNCiAgICB9DQoNCiAgICBhbGxvd1NlbmRlcihhcmdzKSB7IG1lc3NhZ2VCYW5rW2FyZ3MuTVNHXS5mb3JjZSA9IHRydWUgfQ0KDQogICAgLyogRGVwcmVjYXRpb24gTWFya2VyICovDQogICAgYnJvYWRjYXN0MShhcmdzKSB7IHRoaXMuYnJvYWRjYXN0TXNnKHsgLi4uYXJncywgREFUQSA6ICIiLCBXQUlUIDogImNvbnRpbnVlIiB9KSB9DQogICAgYnJvYWRjYXN0RGF0YTEoYXJncykgeyB0aGlzLmJyb2FkY2FzdE1zZyh7IC4uLmFyZ3MsIERBVEEgOiAiIiwgV0FJVCA6ICJ3YWl0IiB9KSB9DQogICAgYnJvYWRjYXN0MihhcmdzKSB7IHRoaXMuYnJvYWRjYXN0TXNnKHsgLi4uYXJncywgV0FJVCA6ICJjb250aW51ZSIgfSkgfQ0KICAgIGJyb2FkY2FzdERhdGEyKGFyZ3MpIHsgdGhpcy5icm9hZGNhc3RNc2coeyAuLi5hcmdzLCBXQUlUIDogIndhaXQiIH0pIH0NCiAgICBkZWxldGVNZXNzYWdlKGFyZ3MpIHsgcmV0dXJuIH0NCiAgICBkZWxldGVBbGwoKSB7IG1lc3NhZ2VCYW5rID0ge30gfQ0KICAgIC8qIE1hcmtlciBFbmQgKi8NCiAgfQ0KDQogIFNjcmF0Y2guZXh0ZW5zaW9ucy5yZWdpc3RlcihuZXcgU1BtZXNzYWdlcygpKTsNCn0pKFNjcmF0Y2gpOw0K","data:text/javascript;base64,Ly8gTmFtZTogQW5pbWF0aW9ucwovLyBJRDogU1BhbmltYXRpb25zCi8vIERlc2NyaXB0aW9uOiBQbGF5IEFuaW1hdGlvbnMgZm9yIHlvdXIgU3ByaXRlcwovLyBCeTogU2hhcmtQb29sCi8vIExpY2VuY2U6IE1JVAoKLy8gVmVyc2lvbiBWLjIuMC4xMQoKKGZ1bmN0aW9uIChTY3JhdGNoKSB7CiAgInVzZSBzdHJpY3QiOwogIGlmICghU2NyYXRjaC5leHRlbnNpb25zLnVuc2FuZGJveGVkKSB0aHJvdyBuZXcgRXJyb3IoIkFuaW1hdGlvbnMgbXVzdCBydW4gdW5zYW5kYm94ZWQiKTsKCiAgY29uc3Qgdm0gPSBTY3JhdGNoLnZtOwogIGNvbnN0IHJ1bnRpbWUgPSB2bS5ydW50aW1lOwogIGNvbnN0IHJlbmRlciA9IHZtLnJlbmRlcmVyOwogIGNvbnN0IHNwZWNpYWxJRCA9IGBTUHNwZWNpYWxJRCR7TWF0aC5yYW5kb20oKX1gOwogIGNvbnN0IHBsYXlUeXBlcyA9IHsKICAgICJub3JtYWxseSI6IDEsCiAgICAiaW4gcmV2ZXJzZSI6IDIsCiAgICAibG9vcGVkIG5vcm1hbGx5IjogMywKICAgICJsb29wZWQgcmV2ZXJzZWQiOiA0CiAgfTsKCiAgbGV0IGFsbEFuaW1hdGlvbnMgPSB7fTsKCiAgY29uc3QgbWVudUljb25VUkkgPQoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4TWpjdU5URWlJR2hsYVdkb2REMGlNVEkzTGpVeElpQjJhV1YzUW05NFBTSXdJREFnTVRJM0xqVXhJREV5Tnk0MU1TSStQSEJoZEdnZ1pEMGlUVEFnTmpNdU56VTFRekFnTWpndU5UUTFJREk0TGpVME5DQXdJRFl6TGpjMU5TQXdjell6TGpjMU5TQXlPQzQxTkRRZ05qTXVOelUxSURZekxqYzFOUzB5T0M0MU5EUWdOak11TnpVMUxUWXpMamMxTlNBMk15NDNOVFZUTUNBNU9DNDVOallnTUNBMk15NDNOVFVpSUdacGJHdzlJaU0wTkRRaUx6NDhjR0YwYUNCa1BTSk5OUzQ0TnpVZ05qTXVOelUxWXpBdE16RXVPVFkzSURJMUxqa3hNeTAxTnk0NE9DQTFOeTQ0T0MwMU55NDRPSE0xTnk0NE9DQXlOUzQ1TVRNZ05UY3VPRGdnTlRjdU9EZ3RNalV1T1RFeklEVTNMamc0TFRVM0xqZzRJRFUzTGpnNExUVTNMamc0TFRJMUxqa3hNeTAxTnk0NE9DMDFOeTQ0T0NJZ1ptbHNiRDBpSXpkaE4yRTNZU0l2UGp4d1lYUm9JR1E5SWsweU15NDJPVFVnT1RBdU5UTmpMVFV1TmpFekxUZ3VNVEkxTFRNdU5UYzJMVEU1TGpJMk1pQTBMalUwT0MweU5DNDROelZ6TVRrdU1qWXlMVE11TlRjMklESTBMamczTlNBMExqVTBPU0F6TGpVM05pQXhPUzR5TmpFdE5DNDFORGtnTWpRdU9EYzBMVEU1TGpJMk1TQXpMalUzTmkweU5DNDROelF0TkM0MU5EaDZJaUJtYVd4c1BTSWpPRGs0T1RnNUlpQnpkSEp2YTJVOUlpTTNZVGRoTjJFaUlITjBjbTlyWlMxM2FXUjBhRDBpTWk0MUlpOCtQSEJoZEdnZ1pEMGlUVEk0TGpFeElEZ3dMak0wTkdNdE5pNHpNeTA1TGpFMk5DMDBMakF6TkMweU1TNDNNalVnTlM0eE15MHlPQzR3TlRaek1qRXVOekkxTFRRdU1ETXpJREk0TGpBMU5pQTFMakV6SURRdU1ETXpJREl4TGpjeU5TMDFMakV6SURJNExqQTFOaTB5TVM0M01qVWdOQzR3TXpRdE1qZ3VNRFUyTFRVdU1UTjZJaUJtYVd4c1BTSWpPV1E1WkRsa0lpQnpkSEp2YTJVOUlpTTNZVGRoTjJFaUlITjBjbTlyWlMxM2FXUjBhRDBpTWk0MUlpOCtQSEJoZEdnZ1pEMGlUVE0yTGpFME5TQTNNeTR6TWpoakxUY3VOREUyTFRFd0xqY3pOaTAwTGpjeU5TMHlOUzQwTlNBMkxqQXhMVE15TGpnMk5uTXlOUzQwTlMwMExqY3lOaUF6TWk0NE5qWWdOaTR3TVdNM0xqUXhOaUF4TUM0M016VWdOQzQzTWpVZ01qVXVORFV0Tmk0d01TQXpNaTQ0TmpWekxUSTFMalExSURRdU56STJMVE15TGpnMk5pMDJMakF4ZWlJZ1ptbHNiRDBpSTJGbFlXVmhaU0lnYzNSeWIydGxQU0lqTjJFM1lUZGhJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqSXVOU0l2UGp4d1lYUm9JR1E5SWswME55NHpNVEVnTmprdU5UTXhZeTA0TGpBek5DMHhNUzQyTXkwMUxqRXlMVEkzTGpVM0lEWXVOVEV0TXpVdU5qQTFjekkzTGpVM0xUVXVNVEU1SURNMUxqWXdOU0EyTGpVeFl6Z3VNRE0wSURFeExqWXpJRFV1TVRJZ01qY3VOVGN4TFRZdU5URWdNelV1TmpBMUxURXhMall6SURndU1ETTFMVEkzTGpVM01TQTFMakV5TFRNMUxqWXdOUzAyTGpVeGVpSWdabWxzYkQwaUkySmhZbUZpWVNJZ2MzUnliMnRsUFNJak4yRTNZVGRoSWlCemRISnZhMlV0ZDJsa2RHZzlJakl1TlNJdlBqeHdZWFJvSUdROUlrMDFOUzQzTVRnZ056TXVNemMxWXkwNExqZ3lPUzB4TWk0M09DMDFMall5Tmkwek1DNHlPVGdnTnk0eE5UUXRNemt1TVRJMklERXlMamM0TFRndU9ESTVJRE13TGpJNU9DMDFMall5TmlBek9TNHhNallnTnk0eE5UUWdPQzQ0TWprZ01USXVOemdnTlM0Mk1qWWdNekF1TWprM0xUY3VNVFUwSURNNUxqRXlObk10TXpBdU1qazNJRFV1TmpJMkxUTTVMakV5TmkwM0xqRTFOQ0lnWm1sc2JEMGlJMlptWmlJdlBqd3ZjM1puUGc9PSI7CiAgY29uc3QgYmxvY2tJY29uVVJJID0KImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJNE5TNHpNeklpSUdobGFXZG9kRDBpT0RVdU16TXlJaUIyYVdWM1FtOTRQU0l3SURBZ09EVXVNek15SURnMUxqTXpNaUkrUEhCaGRHZ2daRDBpVFRVMExqazNJREkxTGpNMk1tRTFJRFVnTUNBd0lERWdOU0ExZGpRd0xqUTJZVFVnTlNBd0lEQWdNUzAxSURWSU1UUXVOVEZoTlNBMUlEQWdNQ0F4TFRVdE5YWXROREF1TkRaaE5TQTFJREFnTUNBeElEVXROWG9pSUdacGJHdzlJaU01TWpreU9USWlMejQ4Y0dGMGFDQmtQU0pOTmpJdU9EazJJREUzTGpRek5tRTFJRFVnTUNBd0lERWdOU0ExZGpRd0xqUTJZVFVnTlNBd0lEQWdNUzAxSURWb0xUUXdMalEyWVRVZ05TQXdJREFnTVMwMUxUVjJMVFF3TGpRMllUVWdOU0F3SURBZ01TQTFMVFY2SWlCbWFXeHNQU0p6YVd4MlpYSWlMejQ4Y0dGMGFDQmtQU0pOTnpBdU9ESXhJRGt1TlRFeFlUVWdOU0F3SURBZ01TQTFJRFYyTkRBdU5EWmhOU0ExSURBZ01DQXhMVFVnTldndE5EQXVORFpoTlNBMUlEQWdNQ0F4TFRVdE5YWXROREF1TkRaaE5TQTFJREFnTUNBeElEVXROWG9pSUdacGJHdzlJaU5tWm1ZaUx6NDhMM04yWno0PSI7CgogIGNvbnN0IHBsYXlJY29uVVJJID0KImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJNE5TNHpNeklpSUdobGFXZG9kRDBpT0RVdU16TXlJaUIyYVdWM1FtOTRQU0l3SURBZ09EVXVNek15SURnMUxqTXpNaUkrUEhCaGRHZ2daRDBpYlRJM0xqUXpNU0F4Tmk0eU1qY2dNemd1TXpBNElESXlMakV4T0dNMExqVXlNaUF5TGpZeElEUXVOVGd5SURZdU1EY3pMakUwTXlBNExqWXpObXd0TXpjdU56YzFJREl4TGpneFl5MHlMamMyTkNBeExqVTVOaTAxTGpZd05pNDNNeTAxTGpZd05pMHpMakU1TjFZeU1DNDBNVGxqTUMwekxqUXlOeUF5TGpRMU5TMDFMall5SURRdU9UTXROQzR4T1RJaUlHWnBiR3c5SWlObVptWWlMejQ4TDNOMlp6ND0iOwogIGNvbnN0IGtleUljb25VUkkgPQoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0k0TlM0ek16SWlJR2hsYVdkb2REMGlPRFV1TXpNeUlpQjJhV1YzUW05NFBTSXdJREFnT0RVdU16TXlJRGcxTGpNek1pSStQSEJoZEdnZ1pEMGlUVGd1TnpFNElESTFMakl6WXpBdE5pNDVNeUExTGpZeE9TMHhNaTQxTkRrZ01USXVOVFV0TVRJdU5UUTVJRFl1T1RNZ01DQXhNaTQxTkRnZ05TNDJNVGdnTVRJdU5UUTRJREV5TGpVME9YTXROUzQyTVRnZ01USXVOVFE1TFRFeUxqVTBPU0F4TWk0MU5EbFRPQzQzTVRnZ016SXVNVFlnT0M0M01UZ2dNalV1TWpJNWJUTXlMakl6TVNBeU9TNDFPRGxqTUMwNUxqZzBPQ0EzTGprNE5DMHhOeTQ0TXpJZ01UY3VPRE15TFRFM0xqZ3pNbk14Tnk0NE16TWdOeTQ1T0RRZ01UY3VPRE16SURFM0xqZ3pNbU13SURrdU9EVXROeTQ1T0RRZ01UY3VPRE16TFRFM0xqZ3pNeUF4Tnk0NE16TnpMVEUzTGpnek1pMDNMams0TkMweE55NDRNekl0TVRjdU9ETXpJaUJtYVd4c1BTSWpabVptSWk4K1BIQmhkR2dnWkQwaWJUSXpMamd3TnlBeU5pNDVPRFVnTXpBdU16Z3hJREkxTGpZeU5pSWdabWxzYkQwaWJtOXVaU0lnYzNSeWIydGxQU0lqWm1abUlpQnpkSEp2YTJVdGQybGtkR2c5SWpVaUlITjBjbTlyWlMxc2FXNWxZMkZ3UFNKeWIzVnVaQ0l2UGp3dmMzWm5QZz09IjsKCiAgZnVuY3Rpb24gZG9Gb3JFYWNoQW5pbWF0aW9uKGZ1bmMpIHsKICAgIGNvbnN0IHRhcmdldHMgPSBPYmplY3QudmFsdWVzKGFsbEFuaW1hdGlvbnMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHRhcmdldENhY2hlID0gdGFyZ2V0c1tpXTsKICAgICAgY29uc3QgdGFyZ0FuaW1zID0gT2JqZWN0LnZhbHVlcyh0YXJnZXRDYWNoZSk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGFyZ0FuaW1zLmxlbmd0aDsgaisrKSBmdW5jKHRhcmdBbmltc1tqXSk7CiAgICB9CiAgfQoKICBjbGFzcyBTUGFuaW1hdGlvbnMgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHJ1bnRpbWUub24oIlBST0pFQ1RfU1RPUF9BTEwiLCAoKSA9PiB7CiAgICAgICAgZG9Gb3JFYWNoQW5pbWF0aW9uKChhbmltKSA9PiB7IGFuaW0ucGxheWluZyA9IGZhbHNlIH0pOwogICAgICB9KTsKICAgICAgcnVudGltZS5vbigiUFJPSkVDVF9TVEFSVCIsICgpID0+IHsKICAgICAgICBkb0ZvckVhY2hBbmltYXRpb24oKGFuaW0pID0+IHsgYW5pbS5wbGF5aW5nID0gZmFsc2UgfSk7CiAgICAgIH0pOwogICAgICBydW50aW1lLm9uKCJBRlRFUl9FWEVDVVRFIiwgKCkgPT4gewogICAgICAgIGlmIChydW50aW1lLmlvRGV2aWNlcy5jbG9jay5fcGF1c2VkKSByZXR1cm47CiAgICAgICAgZG9Gb3JFYWNoQW5pbWF0aW9uKChhbmltKSA9PiB7CiAgICAgICAgICBpZiAoYW5pbS5wbGF5aW5nKSB7CiAgICAgICAgICAgIGNvbnN0IGlzUmV2ZXJzZSA9IGFuaW0ucGxheVR5cGUgPT09IDIgfHwgYW5pbS5wbGF5VHlwZSA9PT0gNDsKICAgICAgICAgICAgYW5pbS50aW1lciArPSAwLjAxOwogICAgICAgICAgICBpZiAoYW5pbS50aW1lciA+IGFuaW0uYnVmZmVyKSB7CiAgICAgICAgICAgICAgYW5pbS5idWZmZXIgKz0gYW5pbS5mcHMgLyAxMDAwOwogICAgICAgICAgICAgIGlmIChpc1JldmVyc2UpIGFuaW0uY3VycmVudEZyYW1lLS07CiAgICAgICAgICAgICAgZWxzZSBhbmltLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICAgIGFuaW0ubm9ybWFsQ3VycmVudEZyYW1lID0gYW5pbS5jdXJyZW50RnJhbWUgKyAxOwoKICAgICAgICAgICAgICAvLyBkZXRlcm1pbmUgaWYgdGhpcyBmcmFtZSBpcyBhIGtleWZyYW1lL2Nvc3R1bWUKICAgICAgICAgICAgICBjb25zdCB0aGlzRnJhbWUgPSBhbmltLmZyYW1lc1thbmltLmN1cnJlbnRGcmFtZV0gPz8gIiI7CiAgICAgICAgICAgICAgaWYgKHRoaXNGcmFtZS5zdGFydHNXaXRoKHNwZWNpYWxJRCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lID0gYW5pbS5zcGVjaWFsRnJhbWVzW3RoaXNGcmFtZV07CiAgICAgICAgICAgICAgICBpZiAoa2V5ZnJhbWUudHlwZSA9PT0gInBhdXNlIikgYW5pbS5idWZmZXIgKz0ga2V5ZnJhbWUuc2VjczsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5rZXlmcmFtZVVwZGF0ZShrZXlmcmFtZSwgYW5pbSwgdHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzRnJhbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYW5pbS50YXJnZXQuZ2V0Q29zdHVtZUluZGV4QnlOYW1lKHRoaXNGcmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgYW5pbS50YXJnZXQuc2V0Q29zdHVtZShpbmRleCk7CiAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUud2FybihgQW5pbWF0aW9ucyAtLSBJbnZhbGlkIENvc3R1bWUgKCR7dGhpc0ZyYW1lfSlgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY29tcGxldGUgYW55IHVuZmluaXNoZWQga2V5ZnJhbWVzCiAgICAgICAgICAgIGFuaW0ua2V5QnVmZmVycy5mb3JFYWNoKChrZXkpID0+IHRoaXMua2V5ZnJhbWVVcGRhdGUoa2V5LCBhbmltLCBmYWxzZSkpOwoKICAgICAgICAgICAgY29uc3QgZnJhbWVDbnQgPSBhbmltLmZyYW1lcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lQ2hlY2sgPSBpc1JldmVyc2UgPyBhbmltLmN1cnJlbnRGcmFtZSA8PSAwIDogYW5pbS5jdXJyZW50RnJhbWUgPj0gZnJhbWVDbnQgLSAxOwogICAgICAgICAgICBpZiAoZnJhbWVDaGVjayAmJiBhbmltLmtleUJ1ZmZlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXNldEFuaW1QbGF5ZXIoYW5pbSk7CiAgICAgICAgICAgICAgaWYgKGlzUmV2ZXJzZSkgYW5pbS5jdXJyZW50RnJhbWUgPSBmcmFtZUNudDsKICAgICAgICAgICAgICBpZiAoYW5pbS5wbGF5VHlwZSA8IDMpIGFuaW0ucGxheWluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgZ2V0SW5mbygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogIlNQYW5pbWF0aW9ucyIsCiAgICAgICAgbmFtZTogIkFuaW1hdGlvbnMiLAogICAgICAgIGNvbG9yMTogIiM3YTdhN2EiLAogICAgICAgIGNvbG9yMjogIiM0NDQ0NDQiLAogICAgICAgIGNvbG9yMzogIiMyMzIzMjMiLAogICAgICAgIG1lbnVJY29uVVJJLAogICAgICAgIGJsb2NrSWNvblVSSSwKICAgICAgICBibG9ja3M6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiY3JlYXRlQW5pbWF0aW9uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAibWFrZSBuZXcgYW5pbWF0aW9uIG5hbWVkIFtOQU1FXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAicmVtb3ZlQW5pbWF0aW9uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAiZGVsZXRlIGFuaW1hdGlvbiBuYW1lZCBbTkFNRV0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInJlbW92ZUFsbCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogImRlbGV0ZSBhbGwgYW5pbWF0aW9ucyIKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImlzRXhpc3RzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAiYW5pbWF0aW9uIFtOQU1FXSBleGlzdHM/IiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhbGxBbmltYXRpb25zWCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJhbGwgW1RZUEVdIGFuaW1hdGlvbnMiLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInB1bGxUeXBlcyIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5MQUJFTCwgdGV4dDogIkZyYW1lcyIgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYWRkRnJhbWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJhZGQgW0NPU1RVTUVdIHRvIFtOQU1FXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfSwKICAgICAgICAgICAgICBDT1NUVU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLkNPU1RVTUUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAicmVtb3ZlRnJhbWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJyZW1vdmUgW0NPU1RVTUVdIGZyb20gW05BTUVdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9LAogICAgICAgICAgICAgIENPU1RVTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuQ09TVFVNRSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhZGRBbGxGcmFtZXMiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJhZGQgY29zdHVtZXMgZnJvbSBbQ09TMV0gdG8gW0NPUzJdIHRvIFtOQU1FXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfSwKICAgICAgICAgICAgICBDT1MxOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxIH0sCiAgICAgICAgICAgICAgQ09TMjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogNSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJyZW1vdmVBbGxGcmFtZXMiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJyZW1vdmUgZnJhbWVzIFtDT1MxXSB0byBbQ09TMl0gZnJvbSBbTkFNRV0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0sCiAgICAgICAgICAgICAgQ09TMTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMSB9LAogICAgICAgICAgICAgIENPUzI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDUgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgICItLS0iLAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhZGRQYXVzZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogImFkZCBhIFtTRUNPTkRdIHNlY29uZCBwYXVzZSB0byBbTkFNRV0gd2l0aCBJRCBbSURdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9LAogICAgICAgICAgICAgIFNFQ09ORDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMyB9LAogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAicGF1c2UxIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJyZW1vdmVQYXVzZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInJlbW92ZSBwYXVzZSBmcmFtZSBmcm9tIFtOQU1FXSB3aXRoIElEIFtJRF0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0sCiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJwYXVzZTEiIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICAiLS0tIiwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAibnVtRnJhbWVzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogIm51bWJlciBvZiBmcmFtZXMgaW4gW05BTUVdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJmcmFtZU5hbWVzIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogImFsbCBmcmFtZXMgaW4gW05BTUVdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJmcmFtZU5hbWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiZnJhbWUgIyBbRlJBTUVdIGluIFtOQU1FXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfSwKICAgICAgICAgICAgICBGUkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgeyBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkxBQkVMLCB0ZXh0OiAiUGxheWJhY2siIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInNldEZQUyIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInNldCBGUFMgb2YgW05BTUVdIHRvIFtGUFNdIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBwbGF5SWNvblVSSSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9LAogICAgICAgICAgICAgIEZQUzogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMzAgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAicGxheUJhY2siLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJwbGF5IGFuaW1hdGlvbiBbTkFNRV0gW1RZUEVdIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBwbGF5SWNvblVSSSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9LAogICAgICAgICAgICAgIFRZUEU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBtZW51OiAicGxheUJhY2siIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInBsYXlCYWNrV2FpdCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInBsYXkgYW5pbWF0aW9uIFtOQU1FXSBbVFlQRV0gdW50aWwgZG9uZSIsCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogcGxheUljb25VUkksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfSwKICAgICAgICAgICAgICBUWVBFOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInBsYXlCYWNrIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJzdG9wQW5pbWF0aW9uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAic3RvcCBhbmltYXRpb24gW05BTUVdIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBwbGF5SWNvblVSSSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImN1cnJlbnRGUFMiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiRlBTIG9mIFtOQU1FXSIsCiAgICAgICAgICAgIGJsb2NrSWNvblVSSTogcGxheUljb25VUkksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiaXNQbGF5aW5nIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAiaXMgW05BTUVdIHBsYXlpbmc/IiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBwbGF5SWNvblVSSSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJjdXJyZW50RnJhbWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiY3VycmVudCBmcmFtZSBvZiBbTkFNRV0iLAogICAgICAgICAgICBibG9ja0ljb25VUkk6IHBsYXlJY29uVVJJLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuTEFCRUwsIHRleHQ6ICJLZXlmcmFtZXMiIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImFkZFBvc2l0aW9uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAiYWRkIGtleWZyYW1lIHBvc2l0aW9uIHRvIFtOQU1FXSB3aXRoIElEIFtJRF0gc3RhcnQgeCBbeF0geSBbeV0gZW5kIHggW3gyXSB5IFt5Ml0iLAogICAgICAgICAgICBibG9ja0ljb25VUkk6IGtleUljb25VUkksCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJhbmltYXRpb24tMSIgfSwKICAgICAgICAgICAgICBJRDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImtleTEiIH0sCiAgICAgICAgICAgICAgeDogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMCB9LAogICAgICAgICAgICAgIHk6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDAgfSwKICAgICAgICAgICAgICB4MjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMTAwIH0sCiAgICAgICAgICAgICAgeTI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDAgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYWRkRGlyZWN0aW9uIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAiYWRkIGtleWZyYW1lIGRpcmVjdGlvbiB0byBbTkFNRV0gd2l0aCBJRCBbSURdIHN0YXJ0IFtESVIxXSBlbmQgW0RJUjJdIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBrZXlJY29uVVJJLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0sCiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJrZXkxIiB9LAogICAgICAgICAgICAgIERJUjE6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuQU5HTEUsIGRlZmF1bHRWYWx1ZTogOTAgfSwKICAgICAgICAgICAgICBESVIyOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLkFOR0xFLCBkZWZhdWx0VmFsdWU6IDAgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYWRkU2NhbGUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJhZGQga2V5ZnJhbWUgc2NhbGUgdG8gW05BTUVdIHdpdGggSUQgW0lEXSBzdGFydCBbc2NhbGVdJSBlbmQgW3NjYWxlMl0lIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBrZXlJY29uVVJJLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0sCiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJrZXkxIiB9LAogICAgICAgICAgICAgIHNjYWxlOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwKICAgICAgICAgICAgICBzY2FsZTI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDE1MCB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJhZGRTdHJldGNoIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAiYWRkIGtleWZyYW1lIHN0cmV0Y2ggdG8gW05BTUVdIHdpdGggSUQgW0lEXSBzdGFydCB3aWR0aCBbeF0gaGVpZ2h0IFt5XSBlbmQgd2lkdGggW3gyXSBoZWlnaHQgW3kyXSIsCiAgICAgICAgICAgIGJsb2NrSWNvblVSSToga2V5SWNvblVSSSwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgTkFNRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogImFuaW1hdGlvbi0xIiB9LAogICAgICAgICAgICAgIElEOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAia2V5MSIgfSwKICAgICAgICAgICAgICB4OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwKICAgICAgICAgICAgICB5OiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxMDAgfSwKICAgICAgICAgICAgICB4MjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsIGRlZmF1bHRWYWx1ZTogMjAwIH0sCiAgICAgICAgICAgICAgeTI6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLCBkZWZhdWx0VmFsdWU6IDUwIH0KICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICAiLS0tIiwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZGVsZXRlS2V5ZnJhbWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJyZW1vdmUga2V5ZnJhbWUgd2l0aCBJRCBbSURdIGZyb20gW05BTUVdIiwKICAgICAgICAgICAgYmxvY2tJY29uVVJJOiBrZXlJY29uVVJJLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgZGVmYXVsdFZhbHVlOiAiYW5pbWF0aW9uLTEiIH0sCiAgICAgICAgICAgICAgSUQ6IHsgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLCBkZWZhdWx0VmFsdWU6ICJrZXkxIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgbWVudXM6IHsKICAgICAgICAgIHBsYXlCYWNrOiBPYmplY3Qua2V5cyhwbGF5VHlwZXMpLAogICAgICAgICAgcHVsbFR5cGVzOiB7IGFjY2VwdFJlcG9ydGVyczogdHJ1ZSwgaXRlbXM6IFsiZXhpc3RpbmciLCAicGxheWluZyJdIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CgogICAgLy8gSGVscGVyIEZ1bmNzCiAgICBnZXRBbmltKG5hbWUsIHV0aWwsIGZvckFsbCkgewogICAgICBpZiAoZm9yQWxsKSB7CiAgICAgICAgbGV0IGFuaW1TZWFyY2ggPSB1bmRlZmluZWQ7CiAgICAgICAgZG9Gb3JFYWNoQW5pbWF0aW9uKChhbmltKSA9PiB7CiAgICAgICAgICBpZiAoYW5pbS5uYW1lID09PSBuYW1lKSBhbmltU2VhcmNoID0gYW5pbTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYW5pbVNlYXJjaDsKICAgICAgfQogICAgICBjb25zdCB0YXJnZXQgPSB1dGlsLnRhcmdldDsKICAgICAgbGV0IGFuaW0gPSBhbGxBbmltYXRpb25zW3RhcmdldC5pZF0/LltuYW1lXTsKICAgICAgaWYgKGFuaW0pIHJldHVybiBhbmltOwogICAgICBlbHNlIGlmICghdGFyZ2V0LmlzT3JpZ2luYWwpIHsKICAgICAgICBhbmltID0gYWxsQW5pbWF0aW9uc1t0YXJnZXQuc3ByaXRlLmNsb25lc1swXS5pZF0/LltuYW1lXTsKICAgICAgICBpZiAoYW5pbSkgewogICAgICAgICAgaWYgKGFsbEFuaW1hdGlvbnNbdGFyZ2V0LmlkXSA9PT0gdW5kZWZpbmVkKSBhbGxBbmltYXRpb25zW3RhcmdldC5pZF0gPSB7fTsKICAgICAgICAgIGNvbnN0IGNsb25lQ29weSA9IHsgLi4uYW5pbSB9OwogICAgICAgICAgY2xvbmVDb3B5LnRhcmdldCA9IHRhcmdldDsKIAogICAgICAgICAgYWxsQW5pbWF0aW9uc1t0YXJnZXQuaWRdW25hbWVdID0gY2xvbmVDb3B5OwogICAgICAgICAgcmV0dXJuIGNsb25lQ29weTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQW5pbWF0aW9uKHsgTkFNRTogbmFtZSwgU0VDUkVUOiB0cnVlIH0sIHV0aWwpOwogICAgfQoKICAgIHJlc2V0QW5pbVBsYXllcihhbmltKSB7CiAgICAgIGFuaW0uYnVmZmVyID0gYW5pbS5mcHMgLyAxMDAwOwogICAgICBhbmltLnRpbWVyID0gMDsKICAgICAgYW5pbS5jdXJyZW50RnJhbWUgPSAtMTsKICAgIH0KCiAgICBrZXlmcmFtZVVwZGF0ZShkYXRhLCBhbmltLCBpbml0KSB7CiAgICAgIGNvbnN0IHRhcmdldCA9IGFuaW0udGFyZ2V0OwogICAgICBsZXQgeyB0eXBlLCBzdGFydCwgZW5kLCB4MSwgeDIsIHkxLCB5MiB9ID0gZGF0YTsKICAgICAgaWYgKGRhdGEuc3RhcnRTdGFtcCA9PT0gdW5kZWZpbmVkKSBkYXRhLnN0YXJ0U3RhbXAgPSBEYXRlLm5vdygpOwogICAgICBjb25zdCBlbGFwc2VkVGltZSA9IERhdGUubm93KCkgLSBkYXRhLnN0YXJ0U3RhbXA7CiAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oZWxhcHNlZFRpbWUgLyAoYW5pbS5mcHMgKiAyMCksIDEpOwogICAgICBsZXQgZGVsdGExLCBkZWx0YTI7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgInBvcyI6CiAgICAgICAgICBkZWx0YTEgPSB4MiAtIHgxOwogICAgICAgICAgZGVsdGEyID0geTIgLSB5MTsKICAgICAgICAgIHRhcmdldC5zZXRYWSh4MSArIGRlbHRhMSAqIHByb2dyZXNzLCB5MSArIGRlbHRhMiAqIHByb2dyZXNzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRpciI6CiAgICAgICAgICBkZWx0YTEgPSBlbmQgLSBzdGFydDsKICAgICAgICAgIHRhcmdldC5zZXREaXJlY3Rpb24oc3RhcnQgKyBkZWx0YTEgKiBwcm9ncmVzcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzaXplIjoKICAgICAgICAgIGRlbHRhMSA9IGVuZCAtIHN0YXJ0OwogICAgICAgICAgdGFyZ2V0LnNldFNpemUoc3RhcnQgKyBkZWx0YTEgKiBwcm9ncmVzcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzdHJldGNoIjoKICAgICAgICAgIGRlbHRhMSA9IHgyIC0geDE7CiAgICAgICAgICBkZWx0YTIgPSB5MiAtIHkxOwogICAgICAgICAgcmVuZGVyLl9hbGxEcmF3YWJsZXNbdGFyZ2V0LmRyYXdhYmxlSURdLnVwZGF0ZVNjYWxlKFsKICAgICAgICAgICAgeDEgKyBkZWx0YTEgKiBwcm9ncmVzcywgeTEgKyBkZWx0YTIgKiBwcm9ncmVzcwogICAgICAgICAgXSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAocHJvZ3Jlc3MgPT09IDEpIHsKICAgICAgICBkZWxldGUgZGF0YS5zdGFydFN0YW1wOwogICAgICAgIGFuaW0ua2V5QnVmZmVycy5zcGxpY2UoYW5pbS5rZXlCdWZmZXJzLmluZGV4T2YoZGF0YSksIDEpOwogICAgICB9IGVsc2UgaWYgKGluaXQpIGFuaW0ua2V5QnVmZmVycy5wdXNoKGRhdGEpOwogICAgfQoKICAgIC8vIEJsb2NrIEZ1bmNzCiAgICBjcmVhdGVBbmltYXRpb24oYXJncywgdXRpbCkgewogICAgICBjb25zdCBuYW1lID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuTkFNRSk7CiAgICAgIGNvbnN0IGlkID0gdXRpbC50YXJnZXQuaWQ7CiAgICAgIGlmIChhbGxBbmltYXRpb25zW2lkXSA9PT0gdW5kZWZpbmVkKSBhbGxBbmltYXRpb25zW2lkXSA9IHt9OwogICAgICBjb25zdCBvYmogPSB7CiAgICAgICAgbmFtZSwgYnVmZmVyOiAwLCB0aW1lcjogMCwKICAgICAgICBwbGF5aW5nOiBmYWxzZSwgcGxheVR5cGU6IDAsCiAgICAgICAgZnBzOiAxMCwgdGFyZ2V0OiB1dGlsLnRhcmdldCwKICAgICAgICBmcmFtZXM6IFtdLCBzcGVjaWFsRnJhbWVzOiB7fSwKICAgICAgICBrZXlCdWZmZXJzOiBbXSwKICAgICAgICBjdXJyZW50RnJhbWU6IC0xLCBub3JtYWxDdXJyZW50RnJhbWU6IDAKICAgICAgfTsKICAgICAgYWxsQW5pbWF0aW9uc1tpZF1bbmFtZV0gPSBvYmo7CiAgICAgIGlmIChhcmdzLlNFQ1JFVCkgcmV0dXJuIG9iajsKICAgIH0KCiAgICByZW1vdmVBbmltYXRpb24oYXJncywgdXRpbCkgewogICAgICBjb25zdCBuYW1lID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuTkFNRSk7CiAgICAgIGlmICh0aGlzLmlzRXhpc3RzKGFyZ3MsIHV0aWwpKSBkZWxldGUgYWxsQW5pbWF0aW9uc1t1dGlsLnRhcmdldC5pZF1bbmFtZV07CiAgICB9CgogICAgcmVtb3ZlQWxsKCkgeyBhbGxBbmltYXRpb25zID0ge30gfQoKICAgIGlzRXhpc3RzKGFyZ3MsIHV0aWwpIHsKICAgICAgcmV0dXJuIFNjcmF0Y2guQ2FzdC50b0Jvb2xlYW4odGhpcy5nZXRBbmltKGFyZ3MuTkFNRSwgIiIsIHRydWUpKTsKICAgIH0KCiAgICBhZGRGcmFtZShhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgYW5pbS5mcmFtZXMucHVzaChTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5DT1NUVU1FKSk7CiAgICB9CgogICAgcmVtb3ZlRnJhbWUoYXJncywgdXRpbCkgewogICAgICBjb25zdCBhbmltID0gdGhpcy5nZXRBbmltKGFyZ3MuTkFNRSwgdXRpbCk7CiAgICAgIGNvbnN0IGluZCA9IGFuaW0uZnJhbWVzLmluZGV4T2YoU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuQ09TVFVNRSkpOwogICAgICBpZiAoaW5kID4gLTEpIGFuaW0uZnJhbWVzLnNwbGljZShpbmQsIDEpOwogICAgfQoKICAgIGFkZEFsbEZyYW1lcyhhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGNvc3R1bWVzID0gdXRpbC50YXJnZXQuZ2V0Q29zdHVtZXMoKTsKICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1pbihjb3N0dW1lcy5sZW5ndGgsIE1hdGgubWF4KDEsIE1hdGgucm91bmQoU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuQ09TMSkpKSk7CiAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGNvc3R1bWVzLmxlbmd0aCwgTWF0aC5tYXgoc3RhcnQsIE1hdGgucm91bmQoU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuQ09TMikpKSk7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0IC0gMTsgaSA8IGVuZDsgaSsrKSBhbmltLmZyYW1lcy5wdXNoKGNvc3R1bWVzW2ldLm5hbWUpOwogICAgfQoKICAgIHJlbW92ZUFsbEZyYW1lcyhhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGNvc3R1bWVzID0gdXRpbC50YXJnZXQuZ2V0Q29zdHVtZXMoKTsKICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1pbihjb3N0dW1lcy5sZW5ndGgsIE1hdGgubWF4KDEsIE1hdGgucm91bmQoU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuQ09TMSkpKSk7CiAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGNvc3R1bWVzLmxlbmd0aCwgTWF0aC5tYXgoc3RhcnQsIE1hdGgucm91bmQoU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuQ09TMikpKSk7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgYW5pbS5mcmFtZXMuc3BsaWNlKHN0YXJ0IC0gMSwgZW5kIC0gKHN0YXJ0IC0gMSkpOwogICAgfQoKICAgIGFkZFBhdXNlKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgaWQgPSBgJHtzcGVjaWFsSUR9cGF1c2UtJHtTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5JRCl9YDsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICBhbmltLmZyYW1lcy5wdXNoKGlkKTsKICAgICAgYW5pbS5zcGVjaWFsRnJhbWVzW2lkXSA9IHsKICAgICAgICB0eXBlOiAicGF1c2UiLAogICAgICAgIHNlY3M6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLlNFQ09ORCkKICAgICAgfTsKICAgIH0KCiAgICByZW1vdmVQYXVzZShhcmdzLCB1dGlsKSB7CiAgICAgIHRoaXMuZGVsZXRlS2V5ZnJhbWUoYXJncywgdXRpbCk7IC8vIHdvcmtzIHRoZSBzYW1lIHdheQogICAgfQoKICAgIG51bUZyYW1lcyhhcmdzKSB7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCAiIiwgdHJ1ZSk7CiAgICAgIHJldHVybiBhbmltID8gYW5pbS5mcmFtZXMubGVuZ3RoIDogMDsKICAgIH0KCiAgICBmcmFtZU5hbWVzKGFyZ3MpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsICIiLCB0cnVlKTsKICAgICAgaWYgKCFhbmltKSByZXR1cm4gIltdIjsKICAgICAgY29uc3QgcmF3RnJhbWVzID0gc3RydWN0dXJlZENsb25lKGFuaW0uZnJhbWVzKTsKICAgICAgcmF3RnJhbWVzLmZvckVhY2goKGZyYW1lLCBpKSA9PiB7IHJhd0ZyYW1lc1tpXSA9IGZyYW1lLnJlcGxhY2Uoc3BlY2lhbElELCAiIikgfSk7CiAgICAgIHJldHVybiBhbmltID8gSlNPTi5zdHJpbmdpZnkocmF3RnJhbWVzKSA6ICJbXSI7CiAgICB9CgogICAgZnJhbWVOYW1lKGFyZ3MpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsICIiLCB0cnVlKTsKICAgICAgY29uc3QgaW5kID0gU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuRlJBTUUpIC0gMTsKICAgICAgcmV0dXJuIGFuaW0gPyBhbmltLmZyYW1lc1tpbmRdLnJlcGxhY2Uoc3BlY2lhbElELCAiIikgPz8gIiIgOiAiIjsKICAgIH0KCiAgICBhbGxBbmltYXRpb25zWChhcmdzKSB7CiAgICAgIGxldCBhcnJheSA9IFtdOwogICAgICBpZiAoYXJncy5UWVBFID09PSAiZXhpc3RpbmciKSBkb0ZvckVhY2hBbmltYXRpb24oKGFuaW0pID0+IHsgYXJyYXkucHVzaChhbmltLm5hbWUpIH0pOwogICAgICBlbHNlIHsKICAgICAgICBkb0ZvckVhY2hBbmltYXRpb24oKGFuaW0pID0+IHsKICAgICAgICAgIGlmIChhbmltLnBsYXlpbmcpIGFycmF5LnB1c2goYW5pbS5uYW1lKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJyYXkpOwogICAgfQoKICAgIHNldEZQUyhhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgYW5pbS5mcHMgPSBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy5GUFMpOwogICAgfQoKICAgIHBsYXlCYWNrKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICB0aGlzLnJlc2V0QW5pbVBsYXllcihhbmltKTsKICAgICAgYW5pbS5wbGF5VHlwZSA9IHBsYXlUeXBlc1thcmdzLlRZUEVdID8/IDE7CiAgICAgIGlmIChhbmltLnBsYXlUeXBlID09PSAyIHx8IGFuaW0ucGxheVR5cGUgPT09IDQpIGFuaW0uY3VycmVudEZyYW1lID0gYW5pbS5mcmFtZXMubGVuZ3RoOwogICAgICBhbmltLnBsYXlpbmcgPSB0cnVlOwogICAgfQoKICAgIHBsYXlCYWNrV2FpdChhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgaWYgKHV0aWwuc3RhY2tGcmFtZS5leGVjdXRlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5yZXNldEFuaW1QbGF5ZXIoYW5pbSk7CiAgICAgICAgYW5pbS5wbGF5VHlwZSA9IHBsYXlUeXBlc1thcmdzLlRZUEVdID8/IDE7CiAgICAgICAgaWYgKGFuaW0ucGxheVR5cGUgPT09IDIgfHwgYW5pbS5wbGF5VHlwZSA9PT0gNCkgYW5pbS5jdXJyZW50RnJhbWUgPSBhbmltLmZyYW1lcy5sZW5ndGg7CiAgICAgICAgYW5pbS5wbGF5aW5nID0gdHJ1ZTsKICAgICAgICB1dGlsLnN0YWNrRnJhbWUuZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgIHV0aWwueWllbGQoKTsKICAgICAgfSBlbHNlIGlmIChhbmltLnBsYXlpbmcpIHV0aWwueWllbGQoKTsKICAgIH0KCiAgICBzdG9wQW5pbWF0aW9uKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICBhbmltLnBsYXlpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBjdXJyZW50RlBTKGFyZ3MpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsICIiLCB0cnVlKTsKICAgICAgcmV0dXJuIGFuaW0gPyBhbmltLmZwcyA6ICIiOwogICAgfQoKICAgIGlzUGxheWluZyhhcmdzKSB7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCAiIiwgdHJ1ZSk7CiAgICAgIHJldHVybiBhbmltID8gYW5pbS5wbGF5aW5nIDogZmFsc2U7CiAgICB9CgogICAgY3VycmVudEZyYW1lKGFyZ3MpIHsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsICIiLCB0cnVlKTsKICAgICAgcmV0dXJuIGFuaW0gPyBhbmltLm5vcm1hbEN1cnJlbnRGcmFtZSA6IDA7CiAgICB9CgogICAgYWRkUG9zaXRpb24oYXJncywgdXRpbCkgewogICAgICBjb25zdCBpZCA9IGAke3NwZWNpYWxJRH1wb3MtJHtTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5JRCl9YDsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICBhbmltLmZyYW1lcy5wdXNoKGlkKTsKICAgICAgYW5pbS5zcGVjaWFsRnJhbWVzW2lkXSA9IHsKICAgICAgICB0eXBlOiAicG9zIiwKICAgICAgICB4MTogU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueCksIHgyOiBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy54MiksCiAgICAgICAgeTE6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnkpLCB5MjogU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueTIpCiAgICAgIH07CiAgICB9CgogICAgYWRkRGlyZWN0aW9uKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgaWQgPSBgJHtzcGVjaWFsSUR9ZGlyLSR7U2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuSUQpfWA7CiAgICAgIGNvbnN0IGFuaW0gPSB0aGlzLmdldEFuaW0oYXJncy5OQU1FLCB1dGlsKTsKICAgICAgYW5pbS5mcmFtZXMucHVzaChpZCk7CiAgICAgIGFuaW0uc3BlY2lhbEZyYW1lc1tpZF0gPSB7CiAgICAgICAgdHlwZTogImRpciIsCiAgICAgICAgc3RhcnQ6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLkRJUjEpLAogICAgICAgIGVuZDogU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MuRElSMikKICAgICAgfTsKICAgIH0KCiAgICBhZGRTY2FsZShhcmdzLCB1dGlsKSB7CiAgICAgIGNvbnN0IGlkID0gYCR7c3BlY2lhbElEfXNpemUtJHtTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5JRCl9YDsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICBhbmltLmZyYW1lcy5wdXNoKGlkKTsKICAgICAgYW5pbS5zcGVjaWFsRnJhbWVzW2lkXSA9IHsKICAgICAgICB0eXBlOiAic2l6ZSIsCiAgICAgICAgc3RhcnQ6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnNjYWxlKSwKICAgICAgICBlbmQ6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnNjYWxlMikKICAgICAgfTsKICAgIH0KCiAgICBhZGRTdHJldGNoKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgaWQgPSBgJHtzcGVjaWFsSUR9c3RyZXRjaC0ke1NjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLklEKX1gOwogICAgICBjb25zdCBhbmltID0gdGhpcy5nZXRBbmltKGFyZ3MuTkFNRSwgdXRpbCk7CiAgICAgIGFuaW0uZnJhbWVzLnB1c2goaWQpOwogICAgICBhbmltLnNwZWNpYWxGcmFtZXNbaWRdID0gewogICAgICAgIHR5cGU6ICJzdHJldGNoIiwKICAgICAgICB4MTogU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueCksIHgyOiBTY3JhdGNoLkNhc3QudG9OdW1iZXIoYXJncy54MiksCiAgICAgICAgeTE6IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLnkpLCB5MjogU2NyYXRjaC5DYXN0LnRvTnVtYmVyKGFyZ3MueTIpCiAgICAgIH07CiAgICB9CgogICAgZGVsZXRlS2V5ZnJhbWUoYXJncywgdXRpbCkgewogICAgICBjb25zdCBpZCA9IFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLklEKTsKICAgICAgY29uc3QgYW5pbSA9IHRoaXMuZ2V0QW5pbShhcmdzLk5BTUUsIHV0aWwpOwogICAgICBjb25zdCBzcGVjaWFsRnJhbWVzID0gYW5pbS5mcmFtZXMuZmlsdGVyKChmcmFtZSkgPT4geyByZXR1cm4gZnJhbWUuc3RhcnRzV2l0aChzcGVjaWFsSUQpIH0pOwogICAgICBjb25zdCBmcmFtZSA9IHNwZWNpYWxGcmFtZXMuZmluZCgoZnJhbWUpID0+IHsgcmV0dXJuIGZyYW1lLmVuZHNXaXRoKGlkKSB9KTsKICAgICAgaWYgKGZyYW1lICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBhbmltLmZyYW1lcy5zcGxpY2UoYW5pbS5mcmFtZXMuaW5kZXhPZihmcmFtZSksIDEpOwogICAgICAgIGRlbGV0ZSBhbmltLnNwZWNpYWxGcmFtZXNbZnJhbWVdOwogICAgICB9CiAgICB9CiAgfQoKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IFNQYW5pbWF0aW9ucygpKTsKfSkoU2NyYXRjaCk7Cg==","https://extensions.turbowarp.org/stretch.js","data:text/javascript;base64,Ly8gTmFtZTogR2FtZXBhZCBFeHBhbmRlZAovLyBJRDogR2FtZXBhZAovLyBEZXNjcmlwdGlvbjogRGlyZWN0bHkgYWNjZXNzIGdhbWVwYWRzIGluc3RlYWQgb2YganVzdCBtYXBwaW5nIGJ1dHRvbnMgdG8ga2V5cy4KCi8vIFNvbWUgcGFydHMgb2YgdGhpcyBzY3JpcHRzIGFyZSBiYXNlZCBvbiBvciBkZXNpZ25lZCB0byBiZSBjb21wYXRpYmxlLWlzaCB3aXRoOgovLyBodHRwczovL2FycHJ1c3MuZ2l0aHViLmlvL2dhbWVwYWQuanMgKE1JVCBMaWNlbnNlZCkKCihmdW5jdGlvbiAoU2NyYXRjaCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIEFYSVNfREVBRFpPTkUgPSAwLjE7CiAgdmFyIEJVVFRPTl9ERUFEWk9ORSA9IDAuMDU7CgogIC8qKgogICAqIEBwYXJhbSB7bnVtYmVyfCdhbnknfSBpbmRleCAxLWluZGV4ZWQgaW5kZXgKICAgKiBAcmV0dXJucyB7R2FtZXBhZFtdfQogICAqLwogIGNvbnN0IGdldEdhbWVwYWRzID0gKGluZGV4KSA9PiB7CiAgICBpZiAoaW5kZXggPT09ICJhbnkiKSB7CiAgICAgIHJldHVybiBuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMoKS5maWx0ZXIoKGkpID0+IGkpOwogICAgfQogICAgY29uc3QgZ2FtZXBhZCA9IG5hdmlnYXRvci5nZXRHYW1lcGFkcygpW2luZGV4IC0gMV07CiAgICBpZiAoZ2FtZXBhZCkgewogICAgICByZXR1cm4gW2dhbWVwYWRdOwogICAgfQogICAgcmV0dXJuIFtdOwogIH07CgogIC8qKgogICAqIEBwYXJhbSB7R2FtZXBhZH0gZ2FtZXBhZAogICAqIEBwYXJhbSB7bnVtYmVyfCdhbnknfSBidXR0b25JbmRleCAxLWluZGV4ZWQgaW5kZXgKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gZmFsc2UgaWYgYnV0dG9uIGRvZXMgbm90IGV4aXN0CiAgICovCiAgY29uc3QgaXNCdXR0b25QcmVzc2VkID0gKGdhbWVwYWQsIGJ1dHRvbkluZGV4KSA9PiB7CiAgICBpZiAoYnV0dG9uSW5kZXggPT09ICJhbnkiKSB7CiAgICAgIHJldHVybiBnYW1lcGFkLmJ1dHRvbnMuc29tZSgoaSkgPT4gaS5wcmVzc2VkKTsKICAgIH0KICAgIGNvbnN0IGJ1dHRvbiA9IGdhbWVwYWQuYnV0dG9uc1tidXR0b25JbmRleCAtIDFdOwogICAgaWYgKCFidXR0b24pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIGJ1dHRvbi5wcmVzc2VkOwogIH07CgogIC8qKgogICAqIEBwYXJhbSB7R2FtZXBhZH0gZ2FtZXBhZAogICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b25JbmRleCAxLWluZGV4ZWQgaW5kZXgKICAgKiBAcmV0dXJucyB7bnVtYmVyfSAwIGlmIGJ1dHRvbiBkb2VzIG5vdCBleGlzdAogICAqLwogIGNvbnN0IGdldEJ1dHRvblZhbHVlID0gKGdhbWVwYWQsIGJ1dHRvbkluZGV4KSA9PiB7CiAgICBjb25zdCBidXR0b24gPSBnYW1lcGFkLmJ1dHRvbnNbYnV0dG9uSW5kZXggLSAxXTsKICAgIGlmICghYnV0dG9uKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3QgdmFsdWUgPSBidXR0b24udmFsdWU7CiAgICBpZiAodmFsdWUgPCBCVVRUT05fREVBRFpPTkUpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKCiAgLyoqCiAgICogQHBhcmFtIHtHYW1lcGFkfSBnYW1lcGFkCiAgICogQHBhcmFtIHtudW1iZXJ9IGF4aXNJbmRleCAxLWluZGV4ZWQgaW5kZXgKICAgKiBAcmV0dXJucyB7bnVtYmVyfSAwIGlmIGF4aXMgZG9lcyBub3QgZXhpc3QKICAgKi8KICBjb25zdCBnZXRBeGlzVmFsdWUgPSAoZ2FtZXBhZCwgYXhpc0luZGV4KSA9PiB7CiAgICBjb25zdCBheGlzVmFsdWUgPSBnYW1lcGFkLmF4ZXNbYXhpc0luZGV4IC0gMV07CiAgICBpZiAodHlwZW9mIGF4aXNWYWx1ZSAhPT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBpZiAoTWF0aC5hYnMoYXhpc1ZhbHVlKSA8IEFYSVNfREVBRFpPTkUpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gYXhpc1ZhbHVlOwogIH07CgogIC8qKgogICAqIEBwYXJhbSB7R2FtZXBhZC5pZH0gaWQKICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAqLwogIGNvbnN0IG1hdGNoVmVuZG9yID0gKGlkKSA9PiB7CiAgICByZXR1cm4gaWQubWF0Y2goL3ZlbmRvcjpccyooXHcrKS9pKVsxXTsKICB9OwoKICAvKioKICAgKiBAcGFyYW0ge0dhbWVwYWQuaWR9IGlkCiAgICogQHJldHVybnMge3N0cmluZ30KICAgKi8KICBjb25zdCBtYXRjaFByb2R1Y3QgPSAoaWQpID0+IHsKICAgIHJldHVybiBpZC5tYXRjaCgvcHJvZHVjdDpccyooXHcrKS9pKVsxXTsKICB9OwoKICBjbGFzcyBHYW1lcGFkRXh0ZW5zaW9uIHsKICAgIGdldEluZm8oKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6ICJHYW1lcGFkIiwKICAgICAgICBuYW1lOiAiR2FtZXBhZCBFeHRlbmRlZCIsCiAgICAgICAgYmxvY2tzOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImdhbWVwYWRDb25uZWN0ZWQiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJPT0xFQU4sCiAgICAgICAgICAgIHRleHQ6ICJnYW1lcGFkIFtwYWRdIGNvbm5lY3RlZD8iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBwYWQ6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogIjEiLAogICAgICAgICAgICAgICAgbWVudTogInBhZE1lbnUiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdnYW1lcGFkRGV0YWlsJywKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogJ2dldCBbZF0gb2YgcGFkIFtpXScsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIGQ6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ2lkJywKICAgICAgICAgICAgICAgIG1lbnU6ICdkZXRhaWxNZW51JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgaTogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnMScsCiAgICAgICAgICAgICAgICBtZW51OiAncGFkTWVudScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCgogICAgICAgICAgJy0tLScsCgogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJidXR0b25Eb3duIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAiYnV0dG9uIFtiXSBvbiBwYWQgW2ldIHByZXNzZWQ/IiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgYjogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMSIsCiAgICAgICAgICAgICAgICBtZW51OiAiYnV0dG9uTWVudSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIxIiwKICAgICAgICAgICAgICAgIG1lbnU6ICJwYWRNZW51IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYnV0dG9uVmFsdWUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAidmFsdWUgb2YgYnV0dG9uIFtiXSBvbiBwYWQgW2ldIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgYjogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMSIsCiAgICAgICAgICAgICAgICBtZW51OiAiYnV0dG9uTWVudSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIxIiwKICAgICAgICAgICAgICAgIG1lbnU6ICJwYWRNZW51IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYXhpc1ZhbHVlIiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogInZhbHVlIG9mIGF4aXMgW2JdIG9uIHBhZCBbaV0iLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBiOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIxIiwKICAgICAgICAgICAgICAgIG1lbnU6ICJheGlzTWVudSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIxIiwKICAgICAgICAgICAgICAgIG1lbnU6ICJwYWRNZW51IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKCiAgICAgICAgICAiLS0tIiwKCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogImF4aXNEaXJlY3Rpb24iLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiZGlyZWN0aW9uIG9mIGF4ZXMgW2F4aXNdIG9uIHBhZCBbcGFkXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIGF4aXM6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogIjEiLAogICAgICAgICAgICAgICAgbWVudTogImF4ZXNHcm91cE1lbnUiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcGFkOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIxIiwKICAgICAgICAgICAgICAgIG1lbnU6ICJwYWRNZW51IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiYXhpc01hZ25pdHVkZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJtYWduaXR1ZGUgb2YgYXhlcyBbYXhpc10gb24gcGFkIFtwYWRdIiwKICAgICAgICAgICAgYXJndW1lbnRzOiB7CiAgICAgICAgICAgICAgYXhpczogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMSIsCiAgICAgICAgICAgICAgICBtZW51OiAiYXhlc0dyb3VwTWVudSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBwYWQ6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogIjEiLAogICAgICAgICAgICAgICAgbWVudTogInBhZE1lbnUiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAoKICAgICAgICAgIC8qCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2J1dHRvblByZXNzZWRSZWxlYXNlZCcsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuRVZFTlQsCiAgICAgICAgICAgIHRleHQ6ICdidXR0b24gW2JdIFtwcl0gb2YgcGFkIFtpXScsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIGI6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJzEnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBwcjogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnMScsCiAgICAgICAgICAgICAgICBtZW51OiAncHJlc3NSZWxlYXNlTWVudScKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGk6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJzEnLAogICAgICAgICAgICAgICAgbWVudTogJ3BhZE1lbnUnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCgogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdheGlzTW92ZWQnLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkVWRU5ULAogICAgICAgICAgICB0ZXh0OiAnYXhpcyBbYl0gb2YgcGFkIFtpXSBtb3ZlZCcsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIGI6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJzEnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5OVU1CRVIsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICcxJywKICAgICAgICAgICAgICAgIG1lbnU6ICdwYWRNZW51JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgKi8KCiAgICAgICAgICAiLS0tIiwKCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogInJ1bWJsZSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInJ1bWJsZSBzdHJvbmcgW3NdIGFuZCB3ZWFrIFt3XSBmb3IgW3RdIHNlYy4gb24gcGFkIFtpXSIsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIHM6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogIjAuMjUiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdzogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMC41IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHQ6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogIjAuMjUiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgaTogewogICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuTlVNQkVSLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAiMSIsCiAgICAgICAgICAgICAgICBtZW51OiAicGFkTWVudSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCgogICAgICAgICAgIi0tLSIsCgoJewogICAgICAgICAgb3Bjb2RlOiAiZGVhZHpvbmUiLAogICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgdGV4dDogInNldCBheGlzIGRlYWR6b25lIHRvIFtpXSIsCiAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgaTogewogICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIwLjEiLAogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICB9LAoKCXsKICAgICAgICAgIG9wY29kZTogImRlYWR6b25lQnV0dG9uIiwKICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgIHRleHQ6ICJzZXQgYnV0dG9uIGRlYWR6b25lIHRvIFtpXSIsCiAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgaTogewogICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwKICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICIwLjA1IiwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgfSwKCXsKICAgICAgICAgICAgb3Bjb2RlOiAiZ2V0ZGVhZHpvbmUiLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiZ2V0IGF4aXMgZGVhZHpvbmUiLCAKICAgICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJnZXRkZWFkem9uZUJ1dHRvbiIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICJnZXQgYnV0dG9uIGRlYWR6b25lIiwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICBtZW51czogewogICAgICAgICAgcGFkTWVudTogewogICAgICAgICAgICBhY2NlcHRSZXBvcnRlcnM6IHRydWUsCiAgICAgICAgICAgIGl0ZW1zOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogImFueSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogImFueSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiMSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjEiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIjIiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIyIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICIzIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiMyIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiNCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICB9LAogICAgICAgICAgZGV0YWlsTWVudTogewogICAgICAgICAgICBhY2NlcHRSZXBvcnRlcnM6IHRydWUsCiAgICAgICAgICAgIGl0ZW1zOiBbJ2lkJywgJ3ZlbmRvcicsICdwcm9kdWN0JywgJ21hcHBpbmcnXQogICAgICAgICAgfSwKICAgICAgICAgIGJ1dHRvbk1lbnU6IHsKICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLAogICAgICAgICAgICBpdGVtczogWwogICAgICAgICAgICAgIC8vIEJhc2VkIG9uIGFuIFhib3ggY29udHJvbGxlcgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJhbnkiLAogICAgICAgICAgICAgICAgdmFsdWU6ICJhbnkiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIkEgKDEpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiMSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiQiAoMikiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIyIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJYICgzKSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjMiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIlkgKDQpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiNCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiTGVmdCBidW1wZXIgKDUpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiNSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUmlnaHQgYnVtcGVyICg2KSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjYiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIkxlZnQgdHJpZ2dlciAoNykiLAogICAgICAgICAgICAgICAgdmFsdWU6ICI3IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJSaWdodCB0cmlnZ2VyICg4KSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjgiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIlNlbGVjdC9WaWV3ICg5KSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjkiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIlN0YXJ0L01lbnUgKDEwKSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjEwIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJMZWZ0IHN0aWNrICgxMSkiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIxMSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUmlnaHQgc3RpY2sgKDEyKSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjEyIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJELXBhZCB1cCAoMTMpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiMTMiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIkQtcGFkIGRvd24gKDE0KSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjE0IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJELXBhZCBsZWZ0ICgxNSkiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIxNSIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiRC1wYWQgcmlnaHQgKDE2KSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjE2IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgICAgfSwKICAgICAgICAgIGF4aXNNZW51OiB7CiAgICAgICAgICAgIGFjY2VwdFJlcG9ydGVyczogdHJ1ZSwKICAgICAgICAgICAgaXRlbXM6IFsKICAgICAgICAgICAgICAvLyBCYXNlZCBvbiBhbiBYYm94IGNvbnRyb2xsZXIKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiTGVmdCBzdGljayBob3Jpem9udGFsICgxKSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIjEiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogIkxlZnQgc3RpY2sgdmVydGljYWwgKDIpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiMiIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAiUmlnaHQgc3RpY2sgaG9yaXpvbnRhbCAoMykiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIzIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJSaWdodCBzdGljayB2ZXJ0aWNhbCAoNCkiLAogICAgICAgICAgICAgICAgdmFsdWU6ICI0IiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgICAgfSwKICAgICAgICAgIGF4ZXNHcm91cE1lbnU6IHsKICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLAogICAgICAgICAgICBpdGVtczogWwogICAgICAgICAgICAgIC8vIEJhc2VkIG9uIGFuIFhib3ggY29udHJvbGxlcgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJMZWZ0IHN0aWNrICgxICYgMikiLAogICAgICAgICAgICAgICAgdmFsdWU6ICIxIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICJSaWdodCBzdGljayAoMyAmIDQpIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiMyIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICAgIH0sCiAgICAgICAgICAvKgogICAgICAgICAgcHJlc3NSZWxlYXNlTWVudTogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGV4dDogJ3ByZXNzJywKICAgICAgICAgICAgICB2YWx1ZTogMQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGV4dDogJ3JlbGVhc2UnLAogICAgICAgICAgICAgIHZhbHVlOiAwCiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICAqLwogICAgICAgIH0sCiAgICAgIH07CiAgICB9CgogICAgZ2FtZXBhZENvbm5lY3RlZCh7IHBhZCB9KSB7CiAgICAgIHJldHVybiBnZXRHYW1lcGFkcyhwYWQpLmxlbmd0aCA+IDA7CiAgICB9CgogICAgZ2FtZXBhZERldGFpbCAoe2QsIGl9KSB7CiAgICAgIGZvciAoY29uc3QgZ2FtZXBhZCBvZiBnZXRHYW1lcGFkcyhpKSkgewogICAgICAgIHN3aXRjaCAoZCkgewogICAgICAgICAgY2FzZSAnbWFwcGluZyc6IHJldHVybiBnYW1lcGFkLm1hcHBpbmc7CiAgICAgICAgICBjYXNlICd2ZW5kb3InOiByZXR1cm4gbWF0Y2hWZW5kb3IoZ2FtZXBhZC5pZCk7CiAgICAgICAgICBjYXNlICdwcm9kdWN0JzogcmV0dXJuIG1hdGNoUHJvZHVjdChnYW1lcGFkLmlkKTsKICAgICAgICAgIGNhc2UgJ2lkJzogcmV0dXJuIGdhbWVwYWQuaWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAnbm90IGNvbm5lY3RlZCc7CiAgICB9CiAgICAgIAogICAgYnV0dG9uRG93bih7IGIsIGkgfSkgewogICAgICBmb3IgKGNvbnN0IGdhbWVwYWQgb2YgZ2V0R2FtZXBhZHMoaSkpIHsKICAgICAgICBpZiAoaXNCdXR0b25QcmVzc2VkKGdhbWVwYWQsIGIpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGJ1dHRvblZhbHVlKHsgYiwgaSB9KSB7CiAgICAgIGxldCBncmVhdGVzdEJ1dHRvbiA9IDA7CiAgICAgIGZvciAoY29uc3QgZ2FtZXBhZCBvZiBnZXRHYW1lcGFkcyhpKSkgewogICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0QnV0dG9uVmFsdWUoZ2FtZXBhZCwgYik7CiAgICAgICAgaWYgKHZhbHVlID4gZ3JlYXRlc3RCdXR0b24pIHsKICAgICAgICAgIGdyZWF0ZXN0QnV0dG9uID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBncmVhdGVzdEJ1dHRvbjsKICAgIH0KCiAgICBheGlzVmFsdWUoeyBiLCBpIH0pIHsKICAgICAgbGV0IGdyZWF0ZXN0QXhpcyA9IDA7CiAgICAgIGZvciAoY29uc3QgZ2FtZXBhZCBvZiBnZXRHYW1lcGFkcyhpKSkgewogICAgICAgIGNvbnN0IGF4aXMgPSBnZXRBeGlzVmFsdWUoZ2FtZXBhZCwgYik7CiAgICAgICAgaWYgKE1hdGguYWJzKGF4aXMpID4gTWF0aC5hYnMoZ3JlYXRlc3RBeGlzKSkgewogICAgICAgICAgZ3JlYXRlc3RBeGlzID0gYXhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGdyZWF0ZXN0QXhpczsKICAgIH0KCiAgICBheGlzRGlyZWN0aW9uKHsgYXhpcywgcGFkIH0pIHsKICAgICAgbGV0IGdyZWF0ZXN0TWFnbml0dWRlID0gMDsKICAgICAgbGV0IGRpcmVjdGlvbiA9IDkwOwogICAgICBmb3IgKGNvbnN0IGdhbWVwYWQgb2YgZ2V0R2FtZXBhZHMocGFkKSkgewogICAgICAgIGNvbnN0IGhvcml6b250YWxBeGlzID0gZ2V0QXhpc1ZhbHVlKGdhbWVwYWQsIGF4aXMpOwogICAgICAgIGNvbnN0IHZlcnRpY2FsQXhpcyA9IGdldEF4aXNWYWx1ZShnYW1lcGFkLCArYXhpcyArIDEpOwogICAgICAgIGNvbnN0IG1hZ25pdHVkZSA9IE1hdGguc3FydChob3Jpem9udGFsQXhpcyAqKiAyICsgdmVydGljYWxBeGlzICoqIDIpOwogICAgICAgIGlmIChtYWduaXR1ZGUgPiBncmVhdGVzdE1hZ25pdHVkZSkgewogICAgICAgICAgZ3JlYXRlc3RNYWduaXR1ZGUgPSBtYWduaXR1ZGU7CiAgICAgICAgICBkaXJlY3Rpb24gPQogICAgICAgICAgICAoTWF0aC5hdGFuMih2ZXJ0aWNhbEF4aXMsIGhvcml6b250YWxBeGlzKSAqIDE4MCkgLyBNYXRoLlBJICsgOTA7CiAgICAgICAgICBpZiAoZGlyZWN0aW9uIDwgMCkgewogICAgICAgICAgICBkaXJlY3Rpb24gKz0gMzYwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZGlyZWN0aW9uOwogICAgfQoKICAgIGF4aXNNYWduaXR1ZGUoeyBheGlzLCBwYWQgfSkgewogICAgICBsZXQgZ3JlYXRlc3RNYWduaXR1ZGUgPSAwOwogICAgICBmb3IgKGNvbnN0IGdhbWVwYWQgb2YgZ2V0R2FtZXBhZHMocGFkKSkgewogICAgICAgIGNvbnN0IGhvcml6b250YWxBeGlzID0gZ2V0QXhpc1ZhbHVlKGdhbWVwYWQsIGF4aXMpOwogICAgICAgIGNvbnN0IHZlcnRpY2FsQXhpcyA9IGdldEF4aXNWYWx1ZShnYW1lcGFkLCArYXhpcyArIDEpOwogICAgICAgIGNvbnN0IG1hZ25pdHVkZSA9IE1hdGguc3FydChob3Jpem9udGFsQXhpcyAqKiAyICsgdmVydGljYWxBeGlzICoqIDIpOwogICAgICAgIGlmIChtYWduaXR1ZGUgPiBncmVhdGVzdE1hZ25pdHVkZSkgewogICAgICAgICAgZ3JlYXRlc3RNYWduaXR1ZGUgPSBtYWduaXR1ZGU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBncmVhdGVzdE1hZ25pdHVkZTsKICAgIH0KCiAgICBydW1ibGUoeyBzLCB3LCB0LCBpIH0pIHsKICAgICAgY29uc3QgZ2FtZXBhZHMgPSBnZXRHYW1lcGFkcyhpKTsKICAgICAgZm9yIChjb25zdCBnYW1lcGFkIG9mIGdhbWVwYWRzKSB7CiAgICAgICAgLy8gQHRzLWlnbm9yZQogICAgICAgIGlmIChnYW1lcGFkLnZpYnJhdGlvbkFjdHVhdG9yKSB7CiAgICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgICBnYW1lcGFkLnZpYnJhdGlvbkFjdHVhdG9yLnBsYXlFZmZlY3QoImR1YWwtcnVtYmxlIiwgewogICAgICAgICAgICBzdGFydERlbGF5OiAwLAogICAgICAgICAgICBkdXJhdGlvbjogdCAqIDEwMDAsCiAgICAgICAgICAgIHdlYWtNYWduaXR1ZGU6IHcsCiAgICAgICAgICAgIHN0cm9uZ01hZ25pdHVkZTogcywKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSAKCiAgICBkZWFkem9uZSh7IGkgfSkgewogICAgICBBWElTX0RFQURaT05FID0gaTsKICAgIH0KCiAgICBkZWFkem9uZUJ1dHRvbih7IGkgfSkgewogICAgICBCVVRUT05fREVBRFpPTkUgPSBpOwogICAgfQoKICAgIGdldGRlYWR6b25lKHsgaSB9KSB7CiAgICAgIHJldHVybiBBWElTX0RFQURaT05FOwogICAgfQoKICAgIGdldGRlYWR6b25lQnV0dG9uKHsgaSB9KSB7CiAgICAgIHJldHVybiBCVVRUT05fREVBRFpPTkU7CiAgICB9CiAgfQoKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIobmV3IEdhbWVwYWRFeHRlbnNpb24oKSk7Cn0pKFNjcmF0Y2gpOwo="],"bakeExtensions":true,"maxTextureDimension":2048}